<nz-affix [nzOffsetTop]="globals.prop.MENU_LV2" class="btn-affix">
  <div class="btn-group">
    <a type="button" class="btn btn-sub" (click)="back()">
      <i class="fa fa-arrow-left"></i>
      <span>Quay lại</span>
    </a>
    <button type="button" class="btn btn-sub xanh-nhat" *ngIf="formData.value.trangThai != STATUS.DA_KY"
            (click)="approve()">
      <i class="icon htvbdh_tcdt_pheduyet"></i>
      <span>Ký</span>
    </button>
    <button type="button" class="btn btn-sub xanh" *ngIf="formData.value.trangThai != STATUS.DA_KY"
            (click)="save()">
      <i class="icon  htvbdh_tcdt_save"></i>
      <span>Lưu</span>
    </button>
  </div>
</nz-affix>

<div class="bg-trang">
  <div class="header header-green-background">
    <div class="header-text">
      <div class="title-chi-tieu">
        <span
          [ngClass]="formData.value.trangThai == STATUS.DA_KY ? 'status-xanh' : 'status-do' ">{{formData.value.tenTrangThai}}</span>
        <span class="title-form">{{title}}</span>
      </div>
    </div>
  </div>

  <nz-card class="mg-t-16 flex-card p-lr16">

    <!-- START THONG TIN CHUNG -->
    <nz-collapse nzAccordion>
      <nz-collapse-panel nzHeader="THÔNG TIN CHUNG" [nzActive]="true">
        <form [nzLayout]="'vertical'" nz-form [formGroup]="formData">
          <div nz-row [nzGutter]="[16, 8]">
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true"> Số biên bản</nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <input nz-input formControlName="soBienBan" [readonly]="true"/>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true"> Ngày lập biên bản</nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-date-picker formControlName="ngayLapBb" [nzFormat]="globals.dateFormat"
                                  [nzDisabled]="isDisable"></nz-date-picker>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Số hồ sơ kỹ thuật
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <input nz-input formControlName="soHskt" [readonly]="true"/>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">Đơn vị nhập hồ sơ kỹ thuật
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <input nz-input formControlName="tenDviNhapHskt" [readonly]="true"/>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true"> Ngày tạo hồ sơ kỹ thuật</nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-date-picker formControlName="ngayTaoHskt" [nzFormat]="globals.dateFormat"></nz-date-picker>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Số biên bản lấy mẫu/bàn giao mẫu
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <input nz-input formControlName="soBbLayMau" [readonly]="true"/>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true">
                  Số quyết định giao nhiệm vụ nhập hàng
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <input nz-input formControlName="soQdGiaoNvNh" [readonly]="true"/>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true"> Ngày ký quyết định</nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-date-picker formControlName="ngayLapBb" [nzFormat]="globals.dateFormat"></nz-date-picker>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true">
                  Đơn vị cung cấp hàng
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <input nz-input [readonly]="true"/>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Ngày kiểm tra hồ sơ kỹ thuật
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <nz-date-picker nzDisabled [nzFormat]="globals.dateFormat" formControlName="tgianKtra">
                    </nz-date-picker>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="8">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Địa điểm kiểm tra
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <input nz-input formControlName="diaDiemKtra" readonly/>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="24">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzSpan="24">
                  Căn cứ pháp lý
                </nz-form-label>
              </nz-form-item>
              <nz-form-item>
                <div class="list-file" nz-col nzSpan="24">
                  <file-list [data]="listCanCu" [isViewDetail]="isDisable"></file-list>
                </div>
              </nz-form-item>
            </div>
          </div>
        </form>
      </nz-collapse-panel>
    </nz-collapse>

    <!-- START THANH PHAN KIEM TRA -->
    <nz-collapse nzAccordion>
      <nz-collapse-panel nzHeader="THÀNH PHẦN KIỂM TRA" [nzActive]="true">
        <nz-table class="nowrap pd-10" #basicTable [nzData]="viewTableDaiDien" nzBordered>
          <thead>
          <tr>
            <th class="text-center" nzWidth="50px">STT</th>
            <th>Họ và tên</th>
            <th nzWidth="300px">Đại diện</th>
            <th nzWidth="100px"></th>
          </tr>
          <tr>
            <th></th>
            <th><input nz-input [(ngModel)]="daiDienRow.ten"/></th>
            <th>
              <nz-select [(ngModel)]="daiDienRow.loai">
                <nz-option nzValue="Đại diện Cục Dự trữ Nhà nước" nzLabel="Đại diện Cục Dự trữ Nhà nước"></nz-option>
                <nz-option nzValue="Đại diện Chi cục Dự trữ Nhà nước"
                           nzLabel="Đại diện Chi cục Dự trữ Nhà nước"></nz-option>
                <nz-option nzValue="Đại diện đơn vị cung cấp" nzLabel="Đại diện đơn vị cung cấp"></nz-option>
              </nz-select>
            </th>
            <th>
              <a (click)="themDaiDien()">
                <i class="fa fa-plus"></i>
              </a>
              <a (click)="nhapLaiDaiDien()">
                <i class="fa fa-refresh"></i>
              </a>
            </th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of basicTable.data;let i = index">
            <ng-container *ngIf="!data.edit">
              <td class="text-center">{{i + 1}}</td>
              <td>{{data.ten}}</td>
              <td>{{data.loai}}</td>
              <td>
                <a (click)="suaDaiDien(data)">
                  <i class="fa fa-edit"></i>
                </a>
                <a>
                  <i class="fa fa-trash-o do" nz-popconfirm nz-button
                     nzPopconfirmTitle="Bạn có chắc muốn xóa ?"
                     (nzOnConfirm)="xoaDaiDien(data)"></i>
                </a>
              </td>
            </ng-container>
            <ng-container *ngIf="data.edit">
              <td class="text-center">{{i + 1}}</td>
              <td><input nz-input [(ngModel)]="data.ten"/></td>
              <td>
                <nz-select [(ngModel)]="data.loai">
                  <nz-option nzValue="Đại diện Cục Dự trữ Nhà nước" nzLabel="Đại diện Cục Dự trữ Nhà nước"></nz-option>
                  <nz-option nzValue="Đại diện Chi cục Dự trữ Nhà nước"
                             nzLabel="Đại diện Chi cục Dự trữ Nhà nước"></nz-option>
                  <nz-option nzValue="Đại diện đơn vị cung cấp" nzLabel="Đại diện đơn vị cung cấp"></nz-option>
                </nz-select>
              </td>
              <td>
                <a>
                  <i class="fa fa-save" nz-popconfirm nz-button
                     nzPopconfirmTitle="Bạn có chắc muốn lưu thay đổi ?"
                     (nzOnConfirm)="luuDaiDien(data)"></i>
                </a>
                <a (click)="huySuaDaiDien()">
                  <i class="fa fa-ban do"></i>
                </a>
              </td>
            </ng-container>
          </tr>
          </tbody>
        </nz-table>
      </nz-collapse-panel>
    </nz-collapse>

    <!-- START NOI DUNG KIEM TRA -->
    <nz-collapse nzAccordion>
      <nz-collapse-panel nzHeader="NỘI DUNG KIỂM TRA" [nzActive]="true">
        <form [nzLayout]="'vertical'" nz-form [formGroup]="formData">
          <div nz-row [nzGutter]="[16, 8]">
            <div nz-col nzSpan="6">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Loại hàng hoá
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <input nz-input formControlName="tenLoaiVthh" readonly/>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="6">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Chủng loại hàng hóa
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <input nz-input formControlName="tenCloaiVthh" readonly/>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="6">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Tên hàng hoá
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <input nz-input formControlName="tenVthh" readonly/>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Số lượng thực nhập
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <input nz-input formControlName="soLuongNhap" readonly/>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="4">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Thời gian nhập
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <nz-date-picker nzDisabled [nzFormat]="globals.dateFormat" formControlName="tgianNhap"></nz-date-picker>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </form>
        <div class="pd-10"><strong>Các văn bản, tài liệu kỹ thuật đã kiểm tra</strong></div>
        <nz-table class="nowrap pd-10" #tblHoSo [nzData]="viewTableHoSo" nzBordered>
          <thead>
          <tr>
            <th class="text-center" nzWidth="50px">STT</th>
            <th>Tên hồ sơ, tài liệu</th>
            <th>Loại tài liệu</th>
            <th>Số lượng</th>
            <th>Ghi chú</th>
            <th>File đính kèm</th>
            <th nzWidth="100px" class="text-center">Trạng thái kiểm tra</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of tblHoSo.data;let i = index">
            <ng-container>
              <td class="text-center">{{i + 1}}</td>
              <td>{{data.ten}}</td>
              <td>{{data.loai}}</td>
              <td>{{data.soLuong}}</td>
              <td>{{data.ghiChu}}</td>
              <td>
                <a nz-button nzType="link"
                   (click)="downloadFile(data.fileDinhKem[0])">
                  {{(data.fileDinhKem && data.fileDinhKem.length > 0) ? data.fileDinhKem[0].fileName : null}}
                </a>
              </td>
              <td class="text-center"><label nz-checkbox [(ngModel)]="data.trangThai" disabled="true"></label></td>
            </ng-container>
          </tr>
          </tbody>
        </nz-table>
        <div>
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> File đính kèm</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <div class="list-file">
                <nz-input-group nzSize="small" [nzSuffix]="suffixTemplateInfo">
                  <input type="text" [ngModel]="formData.value.fileDinhKem[0]?.fileName" nz-input/>
                </nz-input-group>
                <ng-template #suffixTemplateInfo>
                  <div class="icon-file-dinh-kem">
                    <i class="icon htvbdh_tcdt_tep"></i>
                    <input class="input-file" (change)="getNameFile($event)" type="file"/>
                  </div>
                </ng-template>
              </div>
            </nz-form-control>
          </nz-form-item>
        </div>
      </nz-collapse-panel>
    </nz-collapse>

    <!-- START KET LUAT -->
    <nz-collapse nzAccordion>
      <nz-collapse-panel nzHeader="KẾT LUẬN" [nzActive]="true">
        <form [nzLayout]="'vertical'" nz-form [formGroup]="formData">
          <div nz-row [nzGutter]="[16, 8]">
            <div nz-col nzSpan="24">
              <nz-form-item class="d-flex flex-column">
                <nz-form-label [nzNoColon]="true" class="d-flex">
                  Kết luận
                </nz-form-label>
                <textarea nz-input [rows]="3" formControlName="ketLuan" placeholder="Nhập nội dung kết luận"></textarea>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true"> Chọn văn bản, tài liệu bổ sung (nếu có)</nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <div class="list-file" nz-col nzSpan="24">
                    <file-list [data]="listVanBanBsung" [isViewDetail]="isDisable"></file-list>
                  </div>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="8">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true">
                  Thời gian bổ sung chậm nhất trước ngày
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group>
                    <nz-date-picker [nzFormat]="globals.dateFormat" formControlName="tgianBsung">
                    </nz-date-picker>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </form>
      </nz-collapse-panel>
    </nz-collapse>
  </nz-card>
</div>
<ng-template #error let-control>
  <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}</ng-container>
</ng-template>
