<nz-affix [nzOffsetTop]="globals.prop.MENU_LV2" class="btn-affix">
  <div class="btn-group">
    <button type="button" class="btn btn-sub" (click)="goBack()">
      <i class="fa fa-arrow-left"></i>
      <span>Quay lại</span>
    </button>
    <button *ngIf="idInput" type="button" class="btn btn-sub" (click)="preview()">
      <i class="icon htvbdh_totrinh"></i>
      <span> Xem trước </span>
    </button>
    <button *ngIf="this.userService.isCuc() && formData.value.trangThai != STATUS.DA_HOAN_THANH" type="button"
            class="btn btn-sub xanh-nhat" (click)="hoanThanhCapNhat()">
      <i class="icon htvbdh_tcdt_guiduyet"></i>
      <span>Kết thúc đấu giá</span>
    </button>
  </div>
</nz-affix>
<div class="bg-trang">
  <div class="header header-green-background">
    <div class="header-text">
      <div class="title-chi-tieu">
        <span [ngClass]="formData.value.trangThai == STATUS.DA_HOAN_THANH ? 'status-xanh' : 'status-do'">
          {{ formData.value.tenTrangThai }}
        </span>
        <span> QUẢN LÝ THÔNG TIN ĐẤU GIÁ </span>
      </div>
    </div>
  </div>
  <nz-card class="mg-t-16 flex-card p-lr16">
    <nz-collapse>
      <nz-collapse-panel nzActive="true" nzHeader="THÔNG TIN CHUNG">
        <form nzLayout="horizontal" [formGroup]="formData" nz-form>
          <div nz-row [nzGutter]="24">
            <div nz-col [nzSpan]="8">
              <div nz-row [nzGutter]="24" class="label-50 mg-t-10 border-right">
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Năm kế hoạch</nz-form-label>
                    <nz-form-control>
                      <input nz-input formControlName="nam" readonly/>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Số QĐ phê duyệt KH BĐG</nz-form-label>
                    <nz-form-control>
                      <input nz-input formControlName="soQdPd" readonly/>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Số QĐ phê duyệt KQ BĐG</nz-form-label>
                    <nz-form-control>
                      <input nz-input formControlName="soQdPdKqBdg" readonly/>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Đơn vị thực hiện (đơn vị có tài sản ĐG)</nz-form-label>
                    <nz-form-control>
                      <input nz-input formControlName="tenDvi" readonly/>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Tổng khoản tiền đặt trước</nz-form-label>
                    <nz-form-control>
                      <nz-input-number formControlName="tongTienDatTruoc" [nzFormatter]="formatterTien"
                                       [nzParser]="globals.parser" nzDisabled class="blue-text">
                      </nz-input-number>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> % Khoản tiền đặt trước</nz-form-label>
                    <nz-form-control>
                      <nz-input-group>
                        <input nz-input formControlName="khoanTienDatTruocHienThi" readonly />
                      </nz-input-group>
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>
            </div>
            <div nz-col [nzSpan]="8">
              <div nz-row [nzGutter]="24" class="label-50 mg-t-10 border-right">
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Thời gian dự kiến tổ chức bán đấu giá
                    </nz-form-label>
                    <nz-form-control>
                      <input nz-input formControlName="tgianDauGia" nzFormat="dd/MM/yyyy" readonly/>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Thời hạn thanh toán
                    </nz-form-label>
                    <nz-form-control>
                      <nz-input-group>
                        <input nz-input formControlName="tgianTtoan" readonly/>
                      </nz-input-group>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Phương thức thanh toán</nz-form-label>
                    <nz-form-control>
                      <nz-input-group>
                        <input nz-input formControlName="tenPthucTtoan" readonly/>
                      </nz-input-group>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Thời hạn giao nhận hàng</nz-form-label>
                    <nz-form-control>
                      <nz-input-group>
                        <input nz-input formControlName="tgianGnhan" readonly/>
                      </nz-input-group>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Phương thức giao nhận</nz-form-label>
                    <nz-form-control>
                      <nz-input-group>
                        <input nz-input formControlName="pthucGnhan" readonly/>
                      </nz-input-group>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Tổng khoản tiền đặt trước theo đơn giá được duyệt</nz-form-label>
                    <nz-form-control>
                      <nz-input-number formControlName="tongTienDatTruocDd" [nzFormatter]="formatterTien"
                                       [nzParser]="globals.parser" nzDisabled class="blue-text">
                      </nz-input-number>
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>
            </div>
            <div nz-col [nzSpan]="8">
              <div nz-row [nzGutter]="24" class="label-50 mg-t-10 ">
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Loại hàng DTQG</nz-form-label>
                    <nz-form-control>
                      <input style="color: blue ;font-weight: bold;" nz-input formControlName="tenLoaiVthh"
                             readonly="true"/>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Chủng loại hàng DTQG</nz-form-label>
                    <nz-form-control>
                      <input style="color: blue ;font-weight: bold;" nz-input formControlName="tenCloaiVthh"
                             readonly="true"/>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true">  Tổng số lượng xuất bán</nz-form-label>
                    <nz-form-control>
                      <nz-input-number formControlName="tongSoLuong" [nzFormatter]="formatterSoLuong"
                                       [nzParser]="globals.parser" nzDisabled class="blue-text">
                      </nz-input-number>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Loại hình nhập xuất</nz-form-label>
                    <nz-form-control>
                      <nz-input-group>
                        <input nz-input formControlName="tenLoaiHinhNx" readonly/>
                      </nz-input-group>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="24">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Kiểu nhập xuất</nz-form-label>
                    <nz-form-control>
                      <nz-input-group>
                        <input nz-input formControlName="tenKieuNx" readonly/>
                      </nz-input-group>
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>
            </div>
          </div>
        </form>
      </nz-collapse-panel>
    </nz-collapse>
    <nz-collapse>
      <nz-collapse-panel nzActive="true" [nzExtra]="tmpThemMoiPhienDauGia"
                         nzHeader="THÔNG TIN CÁC LẦN THỰC HIỆN ĐẤU GIÁ">
        <ng-template #tmpThemMoiPhienDauGia>
          <div class="buttons"
               *ngIf="this.userService.isCuc() && formData.value.trangThai != STATUS.DA_HOAN_THANH">
            <button style="background: #353a64;" type="button" class="btn btn-main"
                    (click)="themMoiPhienDauGia($event, false)">
              <i class="icon htvbdh_dau-cong"></i>
              <span>Thêm</span>
            </button>
          </div>
        </ng-template>
        <nz-table class="pd-10" nzBordered [nzData]="dataTable" [nzFrontPagination]="false" [nzShowPagination]="false">
          <thead>
          <tr>
            <th width="">Số QĐ PD KH BĐG/Số QĐ ĐC KH BĐG</th>
            <th width="">Lần đấu giá</th>
            <th width="">Tổng sô ĐVTS cần đấu giá</th>
            <th width="">Thông báo bán đấu giá</th>
            <th width="">Tổ chức thực hiện dịch vụ BĐG</th>
            <th width="">Thời gian tổ chức cuộc đấu giá</th>
            <th width="">Địa điểm tổ chức</th>
            <th width="">Kết quả đấu giá</th>
            <th width="">SL đơn vị TS</th>
            <th width="">Trạng thái</th>
            <th width="">Hành động</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of dataTable; let i = index" [ngClass]="{'bg-selected': i == 0 && this.selected}"
              (click)="showDetail($event,data)">
            <td>{{ data.soQdDc == null ? data.soQdPd : data.soQdDc }}</td>
            <td>{{ data.lanDauGia }}</td>
            <td>{{ data.soDviTsan }}</td>
            <td>{{ data.maThongBao }}</td>
            <td>{{ data.tenToChuc }}</td>
            <td>{{ data.tgianDauGiaTu | date: 'dd/MM/YYYY' }}
              đến {{ data.tgianDauGiaDen | date: 'dd/MM/YYYY' }}</td>
            <td>{{ data.diaDiemDauGia }}</td>
            <td>{{ data.ketQua == 1 ? 'Đấu giá thành công' : 'Đấu giá không thành' }}</td>
            <td>{{ data.ketQuaSl }}</td>
            <td>{{ data.tenTrangThai}}</td>
            <td class="text-center">
              <a *ngIf="data.trangThai == STATUS.DA_HOAN_THANH"
                 (click)="themMoiPhienDauGia($event,true,data)">
                <i class="fa fa-eye" title="Xem chi tiết"></i>
              </a>
              <a *ngIf="data.trangThai == STATUS.DANG_THUC_HIEN && userService.isCuc()"
                 (click)="themMoiPhienDauGia($event,false,data)">
                <i class="fa fa-pencil" title="Sửa"></i>
              </a>
              <a *ngIf="data.trangThai == STATUS.DANG_THUC_HIEN && userService.isCuc()"
                 (click)="deleteThongTin(data)">
                <i class="fa fa-trash do"></i>
              </a>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </nz-collapse-panel>
    </nz-collapse>
    <app-thongtin-daugia *ngIf="dataThongTin" [dataThongTin]="dataThongTin" [isView]="true"
                         [isModal]="true"></app-thongtin-daugia>
  </nz-card>
</div>
<ng-template #error let-control>
  <app-template-error #error [control]="control"></app-template-error>
</ng-template>
<nz-modal [nzWidth]="'75%'" [nzClosable]="false" [(nzVisible)]="showDlgPreview"
          nzTitle="THÔNG TIN ĐỀ XUẤT KẾ HOẠCH KẾT QUẢ LỰA CHỌN NHÀ THẦU" nzWidth="100%" (nzOnCancel)="closeDlg()">
  <div *nzModalContent class="modal__content">
    <pdf-viewer [src]="pdfSrc" [render-text]="true" style="width: 100%; height: 600px;"></pdf-viewer>
  </div>
  <div *nzModalFooter>
    <button nz-button (click)="downloadPdf('Thông tin đấu giá')" class="modal__button--save">
      <i class="icon htvbdh_file-pdf"></i>
      Xuất .pdf
    </button>
    <button nz-button (click)="downloadWord('Thông tin đấu giá')" class="modal__button--save">
      <i class="icon htvbdh_file-word"></i>
      Xuất .docx
    </button>
    <button nz-button (click)="closeDlg()" class="modal__button--cancel">
      <i nz-icon nzType="close-circle" nzTheme="fill" class="icon-cancel"></i>
      Đóng
    </button>
  </div>
</nz-modal>
