<div class="header header-green-background mg-t-10">
    <div class="header-text">
        <div class="title-chi-tieu">
            <span>
            </span>
            <span> {{title}} </span>
        </div>
    </div>
</div>
<!--START NỘI DUNG-->
<form nzLayout="vertical" nz-form [formGroup]="formData">
    <div nz-row [nzGutter]="[12]">
        <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Căn cứ </nz-form-label>
                <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfterIcon="folder-open">
                        <input [readonly]="true" nz-input formControlName="soQdCc" readonly="true" />
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]=12>
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Loại hàng hóa </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfterIcon="folder-open">
                        <input [readonly]="true" nz-input formControlName="tenLoaiVthh" readonly="true" />
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true">Tiêu chuẩn chất lượng </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <input nz-input formControlName="tchuanCluong" [readonly]="true" />
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Loại hợp đồng </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-select formControlName="loaiHdong" [nzDisabled]="isView">
                        <nz-option *ngFor="let p of listLoaiHopDong" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                        </nz-option>
                    </nz-select>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Hình thức lựa chọn nhà thầu </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-select formControlName="hthucLcnt" [nzDisabled]="isView">
                        <nz-option *ngFor="let p of listHinhThucDauThau" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                        </nz-option>
                    </nz-select>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Phương thức lựa chọn nhà thầu </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-select formControlName="pthucLcnt" [nzDisabled]="isView">
                        <nz-option *ngFor="let p of listPhuongThucDauThau" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                        </nz-option>
                    </nz-select>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Thời gian bắt đầu tổ chức LCNT (Thời gian phát hành
                    HSMT) </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-date-picker formControlName="tgianBdauTchuc" nzFormat="dd/MM/yyyy" [nzDisabled]="isView">
                    </nz-date-picker>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Thời gian mở thầu</nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group>
                        <nz-date-picker [nzShowTime]="{ nzFormat: 'HH:mm' }" formControlName="tgianMthau"
                            nzFormat="HH:mm dd/MM/yyyy" [nzDisabled]="isView">
                        </nz-date-picker>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Thời gian đóng thầu </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-date-picker [nzShowTime]="{ nzFormat: 'HH:mm' }" formControlName="tgianDthau"
                        nzFormat="HH:mm dd/MM/yyyy" [nzDisabled]="isView">
                    </nz-date-picker>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]=" true"> Thời gian thực dự án (ngày) </nz-form-label>
                <nz-form-control nz-col [nzSpan]="24">
                    <nz-input-number formControlName="tgianThien" nz-input [nzMin]="1" [nzMax]="globals.prop.MAX_INPUT"
                        [nzStep]="1" [nzSize]="'small'" [nzDisabled]="isView">
                    </nz-input-number>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Giá trị bảo đảm dự thầu (%) </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="%">
                        <nz-input-number formControlName="gtriDthau" nz-input [nzMin]="1"
                            [nzMax]="globals.prop.MAX_INPUT" [nzStep]="1" [nzSize]="'small'" [nzDisabled]="isView">
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="5">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Giá trị bảo đảm thực hiện hợp đồng (%)
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="%">
                        <nz-input-number formControlName="gtriHdong" nz-input [nzMin]="1"
                            [nzMax]="globals.prop.MAX_INPUT" [nzStep]="1" [nzSize]="'small'" [nzDisabled]="isView">
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="1">
            <nz-form-item>
                <nz-form-label [nzNoColon]="true"> </nz-form-label>
                <nz-form-control class="text-center">
                    <i class="icon htvbdh_tcdt_lien-ket icon-lien-ket"></i>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label [nzNoColon]="true"></nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="đ">
                        <nz-input-number
                            [ngModel]="formData.value.tongMucDt + ( formData.value.tongMucDt * formData.value.gtriHdong / 100 )"
                            [ngModelOptions]="{standalone: true}" nz-input [nzMin]="1" [nzMax]="globals.prop.MAX_INPUT"
                            [nzStep]="1" [nzSize]="'small'" nzDisabled [nzFormatter]="globals.formatter"
                            [nzParser]="globals.parser">
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Thuế VAT
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="%">
                        <nz-input-number formControlName="vat" nz-input [nzSize]="'small'" nzDisabled>
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Tên cơ quan đơn vị </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group>
                        <input nz-input readonly formControlName="tenDvi" />
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Tổng mức đầu tư theo đơn giá đã duyệt </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="đ">
                        <nz-input-number class="text-right" nz-input formControlName="tongMucDt" [nzMin]="1"
                            [nzMax]="globals.prop.MAX_INPUT" [nzStep]="1" [nzSize]="'small'"
                            [nzFormatter]="globals.formatter" [nzParser]="globals.parser" nzDisabled>
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true">Nguồn vốn</nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-select formControlName="nguonVon" [nzDisabled]="isView">
                        <nz-option *ngFor="let p of listNguonVon" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                        </nz-option>
                    </nz-select>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
            <nz-form-item>
                <nz-form-label [nzNoColon]="true"> Địa điểm quy mô dự án </nz-form-label>
                <textarea rows="3" nz-input formControlName="dienGiai" [readonly]="isView"></textarea>
            </nz-form-item>
        </div>
    </div>
</form>
<!--END NỘI DUNG-->

<!--START TABLE-->
<div class="header header-green-background mg-t-10">
    <div class="header-text">
        <div class="title-chi-tieu">
            <span>
            </span>
            <span> Địa điểm nhập hàng </span>
        </div>
    </div>
</div>
<nz-card class="flex-card p-lr16 card-table">
    <nz-table [nzData]="dataTable" class="nowrap pd-10" nzBordered>
        <thead>
            <tr>
                <th style="width: 2%;"></th>
                <th>Tên gói thầu</th>
                <th>Chủng loại hàng hóa</th>
                <th>Cục DTNN KV</th>
                <th>Chi cục DTNN KV</th>
                <th>Điểm kho</th>
                <th>SL theo chỉ tiêu theo kế hoạch</th>
                <th>SL theo KH năm đã được duyệt</th>
                <th>Số lượng</th>
                <th>Đơn vị tính</th>
                <th>Đơn giá đề xuất (đ)</th>
                <th>Đơn giá đã duyệt gồm VAT (đ)</th>
                <th>Tổng mức đầu tư(đ)</th>
                <th>Tổng mức đầu tư theo đơn giá đã duyệt(đ)</th>
                <th style="width: 5%;">Hành động</th>
            </tr>
        </thead>
        <tbody>
            <ng-container *ngFor="let item of dataTable , let i = index">
                <tr>
                    <td [nzExpand]="expandSet.has(i)" (nzExpandChange)="onExpandChange(i, $event)"></td>
                    <td>{{item.goiThau}}</td>
                    <td>{{item.tenCloaiVthh}}</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>{{item.soLuong | number : '1.0-1' : 'vi_VN'}}</td>
                    <td>{{item.dviTinh }}</td>
                    <td>{{item.donGiaTamTinh | number : '1.0-1' : 'vi_VN'}}</td>
                    <td>{{item.donGiaVat | number : '1.0-1' : 'vi_VN'}}</td>
                    <td>{{item.soLuong * item.donGiaTamTinh | number : '1.0-1' : 'vi_VN'}}</td>
                    <td>{{item.soLuong * item.donGiaVat | number : '1.0-1' : 'vi_VN'}}</td>
                    <td>
                        <!-- <a (click)="themMoiGoiThau(item,i)">
                            <i class="fa fa-pencil"></i>
                        </a>
                        <a (click)="deleteRow(i)">
                            <i class="fa fa-trash-o do"></i>
                        </a> -->
                    </td>
                </tr>
                <ng-container *ngIf="expandSet.has(i)">
                    <ng-container *ngFor="let cuc of item.children, let y = index">
                        <tr>
                            <td></td>
                            <td></td>
                            <td class="text-right" [nzExpand]="expandSet2.has(y)"
                                (nzExpandChange)="onExpandChange2(y, $event)">
                            </td>
                            <td>{{cuc.tenDvi}}</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>{{cuc.soLuong | number : '1.0-1' : 'vi_VN'}}</td>
                            <td>{{item.dviTinh }}</td>
                            <td>{{item.donGiaTamTinh | number : '1.0-1' : 'vi_VN'}}</td>
                            <td>{{item.donGiaVat | number : '1.0-1' : 'vi_VN'}}</td>
                            <td>{{cuc.soLuong * item.donGiaTamTinh | number : '1.0-1' : 'vi_VN'}}</td>
                            <td>{{cuc.soLuong * item.donGiaVat | number : '1.0-1' : 'vi_VN'}}</td>
                            <td class="text-right">
                            </td>
                        </tr>
                        <ng-container *ngIf="expandSet2.has(y)">
                            <ng-container *ngFor="let chiCuc of cuc.children, let z = index">
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right" [nzExpand]="expandSet3.has(z)"
                                        (nzExpandChange)="onExpandChange3(z, $event)">
                                    </td>
                                    <td>{{chiCuc.tenDvi}}</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>{{chiCuc.soLuong | number : '1.0-1' : 'vi_VN'}}</td>
                                    <td></td>
                                    <td>{{item.donGiaTamTinh | number : '1.0-1' : 'vi_VN'}}</td>
                                    <td>{{item.donGiaVat | number : '1.0-1' : 'vi_VN'}}</td>
                                    <td>{{chiCuc.soLuong * item.donGiaTamTinh | number : '1.0-1' : 'vi_VN'}}</td>
                                    <td>{{chiCuc.soLuong * item.donGiaVat | number : '1.0-1' : 'vi_VN'}}</td>
                                    <td class="text-right">
                                    </td>
                                </tr>
                                <ng-container *ngIf="expandSet3.has(z)">
                                    <tr *ngFor="let diemKho of chiCuc.children">
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>{{diemKho.tenDvi}}</td>
                                        <td></td>
                                        <td></td>
                                        <td>{{diemKho.soLuong | number : '1.0-1' : 'vi_VN'}}</td>
                                        <td></td>
                                        <td>{{item.donGiaTamTinh | number : '1.0-1' : 'vi_VN'}}</td>
                                        <td>{{item.donGiaVat | number : '1.0-1' : 'vi_VN'}}</td>
                                        <td>{{diemKho.soLuong * item.donGiaTamTinh | number : '1.0-1' : 'vi_VN'}}</td>
                                        <td>{{diemKho.soLuong * item.donGiaVat | number : '1.0-1' : 'vi_VN'}}</td>
                                        <td class="text-right">
                                        </td>
                                    </tr>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </ng-container>
        </tbody>
    </nz-table>
</nz-card>
<ng-template #error let-control>
    <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}</ng-container>
</ng-template>