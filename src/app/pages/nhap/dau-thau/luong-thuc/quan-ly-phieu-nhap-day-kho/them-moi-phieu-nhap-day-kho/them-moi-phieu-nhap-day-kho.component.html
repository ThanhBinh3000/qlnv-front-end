<div class="luong-thuc__danh-sach">
  <nz-affix class="menu-lv3" [nzOffsetTop]="43">
    <div class="tab-content tab-menu" id="myTabContent">
      <div
        class="tab-pane fade show active justify-content-between"
        id="banhanh"
        role="tabpanel"
        aria-labelledby="banhanh-tab"
      >
        <div class="trai">
          <a
            class="btn btn-outline-grey btn-sm waves-effect waves-light"
            (click)="back()"
          >
            <i class="fa fa-arrow-circle-left"></i>
          </a>
        </div>
        <div class="canphai phai">
          <button class="btn btn-main btn-sm waves-effect waves-light">
            <i class="icon htvbdh_tcdt_save"></i>
            <span>Lưu</span>
          </button>
          <button
            type="button"
            class="btn btn-outline-grey btn-sm waves-effect waves-light"
          >
            <i class="icon htvbdh_tcdt_print"></i>
            <span>In</span>
          </button>
          <button class="btn btn-outline-grey btn-sm waves-effect waves-light">
            <i class="icon htvbdh_trinh"></i>
            <span>Trình duyệt</span>
          </button>
          <button class="btn btn-outline-grey btn-sm waves-effect waves-light">
            <i class="icon htvbdh_da-xu-ly"></i>
            <span>Duyệt</span>
          </button>
          <button
            class="btn btn-outline-grey btn-sm waves-effect waves-light"
            (click)="tuChoi()"
          >
            <i class="icon htvbdh_tcdt_tuchoi"></i>
            <span>Từ chối</span>
          </button>
          <button class="btn btn-outline-grey btn-sm waves-effect waves-light">
            <i class="icon htvbdh_xemthem"></i>
            <span>Xem phiếu nhập</span>
          </button>
        </div>
      </div>
    </div>
  </nz-affix>
  <div class="contentBor chi-tieu__body">
    <div class="contentDetail">
      <div class="main-content">
        <nz-card
          nzTitle="THÔNG TIN CHUNG BIÊN BẢN NHẬP ĐẦY KHO"
          class="mt16 flex-card p-lr16"
        >
          <form nz-form [formGroup]="formData" class="mt-16">
            <div class="search__body" nz-row [nzGutter]="[18, 12]">
              <div nz-col nzSpan="6">
                <nz-form-item>
                  <nz-form-label
                    nz-col
                    [nzSpan]="24"
                    nzRequired
                    [nzNoColon]="true"
                  >
                    Số biên bản
                  </nz-form-label>
                  <nz-form-control
                    nz-col
                    [nzSpan]="24"
                    [nzErrorTip]="soBienBanError"
                  >
                    <input nz-input formControlName="soBienBan" />
                    <ng-template #soBienBanError let-control>
                      <ng-container *ngIf="control.hasError('required')">{{
                        errorInputRequired
                      }}</ng-container>
                    </ng-template>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="6">
                <nz-form-item>
                  <nz-form-label
                    nz-col
                    [nzSpan]="24"
                    nzRequired
                    [nzNoColon]="true"
                  >
                    Ngày lập
                  </nz-form-label>
                  <nz-form-control
                    nz-col
                    [nzSpan]="24"
                    [nzErrorTip]="ngayLapError"
                  >
                    <nz-date-picker
                      class="search__input"
                      nzFormat="yyyy-MM-dd"
                      formControlName="ngayLap"
                      nzPlaceHolder=" Ngày lập"
                    >
                    </nz-date-picker>
                    <ng-template #ngayLapError let-control>
                      <ng-container *ngIf="control.hasError('required')">{{
                        errorInputRequired
                      }}</ng-container>
                    </ng-template>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="12">
                <nz-form-item>
                  <nz-form-label
                    nz-col
                    [nzSpan]="24"
                    nzRequired
                    [nzNoColon]="true"
                  >
                    Đơn vị lập
                  </nz-form-label>
                  <nz-form-control
                    nz-col
                    [nzSpan]="24"
                    [nzErrorTip]="donViError"
                  >
                    <nz-input-group
                      nzSize="large"
                      [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input"
                    >
                      <input
                        placeholder="Đơn vị lập"
                        nz-input
                        formControlName="tenDonVi"
                        (input)="onInput($event)"
                        [nzAutocomplete]="auto"
                      />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #auto>
                      <nz-auto-option
                        *ngFor="let option of options"
                        [nzValue]="option.labelDonVi"
                        (click)="selectDonVi(option)"
                      >
                        {{ option.labelDonVi }}
                      </nz-auto-option>
                    </nz-autocomplete>
                    <ng-template #donViError let-control>
                      <ng-container *ngIf="control.hasError('required')">{{
                        errorInputRequired
                      }}</ng-container>
                    </ng-template>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="6">
                <nz-form-item>
                  <nz-form-label
                    nz-col
                    [nzSpan]="24"
                    nzRequired
                    [nzNoColon]="true"
                  >
                    Mã Kho / Ngăn / Lô
                  </nz-form-label>
                  <nz-form-control
                    nz-col
                    [nzSpan]="24"
                    [nzErrorTip]="maKhoError"
                  >
                    <nz-select
                      (ngModelChange)="selectNganLo($event)"
                      formControlName="maKho"
                    >
                      <nz-option
                        *ngFor="let nganLo of listNganLo"
                        [nzValue]="nganLo.maNganlo"
                        [nzLabel]="nganLo.tenNganlo"
                      >
                      </nz-option>
                    </nz-select>
                    <ng-template #maKhoError let-control>
                      <ng-container *ngIf="control.hasError('required')">{{
                        errorInputRequired
                      }}</ng-container>
                    </ng-template>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="12">
                <nz-form-item>
                  <nz-form-label
                    nz-col
                    [nzSpan]="24"
                    nzRequired
                    [nzNoColon]="true"
                  >
                    Hàng DTQG
                  </nz-form-label>
                  <nz-form-control
                    nz-col
                    [nzSpan]="24"
                    [nzErrorTip]="hangDTQGError"
                  >
                    <nz-select
                      (ngModelChange)="selectHangDTQG($event)"
                      formControlName="hangDTQG"
                    >
                      <nz-option
                        [nzValue]="thocIdDefault"
                        nzLabel="Thóc"
                      ></nz-option>
                      <nz-option
                        [nzValue]="gaoIdDefault"
                        nzLabel="Gạo"
                      ></nz-option>
                    </nz-select>
                    <ng-template #hangDTQGError let-control>
                      <ng-container *ngIf="control.hasError('required')">{{
                        errorInputRequired
                      }}</ng-container>
                    </ng-template>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="6"></div>
              <div nz-col nzSpan="6">
                <nz-form-item>
                  <nz-form-label [nzNoColon]="true">
                    Ngày bắt đầu nhập
                  </nz-form-label>
                  <nz-date-picker
                    class="search__input"
                    [nzDisabledDate]=""
                    nzFormat="yyyy-MM-dd"
                    nzPlaceHolder=" "
                  >
                  </nz-date-picker>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="6">
                <nz-form-item>
                  <nz-form-label [nzNoColon]="true">
                    Ngày kết thúc nhập
                  </nz-form-label>
                  <nz-date-picker
                    class="search__input"
                    [nzDisabledDate]=""
                    nzFormat="yyyy-MM-dd"
                    nzPlaceHolder=" "
                  >
                  </nz-date-picker>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="12"></div>
              <div nz-col nzSpan="6">
                <nz-form-item>
                  <nz-form-label nzRequired [nzNoColon]="true">
                    Thủ kho
                  </nz-form-label>
                  <input nz-input />
                </nz-form-item>
              </div>
              <div nz-col nzSpan="6">
                <nz-form-item>
                  <nz-form-label nzRequired [nzNoColon]="true">
                    Kỹ thuật viên đơn vị
                  </nz-form-label>
                  <input nz-input />
                </nz-form-item>
              </div>
              <div nz-col nzSpan="6">
                <nz-form-item>
                  <nz-form-label nzRequired [nzNoColon]="true">
                    Kế toán
                  </nz-form-label>
                  <input nz-input />
                </nz-form-item>
              </div>
              <div nz-col nzSpan="6">
                <nz-form-item>
                  <nz-form-label nzRequired [nzNoColon]="true">
                    Thủ trưởng đơn vị
                  </nz-form-label>
                  <input nz-input />
                </nz-form-item>
              </div>
            </div>
          </form>
        </nz-card>
        <div class="tab__luong-thuc mt-16" id="table-goi-thau">
          <nz-card
            nzTitle="BIÊN BẢN NHẬP ĐẦY KHO"
            class="mt16 flex-card p-lr16"
          >
            <nz-table
              #basicTable
              class="nowrap"
              [nzFrontPagination]="false"
              [nzShowPagination]="false"
              [nzData]="dataTable"
            >
              <thead>
                <tr>
                  <th width="100px">Số lượng</th>
                  <th width="150px">Đơn giá</th>
                  <th width="250px">Thành tiền</th>
                  <th>Ghi chú</th>
                  <th width="90px"></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <nz-input-number
                      [nzSize]="'small'"
                      nz-input
                      [(ngModel)]="itemRow.soLuong"
                      [nzMin]="0"
                    >
                    </nz-input-number>
                  </td>
                  <td>
                    <nz-input-number
                      [nzSize]="'small'"
                      nz-input
                      [(ngModel)]="itemRow.donGia"
                      [nzMin]="0"
                    ></nz-input-number>
                  </td>
                  <td>
                    <input
                      nz-input
                      [ngModel]="(itemRow.soLuong ?? 0) * (itemRow.donGia ?? 0)"
                      [readonly]="true"
                    />
                  </td>
                  <td>
                    <input type="text" nz-input [(ngModel)]="itemRow.ghiChu" />
                  </td>
                  <td>
                    <a (click)="addRow()">
                      <i class="fa fa-plus"></i>
                    </a>
                    <a (click)="clearItemRow()">
                      <i class="fa fa-trash-o do"></i>
                    </a>
                  </td>
                </tr>
                <tr *ngFor="let data of basicTable.data; let i = index">
                  <ng-container
                    *ngIf="!editCache[data.stt]?.edit; else editTemplate"
                  >
                    <td>{{ data.soLuong | number: '1.0-1' }}</td>
                    <td>{{ data.donGia | number: '1.0-1' }}</td>
                    <td>{{ data.thanhTien | number: '1.0-1' }}</td>
                    <td>{{ data.ghiChu }}</td>
                    <td>
                      <a (click)="editRow(data.stt)">
                        <i class="fa fa-pencil"></i>
                      </a>
                      <a (click)="deleteRow(data)">
                        <i class="fa fa-trash-o do"></i>
                      </a>
                    </td>
                  </ng-container>
                  <ng-template #editTemplate>
                    <td>
                      <nz-input-number
                        [nzSize]="'small'"
                        nz-input
                        [(ngModel)]="editCache[data.stt]?.data.soLuong"
                        [nzMin]="0"
                      >
                      </nz-input-number>
                    </td>
                    <td>
                      <nz-input-number
                        [nzSize]="'small'"
                        nz-input
                        [(ngModel)]="editCache[data.stt]?.data.donGia"
                        [nzMin]="0"
                      >
                      </nz-input-number>
                    </td>
                    <td>
                      <input
                        type="text"
                        nz-input
                        [ngModel]="
                          (editCache[data.stt]?.data.soLuong ?? 0) *
                          (editCache[data.stt]?.data.donGia ?? 0)
                        "
                        [readonly]="true"
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        nz-input
                        [(ngModel)]="editCache[data.stt]?.data.ghiChu"
                      />
                    </td>
                    <td>
                      <a (click)="saveEdit(data.stt)" class="save">
                        <i class="fa fa-save"></i>
                      </a>
                      <a (click)="cancelEdit(data.stt)">
                        <i class="fa fa-times do"></i>
                      </a>
                    </td>
                  </ng-template>
                </tr>
                <tr *ngIf="dataTable.length > 0">
                  <td class="background-last-row align-right">Tổng</td>
                  <td class="background-last-row">
                    {{
                      (tableExist
                        ? reduceRowData(0, 1, 2, ',', 'table-goi-thau')
                        : 0
                      ) | number: '1.0-1'
                    }}
                  </td>
                  <td class="background-last-row">
                    {{
                      (tableExist
                        ? reduceRowData(0, 2, 2, ',', 'table-goi-thau')
                        : 0
                      ) | number: '1.0-1'
                    }}
                  </td>
                  <td class="background-last-row"></td>
                  <td class="background-last-row"></td>
                </tr>
              </tbody>
            </nz-table>
          </nz-card>
          <!-- <button
            type="button"
            class="btn btn-main btn-them"
            (click)="themBienBanDayKho()"
          >
            <i class="icon htvbdh_chuyen-xu-ly"></i>
            <span>Thêm</span>
          </button> -->
        </div>
      </div>
    </div>
  </div>
</div>
