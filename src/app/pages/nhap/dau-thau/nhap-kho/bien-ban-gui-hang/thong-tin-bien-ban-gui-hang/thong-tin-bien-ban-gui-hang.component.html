<nz-affix [nzOffsetTop]="globals.prop.MENU_LV2" class="btn-affix">
  <div class="btn-group">
    <button type="button" class="btn btn-sub" (click)="back()">
      <i class="fa fa-arrow-left"></i>
      <span>Quay lại</span>
    </button>
    <button
      type="button" class="btn btn-sub" (click)="xemTruoc(id,previewName)">
      <i class="icon htvbdh_tcdt_tuchoi"></i>
      <span>Xem trước</span>
    </button>
    <button class="btn btn-sub btn-sm waves-effect waves-light xanh-nhat"
      *ngIf="!isDisableField() && !isView && ( formData.value.trangThai == STATUS.DU_THAO )" (click)="save(true)">
      <i class="icon htvbdh_tcdt_guiduyet"></i>
      <span>Hoàn thành</span>
    </button>
    <button *ngIf="!isDisableField() && !isView && ( formData.value.trangThai == STATUS.DU_THAO) " (click)="save(false)"
      class="btn btn-main btn-sm waves-effect waves-light">
      <i class="icon htvbdh_tcdt_save"></i>
      <span>Lưu</span>
    </button>
  </div>
</nz-affix>
<div class="bg-trang">
  <div class="header header-green-background">
    <div class="header-text">
      <div class="title-chi-tieu">
        <span
          [ngClass]="formData.value.trangThai == STATUS.DA_HOAN_THANH ? 'status-xanh' : 'status-do' ">{{formData.value.tenTrangThai}}</span>
        <span class="title-form" style="text-transform: uppercase">Biên bản tạm giao, nhận hàng chờ kết quả ktcl tại cơ quan chuyên môn</span>
      </div>
    </div>
  </div>
  <nz-alert class="mg-t-16" *ngIf="formData.value.trangThai == STATUS.TU_CHOI_LDCC " nzShowIcon nzType="error"
    nzMessage="Lý do từ chối" nzDescription="{{formData.value.lyDoTuChoi}}">
  </nz-alert>

  <nz-card class="mg-t-16 flex-card p-lr16">
    <div class="mg-t-16 header header-green-background">
      <div class="header-text">
        <div class="title-chi-tieu">
          <span></span>
          <span>Thông tin chung</span>
        </div>
      </div>
    </div>
    <form nzLayout="vertical" nz-form [formGroup]="formData">
      <div nz-row [nzGutter]="24">
        <div nz-col [nzSpan]="2">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Năm kế hoạch</nz-form-label>
            <nz-form-control nz-col [nzErrorTip]="error">
              <nz-select formControlName="nam" [nzDisabled]="isView">
                <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Đơn vị</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="tenDvi" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="4">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Mã QHNS</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="maQhns" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Số BB tạm giao, nhận hàng</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="soBienBanGuiHang" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Số QĐ giao NV nhập hàng</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogSoQd()">
                <input [readonly]="true" nz-input readonly="true" formControlName="soQdGiaoNvNh" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Số hợp đồng</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="soHd" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Ngày ký hợp đồng</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-date-picker formControlName="ngayHd" [nzDisabled]="true" nzFormat="dd/MM/yyyy"></nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true">Ngày lập BB tạm giao, nhận hàng</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-date-picker formControlName="ngayTao" [nzDisabled]="true" nzFormat="dd/MM/yyyy"></nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired> Điểm kho</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogDdiemNhapHang()">
                <input [readonly]="true" nz-input formControlName="tenDiemKho" readonly />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired> Nhà kho</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogDdiemNhapHang()">
                <input [readonly]="true" nz-input formControlName="tenNhaKho" readonly />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired> Ngăn kho</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogDdiemNhapHang()">
                <input [readonly]="true" nz-input formControlName="tenNganKho" readonly />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Lô kho</nz-form-label>
            <nz-form-control>
              <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogDdiemNhapHang()">
                <input [readonly]="true" nz-input formControlName="tenLoKho" readonly />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col nzSpan="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true">
              Số lượng cần nhập
            </nz-form-label>
            <nz-input-number formControlName="soLuongDdiemGiaoNvNh" [nzSize]="'small'" [nzFormatter]="globals.formatter"
              [nzParser]="globals.parser" nzDisabled>
            </nz-input-number>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Số phiếu tạm giao, nhận hàng</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="soPhieuNhapKhoTamGui" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Ngày tạm giao, nhận hàng</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-date-picker formControlName="ngayNhapKhoTamGui" [nzDisabled]="true" nzFormat="dd/MM/yyyy">
              </nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Loại hàng DTQG</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="tenLoaiVthh" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Chủng loại hàng DTQG</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="tenCloaiVthh" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Người tạo biên bản</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="tenNguoiTao" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Số lượng giao nhận</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="soLuongDdiemGiaoNvNh" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> ĐVT</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input formControlName="dvt" [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> SL lấy mẫu KTCL</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> SL còn lại gửi tại chi cục</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> SL cần giao bổ sung để đảm bảo HĐ</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="8">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Tình trạng hàng DTQG</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <textarea rows="3" nz-input formControlName="tinhTrang"></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="8">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Chất lượng hàng DTQG</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <textarea rows="3" nz-input formControlName="chatLuong"></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="8">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Phương pháp kiểm tra chất lượng</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <textarea rows="3" nz-input formControlName="phuongPhap"></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> SL cần giao bổ sung để đảm bảo HĐ</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> SL cần giao bổ sung để đảm bảo HĐ</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input nz-input [readonly]="true" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
          <nz-form-label [nzNoColon]="true"> File đính kèm BB đã ký</nz-form-label>
          <file-list [data]="listFileDinhKem" [isViewDetail]="isView"></file-list>
        </div>
      </div>
    </form>
  </nz-card>

  <nz-card class="flex-card p-lr16">
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="24">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true" class="title-form-chi-tiet">
            I. Bên nhận
          </nz-form-label>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true"> Bên nhận</nz-form-label>
          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
            <input nz-input [ngModel]="formData.value.benNhan" disabled />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="16"></div>
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true">
            Đại diện bên nhận
          </nz-form-label>
          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
            <input nz-input [(ngModel)]="benNhan.daiDien" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true">
            Chức vụ
          </nz-form-label>
          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
            <input nz-input [(ngModel)]="benNhan.chucVu" [disabled]="isDisableField() || isView" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-label [nzNoColon]="true" class="label-empty">
        </nz-form-label>
        <nz-form-control>
          <div class="btn-plus" (click)="addDaiDien('00')" *ngIf="!isView">
            <i class="icon htvbdh_dau-cong"></i>
          </div>
        </nz-form-control>
      </div>
      <ng-container *ngFor="let bienBan of dataTable;let i = index">
        <ng-container *ngIf="bienBan.loaiBen === '00'">
          <div nz-col nzSpan="8">
            <nz-form-item>
              <span>{{bienBan.daiDien}}</span>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="8">
            <nz-form-item>
              <span>{{bienBan.chucVu}}</span>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="8">
            <div class="btn-delete" (click)="deleteBienBan(i)" *ngIf="!isView">
              <i class="icon htvbdh_dau-tru"></i>
            </div>
          </div>
        </ng-container>
      </ng-container>
      <div nz-col [nzSpan]="24">
        <form nzLayout="vertical" nz-form [formGroup]="formData">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true">
              Trách nhiệm bên nhận
            </nz-form-label>
            <nz-form-control>
              <textarea rows="3" nz-input formControlName="trachNhiemBenNhan" [disabled]="isView"></textarea>
            </nz-form-control>
          </nz-form-item>
        </form>
      </div>
      <div nz-col [nzSpan]="24">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true" class="title-form-chi-tiet">
            II. Bên giao
          </nz-form-label>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true">
            Bên giao
          </nz-form-label>
          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
            <input nz-input disabled [ngModel]="formData.value.benGiao" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="16"></div>
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true">
            Đại diện bên giao
          </nz-form-label>
          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
            <input nz-input [(ngModel)]="benGiao.daiDien" [disabled]="isDisableField() || isView" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true">
            Chức vụ
          </nz-form-label>
          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
            <input nz-input [(ngModel)]="benGiao.chucVu" [disabled]="isDisableField() || isView" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-label [nzNoColon]="true" class="label-empty">
        </nz-form-label>
        <div class="btn-plus" (click)="addDaiDien('01')" *ngIf="!isView">
          <i class="icon htvbdh_dau-cong"></i>
        </div>
      </div>
      <ng-container *ngFor="let bienBan of dataTable;let i = index">
        <ng-container *ngIf="bienBan.loaiBen === '01'">
          <div nz-col nzSpan="8">
            <nz-form-item>
              <span>{{bienBan.daiDien}}</span>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="8">
            <nz-form-item>
              <span>{{bienBan.chucVu}}</span>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="8">
            <div class="btn-delete" (click)="deleteBienBan(i)" *ngIf="!isView">
              <i class="icon htvbdh_dau-tru"></i>
            </div>
          </div>
        </ng-container>
      </ng-container>
      <div nz-col [nzSpan]="24">
        <form nzLayout="vertical" nz-form [formGroup]="formData">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true">
              Trách nhiệm bên giao
            </nz-form-label>
            <nz-form-control>
              <textarea rows="3" nz-input formControlName="trachNhiemBenGiao" [disabled]="isView"></textarea>
            </nz-form-control>
          </nz-form-item>
        </form>
      </div>

    </div>
  </nz-card>

  <form nzLayout="vertical" nz-form [formGroup]="formData">
    <nz-form-item>
      <nz-form-label [nzNoColon]="true"> Ghi chú</nz-form-label>
      <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
        <textarea rows="3" nz-input formControlName="ghiChu" [disabled]="isView"></textarea>
      </nz-form-control>
    </nz-form-item>
  </form>
</div>
<ng-template #error let-control>
  <app-template-error #error [control]="control"></app-template-error>
</ng-template>
<nz-modal [(nzVisible)]="showDlgPreview" nzWidth="70%" (nzOnCancel)="closeDlg()">
  <div *nzModalContent class="modal__content">
    <pdf-viewer [src]="pdfSrc" [render-text]="true" style="width: 100%; height: 600px;"></pdf-viewer>
  </div>
  <div *nzModalFooter>
    <button nz-button (click)="printPreview()" class="modal__button--save">
      <i class="icon htvbdh_printer"></i>
      In
    </button>
    <button nz-button (click)="downloadPdf(templateName)" class="modal__button--save">
      <i class="icon htvbdh_file-pdf"></i>
      Xuất .pdf
    </button>
    <button nz-button (click)="downloadWord(templateName)" class="modal__button--save">
      <i class="icon htvbdh_file-word"></i>
      Xuất .docx
    </button>
    <button nz-button (click)="closeDlg()" class="modal__button--cancel">
      <i nz-icon nzType="close-circle" nzTheme="fill" class="icon-cancel"></i>
      Đóng
    </button>
  </div>
</nz-modal>
