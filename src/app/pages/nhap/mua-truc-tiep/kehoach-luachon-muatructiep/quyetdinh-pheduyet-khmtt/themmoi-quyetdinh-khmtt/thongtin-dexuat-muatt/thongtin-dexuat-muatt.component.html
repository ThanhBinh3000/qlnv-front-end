<div class="header header-green-background mg-t-10">
    <div class="header-text">
        <div class="title-chi-tieu">
            <span>
            </span>
            <span> {{title}} </span>
        </div>
    </div>
</div>
<!--START NỘI DUNG-->
<form nzLayout="vertical" nz-form [formGroup]="formData">
    <div nz-row [nzGutter]="[24]">
        <div nz-col [nzSpan]=6>
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Loại hàng hóa </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfterIcon="folder-open">
                        <input [readonly]="true" nz-input formControlName="tenLoaiVthh" readonly="true" />
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="18">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Chủng loại hàng hóa </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfterIcon="folder-open">
                        <input [readonly]="true" nz-input formControlName="tenCloaiVthh" readonly="true" />
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
            <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzRequired> Tên hàng hóa </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <input nz-input readonly formControlName="moTaHangHoa" />
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Phương thức mua </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <textarea nz-input formControlName="ptMua" [readonly]="true"></textarea>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true">Tiêu chuẩn chất lượng </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <textarea nz-input formControlName="tchuanCluong" [readonly]="true"></textarea>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Giá mua </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <textarea nz-input formControlName="giaMua" [readonly]="true"></textarea>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="7">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Giá chưa có thuế
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="đ/kg">
                        <nz-input-number formControlName="giaChuaThue" nz-input [nzMin]="1"
                            [nzMax]="globals.prop.MAX_INPUT" [nzStep]="1" [nzSize]="'small'"
                            [nzDisabled]="formData.value.trangThai !== globals.prop.NHAP_DU_THAO && formData.value.trangThai !== globals.prop.NHAP_CHO_DUYET_LD_CUC && formData.value.trangThai !== ''">
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="10">
            <nz-form-item>
                <nz-form-label [nzNoColon]="true"></nz-form-label>
                <input class="text-green" [ngModel]="convertTienTobangChu(formData.value.giaChuaThue)" nz-input readonly
                    [ngModelOptions]="{standalone: true}" />
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="7">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> %Thuế GTGT
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="%">
                        <nz-input-number formControlName="thueGtgt" nz-input [nzMin]="1"
                            [nzMax]="globals.prop.MAX_INPUT" [nzStep]="1" [nzSize]="'small'"
                            [nzDisabled]="formData.value.trangThai !== globals.prop.NHAP_DU_THAO && formData.value.trangThai !== globals.prop.NHAP_CHO_DUYET_LD_CUC && formData.value.trangThai !== ''">
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="7">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Giá đã có thuế
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="đ/kg">
                        <nz-input-number formControlName="giaCoThue" nz-input [nzMin]="1"
                            [nzMax]="globals.prop.MAX_INPUT" [nzStep]="1" [nzSize]="'small'"
                            [nzDisabled]="formData.value.trangThai !== globals.prop.NHAP_DU_THAO && formData.value.trangThai !== globals.prop.NHAP_CHO_DUYET_LD_CUC && formData.value.trangThai !== ''">
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="10">
            <nz-form-item>
                <nz-form-label [nzNoColon]="true"></nz-form-label>
                <input class="text-green" [ngModel]="convertTienTobangChu(formData.value.giaCoThue)" nz-input readonly
                    [ngModelOptions]="{standalone: true}" />
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Thời gian mở của kho mua từ ngày </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group>
                        <nz-date-picker formControlName="tgianMkho" nzFormat="dd/MM/yyyy"
                            [nzDisabled]="formData.value.trangThai !== globals.prop.NHAP_DU_THAO && formData.value.trangThai !== globals.prop.NHAP_CHO_DUYET_LD_CUC && formData.value.trangThai !== ''">
                        </nz-date-picker>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Thời gian mua thóc đến hết ngày </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group>
                        <nz-date-picker formControlName="tgianKthuc" nzFormat="dd/MM/yyyy"
                            [nzDisabled]="formData.value.trangThai !== globals.prop.NHAP_DU_THAO && formData.value.trangThai !== globals.prop.NHAP_CHO_DUYET_LD_CUC && formData.value.trangThai !== ''">
                        </nz-date-picker>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> ghi chú </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <textarea nz-input formControlName="ghiChu" [readonly]="true"></textarea>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Tên chủ đầu tư</nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group>
                        <input nz-input readonly formControlName="tenDvi" />
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Tổng mức đầu tư </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="đ">
                        <nz-input-number class="text-right" nz-input formControlName="tongMucDt" [nzSize]="'small'"
                            [nzFormatter]="globals.formatter" [nzParser]="globals.parser" nzDisabled>
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true"> Tổng SL đề xuất mua trực tiếp </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-input-group nzAddOnAfter="đ">
                        <nz-input-number class="text-right" nz-input formControlName="tongSoLuong" [nzSize]="'small'"
                            [nzFormatter]="globals.formatter" [nzParser]="globals.parser" nzDisabled>
                        </nz-input-number>
                    </nz-input-group>
                </nz-form-control>
            </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true">Nguồn vốn</nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                    <nz-select formControlName="nguonVon" nzDisabled>
                        <nz-option *ngFor="let p of listNguonVon" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                        </nz-option>
                    </nz-select>
                </nz-form-control>
            </nz-form-item>
        </div>
    </div>
</form>
<!--END NỘI DUNG-->

<!--START TABLE-->
<div class="header header-green-background mg-t-10">
    <div class="header-text">
        <div class="title-chi-tieu">
            <span>
            </span>
            <span> Số lượng, Địa điểm </span>
        </div>
    </div>
</div>
<nz-card class="mg-t-16 flex-card p-lr16 table-card">
    <nz-table [nzData]="listDataGroup" class="nowrap" nzBordered>
        <thead>
            <tr>
                <th style="width: 2%;">STT</th>
                <th>Chi cục</th>
                <th>SL theo chỉ tiêu kế hoạch năm</th>
                <th>SL theo kế hoạch năm đã được duyệt</th>
                <th>SL đề xuất mua trực tiếp (Kg)</th>
                <!--      <th >Đơn giá đã bao gồm VAT (đồng/kg)</th>-->
                <th>Thành tiền (đồng)</th>
                <th *ngIf="!isView"></th>
            </tr>
        </thead>
        <tbody>
            <ng-container *ngFor="let item of listDataGroup , let i = index">
                <tr>
                    <td [nzExpand]="expandSet.has(i)" (nzExpandChange)="onExpandChange(i, $event)"></td>
                    <td colspan="3">{{item.tenDvi}}</td>
                    <td></td>
                    <td></td>
                    <td *ngIf="!isView"></td>
                </tr>
                <ng-container *ngIf="expandSet.has(i)">
                    <tr *ngFor="let dtGoiThau of item.dataChild, let y = index">
                        <td></td>
                        <td></td>
                        <td>{{dtGoiThau.soLuongCtieu | number : '1.0-1' : 'vi_VN'}}</td>
                        <td>{{dtGoiThau.soLuongKhDd | number : '1.0-1' : 'vi_VN'}}</td>
                        <td>{{dtGoiThau.soLuongDxmtt | number : '1.0-1' : 'vi_VN'}}</td>
                        <td>{{dtGoiThau.soLuongDxmtt * dtGoiThau.donGiaVat * 1000 | number: '1.0-1' : 'vi_VN'}}</td>
                        <td *ngIf="!isView">
                            <a (click)="themMoiGoiThau(dtGoiThau,dtGoiThau.idx)">
                                <i class="fa fa-pencil"></i>
                            </a>
                        </td>
                    </tr>
                </ng-container>
            </ng-container>
        </tbody>
    </nz-table>
</nz-card>
<!--END TABLE-->
<ng-template #error let-control>
    <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}</ng-container>
</ng-template>