<nz-collapse nzAccordion class="pd-10">
  <nz-collapse-panel [nzHeader]="title" [nzActive]="true">
    <form nzLayout="vertical" nz-form [formGroup]="formData">
      <div nz-row [nzGutter]="[24]">
<!--        <div nz-col [nzSpan]="6">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label nzRequired [nzNoColon]="true"> Loại hàng hóa </nz-form-label>-->
<!--            <nz-form-control [nzErrorTip]="error">-->
<!--              <nz-input-group nzAddOnAfterIcon="folder-open">-->
<!--                <input [readonly]="true" nz-input formControlName="tenLoaiVthh" readonly="true" />-->
<!--              </nz-input-group>-->
<!--            </nz-form-control>-->
<!--          </nz-form-item>-->
<!--        </div>-->
<!--        <div nz-col [nzSpan]="18">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label nzRequired [nzNoColon]="true"> Chủng loại hàng hóa </nz-form-label>-->
<!--            <nz-form-control [nzErrorTip]="error">-->
<!--              <nz-input-group nzAddOnAfterIcon="folder-open">-->
<!--                <input [readonly]="true" nz-input formControlName="tenCloaiVthh" readonly="true" />-->
<!--              </nz-input-group>-->
<!--            </nz-form-control>-->
<!--          </nz-form-item>-->
<!--        </div>-->
<!--        <div nz-col [nzSpan]="24">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label [nzNoColon]="true" nzRequired> Tên hàng hóa </nz-form-label>-->
<!--            <nz-form-control [nzErrorTip]="error">-->
<!--              <input nz-input readonly formControlName="moTaHangHoa" />-->
<!--            </nz-form-control>-->
<!--          </nz-form-item>-->
<!--        </div>-->
<!--        <div nz-col [nzSpan]="24">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label nzRequired [nzNoColon]="true"> Phương thức mua </nz-form-label>-->
<!--            <nz-form-control [nzErrorTip]="error">-->
<!--              <textarea nz-input formControlName="ptMua" [readonly]="true"></textarea>-->
<!--            </nz-form-control>-->
<!--          </nz-form-item>-->
<!--        </div>-->
<!--        <div nz-col [nzSpan]="24">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label nzRequired [nzNoColon]="true">Tiêu chuẩn chất lượng </nz-form-label>-->
<!--            <nz-form-control [nzErrorTip]="error">-->
<!--              <textarea nz-input formControlName="tchuanCluong" [readonly]="true"></textarea>-->
<!--            </nz-form-control>-->
<!--          </nz-form-item>-->
<!--        </div>-->

<!--        <div nz-col [nzSpan]="24">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label nzRequired [nzNoColon]="true"> Giá chưa có thuế </nz-form-label>-->
<!--            <nz-form-control [nzErrorTip]="error">-->
<!--              <textarea nz-input formControlName="giaMua" [readonly]="true"></textarea>-->
<!--            </nz-form-control>-->
<!--          </nz-form-item>-->
<!--        </div>-->
<!--        <div nz-col [nzSpan]="7">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label nzRequired [nzNoColon]="true"> Giá chưa có thuế-->
<!--            </nz-form-label>-->
<!--            <nz-form-control [nzErrorTip]="error">-->
<!--              <nz-input-group nzAddOnAfter="đ/kg">-->
<!--                <nz-input-number [nzDisabled]="isView" formControlName="giaMua" nz-input [nzMin]="1"-->
<!--                                 [nzMax]="globals.prop.MAX_INPUT" [nzStep]="1" [nzSize]="'small'">-->
<!--                </nz-input-number>-->
<!--              </nz-input-group>-->
<!--            </nz-form-control>-->
<!--          </nz-form-item>-->
<!--        </div>-->
<!--        <div nz-col [nzSpan]="14">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label [nzNoColon]="true"></nz-form-label>-->
<!--            <input class="text-green" [ngModel]="convertTienTobangChu(formData.value.giaMua)" nz-input-->
<!--                   readonly [ngModelOptions]="{standalone: true}" />-->
<!--          </nz-form-item>-->
<!--        </div>-->
<!--        <div nz-col [nzSpan]="7">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label nzRequired [nzNoColon]="true"> Giá đã có thuế-->
<!--            </nz-form-label>-->
<!--            <nz-form-control [nzErrorTip]="error">-->
<!--              <nz-input-group nzAddOnAfter="đ/kg">-->
<!--                <nz-input-number [nzDisabled]="isView" formControlName="donGiaVat" nz-input [nzMin]="1"-->
<!--                                 [nzMax]="globals.prop.MAX_INPUT" [nzStep]="1" [nzSize]="'small'">-->
<!--                </nz-input-number>-->
<!--              </nz-input-group>-->
<!--            </nz-form-control>-->
<!--          </nz-form-item>-->
<!--        </div>-->
<!--        <div nz-col [nzSpan]="14">-->
<!--          <nz-form-item>-->
<!--            <nz-form-label [nzNoColon]="true"></nz-form-label>-->
<!--            <input class="text-green" [ngModel]="convertTienTobangChu(formData.value.donGiaVat)" nz-input-->
<!--                   readonly [ngModelOptions]="{standalone: true}" />-->
<!--          </nz-form-item>-->
<!--        </div>-->
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Thời điểm mở của kho mua từ ngày </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group>
                <nz-date-picker [(ngModel)]="tgianMkhoChange" [ngModelOptions]="{standalone: true}" nzFormat="dd/MM/yyyy"
                                [nzDisabled]="isView" (ngModelChange)="onChangedValue($event, 'tgianMkho')"></nz-date-picker>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Thời hạn mua thóc đến hết ngày </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group>
                <nz-date-picker [(ngModel)]="tgianKthucChange" [ngModelOptions]="{standalone: true}" nzFormat="dd/MM/yyyy"
                                [nzDisabled]="isView" (ngModelChange)="onChangedValue($event, 'tgianKthuc')"></nz-date-picker>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Ghi chú </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <textarea nz-input [(ngModel)]="ghiChuChange" [ngModelOptions]="{standalone: true}" (ngModelChange)="onChangedValue($event, 'ghiChu')" [readonly]="isView"></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Tên chủ đầu tư</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group>
                <input nz-input [readonly]="isView" [(ngModel)]="tenDviChange" [ngModelOptions]="{standalone: true}" (ngModelChange)="onChangedValue($event, 'tenDvi')" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Tổng mức đầu tư </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group nzAddOnAfter="đ">
                <nz-input-number class="text-right" nz-input formControlName="tongMucDt"
                                 [nzSize]="'small'" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                                 nzDisabled>
                </nz-input-number>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true">Nguồn vốn</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-select [disabled]="isView" formControlName="tenNguonVon" nzDisabled>
                <nz-option *ngFor="let p of listNguonVon" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true"> Tổng SL trình phê duyệt </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group nzAddOnAfter="đ">
                <nz-input-number class="text-right" nz-input formControlName="tongSoLuong"
                                 [nzSize]="'small'" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                                 nzDisabled>
                </nz-input-number>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> %Thuế GTGT </nz-form-label>
            <nz-form-control nz-col [nzSpan]="24">
              <span class="text-green">{{formData.value.thueGtgt|number: '1.0-1'}}</span>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </form>

  </nz-collapse-panel>
</nz-collapse>
<nz-collapse nzAccordion class="pd-10">
  <div class="header header-green-background mg-t-16">
    <div class="header-text">
      <div class="title-chi-tieu">
        <span></span>
        <span>Số lượng, địa điểm</span>
      </div>
    </div>
    <div class="buttons" *ngIf="!isView">
      <button type="button" class="btn btn-main" (click)="themMoiBangPhanLoTaiSan()">
        <i class="icon htvbdh_dau-cong"></i>
        <span>Thêm</span>
      </button>
    </div>
  </div>
  <nz-table [nzData]="dataTable" class="nowrap pd-10" nzBordered>
    <thead>
    <tr>
      <th nzWidth="150px" class="text-center wrap">Chi cục</th>
      <th *ngIf="isCache" nzWidth="150px" class="text-center wrap">Điểm kho</th>
      <th *ngIf="isCache" nzWidth="150px" class="text-center wrap">Địa điểm kho</th>
      <th *ngIf="isCache" nzWidth="150px" class="text-center wrap">Chỉ tiêu kế hoạch được giao (Tấn)</th>
      <th nzWidth="150px" class="text-center wrap">Số đã thực hiện<br>(Tấn)</th>
      <th *ngIf="isCache" nzWidth="150px" class="text-center wrap">SL trình<br>phê duyệt (Tấn)</th>
      <th *ngIf="isCache" nzWidth="150px" class="text-center wrap">Đơn giá có<br>VAT đã duyệt (đ/kg)</th>
      <th *ngIf="!isCache" nzWidth="100px" class="text-center wrap">Số lượng phê duyệt (Tấn)</th>
      <th *ngIf="!isCache" nzWidth="100px" class="text-center wrap">Đơn giá có<br>VAT (đ/kg)</th>
      <th nzWidth="100px" class="text-center wrap">Thành tiền (đ)</th>
      <th *ngIf="isCache" nzWidth="100px" class="text-center wrap">Bằng chữ</th>
      <th nzWidth="100px" class="text-center wrap">Số còn lại chưa<br>thực hiện</th>
      <th *ngIf="!isCache" nzWidth="50px">Hành động</th>
    </tr>
    </thead>
    <tbody>
    <ng-container *ngFor="let item of dataTable , let i = index">
      <tr>
        <td>{{item.tenDvi}}</td>
        <td *ngIf="isCache"></td>
        <td *ngIf="isCache"></td>
        <td *ngIf="isCache" class="text-right">{{item.soLuongChiTieu | number : '1.0-1' : 'vi_VN'}}</td>
        <td class="text-red text-right">{{item.soLuongKhDd | number : '1.0-1' : 'vi_VN'}}</td>
        <td *ngIf="isCache" class="text-red text-right">{{item.tongSoLuong | number : '1.0-1' : 'vi_VN'}}</td>
        <td *ngIf="isCache" class="text-blue text-right">{{item.donGiaVat | number : '1.0-1' : 'vi_VN'}}</td>
        <td *ngIf="!isCache" class="text-blue text-right">{{item.tongSoLuong | number : '1.0-1' : 'vi_VN'}}</td>
        <td *ngIf="!isCache" class="text-blue text-right">{{item.donGiaVat}}</td>
        <td class="text-blue text-right">{{item.tongSoLuong * item.donGiaVat * 1000 | number : '1.0-1' : 'vi_VN'}}</td>
        <td *ngIf="isCache"></td>
        <td class="text-red text-right">{{item.tongSoLuong - item.soLuongKhDd | number : '1.0-1' : 'vi_VN'}}</td>
        <td *ngIf="!isCache">
          <a *ngIf="!isView" (click)="themMoiBangPhanLoTaiSan(item,i)">
            <i class="fa fa-pencil" title="Sửa"></i>
          </a>
          <a *ngIf="!isView" (click)="deleteRow(i)">
            <i class="fa fa-trash-o do" title="Xóa"></i>
          </a>
        </td>
      </tr>
      <ng-container *ngIf="isCache">
        <ng-container *ngFor="let data of item.children , let i = index">
          <tr>
            <td></td>
            <td *ngIf="isCache">{{data.tenDiemKho}}</td>
            <td *ngIf="isCache">{{data.diaDiemNhap}}</td>
            <td *ngIf="isCache"></td>
            <td *ngIf="isCache"></td>
            <td *ngIf="isCache" class="text-right">{{data.soLuong | number : '1.0-1' : 'vi_VN'}}</td>
            <td *ngIf="isCache" class="text-right">{{item.donGiaVat}}</td>
<!--            <td *ngIf="!isCache" class="text-blue"></td>-->
<!--            <td *ngIf="!isCache" class="text-blue"></td>-->
<!--            <td *ngIf="!isCache" class="text-blue"></td>-->
            <td *ngIf="isCache" class="text-right">{{data.soLuong * item.donGiaVat * 1000 | number : '1.0-1' : 'vi_VN'}}</td>
            <td *ngIf="isCache">{{convertTienTobangChu(data.soLuong * item.donGiaVat * 1000)}}</td>
            <td *ngIf="isCache"></td>
<!--            <td *ngIf="!isCache"></td>-->
          </tr>
        </ng-container>
      </ng-container>
    </ng-container>
    </tbody>
  </nz-table>
</nz-collapse>
<ng-template #error let-control>
  <app-template-error #error [control]="control"></app-template-error>
</ng-template>
