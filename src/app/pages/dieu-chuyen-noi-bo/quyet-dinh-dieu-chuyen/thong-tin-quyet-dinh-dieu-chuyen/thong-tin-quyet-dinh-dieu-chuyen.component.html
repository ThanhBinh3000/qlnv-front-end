<!-- <nz-affix [nzOffsetTop]="globals.prop.MENU_LV2" class="btn-affix">
  <div class="btn-group">
    <button type="button" class="btn btn-sub" (click)="quayLai()">
      <i class="fa fa-arrow-left"></i>
      <span>Quay lại</span>
    </button>
  </div>
</nz-affix> -->
<div class="bg-trang">
  <div class="header header-green-background">
    <div class="header-text">
      <div class="title-chi-tieu">
        <span [ngClass]="'da-ban-hanh'">
          {{ formData.value.tenTrangThai }}
        </span>
        <span *ngIf="isTongCuc()"> QUYẾT ĐỊNH PHÊ DUYỆT ĐIỀU CHUYỂN NỘI BỘ HÀNG DTQG CỦA TỔNG CỤC DTNN</span>
        <span *ngIf="isCuc()"> QUYẾT ĐỊNH ĐIỀU CHUYỂN NỘI BỘ HÀNG DTQG CỦA CỤC DTNN KHU VỰC</span>
      </div>
    </div>

    <div class="btn-group">
      <button type="button" class="btn btn-sub" (click)="quayLai()">
        <i class="fa fa-arrow-left"></i>
        <span>Quay lại</span>
      </button>
      <button *ngIf="!isView && formData.value.trangThai == STATUS.DU_THAO" type="button"
        class="btn btn-sub xanh-nhat ml-2" (click)="save(true)">
        <i class="icon htvbdh_tcdt_guiduyet"></i>
        <span>Lưu và gửi duyệt</span>
      </button>
      <button *ngIf="!isView" type="button" class="btn btn-main ml-2" (click)="save()">
        <i class="icon htvbdh_tcdt_save"></i>
        <span>Lưu</span>
      </button>
    </div>
  </div>
  <!-- <nz-card class="mg-t-16 flex-card p-lr16"> -->
  <nz-collapse nzAccordion>
    <div class="mt16 flex-card p-lr16">
      <div class="header header-green-background mg-t-16">
        <div class="header-text">
          <div class="title-chi-tieu">
            <span></span>
            <span>Thông tin chung</span>
          </div>
        </div>
      </div>
    </div>
    <form nz-form nzLayout="vertical" [formGroup]="formData">
      <nz-card class="mg-t-16 flex-card p-lr16">
        <div nz-row [nzGutter]="24">
          <div nz-col nzSpan="24">
            <nz-form-item>
              <nz-form-label nzRequired [nzNoColon]="true"> Loại điều chuyển
              </nz-form-label>
              <nz-form-control nz-col [nzErrorTip]="error">
                <nz-radio-group>
                  <label *ngIf="isCuc()" nz-radio nzValue="a">Trong nội bộ Chi cục</label>
                  <label nz-radio nzValue="C">Giữa 2 chi cục trong cùng 1 cục</label>
                  <label nz-radio nzValue="D">Giữa 2 cục DTNN KV</label>
                </nz-radio-group>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </nz-card>
      <nz-card class="mg-t-16 flex-card p-lr16">
        <div nz-row [nzGutter]="24">
          <div nz-col nzSpan="3">
            <nz-form-item>
              <nz-form-label nzRequired [nzNoColon]="true"> Năm kế hoạch
              </nz-form-label>
              <nz-form-control nz-col [nzErrorTip]="error">
                <nz-select formControlName="nam" nzAllowClear [nzDisabled]="true">
                  <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="3">
            <nz-form-item>
              <nz-form-label nzRequired [nzNoColon]="true"> Số quyết định</nz-form-label>
              <nz-form-control [nzErrorTip]="error">
                <nz-input-group nzAddOnAfter="/{{maQd}}">
                  <nz-input-number formControlName="soQd" [nzMin]="1" [nzMax]="999999999999" [nzStep]="1"
                    [nzSize]="'small'" [nzDisabled]="isDisabled()">
                  </nz-input-number>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="3">
            <nz-form-item>
              <nz-form-label nzRequired [nzNoColon]="true"> Ngày ký quyết định</nz-form-label>
              <nz-form-control [nzErrorTip]="error">
                <nz-date-picker formControlName="ngayKy" nzFormat="dd/MM/yyyy" [nzDisabled]="isDisabled()">
                </nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="3">
            <nz-form-item>
              <nz-form-label nzRequired [nzNoColon]="true"> Ngày hiệu lực</nz-form-label>
              <nz-form-control [nzErrorTip]="error">
                <nz-date-picker formControlName="ngayHluc" nzFormat="dd/MM/yyyy" [nzDisabled]="isDisabled()">
                </nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </div>

          <div *ngIf="isTongCuc()" nz-col [nzSpan]="12">
            <nz-radio-group [nzDisabled]="isDisabled()" nzSize="small" class="rdo-input" formControlName="type">
              <nz-form-item nz-col [nzSpan]="11">
                <label nz-radio nzValue="TH">Chọn mã tổng hợp</label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogTh()">
                    <input [readonly]="true" nz-input formControlName="idTongHop" readonly="true" />
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item nz-col [nzSpan]="11">
                <label nz-radio nzValue="TTr">Chọn số đề xuất/ công văn</label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogTr()">
                    <input [readonly]="true" nz-input formControlName="idDx" readonly="true" />
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </nz-radio-group>
          </div>

          <div *ngIf="isCuc()" nz-col [nzSpan]="12">
            <nz-form-item>
              <nz-form-label [nzNoColon]="true">
                Tổng dự toán kinh phí(triệu đồng)
              </nz-form-label>
              <nz-form-control>
                <input nz-input formControlName="tongtien" [readonly]="true" />
              </nz-form-control>
            </nz-form-item>
          </div>


          <div nz-col [nzSpan]="24">
            <nz-form-item>
              <nz-form-label [nzNoColon]="true">
                Trích yếu
              </nz-form-label>
              <nz-form-control>
                <input nz-input formControlName="trichYeu" [readonly]="isDisabled()" />
              </nz-form-control>
            </nz-form-item>
          </div>

          <div nz-col [nzSpan]="24">
            <nz-form-item>
              <nz-form-label [nzNoColon]="true">
                Căn cứ pháp lý
              </nz-form-label>
              <div class="list-file">
                <file-list [disabled]="isDisabled()"></file-list>
              </div>
            </nz-form-item>
          </div>

          <div nz-col [nzSpan]="24">
            <nz-form-item>
              <nz-form-label [nzNoColon]="true">
                File đính kèm QĐ phê duyệt KH điều chuyển nội bộ của Tổng cục đã ban hành
              </nz-form-label>
              <div class="list-file">
                <file-list [disabled]="isDisabled()"></file-list>
              </div>
            </nz-form-item>
          </div>
        </div>
      </nz-card>


      <!-- <div nz-col [nzSpan]="24">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> File đính kèm QĐ đã ban hành</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <div class="list-file">
                <nz-input-group [nzSuffix]="suffixTemplateInfo">
                  <input type="text" nz-input />
                </nz-input-group>
                <ng-template #suffixTemplateInfo>
                  <div class="icon-file-dinh-kem">
                    <i class="icon htvbdh_tcdt_tep"></i>
                    <input class="input-file" (change)="getNameFile($event)" type="file" />
                  </div>
                </ng-template>
              </div>
            </nz-form-control>
          </nz-form-item>
        </div> -->
    </form>

  </nz-collapse>
  <!-- </nz-card> -->
  <div class="mt16 flex-card p-lr16">
    <div *ngIf="isTongCuc()" class="header header-green-background mg-t-16">
      <div class="header-text">
        <div class="title-chi-tieu">
          <span></span>
          <span>Thông tin điều chuyển nội bộ giữa 2 cục DTNN KV</span>
        </div>
      </div>
    </div>
    <nz-card *ngIf="isTongCuc()" class="mt-2px flex-card data-table card-border-content table-card">
      <nz-table #quyetDinhPdDtl class="nowrap mt-16 table-chi-tiet" nzBordered [nzData]="formData.value.quyetDinhPdDtl">
        <thead>
          <tr>
            <th style="width: 35px">STT</th>
            <th>Cục DTNN KV xuất ĐC</th>
            <th>Cục DTNN KV nhận ĐC</th>
            <th>Số đề xuất/ Công văn</th>
            <th>Ngày trình duyệt Tổng cục</th>
            <th>Tổng dự toán kinh phí(triệu đồng)</th>
            <th>Trích yếu</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let item of quyetDinhPdDtl.data, let i = index;">
            <tr [ngClass]="{'bg-selected': item.selected}" (click)="selectRow(item)">
              <td>{{i + 1}}</td>
              <td>{{item.tenDviDx}}</td>
              <td>{{item.soDx}}</td>
              <td>{{item.ngayPduyetDx}}</td>
              <td>{{item.trichYeuDx}}</td>
              <td>{{item.tongSoLuongDx|number: '1.0-1'}}</td>
              <td>{{item.thanhTienDx|number: '1.0-1'}}</td>
            </tr>
          </ng-container>
        </tbody>

      </nz-table>

    </nz-card>

    <div nz-col [nzSpan]="24">
      <div class="header header-green-background mg-t-16">
        <div class="title-card">
          <div class="title-chi-tieu">
            <span></span>
            <span *ngIf="isTongCuc()">Quyết định của TCDTNN</span>
            <span *ngIf="isCuc()"> QUYẾT ĐỊNH ĐIỀU CHUYỂN NỘI BỘ HÀNG DTQG TRONG CÙNG 1 CHI CỤC DTNN</span>
          </div>
        </div>
        <div class="btn-group">
          <button *ngIf="!isView" type="button" class="btn btn-main ml-2" (click)="save()">
            <i class="icon htvbdh_tcdt_add"></i>
            <span>Thêm</span>
          </button>
        </div>
      </div>

      <nz-table *ngIf="isTongCuc()" #expandTable [nzData]="listOfMapData" class="nowrap table-chi-tiet" nzBordered
        [nzFrontPagination]="false" [nzShowPagination]="false">
        <thead>
          <tr>
            <th [rowspan]="2">STT</th>
            <th [rowspan]="2"></th>
            <th [rowspan]="2"></th>
            <th [colspan]="9">Chi cục đề xuất điều chuyển</th>
            <th [rowspan]="2">Thời gian dự kiến điều chuyển</th>
            <th [colspan]="7">Chi cục nhận chuyển đến</th>
          </tr>
          <tr>
            <th>Chi cục</th>
            <th>Điểm kho</th>
            <th>Lô kho</th>
            <th>Loại HH</th>
            <th>Chủng loại hàng hóa</th>
            <th>ĐVT</th>
            <th>Tồn kho</th>
            <th>Số lượng điều chuyển</th>
            <th>Dự toán kinh phí(triệu đồng)</th>
            <th>Chi cục</th>
            <th>Điểm kho</th>
            <th>Nhà kho</th>
            <th>Ngăn kho</th>
            <th>Lô kho</th>
            <th>Tích lượng khả dụng</th>
            <th>SL phân bổ nhập ĐC</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let data of expandTable.data">
            <ng-container *ngFor="let item of mapOfExpandedData[data.key]">
              <tr *ngIf="(item.parent && item.parent.expand) || !item.parent">
                <td>1</td>
                <td [nzShowExpand]="item.isEx" [(nzExpand)]="item.expand"
                  (nzExpandChange)="collapse(mapOfExpandedData[data.key], item, $event)">
                </td>
                <td [nzShowExpand]="item.isCol" [(nzExpand)]="item.expand"
                  (nzExpandChange)="collapse(mapOfExpandedData[data.key], item, $event)">
                </td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>7{{ item.age }}</td>
                <td>8{{ item.address }}</td>
                <td>9{{ item.address }}</td>
                <td>10{{ item.age }}</td>
                <td>11{{ item.address }}</td>
                <td>12{{ item.age }}</td>
                <td>13{{ item.address }}</td>
                <td>14{{ item.age }}</td>
                <td>15{{ item.address }}</td>
                <td>16{{ item.age }}</td>
                <td>17{{ item.address }}</td>
              </tr>
            </ng-container>
          </ng-container>
        </tbody>
      </nz-table>

      <nz-table *ngIf="isCuc()" #expandTable [nzData]="listOfMapData" class="nowrap table-chi-tiet" nzBordered
        [nzFrontPagination]="false" [nzShowPagination]="false">
        <thead>
          <tr>
            <th [rowspan]="2">STT</th>
            <th [rowspan]="2"></th>
            <th [rowspan]="2"></th>
            <th [colspan]="10">Ngăn/lô/kho đang bảo quản hàng hoá</th>
            <!-- <th [rowspan]="2">Thời gian dự kiến điều chuyển</th> -->
            <th [colspan]="7">Ngăn/lô/kho điều chuyển đến</th>
            <th [rowspan]="2">Hành động</th>
          </tr>
          <tr>
            <th>Chi cục</th>
            <th>Điểm kho</th>
            <th>Lô kho</th>
            <th>Loại HH</th>
            <th>Chủng loại hàng hóa</th>
            <th>ĐVT</th>
            <th>Tồn kho</th>
            <th>Số lượng điều chuyển</th>
            <th>Dự toán kinh phí(triệu đồng)</th>
            <th>Thời gian dự kiến điều chuyển</th>
            <th>Điểm kho</th>
            <th>Nhà kho</th>
            <th>Ngăn kho</th>
            <th>Lô kho</th>
            <th>Thay đổi thủ kho</th>
            <th>Tích lượng khả dụng</th>
            <th>SL phân bổ nhập ĐC</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let data of expandTable.data">
            <ng-container *ngFor="let item of mapOfExpandedData[data.key]">
              <tr *ngIf="(item.parent && item.parent.expand) || !item.parent">
                <td>1</td>
                <td [nzShowExpand]="item.isEx" [(nzExpand)]="item.expand"
                  (nzExpandChange)="collapse(mapOfExpandedData[data.key], item, $event)">
                </td>
                <td [nzShowExpand]="item.isCol" [(nzExpand)]="item.expand"
                  (nzExpandChange)="collapse(mapOfExpandedData[data.key], item, $event)">
                </td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.name }}</td>
                <td>7{{ item.age }}</td>
                <td>8{{ item.address }}</td>
                <td>9{{ item.address }}</td>
                <td>10{{ item.age }}</td>
                <td>11{{ item.address }}</td>
                <td>12{{ item.age }}</td>
                <td>13{{ item.address }}</td>
                <td>14{{ item.age }}</td>
                <td>15{{ item.address }}</td>
                <td>16{{ item.age }}</td>
                <td>17{{ item.address }}</td>
                <td class="text-center">
                  <a *ngIf="data.trangThai !== STATUS.DU_THAO">
                    <i class="fa fa-eye"></i>
                  </a>
                  <a *ngIf="data.trangThai == STATUS.DU_THAO">
                    <i class="fa fa-pencil"></i>
                  </a>
                  <!-- <a *ngIf="data.trangThai == STATUS.DU_THAO" (click)="xoaItem(data)">
                    <i class="fa fa-trash-o do"></i>
                  </a> -->
                </td>
              </tr>
            </ng-container>
          </ng-container>
        </tbody>
      </nz-table>






    </div>

  </div>

  <ng-template #error let-control>
    <app-template-error #error [control]="control"></app-template-error>
  </ng-template>

</div>