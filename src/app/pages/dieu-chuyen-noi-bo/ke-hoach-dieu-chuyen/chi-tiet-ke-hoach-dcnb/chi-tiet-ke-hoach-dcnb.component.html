<div class="bg-trang">
  <div class="mt16 flex-card p-lr16">
    <div class="header header-green-background mg-t-16">
      <div class="header-text">
        <div class="title-chi-tieu">
          <span
            [ngClass]="(formData.value.trangThai == STATUS.DA_DUYET_LDCC || formData.value.trangThai == STATUS.DA_PHANBO_DC_DADUYET_LDCC) ? 'status-xanh' : 'status-do'">
            {{ formData.value.tenTrangThai }}
          </span>
          <span>Kế hoạch điều chuyển nội bộ hàng DTQG </span>
        </div>
      </div>
      <div class="btn-group" *ngIf="!isNhanDieuChuyen">
        <button type="button" class="btn btn-sub ml-2" (click)="quayLai()">
          <i class="fa fa-arrow-left"></i>
          <span>Quay lại</span>
        </button>
        <ng-container *ngIf="userService.isChiCuc()">
          <button
            *ngIf="(formData.value.trangThai == STATUS.CHO_DUYET_LDCC) && userService.isAccessPermisson('DCNB_KHDC_DUYET_LDCCUC')"
            type="button" class="btn btn-sub ml-2" (click)="reject(idInput,STATUS.TU_CHOI_LDCC)">
            <i class="icon htvbdh_tcdt_tuchoi do"></i>
            <span>Từ chối</span>
          </button>
          <button
            *ngIf="(formData.value.trangThai == STATUS.CHODUYET_TBP_TVQT) && userService.isAccessPermisson('DCNB_KHDC_DUYET_TBPTVQT')"
            type="button" class="btn btn-sub ml-2" (click)="reject(idInput,STATUS.TUCHOI_TBP_TVQT)">
            <i class="icon htvbdh_tcdt_tuchoi do"></i>
            <span>Từ chối</span>
          </button>

          <button
            *ngIf="(formData.value.trangThai == STATUS.CHO_DUYET_LDCC) && userService.isAccessPermisson('DCNB_KHDC_DUYET_LDCCUC')"
            type="button" class="btn btn-sub ml-2"
            (click)="approveConfirm(idInput,STATUS.DA_DUYET_LDCC,'Bạn có muốn duyệt quyết định này')">
            <i class="icon htvbdh_tcdt_pheduyet"></i>
            <span>Duyệt</span>
          </button>
          <button
            *ngIf="(formData.value.trangThai == STATUS.CHODUYET_TBP_TVQT) && userService.isAccessPermisson('DCNB_KHDC_DUYET_TBPTVQT')"
            type="button" class="btn btn-sub ml-2"
            (click)="approveConfirm(idInput,STATUS.CHO_DUYET_LDCC,'Bạn có muốn duyệt quyết định này')">
            <i class="icon htvbdh_tcdt_pheduyet"></i>
            <span>Duyệt</span>
          </button>
          <button
            *ngIf="(formData.value.trangThai == STATUS.DU_THAO ||
        formData.value.trangThai == STATUS.TU_CHOI_LDCC ||
         formData.value.trangThai == STATUS.TUCHOI_TBP_TVQT || (formData.value.trangThai == this.STATUS.DA_PHANBO_DC_TUCHOI_TP && !!formData.value.xdLaiDiemNhap) || (formData.value.trangThai == this.STATUS.DA_PHANBO_DC_TUCHOI_LDC && !!formData.value.xdLaiDiemNhap)) && userService.isAccessPermisson('DCNB_KHDC_THEM')"
            type="button" class="btn btn-sub ml-2" (click)="saveAndSend('Bạn có muốn gửi duyệt ?')">
            <i class="icon htvbdh_tcdt_guiduyet"></i>
            <span>Lưu và gửi duyệt</span>
          </button>
          <button
            *ngIf="!isView && (formData.value.trangThai == STATUS.DU_THAO || formData.value.trangThai == STATUS.TU_CHOI_LDCC || formData.value.trangThai == STATUS.TUCHOI_TBP_TVQT || (formData.value.trangThai == this.STATUS.DA_PHANBO_DC_TUCHOI_TP && !!formData.value.xdLaiDiemNhap) || (formData.value.trangThai == this.STATUS.DA_PHANBO_DC_TUCHOI_LDC && !!formData.value.xdLaiDiemNhap)) && userService.isAccessPermisson('DCNB_KHDC_THEM')"
            type="button" class="btn btn-main ml-2" (click)="save(false)">
            <i class="icon htvbdh_tcdt_save"></i>
            <span>Lưu</span>
          </button>
        </ng-container>
      </div>
      <div class="btn-group" *ngIf="isNhanDieuChuyen">
        <button type="button" class="btn btn-sub ml-2 ml-2" (click)="quayLai()">
          <i class="fa fa-arrow-left"></i>
          <span>Quay lại</span>
        </button>
        <ng-container *ngIf="userService.isChiCuc()">
          <button
            *ngIf="(formData.value.trangThai == STATUS.DA_PHANBO_DC_CHODUYET_LDCC) && userService.isAccessPermisson('DCNB_KHDC_PHANBODC_DUYET_LDCCUC')"
            type="button" class="btn btn-sub ml-2" (click)="reject(idInput,STATUS.DA_PHANBO_DC_TUCHOI_LDCC)">
            <i class="icon htvbdh_tcdt_tuchoi do"></i>
            <span>Từ chối</span>
          </button>
          <button
            *ngIf="(formData.value.trangThai == STATUS.DA_PHANBO_DC_CHODUYET_TBP_TVQT) && userService.isAccessPermisson('DCNB_KHDC_PHANBODC_DUYET_TBPTVQT')"
            type="button" class="btn btn-sub ml-2" (click)="reject(idInput,STATUS.DA_PHANBO_DC_TUCHOI_TBP_TVQT)">
            <i class="icon htvbdh_tcdt_tuchoi do"></i>
            <span>Từ chối</span>
          </button>

          <button
            *ngIf="(formData.value.trangThai == STATUS.DA_PHANBO_DC_CHODUYET_LDCC) && userService.isAccessPermisson('DCNB_KHDC_PHANBODC_DUYET_LDCCUC')"
            type="button" class="btn btn-sub ml-2"
            (click)="approveConfirm(idInput,STATUS.DA_PHANBO_DC_DADUYET_LDCC,'Bạn có muốn duyệt quyết định này')">
            <i class="icon htvbdh_tcdt_pheduyet"></i>
            <span>Duyệt</span>
          </button>
          <button
            *ngIf="(formData.value.trangThai == STATUS.DA_PHANBO_DC_CHODUYET_TBP_TVQT) && userService.isAccessPermisson('DCNB_KHDC_PHANBODC_DUYET_TBPTVQT')"
            type="button" class="btn btn-sub ml-2"
            (click)="approveConfirm(idInput,STATUS.DA_PHANBO_DC_CHODUYET_LDCC,'Bạn có muốn duyệt quyết định này')">
            <i class="icon htvbdh_tcdt_pheduyet"></i>
            <span>Duyệt</span>
          </button>
          <button
            *ngIf="(formData.value.trangThai == STATUS.YC_CHICUC_PHANBO_DC ||
        formData.value.trangThai == STATUS.DA_PHANBO_DC_TUCHOI_LDCC ||
         formData.value.trangThai == STATUS.DA_PHANBO_DC_TUCHOI_TBP_TVQT  || (formData.value.trangThai == this.STATUS.DA_PHANBO_DC_TUCHOI_TP && !!formData.value.xdLaiDiemNhap) || (formData.value.trangThai == this.STATUS.DA_PHANBO_DC_TUCHOI_LDC && !!formData.value.xdLaiDiemNhap)) && userService.isAccessPermisson('DCNB_KHDC_PHANBODC')"
            type="button" class="btn btn-sub ml-2" (click)="saveAndSend('Bạn có muốn gửi duyệt ?')">
            <i class="icon htvbdh_tcdt_guiduyet"></i>
            <span>Lưu và gửi duyệt</span>
          </button>
          <button
            *ngIf="(formData.value.trangThai == STATUS.YC_CHICUC_PHANBO_DC || formData.value.trangThai == STATUS.DA_PHANBO_DC_TUCHOI_LDCC || formData.value.trangThai == STATUS.DA_PHANBO_DC_TUCHOI_TBP_TVQT || (formData.value.trangThai == this.STATUS.DA_PHANBO_DC_TUCHOI_TP && !!formData.value.xdLaiDiemNhap) || (formData.value.trangThai == this.STATUS.DA_PHANBO_DC_TUCHOI_LDC && !!formData.value.xdLaiDiemNhap)) && userService.isAccessPermisson('DCNB_KHDC_PHANBODC')"
            type="button" class="btn btn-main ml-2" (click)="save(false)">
            <i class="icon htvbdh_tcdt_save"></i>
            <span>Lưu</span>
          </button>
        </ng-container>
      </div>
    </div>
  </div>
  <nz-alert class="mg-t-16 mb-2"
    *ngIf="formData.value.trangThai == STATUS.TUCHOI_TBP_TVQT || formData.value.trangThai == STATUS.TU_CHOI_LDCC || formData.value.trangThai == STATUS.DA_PHANBO_DC_TUCHOI_LDCC || formData.value.trangThai == STATUS.DA_PHANBO_DC_TUCHOI_TBP_TVQT || formData.value.trangThai == STATUS.DA_PHANBO_DC_TUCHOI_TP || formData.value.trangThai == STATUS.DA_PHANBO_DC_TUCHOI_LDC"
    nzShowIcon nzType="error" nzMessage="Lý do từ chối" nzDescription="{{formData.value.lyDoTuChoi}}">
  </nz-alert>
  <nz-card class="flex-card pd-l-6 pd-r-6">
    <form nzLayout="vertical" nz-form [formGroup]="formData">
      <ng-template #error let-control>
        <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
        </ng-container>
      </ng-template>
      <div class="mt16 flex-card p-lr16">
        <div class="header header-green-background mg-t-16">
          <div class="header-text">
            <div class="title-chi-tieu">
              <span></span>
              <span>Thông tin chung</span>
            </div>
          </div>
        </div>
      </div>
      <div nz-row [nzGutter]="24">
        <div nz-col nzSpan="24">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" class="label-color-kh" nzRequired>Loại điều chuyển
            </nz-form-label>
            <nz-form-control>
              <nz-radio-group formControlName="loaiDc" nzName="radiogroup" [nzDisabled]="isView || isNhanDieuChuyen"
                (ngModelChange)="handleChangeLoaiDC($event)">
                <label nz-radio nzValue="CHI_CUC"> Giữa 2 chi cục trong cùng 1 cục </label>
                <label nz-radio nzValue="CUC"> Giữa 2 cục DTNN KV </label>
              </nz-radio-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col nzSpan="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" class="label-color-kh" nzRequired> Năm kế hoạch
            </nz-form-label>
            <nz-select formControlName="nam" [nzDisabled]="isView || isNhanDieuChuyen">
              <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
            </nz-select>
          </nz-form-item>
        </div>
        <div nz-col nzSpan="4">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired> Số đề xuất/công văn</nz-form-label>
            <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập số đề xuất/công văn'">
              <nz-input-group nzAddOnAfter="/DCNB">
                <input nz-input formControlName="soDxuat" [readOnly]="isView || isNhanDieuChuyen" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired> Ngày lập KH</nz-form-label>
            <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập Ngày lập KH'">
              <nz-date-picker class="search__input" formControlName="ngayLapKh"
                [nzDisabled]="isView || isNhanDieuChuyen" nzFormat="dd/MM/yyyy">
              </nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="3">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Ngày duyệt LĐ Chi Cục</nz-form-label>
            <nz-form-control nz-col [nzSpan]="24">
              <nz-date-picker class="search__input" formControlName="ngayPduyet" [nzDisabled]="true"
                nzFormat="dd/MM/yyyy">
              </nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="11">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Trích yếu</nz-form-label>
            <nz-form-control nz-col [nzSpan]="24">
              <nz-form-control nz-col [nzSpan]="24">
                <input nz-input formControlName="trichYeu" [readOnly]="isView || isNhanDieuChuyen" />
              </nz-form-control>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired>Lý do điều chuyển</nz-form-label>
            <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập Lý do điều chuyển'">
              <nz-form-control nz-col [nzSpan]="24">
                <input nz-input formControlName="lyDoDc" [readOnly]="isView || isNhanDieuChuyen" />
              </nz-form-control>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
      <div nz-col nzSpan="24">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true" nzSpan="24">
            Căn cứ pháp lý
          </nz-form-label>
        </nz-form-item>
        <nz-form-item>
          <div class="list-file" nz-col nzSpan="24">
            <file-list [data]="formData.value.canCu" [isViewDetail]="isView || isNhanDieuChuyen">
            </file-list>
          </div>
        </nz-form-item>
      </div>
    </form>
  </nz-card>
  <nz-card class="mt-16 flex-card p-lr16">
    <form nzLayout="vertical" nz-form [formGroup]="formData">
      <div nz-row [nzGutter]="24">
        <div nz-col [nzSpan]="8">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired>Chi cục đề xuất điều chuyển</nz-form-label>
            <nz-form-control nz-col [nzSpan]="24">
              <nz-form-control nz-col [nzSpan]="24">
                <input nz-input formControlName="tenDvi" [readOnly]="true" />
              </nz-form-control>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="8" *ngIf="formData.value.loaiDc==='CUC'">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired>Cục đề xuất điều chuyển</nz-form-label>
            <nz-form-control nz-col [nzSpan]="24">
              <nz-form-control nz-col [nzSpan]="24">
                <input nz-input formControlName="tenDviCuc" [readOnly]="true" />
              </nz-form-control>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="8" *ngIf="formData.value.loaiDc==='CUC'">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired>Cục nhận điều chuyển</nz-form-label>
            <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="'Vui lòng chọn Mã cục nhận'"
              [nzValidateStatus]="checkVld('maCucNhan')">
              <nz-select nzAllowClear
                [nzDisabled]="isView || (formData.value.danhSachHangHoa.length > 0) || isNhanDieuChuyen" nzShowSearch
                formControlName="maCucNhan" (ngModelChange)="changeCucNhan($event)">
                <nz-option *ngFor="let p of dsDonViNhan" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </form>
    <div class="mt16 flex-card p-lr16">
      <div class="header header-green-background mg-t-16">
        <div class="title-card">
          <div class="title-chi-tieu">
            <span></span>
            <span>Thông tin hàng DTQG cần điều chuyển</span>
          </div>
          <div>
            <button type="button" class="btn btn-main" (click)="showModal()" *ngIf="!(isView || isNhanDieuChuyen)">
              <i class="icon htvbdh_dau-cong"></i>
              <span>Thêm</span>
            </button>
          </div>
        </div>
      </div>
      <ng-container>
        <div class="mt-16">
          <nz-table #tblData [nzData]="tableView" class="nowrap table-chi-tiet" nzBordered>
            <thead>
              <tr>
                <th [rowspan]="2"></th>
                <th [rowspan]="2" style="width: 35px">STT</th>
                <th [rowspan]="2">Chi cục nhận điều chuyển</th>
                <th [rowspan]="2">Thời gian dự kiến điều chuyển</th>
                <th [colspan]="8">Ngăn kho đang bảo quản hàng cần điều chuyển</th>
                <th [colspan]="4">Ngăn kho nhận điều chuyển</th>
                <th [rowspan]="2" style="width: 10%">Hành động</th>
              </tr>
              <tr>
                <th>Điểm kho</th>
                <th>Lô kho</th>
                <th>Loại hàng hóa</th>
                <th>Chủng loại HH</th>
                <th>Năm nhập kho</th>
                <th>ĐVT</th>
                <th></th>
                <th>SL điều chuyển</th>
                <th>Dự toán kinh phí (triệu đồng)</th>
                <th>Điểm kho</th>
                <!--              <th>Nhà kho</th>-->
                <!--              <th>Ngăn kho</th>-->
                <th>Lô kho</th>
                <th>Tích lượng khả dụng</th>
                <th>SL phân bổ nhập điều chuyển</th>
              </tr>
            </thead>
            <tbody>

              <ng-container *ngFor="let item of tblData.data, let i = index;">
                <tr [ngClass]="{'bg-selected': item.selected}" (click)="selectRow(item)">
                  <td (nzExpandChange)="onExpandStringChange(item.idVirtual, $event)"
                    [nzExpand]="expandSetString.has(item.idVirtual)" nzShowExpand="true" style="width: 35px"></td>
                  <td>{{i + 1}}</td>
                  <td><strong>{{ item.tenChiCucNhan }}</strong></td>
                  <td>{{ item.thoiGianDkDc |date: globals.dateFormat }}</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td><strong>{{item.duToanKphi|number:'1.0-1' : 'vi_VN'}}</strong></td>
                  <!--                <td></td>-->
                  <!--                <td></td>-->
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td *ngIf="!isNhanDieuChuyen">
                    <a>
                      <i class="fa fa-edit" *ngIf="!isView" (click)="suaChiCuc(item)"></i>
                    </a>
                    <a>
                      <i class="fa fa-trash-o do" *ngIf="!isView" nz-popconfirm nz-button
                        nzPopconfirmTitle="Bạn có chắc muốn xóa ?" (nzOnConfirm)="xoaHangHoa(item,tableView)"></i>
                    </a>
                  </td>
                  <td *ngIf="isNhanDieuChuyen"></td>
                </tr>
                <ng-container *ngIf="expandSetString.has(item.idVirtual)">
                  <ng-container *ngFor="let lv1 of item.childData,let i1=index">
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td><strong>{{lv1.tenDiemKho}}</strong></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td><strong>{{lv1.duToanKphi|number:'1.0-1' : 'vi_VN'}}</strong></td>
                      <td></td>
                      <td></td>
                      <!--                    <td></td>-->
                      <!--                    <td></td>-->
                      <td></td>
                      <td></td>
                      <td *ngIf="!isNhanDieuChuyen">
                        <a>
                          <i class="fa fa-plus" *ngIf="!isView" (click)="addDiemKho(item)"></i>
                        </a>
                        <a>
                          <i class="fa fa-trash-o do" *ngIf="!isView" nz-popconfirm
                            nzPopconfirmTitle="Bạn có chắc muốn xóa ?" (nzOnConfirm)="xoaHangHoa(lv1,tableView)"></i>
                        </a>
                      </td>
                      <td *ngIf="isNhanDieuChuyen">
                      </td>
                    </tr>
                    <ng-container *ngIf="expandSetString.has(item.idVirtual)">
                      <ng-container *ngFor="let lv2 of lv1.childData,let i2=index">
                        <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td>{{lv2.tenLoKho ? lv2.tenLoKho + "-": ""}}{{lv2.tenNganKho}}-{{lv2.tenNhaKho}}</td>
                          <td>{{lv2.tenLoaiVthh}}</td>
                          <td>{{lv2.tenCloaiVthh}}</td>
                          <td>{{lv2.namNhap}}</td>
                          <td>{{lv2.donViTinh}}</td>
                          <td>{{lv2.tonKho|number:'1.0-1' : 'vi_VN'}}</td>
                          <td>{{lv2.soLuongDc|number:'1.0-1' : 'vi_VN'}}</td>
                          <td>{{lv2.duToanKphi|number:'1.0-1' : 'vi_VN'}}</td>
                          <td></td>
                          <td></td>
                          <!--                        <td></td>-->
                          <!--                        <td></td>-->
                          <td></td>
                          <td></td>
                          <td *ngIf="!isNhanDieuChuyen">
                            <a>
                              <i class="fa fa-edit" *ngIf="!isView" (click)="suaHangHoa(lv2)"></i>
                            </a>
                            <a>
                              <i class="fa fa-trash-o do" *ngIf="!isView" nz-popconfirm nz-button
                                nzPopconfirmTitle="Bạn có chắc muốn xóa ?" (nzOnConfirm)="xoaHangHoa(lv2)"></i>
                            </a>
                          </td>
                          <td *ngIf="isNhanDieuChuyen">
                            <a>
                              <i class="fa fa-plus" *ngIf="!isView"
                                (click)="addDiemKhoNhan(lv2) && userService.isAccessPermisson('DCNB_KHDC_PHANBODC')"></i>
                            </a>
                          </td>
                        </tr>
                        <ng-container *ngIf="expandSetString.has(item.idVirtual)">
                          <ng-container *ngFor="let lv3 of lv2.childData,let i3=index">
                            <tr>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td><strong>{{lv3.tenDiemKhoNhan}}</strong></td>
                              <td></td>
                              <!--                            <td></td>-->
                              <!--                            <td></td>-->
                              <td></td>
                              <td></td>
                              <td *ngIf="!isNhanDieuChuyen"></td>
                              <td *ngIf="isNhanDieuChuyen">
                                <a>
                                  <i class="fa fa-plus" *ngIf="!isView"
                                    (click)="addDiemKhoNhan(lv2) && userService.isAccessPermisson('DCNB_KHDC_PHANBODC')"></i>
                                </a>
                                <a>
                                  <i class="fa fa-trash-o do" *ngIf="!isView" nz-popconfirm nz-button
                                    nzPopconfirmTitle="Bạn có chắc muốn xóa ?" (nzOnConfirm)="xoaHangHoa(lv3)"></i>
                                </a>
                              </td>
                            </tr>
                            <ng-container *ngIf="expandSetString.has(item.idVirtual)">
                              <ng-container *ngFor="let lv4 of lv3.childData,let i4=index">
                                <tr>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <!--                                <td>{{lv4.tenNhaKhoNhan}}</td>-->
                                  <!--                                <td>{{lv4.tenNganKhoNhan}}</td>-->
                                  <td>{{lv4.tenLoKhoNhan ? lv4.tenLoKhoNhan + "-":
                                    ""}}{{lv4.tenNganKhoNhan}}-{{lv4.tenNhaKhoNhan}}</td>
                                  <td>{{lv4.tichLuongKd}}</td>
                                  <td>{{lv4.soLuongPhanBo}}</td>
                                  <td *ngIf="!isNhanDieuChuyen"></td>
                                  <td *ngIf="isNhanDieuChuyen">
                                    <a>
                                      <i class="fa fa-edit" *ngIf="!isView"
                                        (click)="suaHangHoa(lv4) && userService.isAccessPermisson('DCNB_KHDC_PHANBODC')"></i>
                                    </a>
                                    <a>
                                      <i class="fa fa-trash-o do" *ngIf="!isView" nz-popconfirm nz-button
                                        nzPopconfirmTitle="Bạn có chắc muốn xóa ?" (nzOnConfirm)="xoaHangHoa(lv4)"></i>
                                    </a>
                                  </td>
                                </tr>
                              </ng-container>
                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </ng-container>
            </tbody>
          </nz-table>
        </div>
      </ng-container>

    </div>
    <nz-collapse nzAccordion>
      <nz-collapse-panel [nzHeader]="'PHƯƠNG ÁN ĐIỀU CHUYỂN'" [nzActive]="true">
        <div class="mt16 flex-card p-lr16">
          <ng-container>
            <div class="mt-16">
              <nz-table class="nowrap table-chi-tiet" nzBordered>
                <thead>
                  <tr>
                    <th>STT</th>
                    <th>Chi cục nhận điều chuyển</th>
                    <th>Hình thức lựa chọn đơn vị cung cấp DV vận chuyển</th>
                    <th>Phương thức giao hàng</th>
                    <th>Phương thức nhận hàng</th>
                    <th>Nguồn chi</th>
                  </tr>
                </thead>
                <tbody [formGroup]="tableForm">
                  <ng-container formArrayName="rows">
                    <tr *ngFor="let row of rows.controls; let i = index" [formGroupName]="i">
                      <td>{{i + 1}}</td>
                      <td>
                        {{valueRow(i).tenChiCucNhan}}
                      </td>
                      <td>
                        <nz-form-item>
                          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="'Vui lòng chọn'"
                            [nzValidateStatus]="checkVld('hinhThucDvCcDvVanChuyen')">
                            <nz-select formControlName="hinhThucDvCcDvVanChuyen"
                              [nzDisabled]="isView || isNhanDieuChuyen"
                              (ngModelChange)="changeHinhThucDvCcDvVanChuyen($event,row)">
                              <nz-option *ngFor="let p of listHinhThucDvCcDvVanChuyen" [nzValue]="p.ma"
                                [nzLabel]="p.giaTri">
                              </nz-option>
                            </nz-select>
                          </nz-form-control>
                        </nz-form-item>
                      </td>
                      <td>
                        <nz-form-item>
                          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="'Vui lòng chọn'"
                            [nzValidateStatus]="checkVld('hinhThucDvCcDvVanChuyen')">
                            <nz-select formControlName="pthucGiaoHang" [nzDisabled]="isView || isNhanDieuChuyen"
                              (ngModelChange)="changePtGiaoHang($event,row)">
                              <nz-option *ngFor="let p of listPtGiaoHang" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                              </nz-option>
                            </nz-select>
                          </nz-form-control>
                        </nz-form-item>
                      </td>
                      <td>
                        <nz-form-item>
                          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="'Vui lòng chọn'"
                            [nzValidateStatus]="checkVld('hinhThucDvCcDvVanChuyen')">
                            <nz-select formControlName="pthucNhanHang" [nzDisabled]="isView || isNhanDieuChuyen"
                              (ngModelChange)="changePtNhanHang($event,row)">
                              <nz-option *ngFor="let p of listPtNhanHang" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                              </nz-option>
                            </nz-select>
                          </nz-form-control>
                        </nz-form-item>
                      </td>
                      <td>
                        <nz-form-item>
                          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="'Vui lòng chọn'"
                            [nzValidateStatus]="checkVld('hinhThucDvCcDvVanChuyen')">
                            <nz-select formControlName="nguonChi" [nzDisabled]="isView || isNhanDieuChuyen"
                              (ngModelChange)="changeNguonChi($event,row)">
                              <nz-option *ngFor="let p of listNguonChi" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                              </nz-option>
                            </nz-select>
                          </nz-form-control>
                        </nz-form-item>
                      </td>
                    </tr>
                  </ng-container>
                </tbody>
              </nz-table>
            </div>
          </ng-container>

        </div>
      </nz-collapse-panel>
    </nz-collapse>


    <div nz-col [nzSpan]="24">
      <form nzLayout="vertical" nz-form [formGroup]="formData">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true" nzRequired>
            Trách nhiệm của đơn vị thực hiện
          </nz-form-label>
          <nz-form-control>
            <textarea rows="3" nz-input formControlName="trachNhiemDviTh"
              [readOnly]="isView || isNhanDieuChuyen"></textarea>
          </nz-form-control>
        </nz-form-item>
      </form>
    </div>
  </nz-card>
</div>

<nz-modal [nzWidth]="isNhanDieuChuyen ? '1200px':'960px'" [(nzVisible)]="isVisible" [nzFooter]="modalFooter"
  [nzClosable]="true" (nzOnCancel)="handleCancel()" nzTitle="CHI TIẾT HÀNG DTQG CẦN ĐIỀU CHUYỂN">
  <ng-container *nzModalContent>
    <!--    <form nz-form>-->
    <div class="dcnb modal-card" *ngIf="!isNhanDieuChuyen">
      <form nzLayout="vertical" nz-form [formGroup]="formDataChiTiet">
        <nz-card nzTitle="Thông tin chi cục nhận điều chuyển">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="7" class="dcnb-label">Chi cục nhận điều chuyển
            </nz-form-label>
            <nz-form-control [nzErrorTip]="'Vui lòng chọn chi cục nhận điều chuyển'"
              [nzValidateStatus]="checkVld('maChiCucNhan')">
              <nz-select nzAllowClear [nzDisabled]="isView || isEditDetail || isAddDiemKho" nzShowSearch
                formControlName="maChiCucNhan" (ngModelChange)="changeDonViNhan($event)">
                <nz-option *ngFor="let p of listChiCucNhan" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="7" class="dcnb-label">Thời gian dự kiến điều
              chuyển
            </nz-form-label>
            <nz-form-control nz-col [nzSpan]="8" [nzErrorTip]="'Vui lòng nhập thời gian dự kiến điều chuyển'"
              [nzValidateStatus]="checkVld('thoiGianDkDc')">
              <nz-date-picker class="search__input" formControlName="thoiGianDkDc"
                [nzDisabled]="isView || isEditDetail || isAddDiemKho" nzFormat="dd/MM/yyyy">
              </nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </nz-card>
        <nz-card nzTitle="Ngăn kho đang bảo quản hàng cần DC">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="7" class="dcnb-label">Điểm kho</nz-form-label>
            <nz-form-control [nzErrorTip]="'Vui lòng chọn điểm kho'" [nzValidateStatus]="checkVld('maDiemKho')">
              <nz-select nzAllowClear [nzDisabled]="isView" nzShowSearch formControlName="maDiemKho"
                (ngModelChange)="changeDiemKho($event)">
                <nz-option *ngFor="let p of listDiemKhoBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="7" class="dcnb-label">Nhà kho</nz-form-label>
            <nz-form-control [nzErrorTip]="'Vui lòng chọn nhà kho'" [nzValidateStatus]="checkVld('maNhaKho')">
              <nz-select nzAllowClear [nzDisabled]="isView" nzShowSearch formControlName="maNhaKho"
                (ngModelChange)="changeNhaKho($event)">
                <nz-option *ngFor="let p of listNhaKhoBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="7" class="dcnb-label">Ngăn kho</nz-form-label>
            <nz-form-control [nzErrorTip]="'Vui lòng chọn ngăn kho'" [nzValidateStatus]="checkVld('maNganKho')">
              <nz-select nzAllowClear [nzDisabled]="isView" nzShowSearch formControlName="maNganKho"
                (ngModelChange)="changeNganKho($event)">
                <nz-option *ngFor="let p of listNganKhoBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item *ngIf="formDataChiTiet.value.coLoKho">
            <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="7" class="dcnb-label">Lô kho</nz-form-label>
            <nz-form-control [nzErrorTip]="'Vui lòng chọn lô kho'" [nzValidateStatus]="checkVld('maLoKho')">
              <nz-select nzAllowClear [nzDisabled]="isView" nzShowSearch formControlName="maLoKho"
                (ngModelChange)="changeLoKho($event)">
                <nz-option *ngFor="let p of listLoKhoBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="7" class="dcnb-label">Loại hàng hóa</nz-form-label>
            <span>{{formDataChiTiet.value.tenLoaiVthh}}</span>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="7" class="dcnb-label">Chủng loại hàng hóa</nz-form-label>
            <span>{{formDataChiTiet.value.tenCloaiVthh}}</span>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="7" class="dcnb-label">Năm nhập kho
            </nz-form-label>
            <span>{{formDataChiTiet.value.namNhap}}</span>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="7" class="dcnb-label">Tồn kho </nz-form-label>
            <span><span style="color: #001CFF">{{formDataChiTiet.value.tonKho |number : '1.0-1' :
                'vi_VN'}}</span><span>({{formDataChiTiet.value.donViTinh}})</span></span>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="7" nzRequired class="dcnb-label">SL điều chuyển
            </nz-form-label>
            <nz-form-control>
              <nz-input-number [nzDisabled]="isView" formControlName="soLuongDc" [nzMin]="1" [nzStep]="0.1"
                [nzSize]="'small'" [nzMax]="formDataChiTiet.value.tonKho" [nzFormatter]="globals.formatter"
                [nzParser]="globals.parser">
              </nz-input-number>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="7" nzRequired class="dcnb-label">Dự toán kinh phí (triệu
              đồng)
            </nz-form-label>
            <nz-form-control>
              <input class="money-input" currencyMask formControlName="duToanKphi" [options]="AMOUNT" />
              <!--              <nz-input-number [nzDisabled]="isView" formControlName="duToanKphi" [nzMin]="0" [nzMax]="999999999999"-->
              <!--                               [nzStep]="0.1"-->
              <!--                               [nzSize]="'small'" [nzFormatter]="globals.formatter" [nzParser]="globals.parser">-->
              <!--              </nz-input-number>-->
            </nz-form-control>
          </nz-form-item>
        </nz-card>
      </form>
    </div>
    <div class="dcnb modal-card flex-card pd-l-6 pd-r-6" *ngIf="isNhanDieuChuyen">
      <form nzLayout="vertical" nz-form [formGroup]="formDataChiTiet">
        <nz-card nzTitle="Thông tin chi cục nhận điều chuyển">
          <div nz-row [nzGutter]="24">
            <div nz-col [nzSpan]="14">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="10" class="dcnb-label">Chi cục nhận điều
                  chuyển
                </nz-form-label>
                <nz-form-control [nzErrorTip]="'Vui lòng chọn chi cục nhận điều chuyển'"
                  [nzValidateStatus]="checkVld('maChiCucNhan')">
                  <nz-select nzAllowClear [nzDisabled]="isView || isEditDetail || isAddDiemKho || isNhanDieuChuyen"
                    nzShowSearch formControlName="maChiCucNhan" (ngModelChange)="changeDonViNhan($event)">
                    <nz-option *ngFor="let p of listChiCucNhan" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="10">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="14" class="dcnb-label">Thời gian dự kiến
                  điều
                  chuyển
                </nz-form-label>
                <nz-form-control nz-col [nzErrorTip]="'Vui lòng nhập thời gian dự kiến điều chuyển'"
                  [nzValidateStatus]="checkVld('thoiGianDkDc')">
                  <nz-date-picker class="search__input" formControlName="thoiGianDkDc"
                    [nzDisabled]="isView || isEditDetail || isAddDiemKho || isNhanDieuChuyen" nzFormat="dd/MM/yyyy">
                  </nz-date-picker>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

        </nz-card>
        <div nz-row [nzGutter]="24">
          <div nz-col [nzSpan]="12">
            <nz-card nzTitle="Ngăn kho đang bảo quản hàng cần DC">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="8" class="dcnb-label">Điểm kho
                </nz-form-label>
                <nz-form-control [nzErrorTip]="'Vui lòng chọn điểm kho'" [nzValidateStatus]="checkVld('maDiemKho')">
                  <nz-select nzAllowClear [nzDisabled]="isView || isNhanDieuChuyen" nzShowSearch
                    formControlName="maDiemKho" (ngModelChange)="changeDiemKho($event)">
                    <nz-option *ngFor="let p of listDiemKhoBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="8" class="dcnb-label">Nhà kho
                </nz-form-label>
                <nz-form-control [nzErrorTip]="'Vui lòng chọn nhà kho'" [nzValidateStatus]="checkVld('maNhaKho')">
                  <nz-select nzAllowClear [nzDisabled]="isView || isNhanDieuChuyen" nzShowSearch
                    formControlName="maNhaKho" (ngModelChange)="changeNhaKho($event)">
                    <nz-option *ngFor="let p of listNhaKhoBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="8" class="dcnb-label">Ngăn kho
                </nz-form-label>
                <nz-form-control [nzErrorTip]="'Vui lòng chọn ngăn kho'" [nzValidateStatus]="checkVld('maNganKho')">
                  <nz-select nzAllowClear [nzDisabled]="isView || isNhanDieuChuyen" nzShowSearch
                    formControlName="maNganKho" (ngModelChange)="changeNganKho($event)">
                    <nz-option *ngFor="let p of listNganKhoBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item *ngIf="formDataChiTiet.value.coLoKho">
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="8" class="dcnb-label">Lô kho
                </nz-form-label>
                <nz-form-control [nzErrorTip]="'Vui lòng chọn lô kho'" [nzValidateStatus]="checkVld('maLoKho')">
                  <nz-select nzAllowClear [nzDisabled]="isView || isNhanDieuChuyen" nzShowSearch
                    formControlName="maLoKho" (ngModelChange)="changeLoKho($event)">
                    <nz-option *ngFor="let p of listLoKhoBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="8" class="dcnb-label">Loại hàng hóa</nz-form-label>
                <span>{{formDataChiTiet.value.tenLoaiVthh}}</span>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="8" class="dcnb-label">Chủng loại hàng hóa
                </nz-form-label>
                <span>{{formDataChiTiet.value.tenCloaiVthh}}</span>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="8" class="dcnb-label">Tồn kho </nz-form-label>
                <span><span style="color: #001CFF">{{formDataChiTiet.value.tonKho |number : '1.0-1' :
                    'vi_VN'}}</span><span>({{formDataChiTiet.value.donViTinh}})</span></span>
              </nz-form-item>

              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="8" nzRequired class="dcnb-label">SL điều chuyển
                </nz-form-label>
                <nz-form-control>
                  <nz-input-number [nzDisabled]="isView || isNhanDieuChuyen" formControlName="soLuongDc" [nzMin]="1"
                    [nzStep]="0.1" [nzSize]="'small'" [nzMax]="formDataChiTiet.value.tonKho"
                    [nzFormatter]="globals.formatter" [nzParser]="globals.parser">
                  </nz-input-number>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="8" nzRequired class="dcnb-label">Dự toán kinh phí
                  (triệu
                  đồng)
                </nz-form-label>
                <nz-form-control>
                  <input class="money-input" currencyMask formControlName="duToanKphi" [options]="AMOUNT" />
                  <!--                  <nz-input-number [nzDisabled]="isView || isNhanDieuChuyen" formControlName="duToanKphi" [nzMin]="0"-->
                  <!--                                   [nzMax]="999999999999" [nzStep]="0.1"-->
                  <!--                                   [nzSize]="'small'" [nzFormatter]="globals.formatter" [nzParser]="globals.parser">-->
                  <!--                  </nz-input-number>-->
                </nz-form-control>
              </nz-form-item>
            </nz-card>
          </div>
          <div nz-col [nzSpan]="12">
            <nz-card nzTitle="Ngăn kho nhận điều chuyển">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="8" class="dcnb-label">Điểm kho
                </nz-form-label>
                <nz-form-control [nzErrorTip]="'Vui lòng chọn điểm kho'" [nzValidateStatus]="checkVld('maDiemKhoNhan')">
                  <nz-select nzAllowClear [nzDisabled]="isView" nzShowSearch formControlName="maDiemKhoNhan"
                    (ngModelChange)="changeDiemKhoNhan($event)">
                    <nz-option *ngFor="let p of listDiemKhoNhanBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="8" class="dcnb-label">Nhà kho
                </nz-form-label>
                <nz-form-control [nzErrorTip]="'Vui lòng chọn nhà kho'" [nzValidateStatus]="checkVld('maNhaKhoNhan')">
                  <nz-select nzAllowClear [nzDisabled]="isView" nzShowSearch formControlName="maNhaKhoNhan"
                    (ngModelChange)="changeNhaKhoNhan($event)">
                    <nz-option *ngFor="let p of listNhaKhoNhanBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="8" class="dcnb-label">Ngăn kho
                </nz-form-label>
                <nz-form-control [nzErrorTip]="'Vui lòng chọn ngăn kho'" [nzValidateStatus]="checkVld('maNganKhoNhan')">
                  <nz-select nzAllowClear [nzDisabled]="isView" nzShowSearch formControlName="maNganKhoNhan"
                    (ngModelChange)="changeNganKhoNhan($event)">
                    <nz-option *ngFor="let p of listNganKhoNhanBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item *ngIf="formDataChiTiet.value.coLoKhoNhan">
                <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="8" class="dcnb-label">Lô kho
                </nz-form-label>
                <nz-form-control [nzErrorTip]="'Vui lòng chọn lô kho'" [nzValidateStatus]="checkVld('maLoKhoNhan')">
                  <nz-select nzAllowClear [nzDisabled]="isView" nzShowSearch formControlName="maLoKhoNhan"
                    (ngModelChange)="changeLoKhoNhan($event)">
                    <nz-option *ngFor="let p of listLoKhoNhanBq" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="8" class="dcnb-label">Tích lượng khả dụng
                </nz-form-label>
                <span>{{formDataChiTiet.value.tichLuongKd}} (kg)</span>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="8" nzRequired class="dcnb-label">SL nhập ĐC
                </nz-form-label>
                <nz-form-control>
                  <nz-input-number formControlName="soLuongPhanBo" [nzMin]="1" [nzStep]="0.1" [nzSize]="'small'"
                    [nzMax]="formDataChiTiet.value.tichLuongKd" (ngModelChange)="changeSoLuongPhanBo($event)"
                    [nzFormatter]="globals.formatter" [nzParser]="globals.parser">
                  </nz-input-number>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" nz-col [nzSpan]="8" class="dcnb-label">Số lượng điều chuyển còn lại
                  (kg)
                </nz-form-label>
                <span>{{formDataChiTiet.value.slDcConLai}}</span>
              </nz-form-item>
            </nz-card>
          </div>
        </div>

      </form>
    </div>
  </ng-container>
  <ng-template #modalFooter>
    <div class="modal-footer">
      <div class="dcnb-footer nut">
        <div class="cantrai">
        </div>
        <div class="canphai">
          <button nz-button (click)="handleCancel()" class="modal__button--cancel">
            <i nz-icon nzType="close-circle" nzTheme="fill" class="icon-cancel"></i>
            Hủy bỏ
          </button>
          <button nz-button (click)="handleOk()" class="modal__button--save">
            <i class="icon htvbdh_tcdt_pheduyet"></i>
            Lưu
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</nz-modal>

<!--modal sua noi dung-->
<nz-modal [nzWidth]="'50%'" [(nzVisible)]="isVisibleSuaChiCuc" [nzFooter]="modalFooterSuaNoiDung" [nzClosable]="false"
  nzTitle="Thông tin chi cục nhận điều chuyển">
  <ng-container *nzModalContent>
    <!--    <form nz-form>-->
    <div class="modal-card">
      <form nzLayout="vertical" nz-form [formGroup]="formDataChiTiet">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="7" class="dcnb-label">Chi cục nhận điều
            chuyển
          </nz-form-label>
          <nz-form-control [nzErrorTip]="'Vui lòng chọn chi cục nhận điều chuyển'"
            [nzValidateStatus]="checkVld('maChiCucNhan')">
            <nz-select nzAllowClear [nzDisabled]="true" nzShowSearch formControlName="maChiCucNhan"
              (ngModelChange)="changeDonViNhan($event)">
              <nz-option *ngFor="let p of listChiCucNhan" [nzLabel]="p.tenDvi" [nzValue]="p.maDvi"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzNoColon]="true" nzRequired nz-col [nzSpan]="7" class="dcnb-label">Thời gian dự kiến điều
            chuyển
          </nz-form-label>
          <nz-form-control nz-col [nzSpan]="8" [nzErrorTip]="'Vui lòng nhập thời gian dự kiến điều chuyển'"
            [nzValidateStatus]="checkVld('thoiGianDkDc')">
            <nz-date-picker class="search__input" formControlName="thoiGianDkDc" [nzDisabled]="isView"
              nzFormat="dd/MM/yyyy">
            </nz-date-picker>
          </nz-form-control>
        </nz-form-item>
      </form>
    </div>
  </ng-container>
  <ng-template #modalFooterSuaNoiDung>
    <button nz-button (click)="handleCancelSuaChiCuc()">Đóng</button>
    <button nz-button class="btn btn-main" (click)="handleOkSuaChiCuc()">Lưu</button>
  </ng-template>
</nz-modal>