<nz-affix [nzOffsetTop]="globals.prop.MENU_LV1" class="btn-affix">
    <div class="btn-group">
        <button type="button" class="btn btn-sub" (click)="back()">
            <i class="fa fa-arrow-left"></i>
            <span>Quay lại</span>
        </button>
        <button class="btn btn-sub btn-sm waves-effect waves-light" *ngIf="!isDisableField() && !isView"
            (click)="guiDuyet()" [disabled]="!formData.valid">
            <i class="icon htvbdh_tcdt_guiduyet"></i>
            <span>Lưu và gửi duyệt</span>
        </button>
        <button class="btn btn-sub btn-sm waves-effect waves-light"
            *ngIf="khBanDauGia.trangThai == globals.prop.NHAP_CHO_DUYET_LD_VU" (click)="pheDuyet()">
            <i class="icon htvbdh_tcdt_pheduyet"></i>
            <span>Duyệt</span>
        </button>
        <button type="button" class="btn btn-sub" *ngIf="khBanDauGia.trangThai == globals.prop.NHAP_CHO_DUYET_LD_VU"
            (click)="tuChoi()">
            <i class="icon htvbdh_tcdt_tuchoi do"></i>
            <span>Từ chối</span>
        </button>
        <button *ngIf="!isDisableField() && !isView" (click)="save(false)"
            class="btn btn-main btn-sm waves-effect waves-light" [disabled]="!formData.valid">
            <i class="icon htvbdh_tcdt_save"></i>
            <span>Lưu</span>
        </button>
    </div>
</nz-affix>
<div class="bg-trang">
    <div class="mt16 flex-card p-lr16">
        <div class="header mg-t-16">
            <div class="header-text">
                <div class="title-chi-tieu">
                    <span *ngIf="!khBanDauGia.id" class="du-thao-va-lanh-dao-duyet">
                        Dự Thảo
                    </span>
                    <span *ngIf="khBanDauGia.id"
                        [ngClass]="thongTinTrangThai(khBanDauGia.trangThai)">{{khBanDauGia.tenTrangThai}}</span>
                    <span>Thông tri duyệt y dự toán</span>
                </div>
            </div>
        </div>
        <form nzLayout="vertical" nz-form [formGroup]="formData">
            <div nz-row [nzGutter]="[24]">
                <div nz-col [nzSpan]="4">
                    <nz-form-item>
                        <nz-form-label nzRequired [nzNoColon]="true"> Số thông tri </nz-form-label>
                        <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                            <input nz-input formControlName="soThongTri" [readonly]="isView" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="2">
                    <nz-form-item>
                        <nz-form-label nzRequired [nzNoColon]="true"> Năm </nz-form-label>
                        <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                            <nz-select formControlName="nam" [nzDisabled]="isView">
                                <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="3">
                    <nz-form-item>
                        <nz-form-label nzRequired [nzNoColon]="true"> Ngày lập </nz-form-label>
                        <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                            <nz-input-group>
                                <nz-date-picker class="search__input" formControlName="ngayLap" [nzDisabled]="isView">
                                </nz-date-picker>
                            </nz-input-group>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="3">
                    <nz-form-item>
                        <nz-form-label nzRequired [nzNoColon]="true"> Số đề nghị cấp phí </nz-form-label>
                        <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                            <nz-select formControlName="soDnCapPhi" [nzDisabled]="isView">
                                <nz-option *ngFor="let p of listDeNghi" [nzValue]="p.id" [nzLabel]="p.soDeNghi">
                                </nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="3">
                    <nz-form-item>
                        <nz-form-label nzRequired [nzNoColon]="true"> Đơn vị </nz-form-label>
                        <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                            <nz-select formControlName="maDvi" [nzDisabled]="isView">
                                <nz-option *ngFor="let p of dsBoNganh" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                                </nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="3">
                    <nz-form-item>
                        <nz-form-label nzRequired [nzNoColon]="true"> Chương </nz-form-label>
                        <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                            <input nz-input formControlName="chuong" [readonly]="isView" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="3">
                    <nz-form-item>
                        <nz-form-label nzRequired [nzNoColon]="true"> Loại </nz-form-label>
                        <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                            <input nz-input formControlName="loai" [readonly]="isView" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="3">
                    <nz-form-item>
                        <nz-form-label nzRequired [nzNoColon]="true"> Khoản </nz-form-label>
                        <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                            <input nz-input formControlName="khoan" [readonly]="isView" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <ng-template #error let-control>
                <app-template-error #error [control]="control"></app-template-error>
            </ng-template>
        </form>
    </div>
    <div class="mt-16 flex-card p-lr16">
        <nz-card class="mt-16 flex-card data-table card-border-content table-card">
            <nz-table #phanBo class="nowrap mt-16 table-chi-tiet" nzBordered [nzData]="chiTietList">
                <thead>
                    <tr>
                        <th style="width: 35px">STT</th>
                        <th>Mục</th>
                        <th>Tiểu mục</th>
                        <th>Số tiền</th>
                        <th>Chú thích</th>
                        <th>Hành động</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th>
                            <nz-input-group>
                                <input type="text" nz-input [(ngModel)]="rowItem.muc" />
                            </nz-input-group>
                        </th>
                        <th>
                            <nz-input-group>
                                <input type="text" nz-input [(ngModel)]="rowItem.tieuMuc" />
                            </nz-input-group>
                        </th>
                        <th>
                            <nz-input-group>
                                <nz-input-number [nzMin]="1" [nzMax]="" [nzSize]="'small'" [(ngModel)]="rowItem.soTien">
                                </nz-input-number>
                            </nz-input-group>
                        </th>
                        <th>
                            <nz-input-group>
                                <input type="text" nz-input [(ngModel)]="rowItem.chuThich" />
                            </nz-input-group>
                        </th>
                        <th>
                            <a (click)="them()">
                                <i class="table-icon icon htvbdh_dau-cong"></i>
                            </a>
                            <a (click)="clear()">
                                <i class="table-icon icon  htvbdh_nhap-lai1"></i>
                            </a>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of chiTietList, let idx = index">
                        <ng-container *ngIf="!item.edit; else editTemplate">
                            <td>{{idx+1}}</td>
                            <td>{{item.muc}}</td>
                            <td>{{item.tieuMuc}}</td>
                            <td>{{item.soTien}}</td>
                            <td>{{item.chuThich}}</td>
                            <td>
                                <a (click)="showEditItem(idx, 'show')">
                                    <i class="fa fa-pencil"></i>
                                </a>
                                <a (click)="xoaItem(idx)">
                                    <i class="fa fa-trash-o do"></i>
                                </a>
                            </td>
                        </ng-container>
                        <ng-template #editTemplate>
                            <td>{{idx+1}}</td>
                            <td>
                                <nz-input-group>
                                    <input type="text" nz-input [(ngModel)]="item.muc" />
                                </nz-input-group>
                            </td>
                            <th>
                                <nz-input-group>
                                    <input type="text" nz-input [(ngModel)]="item.tieuMuc" />
                                </nz-input-group>
                            </th>
                            <th>
                                <nz-input-group>
                                    <nz-input-number [nzMin]="1" [nzMax]="" [nzSize]="'small'"
                                        [(ngModel)]="item.soTien">
                                    </nz-input-number>
                                </nz-input-group>
                            </th>
                            <th>
                                <nz-input-group>
                                    <input type="text" nz-input [(ngModel)]="item.chuThich" />
                                </nz-input-group>
                            </th>
                            <td>
                                <a class="save" (click)="showEditItem(idx, 'save')">
                                    <i class="fa fa-save"></i>
                                </a>
                                <a (click)="showEditItem(idx, 'huy')">
                                    <i class="fa fa-times do"></i>
                                </a>
                            </td>
                        </ng-template>
                    </tr>
                </tbody>
            </nz-table>
        </nz-card>
    </div>
    <form nzLayout="vertical" nz-form [formGroup]="formData">
        <div nz-row [nzGutter]="[24]">
            <div nz-col [nzSpan]="24">
                <nz-form-item>
                    <nz-form-label nzRequired [nzNoColon]="true"> Nhận xét </nz-form-label>
                    <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                        <input nz-input formControlName="nhanXet" [readonly]="isView" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col nzSpan="24">
                <nz-form-item>
                    <nz-form-label [nzNoColon]="true">
                        File đính kèm
                    </nz-form-label>
                    <div class="list-file">
                        <file-list [data]="listFileDinhKem" [isViewDetail]="isView"></file-list>
                    </div>
                </nz-form-item>
            </div>
        </div>
    </form>
</div>