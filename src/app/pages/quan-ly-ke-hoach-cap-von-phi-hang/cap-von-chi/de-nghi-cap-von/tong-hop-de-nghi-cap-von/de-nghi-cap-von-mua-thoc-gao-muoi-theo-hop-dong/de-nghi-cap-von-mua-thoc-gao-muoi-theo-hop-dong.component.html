<ng-container *ngIf="isDataAvailable">
	<nz-affix [nzOffsetTop]="globals.prop.MENU_LV1" class="btn-affix">
		<div class="btn-group">
			<button type="button" class="btn btn-sub" (click)="back()">
				<i class="fa fa-arrow-left"></i>
				<span>Quay lại</span>
			</button>
			<button *ngIf="saveStatus" type="button" class="btn btn-sub" (click)="action('save')">
				<i class="icon htvbdh_tcdt_save"></i>
				<span>Lưu</span>
			</button>
			<button *ngIf="submitStatus" type="button" class="btn btn-sub" (click)="action('submit')">
				<i class="icon htvbdh_tcdt_guiduyet"></i>
				<span>Trình duyệt</span>
			</button>
			<!-- <button *ngIf="passStatus" type="button" class="btn btn-sub" (click)="action('nonpass')">
                <i class="icon htvbdh_tcdt_tuchoi"></i>
                <span>Từ chối</span>
            </button>
            <button *ngIf="passStatus" type="button" class="btn btn-sub" (click)="action('pass')">
                <i class="icon htvbdh_tcdt_pheduyet"></i>
                <span>Duyệt</span>
            </button> -->
			<button *ngIf="approveStatus" type="button" class="btn btn-sub" (click)="action('nonapprove')">
				<i class="icon htvbdh_tcdt_tuchoi"></i>
				<span>Từ chối</span>
			</button>
			<button *ngIf="approveStatus" type="button" class="btn btn-sub" (click)="action('approve')">
				<i class="icon htvbdh_tcdt_pheduyet"></i>
				<span>Phê duyệt</span>
			</button>
			<button *ngIf="copyStatus" type="button" class="btn btn-sub" (click)="showDialogCopy()">
				<i nz-icon nzType="copy" nzTheme="outline"></i>
				<span>Copy</span>
			</button>
		</div>
	</nz-affix>

	<div class="bg-trang">
		<div class="mt16 flex-card p-lr16">
			<div class="header mg-t-16">
				<div class="header-text">
					<div class="title-chi-tieu">
						<span [ngClass]="statusClass()">{{getStatusName()}}</span>
						<span>Đề nghị cấp vốn chi dự trữ quốc gia</span>
					</div>
				</div>
			</div>
			<nz-card class="mt-2px flex-card data-table card-border-content table-card">
				<nz-table class="nowrap mt-16 table-chi-tiet">
					<thead>
						<tr>
							<th>Mã đề nghị</th>
							<th>Năm đề nghị</th>
							<th>Quyết định chỉ tiêu</th>
							<th>Loại hợp đồng</th>
							<th>Căn cứ giá</th>
							<th>Công văn</th>
							<th>Số lần</th>
							<th>Ngày lập</th>
							<th>Ngày trình duyệt</th>
							<th>Ngày duyệt</th>
							<th>Ngày phê duyệt</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>{{ baoCao.maDnghi }}</td>
							<td>{{ baoCao.namBcao }}</td>
							<td>{{ baoCao.soQdChiTieu }}</td>
							<td>
								<ng-container *ngFor="let item of loaiDns">
									<ng-container *ngIf="baoCao.loaiDnghi == item.id">
										{{ item.tenDm }}
									</ng-container>
								</ng-container>
							</td>
							<td>
								<ng-container *ngFor="let item of canCuGias">
									<ng-container *ngIf="baoCao.canCuVeGia == item.id">
										{{ item.tenDm }}
									</ng-container>
								</ng-container>
							</td>
							<td>
								<nz-upload [nzBeforeUpload]="beforeUploadCV" *ngIf="statusCv">
									<button nz-button>
										<i nz-icon nzType="upload"></i>
										Chọn tệp
									</button>
								</nz-upload>
								<div class="tep__sqd" (click)="downloadFileCv()">
									<!-- <i class="icon htvbdh_tcdt_tep"></i> -->
									<span>{{ baoCao.congVan?.fileName }}</span>
								</div>
							</td>
							<td>{{ baoCao.soLan }}</td>
							<td>{{ getDate(baoCao.ngayTao) }}</td>
							<td>{{ getDate(baoCao.ngayTrinh) }}</td>
							<td>{{ getDate(baoCao.ngayDuyet) }}</td>
							<td>{{ getDate(baoCao.ngayPheDuyet) }}</td>
						</tr>
					</tbody>
				</nz-table>
			</nz-card>
		</div>

		<div class="mt-16 flex-card p-lr16">
			<nz-card class="mt-2px flex-card data-table card-border-content table-card" nzTitle="Danh sách hợp đồng">
				<!-- <div id="tablePrint">
					<nz-table class="table__body" nzBordered [nzScroll]="{x: scrollX}">
						<thead>
							<tr>
								<th rowspan="2" nzWidth="50px" nzLeft>STT</th>
								<th rowspan="2" nzWidth="250px" nzLeft>Cục DTNNKV</th>
								<th colspan="2">Số lượng</th>
								<th rowspan="2">Giá trị hợp đồng (đã <br /> bao gồm VAT)(đồng)</th>
								<th rowspan="2">Dự toán đã giao <br /> (đồng)</th>
								<th colspan="3">Lũy kế vốn cấp thời điểm báo cáo</th>
								<th rowspan="2">Tổng vốn và <br /> dự toán đã cấp</th>
								<th rowspan="2">Vốn đề nghị cấp <br /> lần này</th>
								<th colspan="3">Vốn duyệt cấp lần này</th>
								<th rowspan="2">Tổng cấp (Tổng tiền <br /> được cấp sau lần này)</th>
								<th rowspan="2">Số còn được cấp</th>
								<th rowspan="2" style="width: 200px;">Ghi chú</th>
								<th rowspan="2" style="width: 50px;" *ngIf="status" nzRight></th>
							</tr>
							<tr>
								<th>Kế hoạch</th>
								<th>Hợp đồng</th>
								<th>Cộng</th>
								<th>Cấp vốn</th>
								<th>Ứng vốn</th>
								<th>Cộng</th>
								<th>Cấp vốn</th>
								<th>Ứng vốn</th>
							</tr>
							<tr>
								<th nzLeft>A</th>
								<th nzLeft>B</th>
								<th>1</th>
								<th>2</th>
								<th>3</th>
								<th>4</th>
								<th>5=6+7</th>
								<th>6</th>
								<th>7</th>
								<th>8=4+5</th>
								<th>9=3-8</th>
								<th>10=11+12</th>
								<th>11</th>
								<th>12</th>
								<th>13=8+10</th>
								<th>14=3-13</th>
								<th>D</th>
								<th *ngIf="status" nzRight></th>
							</tr>
							<tr>
								<th nzLeft></th>
								<th nzLeft>Tổng cộng</th>
								<th>{{displayValue(total.slKeHoach)}}</th>
								<th>{{displayValue(total.slHopDong)}}</th>
								<th>{{displayValue(total.gtHopDong)}}</th>
								<th>{{displayValue(total.duToanDaGiao)}}</th>
								<th>{{displayValue(total.luyKeCong)}}</th>
								<th>{{displayValue(total.luyKeCapVon)}}</th>
								<th>{{displayValue(total.luyKeCapUng)}}</th>
								<th>{{displayValue(total.tongVonVaDtDaCap)}}</th>
								<th>{{displayValue(total.vonDnghiCapLanNay)}}</th>
								<th>{{displayValue(total.vonDuyetCong)}}</th>
								<th>{{displayValue(total.vonDuyetCapVon)}}</th>
								<th>{{displayValue(total.vonDuyetCapUng)}}</th>
								<th>{{displayValue(total.tongCap)}}</th>
								<th>{{displayValue(total.soConDuocCap)}}</th>
								<th></th>
								<th *ngIf="status" nzRight></th>
							</tr>
						</thead>
						<tbody>
							<tr *ngFor="let data of baoCao.dnghiCapvonCtiets; let i = index">
								<ng-container *ngIf="!editCache[data.id].edit; else editTemplate">
									<td nzLeft>
										{{ i+1 }}
									</td>
									<td nzLeft>
										{{ data.tenDvi }}
									</td>
									<td>
										{{ displayValue(data.slKeHoach) }}
									</td>
									<td>
										{{ displayValue(data.slHopDong) }}
									</td>
									<td>
										{{ displayValue(data.gtHopDong) }}
									</td>
									<td>
										{{ displayValue(data.duToanDaGiao) }}
									</td>
									<td>
										{{ displayValue(data.luyKeCong) }}
									</td>
									<td>
										{{ displayValue(data.luyKeCapVon) }}
									</td>
									<td>
										{{ displayValue(data.luyKeCapUng) }}
									</td>
									<td>
										{{displayValue(data.tongVonVaDtDaCap)}}
									</td>
									<td>
										{{ displayValue((data.vonDnghiCapLanNay)) }}
									</td>
									<td>
										{{ displayValue(data.vonDuyetCong) }}
									</td>
									<td>
										{{ displayValue(data.vonDuyetCapVon) }}
									</td>
									<td>
										{{ displayValue(data.vonDuyetCapUng) }}
									</td>
									<td>
										{{ displayValue(data.tongCap) }}
									</td>
									<td>
										{{ displayValue(data.soConDuocCap) }}
									</td>
									<td>
										{{ data.ghiChu }}
									</td>
									<td *ngIf="status" nzRight>
										<i class="fa fa-pencil" (click)="startEdit(data.id)"></i>
									</td>
								</ng-container>
								<ng-template #editTemplate>
									<td nzLeft>
										{{ i+1 }}
									</td>
									<td nzLeft>
										{{ editCache[data.id].data.tenDvi }}
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.slKeHoach) }}
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.slHopDong) }}
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.gtHopDong) }}
									</td>
									<td>
										<input class="money-input" currencyMask [options]="amount"
											[(ngModel)]="editCache[data.id].data.duToanDaGiao"
											(ngModelChange)="changeModel(data.id)" />
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.luyKeCong) }}
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.luyKeCapVon) }}
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.luyKeCapUng) }}
									</td>

									<td>
										{{ displayValue(editCache[data.id].data.tongVonVaDtDaCap) }}
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.vonDnghiCapLanNay) }}
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.vonDuyetCong) }}
									</td>
									<td>
										<input class="money-input" currencyMask [options]="amount"
											[(ngModel)]="editCache[data.id].data.vonDuyetCapVon"
											(ngModelChange)="changeModel(data.id)" />
									</td>
									<td>
										<input class="money-input" currencyMask [options]="amount"
											[(ngModel)]="editCache[data.id].data.vonDuyetCapUng"
											(ngModelChange)="changeModel(data.id)" />
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.tongCap) }}
									</td>
									<td>
										{{ displayValue(editCache[data.id].data.soConDuocCap) }}
									</td>
									<td>
										<input nz-input class="search__input"
											[(ngModel)]="editCache[data.id].data.ghiChu" />
									</td>
									<td *ngIf="status" nzRight>
										<a (click)="saveEdit(data.id)" class="save">Lưu</a>
										<a nz-popconfirm nzPopconfirmTitle="Bạn có chắc muốn hủy thao tác này?"
											(nzOnConfirm)="cancelEdit(data.id)" class="save">
											Hủy
										</a>
									</td>
								</ng-template>
							</tr>
						</tbody>
					</nz-table>
				</div> -->
				<nz-tabset class="tab__container" [(nzSelectedIndex)]="selectedIndex"
					[nzTabBarExtraContent]="extraTemplate">
					<nz-tab [nzTitle]="'HỢP ĐỒNG'">
						<nz-table nzBordered class="table__body">
							<thead>
								<tr>
									<th rowspan="2">Cục DTNNKV</th>
									<th rowspan="2">Quyết định phê duyệt kết quả<br />lựa chọn nhà
										thầu/Hợp đồng</th>
									<th colspan="2">Số lương</th>
									<th rowspan="2">Đơn giá(đồng/kg)</th>
									<th rowspan="2">Giá trị hợp<br />đồng(đã bao gồm<br />VAT)(đồng)</th>
									<th rowspan="2">Vi phạm hợp đồng</th>
									<th colspan="2">Thanh lý hợp đồng</th>
								</tr>
								<tr>
									<th>Kế hoạch</th>
									<th>Hợp đồng</th>
									<th>Số lượng</th>
									<th>Thành tiền</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let data of baoCao.dnghiCapvonCtiets; let i = index">
									<!-- <ng-container *ngIf="data.maBieuMau.startsWith('pl')"> -->
									<!-- <td>{{ getIndex(data.maBieuMau) }}</td>
										<td>{{data.tenPl}}</td>
										<td>{{data.tenDm}}</td>
										<td>
											{{Status.appendixStatusName(data.trangThai)}}
											<ng-container *ngIf="data.trangThai == '0'">
												<br>
												Lý do: {{data.lyDoTuChoi}}
											</ng-container>
										</td>
										<td>
											<ng-container
												*ngIf="userInfo?.sub == baoCao.nguoiTao && status.general && data?.id?.length==38 ;else templateNguoiBcao ">
												<nz-select nzShowSearch nzAllowClear
													nzPlaceHolder="Chọn cán bộ thực hiện" [(ngModel)]="data.nguoiBcao"
													[class]="data.nguoiBcao ?'' : 'input-error-validate'">
													<nz-option *ngFor="let item of canBos" [nzValue]="item.username"
														[nzLabel]="item.username">
													</nz-option>
												</nz-select>
											</ng-container>
											<ng-template #templateNguoiBcao>
												{{data.nguoiBcao}}
											</ng-template>
										</td> -->
									<!-- <td>
											<ng-container *ngIf="baoCao.id && data.id?.length == 36"> -->
									<!-- <a *ngIf="status.general && (userInfo?.sub == data.nguoiBcao)"> -->
									<!-- <i class="fa fa-pencil" (click)="viewAppendix(data.id)"></i> -->
									<!-- </a>
												<a
													*ngIf="(!status.general || userInfo?.sub != data.nguoiBcao) && data.nguoiBcao"> -->
									<!-- <i class="fa fa-eye" (click)="viewAppendix(data.id)"></i> -->
									<!-- </a>
											</ng-container>
											<a *ngIf="status.general && (userInfo?.sub == baoCao.nguoiTao)"> -->
									<!-- <i class="fa fa-trash-o do" (click)="deleteAppendix(data.id)"></i> -->
									<!-- </a>
										</td> -->
									<!-- </ng-container> -->
								</tr>
							</tbody>
						</nz-table>
					</nz-tab>
					<nz-tab [nzTitle]="'ĐỀ NGHỊ'">
						<nz-table nzBordered class="table__body">
							<thead>
								<tr>
									<th rowspan="2">STT</th>
									<th rowspan="2">Cục DTNNKV</th>
									<th colspan="2">Số lượng</th>
									<th rowspan="2">Giá trị hợp đồng<br />(đã bao gồm VAT)(đồng)</th>
									<th rowspan="2">Vi phạm hợp đồng</th>
									<th colspan="2">Thanh lý hợp đồng</th>
									<th colspan="3">Lũy kế cấp vốn đến thời điểm báo cáo</th>
									<th rowspan="2">Dự toán đã giao(đồng)</th>
									<th rowspan="2">Tổng vốn và Dự toán<br />đã cấp đến trước<br />thời điểm báo cáo
									</th>
									<th rowspan="2">Vốn để nghị cấp lần này</th>
								</tr>
								<tr>
									<th>Kế hoạch</th>
									<th>Hợp đồng</th>
									<th>Số lượng</th>
									<th>Thành tiền</th>
									<th>Cộng</th>
									<th>Cấp ứng</th>
									<th>Cấp vốn</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let data of baoCao.dnghiCapvonCtiets; let i = index">
									<!-- <ng-container *ngIf="data.maBieuMau.startsWith('TT342')">
										<td>{{ getIndex(data.maBieuMau) }}</td>
										<td>{{data.tenPl}}</td>
										<td>{{data.tenDm}}</td>
										<td>
											{{Status.appendixStatusName(data.trangThai)}}
											<ng-container *ngIf="data.trangThai == '0'">
												<br>
												Lý do: {{data.lyDoTuChoi}}
											</ng-container>
										</td>
										<td>
											<ng-container
												*ngIf="userInfo?.sub == baoCao.nguoiTao && status.general && data?.id?.length==38 ;else templateNguoiBcao ">
												<nz-select nzShowSearch nzAllowClear
													nzPlaceHolder="Chọn cán bộ thực hiện" [(ngModel)]="data.nguoiBcao"
													[class]="data.nguoiBcao ?'' : 'input-error-validate'">
													<nz-option *ngFor="let item of canBos" [nzValue]="item.username"
														[nzLabel]="item.username">
													</nz-option>
												</nz-select>
											</ng-container>
											<ng-template #templateNguoiBcao>
												{{data.nguoiBcao}}
											</ng-template>
										</td>
										<td>
											<ng-container *ngIf="baoCao.id && data.id?.length == 36">
												<a *ngIf="status.general && (userInfo?.sub == data.nguoiBcao)">
													<!-- <i class="fa fa-pencil" (click)="viewAppendix(data.id)"></i> -->
									<!-- </a> -->
									<!-- <a -->
									<!-- *ngIf="(!status.general || userInfo?.sub != data.nguoiBcao) && data.nguoiBcao"> -->
									<!-- <i class="fa fa-eye" (click)="viewAppendix(data.id)"></i> -->
									<!-- </a> -->
									<!-- </ng-container> -->
									<!-- <a *ngIf="status.general && (userInfo?.sub == baoCao.nguoiTao)"> -->
									<!-- <i class="fa fa-trash-o do" (click)="deleteAppendix(data.id)"></i> -->
									<!-- </a> -->
									<!-- </td> -->
									<!-- </ng-container> -->
								</tr>
							</tbody>
						</nz-table>
					</nz-tab>
					<ng-template #extraTemplate>
						<button *ngIf="status.general && userInfo?.sub == baoCao.nguoiTao" type="button"
							class="btn btn-main" (click)="addAppendix()">
							<i class="icon htvbdh_dau-cong"></i>
							<span>Thêm</span>
						</button>
					</ng-template>
				</nz-tabset>
				<div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
					<div nz-col nzSpan="24">
						<label class="search__label">Thuyết minh</label>
						<textarea rows="2" nz-input [(ngModel)]="baoCao.thuyetMinh" [disabled]="status.new"></textarea>
					</div>
				</div>
				<div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
					<div nz-col class="gutter-row" [nzSpan]="3">
						Danh sách văn bản đính kèm
						<nz-upload [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" *ngIf="!status.new">
							<button nz-button>
								<i nz-icon nzType="upload"></i>
								Chọn tệp
							</button>
						</nz-upload>
						<button nz-button [nzType]="'primary'" (click)="handleUpload()"
							[disabled]="fileList.length === 0" *ngIf="!status.new" style="margin-top: 16px">
							Thêm vào danh sách
						</button>
					</div>
				</div>
				<div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
					<div nz-col class="gutter-row" [nzSpan]="12">
						<nz-table nzBordered class="table__body">
							<thead>
								<tr>
									<th nzWidth="7%">STT</th>
									<th>Tên file</th>
									<th nzWidth="10%"></th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let data of baoCao.lstFiles; let i = index">
									<td>{{ i + 1 }} </td>
									<td>{{ data.fileName }}</td>
									<td>
										<a (click)="downloadFile(data.id)">
											<i class="fa fa-eye"></i>
										</a>
										<a *ngIf="status" (click)="deleteFile(data.id)">
											<i class="fa fa-trash-o do"></i>
										</a>
									</td>
								</tr>
							</tbody>
						</nz-table>
					</div>
				</div>
			</nz-card>
		</div>
	</div>
</ng-container>