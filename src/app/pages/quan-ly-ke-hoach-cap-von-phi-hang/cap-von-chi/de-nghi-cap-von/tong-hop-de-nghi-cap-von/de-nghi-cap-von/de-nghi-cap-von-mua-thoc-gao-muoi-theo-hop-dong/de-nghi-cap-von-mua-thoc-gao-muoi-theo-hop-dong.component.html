<ng-container *ngIf="isDataAvailable">
	<nz-affix [nzOffsetTop]="globals.prop.MENU_LV1" class="btn-affix">
		<div class="btn-group">
			<button type="button" class="btn btn-sub" (click)="back()">
				<i class="fa fa-arrow-left"></i>
				<span>Quay lại</span>
			</button>
			<button *ngIf="saveStatus" type="button" class="btn btn-sub" (click)="action('save')">
				<i class="icon htvbdh_tcdt_save"></i>
				<span>Lưu</span>
			</button>
			<button *ngIf="submitStatus" type="button" class="btn btn-sub" (click)="action('submit')">
				<i class="icon htvbdh_tcdt_guiduyet"></i>
				<span>Trình duyệt</span>
			</button>
			<!-- <button *ngIf="passStatus" type="button" class="btn btn-sub" (click)="action('nonpass')">
                <i class="icon htvbdh_tcdt_tuchoi"></i>
                <span>Từ chối</span>
            </button>
            <button *ngIf="passStatus" type="button" class="btn btn-sub" (click)="action('pass')">
                <i class="icon htvbdh_tcdt_pheduyet"></i>
                <span>Duyệt</span>
            </button> -->
			<button *ngIf="approveStatus" type="button" class="btn btn-sub" (click)="action('nonapprove')">
				<i class="icon htvbdh_tcdt_tuchoi"></i>
				<span>Từ chối</span>
			</button>
			<button *ngIf="approveStatus" type="button" class="btn btn-sub" (click)="action('approve')">
				<i class="icon htvbdh_tcdt_pheduyet"></i>
				<span>Phê duyệt</span>
			</button>
			<button *ngIf="copyStatus" type="button" class="btn btn-sub" (click)="showDialogCopy()">
				<i nz-icon nzType="copy" nzTheme="outline"></i>
				<span>Copy</span>
			</button>
		</div>
	</nz-affix>

	<div class="bg-trang">
		<div class="mt16 flex-card p-lr16">
			<div class="header mg-t-16">
				<div class="header-text">
					<div class="title-chi-tieu">
						<span [ngClass]="statusClass()">{{getStatusName()}}</span>
						<span>Đề nghị cấp vốn chi dự trữ quốc gia</span>
					</div>
				</div>
			</div>
			<nz-card class="mt-2px flex-card data-table card-border-content table-card">
				<nz-table class="nowrap mt-16 table-chi-tiet">
					<thead>
						<tr>
							<th>Mã đề nghị</th>
							<th>Năm đề nghị</th>
							<th>Quyết định chỉ tiêu</th>
							<th>Loại hợp đồng</th>
							<th>Căn cứ giá</th>
							<th>Công văn</th>
							<th>Số lần</th>
							<th>Ngày lập</th>
							<th>Ngày trình duyệt</th>
							<th>Ngày duyệt</th>
							<th>Ngày phê duyệt</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>{{ baoCao.maDnghi }}</td>
							<td>{{ baoCao.namBcao }}</td>
							<td>{{ baoCao.soQdChiTieu }}</td>
							<td>
								<ng-container *ngFor="let item of loaiDns">
									<ng-container *ngIf="baoCao.loaiDnghi == item.id">
										{{ item.tenDm }}
									</ng-container>
								</ng-container>
							</td>
							<td>
								<ng-container *ngFor="let item of canCuGias">
									<ng-container *ngIf="baoCao.canCuVeGia == item.id">
										{{ item.tenDm }}
									</ng-container>
								</ng-container>
							</td>
							<td>
								<nz-upload [nzBeforeUpload]="beforeUploadCV" *ngIf="statusCv">
									<button nz-button>
										<i nz-icon nzType="upload"></i>
										Chọn tệp
									</button>
								</nz-upload>
								<div class="tep__sqd" (click)="downloadFileCv()">
									<!-- <i class="icon htvbdh_tcdt_tep"></i> -->
									<span>{{ baoCao.congVan?.fileName }}</span>
								</div>
							</td>
							<td>{{ baoCao.soLan }}</td>
							<td>{{ getDate(baoCao.ngayTao) }}</td>
							<td>{{ getDate(baoCao.ngayTrinh) }}</td>
							<td>{{ getDate(baoCao.ngayDuyet) }}</td>
							<td>{{ getDate(baoCao.ngayPheDuyet) }}</td>
						</tr>
					</tbody>
				</nz-table>
			</nz-card>
		</div>

		<div class="mt-16 flex-card p-lr16">
			<nz-card class="mt-2px flex-card data-table card-border-content table-card" nzTitle="Danh sách hợp đồng">
				<nz-tabset class="tab__container" [(nzSelectedIndex)]="selectedIndex"
					[nzTabBarExtraContent]="extraTemplate" (click)="selectab()">
					<nz-tab [nzTitle]="'HỢP ĐỒNG'">
						<nz-table nzBordered class="table__body">
							<thead>
								<tr>
									<th rowspan="2">Cục DTNNKV</th>
									<th rowspan="2">Quyết định phê duyệt kết quả<br />lựa chọn nhà
										thầu/Hợp đồng</th>
									<th colspan="2">Số lương</th>
									<th rowspan="2">Đơn giá(đồng/kg)</th>
									<th rowspan="2">Giá trị hợp<br />đồng(đã bao gồm<br />VAT)(đồng)</th>
									<th rowspan="2">Vi phạm hợp đồng</th>
									<th colspan="2">Thanh lý hợp đồng</th>
								</tr>
								<tr>
									<th>Kế hoạch</th>
									<th>Hợp đồng</th>
									<th>Số lượng</th>
									<th>Thành tiền</th>
								</tr>
								<tr>
									<th>A</th>
									<th>B</th>
									<th>1</th>
									<th>2</th>
									<th>3</th>
									<th>4=2*3</th>
									<th>5</th>
									<th>6</th>
									<th>7</th>
									<th [hidden]="status"></th>
								</tr>
								<tr>
									<th>Tổng cộng</th>
									<th></th>
									<th>{{Op.fmtVal(total.slKeHoach)}}</th>
									<th>{{Op.fmtVal(total.slHopDong)}}</th>
									<th></th>
									<th>{{Op.fmtVal(total.gtHopDong)}}</th>
									<th>{{Op.fmtVal(total.viPhamHopDong)}}</th>
									<th>{{Op.fmtVal(total.thanhLyHdongSl)}}</th>
									<th>{{Op.fmtVal(total.thanhLyHdongTt)}}</th>
									<th [hidden]="status"></th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let data of baoCao.lstCtiets; let i = index">
									<td>
										<ng-container *ngIf="data.isParent">
											{{ data.tenDvi }}
										</ng-container>
									</td>
									<td>
										{{ data.qdPheDuyetKqNhaThau }}
									</td>
									<td>
										{{ Op.fmtVal(data.slKeHoach) }}
									</td>
									<td>
										{{ Op.fmtVal(data.slHopDong) }}
									</td>
									<td>
										{{ Op.fmtVal(data.donGia) }}
									</td>
									<td>
										{{ Op.fmtVal(data.gtHopDong) }}
									</td>
									<td>
										{{Op.fmtVal(data.viPhamHopDong)}}
									</td>
									<td>
										{{ Op.fmtVal(data.thanhLyHdongSl)}}
									</td>
									<td>
										{{Op.fmtVal(data.thanhLyHdongTt)}}
									</td>
								</tr>
							</tbody>
						</nz-table>
					</nz-tab>
					<nz-tab [nzTitle]="'ĐỀ NGHỊ'">
						<nz-table nzBordered class="table__body">
							<thead>
								<tr>
									<th rowspan="2">STT</th>
									<th rowspan="2">Cục DTNNKV</th>
									<th colspan="2">Số lượng</th>
									<th rowspan="2">Giá trị hợp đồng<br />(đã bao gồm VAT)(đồng)</th>
									<th rowspan="2">Vi phạm hợp đồng</th>
									<th colspan="2">Thanh lý hợp đồng</th>
									<th colspan="3">Lũy kế cấp vốn đến thời điểm báo cáo</th>
									<th rowspan="2">Dự toán đã giao(đồng)</th>
									<th rowspan="2">Tổng vốn và Dự toán<br />đã cấp đến trước<br />thời điểm báo cáo
									</th>
									<th rowspan="2">Vốn để nghị cấp lần này</th>
								</tr>
								<tr>
									<th>Kế hoạch</th>
									<th>Hợp đồng</th>
									<th>Số lượng</th>
									<th>Thành tiền</th>
									<th>Cộng</th>
									<th>Cấp ứng</th>
									<th>Cấp vốn</th>
								</tr>
								<tr>
									<th>A</th>
									<th>B</th>
									<th>1</th>
									<th>2</th>
									<th>3</th>
									<th>4</th>
									<th>5</th>
									<th>6</th>
									<th>7=8+9</th>
									<th>8</th>
									<th>9</th>
									<th>10</th>
									<th>11=7+10</th>
									<th>12=3-4-11</th>
								</tr>
								<tr></tr>
							</thead>
							<tbody>
								<tr *ngFor="let data of response.lstCtiets; let i = index">
									<td>
										{{i+1}}
									</td>
									<td>
										{{ data.tenDvi }}
									</td>
									<td>
										{{ Op.fmtVal(data.slKeHoach) }}
									</td>
									<td>
										{{ Op.fmtVal(data.slHopDong) }}
									</td>
									<td>
										{{ Op.fmtVal(data.gtHopDong) }}
									</td>
									<td>
										{{Op.fmtVal(data.viPhamHopDong)}}
									</td>
									<td>
										{{ Op.fmtVal(data.thanhLyHdongSl)}}
									</td>
									<td>
										{{ Op.fmtVal(data.thanhLyHdongTt)}}
									</td>
									<td>
										{{Op.fmtVal(data.luyKeCong)}}
									</td>
									<td>
										{{Op.fmtVal(data.luyKeCapUng)}}
									</td>
									<td>
										{{Op.fmtVal(data.luyKeCapVon)}}
									</td>
									<td>
										{{Op.fmtVal(data.duToanDaGiao)}}
									</td>
									<td>
										{{Op.fmtVal(data.tongVonVaDuToanDaCap)}}
									</td>
									<td>
										{{Op.fmtVal(data.vonDnghiCapLanNay)}}
									</td>
								</tr>
							</tbody>
						</nz-table>
					</nz-tab>
					<ng-template #extraTemplate>
						<button *ngIf="status.general && userInfo?.sub == baoCao.nguoiTao" type="button"
							class="btn btn-main" (click)="addAppendix()">
							<i class="icon htvbdh_dau-cong"></i>
							<span>Thêm</span>
						</button>
					</ng-template>
				</nz-tabset>
				<div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
					<div nz-col nzSpan="24">
						<label class="search__label">Thuyết minh</label>
						<textarea rows="2" nz-input [(ngModel)]="baoCao.thuyetMinh" [disabled]="status.new"></textarea>
					</div>
				</div>
				<div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
					<div nz-col class="gutter-row" [nzSpan]="3">
						Danh sách văn bản đính kèm
						<nz-upload [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" *ngIf="!status.new">
							<button nz-button>
								<i nz-icon nzType="upload"></i>
								Chọn tệp
							</button>
						</nz-upload>
						<button nz-button [nzType]="'primary'" (click)="handleUpload()"
							[disabled]="fileList.length === 0" *ngIf="!status.new" style="margin-top: 16px">
							Thêm vào danh sách
						</button>
					</div>
				</div>
				<div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
					<div nz-col class="gutter-row" [nzSpan]="12">
						<nz-table nzBordered class="table__body">
							<thead>
								<tr>
									<th nzWidth="7%">STT</th>
									<th>Tên file</th>
									<th nzWidth="10%"></th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let data of baoCao.lstFiles; let i = index">
									<td>{{ i + 1 }} </td>
									<td>{{ data.fileName }}</td>
									<td>
										<a (click)="downloadFile(data.id)">
											<i class="fa fa-eye"></i>
										</a>
										<a *ngIf="status" (click)="deleteFile(data.id)">
											<i class="fa fa-trash-o do"></i>
										</a>
									</td>
								</tr>
							</tbody>
						</nz-table>
					</div>
				</div>
			</nz-card>
		</div>
	</div>
</ng-container>