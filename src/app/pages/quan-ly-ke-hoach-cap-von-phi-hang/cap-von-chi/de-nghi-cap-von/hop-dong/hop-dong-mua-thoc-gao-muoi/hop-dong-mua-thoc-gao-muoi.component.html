<ng-container *ngIf="isDataAvailable">
	<nz-affix [nzOffsetTop]="globals.prop.MENU_LV1" class="btn-affix">
		<div class="btn-group">
			<button type="button" class="btn btn-sub" (click)="back()">
				<i class="fa fa-arrow-left"></i>
				<span>Quay lại</span>
			</button>
			<button *ngIf="saveStatus" type="button" class="btn btn-sub" (click)="action('save')">
				<i class="icon htvbdh_tcdt_save"></i>
				<span>Lưu</span>
			</button>
			<button *ngIf="submitStatus" type="button" class="btn btn-sub" (click)="action('submit')">
				<i class="icon htvbdh_tcdt_guiduyet"></i>
				<span>Trình duyệt</span>
			</button>
			<button *ngIf="approveStatus" type="button" class="btn btn-sub" (click)="action('nonapprove')">
				<i class="icon htvbdh_tcdt_tuchoi"></i>
				<span>Từ chối</span>
			</button>
			<button *ngIf="approveStatus" type="button" class="btn btn-sub" (click)="action('approve')">
				<i class="icon htvbdh_tcdt_pheduyet"></i>
				<span>Phê duyệt</span>
			</button>
			<button *ngIf="copyStatus" type="button" class="btn btn-sub" (click)="showDialogCopy()">
				<i nz-icon nzType="copy" nzTheme="outline"></i>
				<span>Copy</span>
			</button>
			<ng-container *ngIf="baoCao.trangThai == '7'">
				<button type="button" class="btn btn-main" *ngIf="statusExportExcel.export" (click)="exportToExcel()">
					<span nz-icon nzType="export" nzTheme="outline" style="margin-right: 5px;"></span>
					<span>Xuất</span>
				</button>
			</ng-container>
		</div>
	</nz-affix>

	<div class="bg-trang">
		<div class="mt16 flex-card p-lr16">
			<div class="header mg-t-16">
				<div class="header-text">
					<div class="title-chi-tieu">
						<span [ngClass]="statusClass()">{{getStatusName()}}</span>
						<span>Hợp đồng cấp vốn chi dự trữ quốc gia</span>
					</div>
				</div>
			</div>
			<nz-card class="mt-2px flex-card data-table card-border-content table-card">
				<nz-table class="nowrap mt-16 table-chi-tiet">
					<thead>
						<tr>
							<th>Mã hợp đồng</th>
							<th>Năm hợp đồng</th>
							<th>Quyết định chỉ tiêu</th>
							<th>Loại hợp đồng</th>
							<th>Công văn</th>
							<th>Ngày lập</th>
							<th>Ngày trình duyệt</th>
							<th>Ngày duyệt</th>
							<th>Ngày phê duyệt</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>{{ baoCao.maDnghi }}</td>
							<td>{{ baoCao.namBcao }}</td>
							<td>{{ baoCao.soQdChiTieu }}</td>
							<td>
								<ng-container *ngFor="let item of loaiDns">
									<ng-container *ngIf="baoCao.loaiDnghi == item.id">
										{{ item.tenDm }}
									</ng-container>
								</ng-container>
							</td>
							<td>
								<nz-upload [nzBeforeUpload]="beforeUploadCV" [hidden]="status">
									<button nz-button>
										<i nz-icon nzType="upload"></i>
										Chọn tệp
									</button>
								</nz-upload>
								<div class="tep__sqd" (click)="downloadFileCv()">
									<span>{{ baoCao.congVan?.fileName }}</span>
								</div>
							</td>
							<td>{{ getDate(baoCao.ngayTao) }}</td>
							<td>{{ getDate(baoCao.ngayTrinh) }}</td>
							<td>{{ getDate(baoCao.ngayDuyet) }}</td>
							<td>{{ getDate(baoCao.ngayPheDuyet) }}</td>
						</tr>
					</tbody>
				</nz-table>
			</nz-card>
		</div>

		<div class="mt-16 flex-card p-lr16">
			<nz-card class="mt-2px flex-card data-table card-border-content table-card" nzTitle="Danh sách hợp đồng">
				<div id="tablePrint">
					<nz-table class="nowrap mt-16 table-chi-tiet" nzBordered>
						<thead>
							<tr>
								<th rowspan="2">Cục DTNNKV</th>
								<th rowspan="2">Quyết định phê duyệt kết quả lựa chọn nhà thầu / Hợp đồng</th>
								<th colspan="2">Số lượng</th>
								<th rowspan="2">Đơn giá (kg/đồng)</th>
								<th rowspan="2">Giá trị hợp đồng (đã bao gồm VAT)(đồng)</th>
								<th rowspan="2">Vi phạm hợp đồng</th>
								<th colspan="2">Thanh lý hợp đồng</th>
								<th rowspan="2">Công văn</th>
								<th rowspan="2" [hidden]="status"></th>
							</tr>
							<tr>
								<th>Kế hoạch</th>
								<th>Hợp đồng</th>
								<th>Số lượng</th>
								<th>Thành tiền</th>
							</tr>
							<tr>
								<th>A</th>
								<th>B</th>
								<th>1</th>
								<th>2</th>
								<th>3</th>
								<th>4=2*3</th>
								<th>5</th>
								<th>6</th>
								<th>7</th>
								<th>8</th>
								<th [hidden]="status"></th>
							</tr>
							<tr>
								<th>Tổng cộng</th>
								<th></th>
								<th>{{displayValue(total.slKeHoach)}}</th>
								<th>{{displayValue(total.slHopDong)}}</th>
								<th></th>
								<th>{{displayValue(total.gtHopDong)}}</th>
								<th>{{displayValue(total.viPhamHopDong)}}</th>
								<th>{{displayValue(total.thanhLyHdongSl)}}</th>
								<th>{{displayValue(total.thanhLyHdongTt)}}</th>
								<th></th>
								<th [hidden]="status"></th>
							</tr>
						</thead>
						<tbody>
							<tr *ngFor="let data of baoCao.lstCtiets; let i = index">
								<ng-container *ngIf="!editCache[data.id].edit; else editTemplate">
									<td>
										<ng-container *ngIf="data.isParent">
											{{ data.tenDvi }}
										</ng-container>
									</td>
									<td>
										{{ data.qdPheDuyetKqNhaThau }}
									</td>
									<td>
										{{ displayValue(data.slKeHoach) }}
									</td>
									<td>
										{{ displayValue(data.slHopDong) }}
									</td>
									<td>
										{{ displayValue(data.donGia) }}
									</td>
									<td>
										{{ displayValue(data.gtHopDong) }}
									</td>
									<td>
										{{displayValue(data.viPhamHopDong)}}
									</td>
									<td>
										{{ displayValue(data.thanhLyHdongSl)}}
									</td>
									<td>
										{{displayValue(data.thanhLyHdongTt)}}
									</td>
									<td>
										{{ data.congVan }}
									</td>
									<td [hidden]="status">
										<i class="fa fa-pencil" (click)="startEdit(data.id)"></i>
									</td>
								</ng-container>
								<ng-template #editTemplate>
									<td>
										<ng-container *ngIf="data.isParent">
											{{ data.tenDvi }}
										</ng-container>
									</td>
									<td>
										{{ data.qdPheDuyetKqNhaThau }}
									</td>
									<td>
										{{ displayValue(data.slKeHoach) }}
									</td>
									<td>
										{{ displayValue(data.slHopDong) }}
									</td>
									<td>
										{{ displayValue(data.donGia) }}
									</td>
									<td>
										{{ displayValue(data.gtHopDong) }}
									</td>
									<td>
										<input nz-input class="search__input"
											[(ngModel)]="editCache[data.id].data.viPhamHopDong" />
									</td>
									<td>
										<input nz-input class="search__input"
											[(ngModel)]="editCache[data.id].data.thanhLyHdongSl" />
									</td>
									<td>
										<input nz-input class="search__input"
											[(ngModel)]="editCache[data.id].data.thanhLyHdongTt" />
									</td>
									<td>
										<input nz-input class="search__input"
											[(ngModel)]="editCache[data.id].data.congVan" />
									</td>
									<td [hidden]="status">
										<a (click)="saveEdit(data.id)" class="save">Lưu</a>
										<a nz-popconfirm nzPopconfirmTitle="Bạn có chắc muốn hủy thao tác này?"
											(nzOnConfirm)="cancelEdit(data.id)" class="save">
											Hủy
										</a>
									</td>
								</ng-template>
							</tr>
						</tbody>
					</nz-table>
				</div>
				<div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
					<div nz-col nzSpan="24">
						<label class="search__label">Thuyết minh</label>
						<textarea rows="2" nz-input [(ngModel)]="baoCao.thuyetMinh" [disabled]="status"></textarea>
					</div>
				</div>
				<div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
					<div nz-col class="gutter-row" [nzSpan]="3">
						Danh sách văn bản đính kèm
						<nz-upload [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" [hidden]="status">
							<button nz-button>
								<i nz-icon nzType="upload"></i>
								Chọn tệp
							</button>
						</nz-upload>
						<button nz-button [nzType]="'primary'" (click)="handleUpload()"
							[disabled]="fileList.length === 0" [hidden]="status" style="margin-top: 16px">
							Thêm vào danh sách
						</button>
					</div>
				</div>
				<div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
					<div nz-col class="gutter-row" [nzSpan]="12">
						<nz-table nzBordered class="table__body">
							<thead>
								<tr>
									<th nzWidth="7%">STT</th>
									<th>Tên file</th>
									<th nzWidth="10%"></th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let data of baoCao.lstFiles; let i = index">
									<td>{{ i + 1 }} </td>
									<td>{{ data.fileName }}</td>
									<td>
										<a (click)="downloadFile(data.id)">
											<i class="fa fa-eye"></i>
										</a>
										<a *ngIf="!status" (click)="deleteFile(data.id)">
											<i class="fa fa-trash-o do"></i>
										</a>
									</td>
								</tr>
							</tbody>
						</nz-table>
					</div>
				</div>
			</nz-card>
		</div>
	</div>
</ng-container>