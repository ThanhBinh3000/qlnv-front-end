<nz-affix class="menu-lv2 dieu-chinh-button" [nzOffsetTop]="43">
  <div class="tab-content tab-menu" id="myTabContent">
    <div class="d-flex justify-content-between header-tab" id="banhanh">
      <div class="trai">
      </div>
      <div class="canphai phai">
        <button type="button" class="btn btn-sub" (click)="redirectChiTieuKeHoachNam()">
          <i class="fa fa-arrow-left"></i>
          <span>Quay lại</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="guiDuyet()"
                *ngIf="(thongTinChiTieuKeHoachNam.trangThai == STATUS.DU_THAO || thongTinChiTieuKeHoachNam.trangThai ==  STATUS.TU_CHOI_TP || thongTinChiTieuKeHoachNam.trangThai == STATUS.TU_CHOI_LDC || thongTinChiTieuKeHoachNam.trangThai == STATUS.TU_CHOI_LDV) && !isViewDetail">
          <i class="icon htvbdh_tcdt_guiduyet"></i>
          <span>Lưu và gửi duyệt</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="banHanh()"
                *ngIf="thongTinChiTieuKeHoachNam.trangThai == STATUS.DA_DUYET_LDC ||thongTinChiTieuKeHoachNam.trangThai == STATUS.DA_DUYET_LDV  ">
          <i class="icon htvbdh_chuyenvanthu"></i>
          <span>Ban hành</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light"
                *ngIf="(thongTinChiTieuKeHoachNam.trangThai == STATUS.CHO_DUYET_TP || thongTinChiTieuKeHoachNam.trangThai == STATUS.CHO_DUYET_LDC) && userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_CTKH_DUYET_TP')"
                (click)="pheDuyet()">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Duyệt</span>
        </button>
<!--        <button class="btn btn-outline-grey btn-sm waves-effect waves-light"-->
<!--                *ngIf="() && userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_CTKH_DUYET_TP')"-->
<!--                (click)="pheDuyet()">-->
<!--          <i class="icon htvbdh_tcdt_pheduyet"></i>-->
<!--          <span>Duyệt</span>-->
<!--        </button>-->
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light"
                *ngIf="(thongTinChiTieuKeHoachNam.trangThai == STATUS.CHO_DUYET_LDV) && userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_CTKH_DUYET_LDVU')"
                (click)="pheDuyet()">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Duyệt</span>
        </button>
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="tuChoi()"
           *ngIf="(!userService.isTongCuc() &&  thongTinChiTieuKeHoachNam.trangThai ==  STATUS.CHO_DUYET_TP || thongTinChiTieuKeHoachNam.trangThai == STATUS.CHO_DUYET_LDC) && (userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_CTKH_DUYET_TP'))">
          <i class="icon htvbdh_tcdt_tuchoi"></i>
          <span>Từ chối</span>
        </a>
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="tuChoi()"
           *ngIf="(userService.isTongCuc() && thongTinChiTieuKeHoachNam.trangThai == STATUS.CHO_DUYET_LDV ) && ( userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_CTKH_DUYET_LDVU') )">
          <i class="icon htvbdh_tcdt_tuchoi"></i>
          <span>Từ chối</span>
        </a>
        <button class="btn btn-main btn-sm waves-effect waves-light" (click)="save()"
                *ngIf="!this.isViewDetail && (thongTinChiTieuKeHoachNam.trangThai == STATUS.DU_THAO || thongTinChiTieuKeHoachNam.trangThai == STATUS.TU_CHOI_LDV || thongTinChiTieuKeHoachNam.trangThai == STATUS.TU_CHOI_LDC || thongTinChiTieuKeHoachNam.trangThai == STATUS.TU_CHOI_TP)">
          <i class="icon htvbdh_tcdt_save"></i>
          <span>Lưu</span>
        </button>
      </div>
    </div>
  </div>
</nz-affix>
<div class="bg-trang">
  <nz-card class="mt16 flex-card p-lr16">
    <div class="header">
      <div class="header-text">
        <div class="title-chi-tieu">
          <span
            [ngClass]="thongTinChiTieuKeHoachNam.trangThai == globals.prop.NHAP_BAN_HANH ? 'da-ban-hanh' : 'du-thao-va-lanh-dao-duyet'  ">
            {{thongTinChiTieuKeHoachNam.trangThai == '00' ? 'Dự thảo' : thongTinChiTieuKeHoachNam.tenTrangThai }}
          </span>
          <span>Thông tin chỉ tiêu kế hoạch năm {{userService.isTongCuc() ? 'Tổng cục' : 'Cục'}} giao</span>
        </div>
      </div>
    </div>
    <form nz-form [formGroup]="formData" [nzLayout]="'vertical'">
      <ng-template #ngayKyError1 let-control>
        <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
      </ng-template>
      <div nz-row [nzGutter]="[16, 12]">
        <div nz-col nzSpan="3">
          <!-- <nz-form-item> -->
          <nz-form-label nz-col nzRequired [nzNoColon]="true" class="text-left"> Năm kế hoạch
          </nz-form-label>
          <nz-form-control nz-col [nzErrorTip]="namKeHoachError">
            <nz-select formControlName="namKeHoach" (ngModelChange)="selectNam()" [nzDisabled]="isViewDetail"
                       nzAllowClear>
              <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
            </nz-select>
            <ng-template #namKeHoachError let-control>
              <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
            </ng-template>
          </nz-form-control>
          <!-- </nz-form-item> -->
        </div>
        <div nz-col nzSpan="4">
          <!-- <nz-form-item> -->
          <nz-form-label [nzNoColon]="true" class="text-left"> Số quyết định</nz-form-label>
          <nz-form-control [nzErrorTip]="soQDError">
            <nz-input-group nzAddOnAfter="/{{qdTCDT}}">
              <input formControlName="soQd" [readonly]="checkTrangThaiRecord()" nz-input nzSize="small"
                     placeholder="Nhập số quyết định" appNumberOnly
              />
            </nz-input-group>
            <ng-template #soQDError let-control>
              <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
            </ng-template>
          </nz-form-control>
          <!-- </nz-form-item> -->
        </div>
        <div nz-col nzSpan="4">
          <nz-form-label [nzNoColon]="true" class="text-left"> Ngày ký
          </nz-form-label>
          <nz-form-control nz-col [nzErrorTip]="ngayKyError1">
            <nz-date-picker class="search__input" [nzDisabled]="checkTrangThaiRecord()"
                            [nzDisabledDate]="disabledStartDate"
                            nzFormat="dd-MM-yyyy" formControlName="ngayKy" nzPlaceHolder="Ngày ký">
            </nz-date-picker>
            <ng-template #ngayKyError let-control>
              <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
            </ng-template>
          </nz-form-control>
        </div>
        <div nz-col nzSpan="4">
          <!-- <nz-form-item> -->
          <nz-form-label [nzNoColon]="true" class="text-left"> Ngày hiệu lực
          </nz-form-label>
          <nz-form-control nz-col [nzErrorTip]="ngayHieuLucError">
            <nz-date-picker nzFormat="dd-MM-yyyy" [nzDisabled]="checkTrangThaiRecord()" formControlName="ngayHieuLuc"
                            nzPlaceHolder="Ngày hiệu lực">
            </nz-date-picker>
            <ng-template #ngayHieuLucError let-control>
              <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
            </ng-template>
          </nz-form-control>
          <!-- </nz-form-item> -->
        </div>
        <div nz-col nzSpan="24">
          <!-- <nz-form-item> -->
          <nz-form-label nz-col nzRequired [nzNoColon]="true" class="text-left">
            {{userService.isCuc() ? ' Quyết định chỉ tiêu kế hoạch của Tổng cục' : 'Quyết định của BTC giao TCDT'}}
          </nz-form-label>
          <nz-form-control [nzErrorTip]="canCuError">
            <nz-input-group>
              <input formControlName="canCu" nz-input nzSize="small" [readonly]="true"/>
            </nz-input-group>
            <!--<nz-select formControlName="arrCanCu" nzMode="multiple" nzPlaceHolder="Chọn căn cứ"
                       [nzDisabled]="isViewDetail">
              <nz-option *ngFor="let option of this.dsCanCu" [nzLabel]="option.soQd" [nzValue]="option.id"></nz-option>
            </nz-select>-->
            <ng-template #canCuError let-control>
              <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
            </ng-template>
          </nz-form-control>
          <!-- </nz-form-item> -->
        </div>
        <div nz-col nzSpan="24">
          <!-- <nz-form-item> -->
          <nz-form-label nzRequired [nzNoColon]="true" class="text-left"> Trích yếu
          </nz-form-label>
          <nz-form-control [nzErrorTip]="error">
            <textarea rows="3" formControlName="trichYeu" class="search__input" nz-input nzSize="small"
                      placeholder="Nhập text" [readonly]="isViewDetail"></textarea>
            <ng-template #error let-control>
              <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
              </ng-container>
            </ng-template>
          </nz-form-control>
        </div>
        <div nz-col [nzSpan]="24">
          <nz-form-label [nzNoColon]="true" class="label-color-kh"> Tài liệu đính kèm</nz-form-label>
          <nz-form-control>
            <div class="list-file">
              <file-list [disabled]="isViewDetail" [data]="taiLieuDinhKemList"></file-list>
            </div>
          </nz-form-control>
        </div>
      </div>
    </form>
  </nz-card>
  <nz-tabset nzType="card" class="mt16 flex-card p-lr16">
    <nz-tab [nzTitle]="'Kế hoạch lương thực dự trữ nhà nước'">
      <div id="table-luong-thuc"
           [ngClass]="tabSelected == tab.luongThuc ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
        <div class="ghichu_tab">Đơn vị tính:Tấn</div>
        <nz-table #groupingTable [nzData]="dsKeHoachLuongThucClone" nzBordered class="nowrap"
                  [nzFrontPagination]="false" [nzShowPagination]="false" [nzScroll]="{ x: '1700px' }">
          <thead>
          <tr>
            <th rowspan="4" class="text-center" width="40px" nzLeft>STT</th>
            <th rowspan="4" class="text-center" width="330px" nzLeft>
              {{userService.isTongCuc() ? 'CỤC DTNN KHU VỰC' : 'CHI CỤC KHU VỰC'}}</th>
            <th colspan="9" class="text-center" width="1200px">Tồn kho đầu năm (1) <br/>( 01/01/{{yearNow}})</th>
            <th colspan="3" class="text-center" width="400px">Nhập trong năm (2)</th>
            <th colspan="9" class="text-center" width="1200px">Xuất trong năm (3)</th>
            <th colspan="3" class="text-center" width="400px">Tồn kho cuối năm (4)
              <br>
              ( 31/12/{{yearNow}})
            </th>
            <!-- <th rowspan="4">Trạng thái</th> -->
            <th rowspan="4" *ngIf="!this.isViewDetail" class="text-center" width="90px" nzRight>Hành động</th>
          </tr>
          <tr>
            <th rowspan="3" class="text-center">
              Tổng số
              <br/>
              (quy thóc)
            </th>
            <th colspan="8" class="text-center">Trong đó</th>
            <th rowspan="3" class="text-center">
              Tổng số
              <br/>
              (quy thóc)
            </th>
            <th colspan="2" class="text-center">Trong đó</th>
            <th rowspan="3" class="text-center">
              Tổng số
              <br/>
              (quy thóc)
            </th>
            <th colspan="8" class="text-center">Trong đó</th>
            <th rowspan="3" class="text-center">Tổng số
              <br>
              (quy thóc)
            </th>
            <th colspan="2" class="text-center">Trong đó</th>
          </tr>
          <tr>
            <th colspan="4" class="text-center">Thóc (Tấn)</th>
            <th colspan="4" class="text-center">Gạo (Tấn)</th>
            <th rowspan="2" class="text-center">Thóc (Tấn)</th>
            <th rowspan="2" class="text-center">Gạo (Tấn)</th>
            <th colspan="4" class="text-center">Thóc (Tấn)</th>
            <th colspan="4" class="text-center">Gạo (Tấn)</th>
            <th rowspan="2" class="text-center">Thóc (Tấn)</th>
            <th rowspan="2" class="text-center">Gạo (Tấn)</th>
          </tr>
          <tr>
            <th class="text-center">Tổng</th>
            <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
            <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
            <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
            <th class="text-center">Tổng</th>
            <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
            <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
            <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
            <th class="text-center">Tổng</th>
            <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
            <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
            <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
            <th class="text-center">Tổng</th>
            <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
            <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
            <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
          </tr>
          <tr
            [ngClass]="this.thongTinChiTieuKeHoachNam.trangThai === this.globals.prop.BAN_HANH || this.isViewDetail ? 'row-disabled' : ''">
            <th nzLeft></th>
            <th nzLeft>
              <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                class="search__input autocomplete__input donvi__input">
                  <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input
                         (input)="onInput($event,'luong-thuc')" [nzAutocomplete]="auto" class="w-300"
                         [(ngModel)]="keHoachLuongThucCreate.tenDonvi"/>
                </nz-input-group>
                <ng-template #suffixIcon>
                  <i nz-icon nzType="search"></i>
                </ng-template>
                <nz-autocomplete #auto (selectionChange)="selectDonViKeyDown($event,'khlt')" [nzBackfill]="false">
                  <ng-container>
                    <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                                    (click)="selectDonvi(option)">
                      {{ option.labelDonVi }}
                    </nz-auto-option>
                  </ng-container>
                </nz-autocomplete>
              </nz-form-control>
            </th>
            <th class="text-right">{{calculatortkdnTongQuyThocCreate()}}</th>
            <th class="text-right">{{calculatortkdnTongThocCreate()}}
            </th>
            <th class="text-right">{{this.keHoachLuongThucCreate.tkdnThoc[0].soLuong}}</th>
            <th class="text-right">{{this.keHoachLuongThucCreate.tkdnThoc[1].soLuong}}</th>
            <th class="text-right">{{this.keHoachLuongThucCreate.tkdnThoc[2].soLuong}}</th>
            <th class="text-right">{{calculatortkdnTongGaoCreate()}}</th>
            <th class="text-right">{{this.keHoachLuongThucCreate.tkdnGao[0].soLuong}}</th>
            <th class="text-right">{{this.keHoachLuongThucCreate.tkdnGao[1].soLuong}}</th>
            <th class="text-right">{{this.keHoachLuongThucCreate.tkdnGao[2].soLuong}}</th>
            <th class="text-right">{{calculatorntnTongQuyThocCreate()}}</th>
            <th class="text-right">
              <nz-input-number [nzMin]="1" [nzStep]="1" [nzSize]="'small'"
                               [(ngModel)]="keHoachLuongThucCreate.ntnThoc">
              </nz-input-number>
            </th>
            <th class="text-right">
              <nz-input-number [nzMin]="1" [nzStep]="1" [nzSize]="'small'"
                               [(ngModel)]="keHoachLuongThucCreate.ntnGao">
              </nz-input-number>
            </th>
            <th class="text-right">{{calculatorxtnTongSoQuyThocCreate()}}</th>
            <th class="text-right">{{calculatorxtnTongThocCreate()}}</th>
            <th class="text-right">
              <!-- <input nz-input nzSize="small" placeholder="Nhập số quyết định" type="number"
          [max]="keHoachLuongThucCreate.tkdnThoc[0].soLuong"
          [(ngModel)]="keHoachLuongThucCreate.xtnThoc[0].soLuong" class="w-120" [min]="0"
          [readonly]="disableBanHanhLanhDaoDuyet()" appNumberOnly /> -->

              <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                               [nzMax]="keHoachLuongThucCreate.tkdnThoc[0].soLuong" [nzSize]="'small'"
                               [(ngModel)]="keHoachLuongThucCreate.xtnThoc[0].soLuong"></nz-input-number>
            </th>
            <th class="text-right">
              <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                               [nzMax]="keHoachLuongThucCreate.tkdnThoc[1].soLuong" [nzSize]="'small'"
                               [(ngModel)]="keHoachLuongThucCreate.xtnThoc[1].soLuong"></nz-input-number>
            </th>
            <th class="text-right">
              <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                               [nzMax]="keHoachLuongThucCreate.tkdnThoc[2].soLuong" [nzSize]="'small'"
                               [(ngModel)]="keHoachLuongThucCreate.xtnThoc[2].soLuong"></nz-input-number>
            </th>
            <th class="text-right">{{calculatorxtnTongGaoCreate()}}</th>
            <th class="text-right">
              <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                               [nzMax]="keHoachLuongThucCreate.tkdnGao[0].soLuong" [nzSize]="'small'"
                               [(ngModel)]="keHoachLuongThucCreate.xtnGao[0].soLuong"></nz-input-number>
            </th>
            <th class="text-right">
              <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                               [nzMax]="keHoachLuongThucCreate.tkdnGao[1].soLuong" [nzSize]="'small'"
                               [(ngModel)]="keHoachLuongThucCreate.xtnGao[1].soLuong"></nz-input-number>
            </th>
            <th class="text-right">
              <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                               [nzMax]="keHoachLuongThucCreate.tkdnGao[2].soLuong" [nzSize]="'small'"
                               [(ngModel)]="keHoachLuongThucCreate.xtnGao[2].soLuong"></nz-input-number>
            </th>
            <th class="text-right">{{calculatortkcnTongSoQuyThocCreate()}}</th>
            <th class="text-right">{{calculatortkcnTongThocCreate()}}</th>
            <th class="text-right">{{calculatortkcnTongGaoCreate()}}</th>
            <!-- <td class="background-last-row"></td> -->
            <th class="text-center" *ngIf="!this.isViewDetail" nzRight>
              <a class="save" (click)="themMoiKHLT()" [ngClass]="{'isDisabled': !isAddLuongThuc}">
                <i class="icon htvbdh_dau-cong"></i>
              </a>
              <a (click)="clearKHLT()" class="ml-3" [ngClass]="{'isDisabled': !isAddLuongThuc}">
                <i class="fa fa-trash-o do"></i>
              </a>
            </th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of groupingTable.data, let i = index">
            <ng-container *ngIf="!dsKeHoachLuongThucClone[i]?.isEdit; else editTemplate">
              <td nzLeft class="text-right">{{data.stt}}</td>
              <td nzLeft class="text-left">{{data.tenDonvi}}</td>
              <td class="text-right">{{data.tkdnTongSoQuyThoc | number:
                '1.0-1'}}</td>
              <td class="text-right">{{data.tkdnTongThoc | number: '1.0-1'}}
              </td>
              <ng-container *ngIf="data?.tkdnThoc?.length > 0">
                <td *ngFor="let item of data.tkdnThoc" class="text-right">
                  {{item.soLuong | number: '1.0-1'}}</td>
              </ng-container>
              <ng-container *ngIf="data?.tkdnThoc?.length == 0">
                <td class="text-right">0</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
              </ng-container>
              <td class="text-right"> {{data.tkdnTongGao | number: '1.0-1'}} </td>
              <ng-container *ngIf="data?.tkdnGao?.length > 0">
                <td *ngFor="let item of data.tkdnGao" class="text-right"> {{item.soLuong | number: '1.0-1'}} </td>
              </ng-container>
              <ng-container *ngIf="data?.tkdnGao?.length == 0">
                <td class="text-right"> 0</td>
                <td class="text-right"> 0</td>
                <td class="text-right"> 0</td>
              </ng-container>
              <td class="tong-so-quy-tdoc" class="text-right"> {{data.ntnTongSoQuyThoc | number: '1.0-1'}}</td>
              <td class="text-right">{{data.ntnThoc | number: '1.0-1'}}</td>
              <td class="text-right">{{data.ntnGao | number: '1.0-1'}}</td>
              <td class="text-right">{{data.xtnTongSoQuyThoc | number:
                '1.0-1'}}</td>
              <td class="text-right">{{data.xtnTongThoc | number: '1.0-1'}}
              </td>
              <ng-container *ngIf="data?.xtnThoc?.length > 0">
                <td *ngFor="let item of data.xtnThoc" class="text-right">
                  {{item.soLuong | number: '1.0-1'}}</td>
              </ng-container>
              <ng-container *ngIf="data?.xtnThoc?.length == 0">
                <td class="text-right">0</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
              </ng-container>
              <td class="text-right">{{data.xtnTongGao | number: '1.0-1'}}
              </td>
              <ng-container *ngIf="data?.xtnGao?.length > 0">
                <td *ngFor="let item of data.xtnGao" class="text-right">
                  {{item.soLuong | number: '1.0-1'}}</td>
              </ng-container>
              <ng-container *ngIf="data?.xtnGao?.length == 0">
                <td class="text-right">0</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
              </ng-container>
              <td class="text-right">{{data.tkcnTongSoQuyThoc | number:
                '1.0-1'}}</td>
              <td class="text-right">{{data.tkcnTongThoc | number: '1.0-1'}}
              </td>
              <td class="text-right">{{data.tkcnTongGao | number: '1.0-1'}}
              </td>
              <!-- <td>{{ convertTrangThai(tdongTinChiTieuKeHoachNam.trangThai) }}</td> -->
              <td *ngIf="!this.isViewDetail" class="text-center" nzRight>
                <a (click)="startEdit(i)">
                  <i class="fa fa-pencil"></i>
                </a>
                <a (click)="deleteKeHoachLuongThuc(data.stt)" class="ml-3">
                  <i class="fa fa-trash-o do"></i>
                </a>
              </td>
              <td *ngIf="data.stt == null" class="background-last-row"></td>
              <td *ngIf="data.stt ==  null" class="background-last-row"></td>
            </ng-container>
            <ng-template #editTemplate>
              <td nzLeft class="text-right">{{data.stt}}</td>
              <td nzLeft class="text-left">{{data.tenDonvi}}</td>
              <td class="text-right">{{data.tkdnTongSoQuyThoc | number:
                '1.0-1'}}</td>
              <td class="text-right">{{data.tkdnTongThoc | number: '1.0-1'}}
              </td>
              <ng-container *ngIf="data?.tkdnThoc?.length > 0">
                <td *ngFor="let item of data.tkdnThoc" class="text-right">
                  {{item.soLuong | number: '1.0-1'}}</td>
              </ng-container>
              <ng-container *ngIf="data?.tkdnThoc?.length == 0">
                <td class="text-right">0</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
              </ng-container>
              <td class="text-right"> {{data.tkdnTongGao | number: '1.0-1'}} </td>
              <ng-container *ngIf="data?.tkdnGao?.length > 0">
                <td *ngFor="let item of data.tkdnGao" class="text-right"> {{item.soLuong | number: '1.0-1'}} </td>
              </ng-container>
              <ng-container *ngIf="data?.tkdnGao?.length == 0">
                <td class="text-right"> 0</td>
                <td class="text-right"> 0</td>
                <td class="text-right"> 0</td>
              </ng-container>
              <td class="text-right">
                {{calculatorntnTongSoQuyThoc(i)}}
              </td>
              <td class="text-right">
                <input class="w-200" nz-input nzSize="small" appNumberOnly
                       [(ngModel)]="dsKeHoachLuongThucClone[i].ntnThoc"/>
              </td>
              <td class="text-right">
                <input class="w-200" nz-input nzSize="small" appNumberOnly
                       [(ngModel)]="dsKeHoachLuongThucClone[i].ntnGao"/>
              </td>
              <td class="text-right">
                {{calculatorxtnTongSoQuyThoc(i)}}
              </td>
              <td class="text-right">
                {{calculatorxtnTongThoc(i)}}
              </td>
              <td class="text-right">
                <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnThoc[0].soLuong"
                                 name="goiThau" class="w-200" [nzMin]="0"
                                 [nzMax]="dsKeHoachLuongThucClone[i].tkdnThoc[0].soLuong"
                                 [nzSize]="'small'"></nz-input-number>
              </td>
              <td class="text-right">
                <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnThoc[1].soLuong"
                                 name="goiThau" class="w-200" [nzMin]="0"
                                 [nzMax]="dsKeHoachLuongThucClone[i].tkdnThoc[1].soLuong"
                                 [nzSize]="'small'"></nz-input-number>
              </td>
              <td class="text-right">
                <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnThoc[2].soLuong"
                                 name="goiThau" class="w-200" [nzMin]="0"
                                 [nzMax]="dsKeHoachLuongThucClone[i].tkdnThoc[2].soLuong"
                                 [nzSize]="'small'"></nz-input-number>
              </td>
              <td class="text-right">
                {{calculatorxtnTongGao(i)}}
              </td>
              <td class="text-right">
                <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnGao[0].soLuong"
                                 name="goiThau" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnGao[0].soLuong"
                                 class="w-200"
                                 [nzSize]="'small'"></nz-input-number>
              </td>
              <td class="text-right">
                <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnGao[1].soLuong"
                                 name="goiThau" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnGao[1].soLuong"
                                 class="w-200"
                                 [nzSize]="'small'"></nz-input-number>
              </td>
              <td class="text-right">
                <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnGao[2].soLuong"
                                 name="goiThau" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnGao[2].soLuong"
                                 class="w-200"
                                 [nzSize]="'small'"></nz-input-number>
              </td>
              <td class="text-right">
                {{ calculatortkcnTongSoQuyThoc(i)}}
              </td>
              <td class="text-right">
                {{ calculatortkcnTongThoc(i)}}
              </td>
              <td class="text-right">
                {{calculatortkcnTongGao(i)}}
              </td>
              <!-- <td></td> -->
              <td class="text-center" nzRight *ngIf="!isViewDetail">
                <a (click)="saveEdit(i)" class="save">
                  <i class="fa fa-save"></i>
                </a>
                <a (click)="cancelEdit(i)" nzRight class="ml-3">
                  <i class="fa fa-times do"></i>
                </a>
              </td>
            </ng-template>
          </tr>
          </tbody>
          <tfoot>
          <tr *ngIf="thongTinChiTieuKeHoachNam?.khLuongThuc?.length > 0">
            <td nzLeft></td>
            <td class="first-last-row-table background-last-row" nzLeft> Cộng</td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 2, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 3, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 4, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 5, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 6, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 7, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 8, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 9, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 10, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 11, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 12, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 13, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 14, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 15, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 16, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 17, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 18, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 19, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 20, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 21, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 22, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 23, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 24, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 25, 5,
              ',', 'table-luong-thuc') : 0 |
              number: '1.0-1'}}
            </td>
            <!-- <td class="background-last-row"></td> -->
            <td class="background-last-row" *ngIf="thongTinChiTieuKeHoachNam.trangThai===globals.prop.DU_THAO || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai===globals.prop.TU_CHOI" nzRight></td>
          </tr>
          </tfoot>
        </nz-table>
        <div class="tab-content tab-menu" *ngIf="thongTinChiTieuKeHoachNam?.khLuongThuc?.length > 0">
          <div class="tab-pane fade show active justify-content-between">
            <div class="trai">
            </div>
            <div class="canphai">
              <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                             [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate"
                             (nzPageIndexChange)="changePageIndex($event)"
                             (nzPageSizeChange)="changePageSize($event)">
                <ng-template #rangeTemplate let-range="range" let-total>
                  {{ range[0] }}-{{ range[1] }} of {{ total }} items
                </ng-template>
              </nz-pagination>
            </div>
          </div>
        </div>
      </div>
    </nz-tab>
    <nz-tab [nzTitle]="'Kế hoạch muối dự trữ nhà nước'">
      <div id="table-muoi"
           [ngClass]="tabSelected == tab.muoi ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
        <div class="ghichu_tab">Đơn vị tính:Kg</div>
        <nz-table #groupingTableMuoi [nzData]="dsMuoiClone" nzBordered class="table__body" [nzFrontPagination]="false"
                  [nzShowPagination]="false" [nzScroll]="{ x: '1700px' }">
          <thead>
          <tr>
            <th class="text-center" width="2%" nzLeft>STT</th>
            <th class="text-center" width="48%" nzLeft>
              {{userService.isTongCuc() ? 'CỤC DTNN KHU VỰC' : 'CHI CỤC KHU VỰC'}}
            </th>
            <th class="text-center" width="10%">Tồn kho đầu năm</th>
            <th class="text-center" width="10%">Nhập trong năm</th>
            <th class="text-center" width="10%">Xuất trong năm</th>
            <th class="text-center" width="10%">Tồn kho cuối năm</th>
            <th *ngIf="!this.isViewDetail" class="text-center" width="10%" nzRight>
              Hành động
            </th>
          </tr>
          <tr
            [ngClass]="this.thongTinChiTieuKeHoachNam.trangThai === this.globals.prop.BAN_HANH || this.isViewDetail ? 'row-disabled' : ''">
            <td></td>
            <td>
              <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                class="search__input autocomplete__input donvi__input ">
                  <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input (input)="onInput($event, 'muoi')"
                         [nzAutocomplete]="autoMuoi" class="" [(ngModel)]="keHoachMuoiCreate.tenDonVi"
                         (input)="changeDonViMuoi()"/>
                </nz-input-group>
                <ng-template #suffixIcon>
                  <i nz-icon nzType="search"></i>
                </ng-template>
                <nz-autocomplete #autoMuoi (selectionChange)="selectDonViKeyDown($event,'kh-muoi')"
                                 [nzBackfill]="false">
                  <ng-container>
                    <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                                    (click)="selectDonViMuoi(option)">
                      {{ option.labelDonVi }}
                    </nz-auto-option>
                  </ng-container>

                </nz-autocomplete>
              </nz-form-control>
            </td>
            <td class="text-right">
              {{keHoachMuoiCreate.tonKhoDauNam}}
            </td>
            <td class="text-right">
              <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0" [nzSize]="'small'"
                               [(ngModel)]="keHoachMuoiCreate.nhapTrongNam">
              </nz-input-number>
            </td>
            <td class="text-right">
              <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0" [nzSize]="'small'"
                               [nzMax]="keHoachMuoiCreate.tonKhoDauNam"
                               [(ngModel)]="keHoachMuoiCreate.xuatTrongNamMuoi">
              </nz-input-number>
            </td>
            <td class="text-right">
              {{(keHoachMuoiCreate.tonKhoDauNam ? keHoachMuoiCreate.tonKhoDauNam : 0) + (keHoachMuoiCreate.nhapTrongNam ? keHoachMuoiCreate.nhapTrongNam : 0) - (keHoachMuoiCreate.xuatTrongNamMuoi ? keHoachMuoiCreate.xuatTrongNamMuoi : 0)}}
            </td>
            <td *ngIf="!this.isViewDetail" class="text-center">
              <a class="save" (click)="themMoiMuoiDuTru()" [ngClass]="{'isDisabled': (!isAddMuoi)}"
                 style="margin-right: 30px;">
                <i class="icon htvbdh_dau-cong"></i>
              </a>
              <a (click)="clearMuoiDuTru()" [ngClass]="{'isDisabled': !isAddMuoi}" style="margin-right: 10px;">
                <i class="fa fa-trash-o do"></i>
              </a>
            </td>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let dataMuoi of groupingTableMuoi.data, let i = index">
            <ng-container *ngIf="!dsMuoiClone[i]?.isEdit; else editTemplateMuoi">
              <td class="text-right">{{dataMuoi.stt}}</td>
              <td class="text-left">{{dataMuoi.tenDonVi}}</td>
              <td class="text-right">{{dataMuoi.tonKhoDauNam | number: '1.0-1'}}</td>
              <td class="text-right">{{dataMuoi.nhapTrongNam | number: '1.0-1'}}</td>
              <td class="text-right">{{dataMuoi.xuatTrongNamMuoi | number: '1.0-1'}}</td>
              <td
                class="text-right">{{dataMuoi.tonKhoDauNam + dataMuoi.nhapTrongNam - dataMuoi.xuatTrongNamMuoi | number: '1.0-1'}}</td>
              <td *ngIf="!this.isViewDetail" class="text-center" nzRight>
                <a (click)="startEditMuoi(i)">
                  <i class="fa fa-pencil"></i>
                </a>
                <a (click)="deleteKeHoachMuoi(dataMuoi.stt)">
                  <i class="fa fa-trash-o do"></i>
                </a>
              </td>
            </ng-container>
            <ng-template #editTemplateMuoi>
              <td class="text-right">{{dataMuoi.stt}}</td>
              <td class="text-left">{{dataMuoi.tenDonVi}}</td>
              <td class="text-right">{{dataMuoi.tonKhoDauNam | number: '1.0-1'}}</td>
              <td class="text-right">
                <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0" [nzSize]="'small'"
                                 [(ngModel)]="dsMuoiClone[i].nhapTrongNam">
                </nz-input-number>
              </td>
              <td class="text-right">
                <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                                 [nzMax]="dsMuoiClone[i].tonKhoDauNam" [nzSize]="'small'"
                                 [(ngModel)]="dsMuoiClone[i].xuatTrongNamMuoi">
                </nz-input-number>
              </td>
              <td
                class="text-right">{{dataMuoi.tonKhoDauNam + dsMuoiClone[i].nhapTrongNam - dsMuoiClone[i].xuatTrongNamMuoi | number: '1.0-1'}}</td>
              <td *ngIf="!this.isViewDetail" class="text-right" nzRight>
                <a (click)="saveEditMuoi(i)" class="save">
                  <i class="fa fa-save"></i>
                </a>
                <a (click)="cancelEditMuoi(i)">
                  <i class="fa fa-times do"></i>
                </a>
              </td>
            </ng-template>
          </tr>
          </tbody>
          <tfoot>
          <tr>
            <td></td>
            <td style="text-align: center; font-weight: 700">Cộng</td>
            <td class="text-right"> {{sumTotalKhDuTruMuoi.tonKhoDauNam | number: '1.0-1'}}</td>
            <td class="text-right"> {{sumTotalKhDuTruMuoi.nhapTrongNam | number: '1.0-1'}}</td>
            <td class="text-right"> {{sumTotalKhDuTruMuoi.xuatTrongNamMuoi | number: '1.0-1'}}</td>
            <td class="text-right"> {{sumTotalKhDuTruMuoi.tonKhoCuoiNam | number: '1.0-1'}}</td>
            <td></td>
          </tr>
          </tfoot>
        </nz-table>
        <div class="tab-content tab-menu" *ngIf="thongTinChiTieuKeHoachNam?.khMuoiDuTru?.length > 0">
          <div class="tab-pane fade show active justify-content-between">
            <div class="trai">
            </div>
            <div class="canphai">
              <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                             [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate"
                             (nzPageIndexChange)="changePageIndex($event)"
                             (nzPageSizeChange)="changePageSize($event)">
                <ng-template #rangeTemplate let-range="range" let-total>
                  {{ range[0] }}-{{ range[1] }} of {{ total }} items
                </ng-template>
              </nz-pagination>
            </div>
          </div>
        </div>
      </div>
    </nz-tab>
    <nz-tab [nzTitle]="'Kế hoạch nhập vật tư, thiết bị dự trữ nhà nước'">
      <nz-tabset>
        <!--        nhapvattu-->
        <nz-tab nzTitle="Nhập">
          <nz-card class="mt-2px flex-card data-table card-border-content table-card">
            <nz-table #phanBo class="nowrap mt-16 table-chi-tiet" nzBordered>
              <thead>
              <tr>
                <th rowSpan="2">STT</th>
                <th rowSpan="2">Cục DTNN khu vực</th>
                <th rowSpan="2">Mã hàng</th>
                <th rowSpan="2">Ký hiệu</th>
                <th rowSpan="2">Tên hàng</th>
                <th rowSpan="2">Chủng loại hàng</th>
                <th rowSpan="2">Đơn vị tính</th>
                <th colSpan="3">Chỉ tiêu nhập trong năm kế hoạch</th>
                <th rowSpan="2">Hành động</th>
              </tr>
              <tr>
                <th>Tổng số</th>
                <th>Chỉ tiêu nhập các năm trước chuyển sang</th>
                <th>Kế hoạch năm hiện tại</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td></td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                    class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input (input)="onInput($event,'vat-tu')"
                             [nzAutocomplete]="autoDonViVatTuNhap" class=""
                             [(ngModel)]="keHoachVatTuNhapCreate.tenDvi"/>
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoDonViVatTuNhap (selectionChange)="selectDonViKeyDown($event,'kh-vat-tu')"
                                     [nzBackfill]="false">
                      <ng-container>
                        <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                                        (click)="selectDonViVatTuNew(option,'nhap')">
                          {{ option.labelDonVi }}
                        </nz-auto-option>
                      </ng-container>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>{{keHoachVatTuNhapCreate.dsVatTu[0].maHang}}</td>
                <td>{{keHoachVatTuNhapCreate.dsVatTu[0].kyHieu}}</td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                    class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                             [nzAutocomplete]="autoVatTuNhap"
                             class="" [(ngModel)]="keHoachVatTuNhapCreate.dsVatTu[0].tenVatTuCha"
                      />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoVatTuNhap>
                      <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                                      (click)="selectTenHangNew(vatTuCha,'nhap')">
                        {{ vatTuCha.ten }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                    class="search__input autocomplete__input donvi__input w-300">
                      <input nz-input (input)="onInputChungLoaiHang($event)" [nzAutocomplete]="autoChungLoaiHangNhap"
                             class=""
                             [(ngModel)]="keHoachVatTuNhapCreate.dsVatTu[0].tenVatTu"
                             [disabled]="dataVatTuConClone.length == 0"
                             [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'"/>
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoChungLoaiHangNhap>
                      <nz-auto-option *ngFor="let vatTuCon of dataVatTuConShow" [nzValue]="vatTuCon.ten"
                                      (click)="selectChungLoaiHangNew(vatTuCon,'nhap')">
                        {{ vatTuCon.ten }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>{{keHoachVatTuNhapCreate.dsVatTu[0].donViTinh}}</td>
                <td></td>
                <td>
                  <nz-input-number [nzSize]="'small'" nz-input
                                   [(ngModel)]="keHoachVatTuNhapCreate.dsVatTu[0].soLuongChuyenSang"
                                   [nzMin]="0" [nzFormatter]="globals.formatter"
                                   [nzParser]="globals.parser"></nz-input-number>
                </td>
                <td>
                  <nz-input-number [nzSize]="'small'" nz-input
                                   [(ngModel)]="keHoachVatTuNhapCreate.dsVatTu[0].soLuongNhap"
                                   [nzMin]="0" [nzFormatter]="globals.formatter"
                                   [nzParser]="globals.parser"></nz-input-number>
                </td>
                <td>
                  <a (click)="themVatTu('nhap')">
                    <i class="fa fa-plus"></i>
                  </a>
                </td>
              </tr>
              <ng-container *ngFor="let item of dataVatTuNhap, let i = index">
                <!--      tr create line-->
                <tr>
                  <td>{{i + 1}}</td>
                  <td colspan="9" [nzExpand]="expandSetVatTuNhap.has(item.maDvi)" nzShowExpand="true"
                      (nzExpandChange)="onExpandChange(item.maDvi, $event)"
                      style="width: 35px">{{ item.tenDvi }}</td>
                  <td>
                  </td>
                </tr>
                <ng-container *ngIf="expandSetVatTuNhap.has(item.maDvi)">
                  <tr *ngFor="let r of item.dsVatTu,let i1=index">
                    <ng-container *ngIf="!dataVatTuNhapEdit[i].dsVatTu[i1].isEdit; else editTemplateNhap">
                      <td></td>
                      <td>{{i1 + 1}}</td>
                      <td>{{r.maHang}}</td>
                      <td>{{r.kyHieu}}</td>
                      <td>{{r.tenVatTuCha}}</td>
                      <td>{{r.tenVatTu}}</td>
                      <td>{{r.donViTinh}}</td>
                      <td>{{+r.soLuongChuyenSang + +r.soLuongNhap|number: '1.0-1'}}</td>
                      <td>{{r.soLuongChuyenSang|number: '1.0-1'}}</td>
                      <td>{{r.soLuongNhap|number: '1.0-1'}}</td>
                      <td>
                        <a (click)="suaVatTu(i,i1,'nhap')">
                          <i class="fa fa-pencil"></i>
                        </a>
                        <a (click)="xoaVatTu(i,i1,'nhap')">
                          <i class="fa fa-trash-o do"></i>
                        </a>
                      </td>
                    </ng-container>
                    <ng-template #editTemplateNhap>
                      <td></td>
                      <td></td>
                      <td>{{dataVatTuNhapEdit[i].dsVatTu[i1].maHang}}</td>
                      <td>{{dataVatTuNhapEdit[i].dsVatTu[i1].kyHieu}}</td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                                   [nzAutocomplete]="autoVatTuNhapEdit"
                                   class="" [(ngModel)]="dataVatTuNhapEdit[i].dsVatTu[i1].tenVatTuCha"
                            />
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoVatTuNhapEdit>
                            <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                                            (click)="selectTenHangEditNew(i,i1,vatTuCha,'nhap')">
                              {{ vatTuCha.ten }}
                            </nz-auto-option>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input nz-input (input)="onInputChungLoaiHang($event)"
                                   [nzAutocomplete]="autoChungLoaiHangNhapEdit"
                                   class=""
                                   [(ngModel)]="dataVatTuNhapEdit[i].dsVatTu[i1].tenVatTu"
                                   [disabled]="dataVatTuConClone.length == 0"
                                   [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'"/>
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoChungLoaiHangNhapEdit>
                            <nz-auto-option *ngFor="let vatTuCon of dataVatTuConEditNhapShow[i]"
                                            [nzValue]="vatTuCon.ten"
                                            (click)="selectChungLoaiHangEditNew(i,i1,vatTuCon,'nhap')">
                              {{ vatTuCon.ten }}
                            </nz-auto-option>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>{{dataVatTuNhapEdit[i].dsVatTu[i1].donViTinh}}</td>
                      <td>{{+dataVatTuNhapEdit[i].dsVatTu[i1].soLuongChuyenSang + +dataVatTuNhapEdit[i].dsVatTu[i1].soLuongNhap|number: '1.0-1'}}</td>
                      <td>
                        <nz-input-number [nzMin]=0 nzSize="small"
                                         [(ngModel)]="dataVatTuNhapEdit[i].dsVatTu[i1].soLuongChuyenSang"
                                         [nzFormatter]="globals.formatter"
                                         [nzParser]="globals.parser"></nz-input-number>
                      </td>
                      <td>
                        <nz-input-number [nzMin]=0 nzSize="small"
                                         [(ngModel)]="dataVatTuNhapEdit[i].dsVatTu[i1].soLuongNhap"
                                         [nzFormatter]="globals.formatter"
                                         [nzParser]="globals.parser"></nz-input-number>
                      </td>
                      <td>
                        <a (click)="luuSuaVatTu(i,i1,'nhap')" class="save">
                          <i class="fa fa-save"></i>
                        </a>
                        <a (click)="huySuaVatTu(i,i1,'nhap')">
                          <i class="fa fa-times do"></i>
                        </a>
                      </td>
                    </ng-template>
                  </tr>
                </ng-container>
              </ng-container>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>
        <!--        xuatvattu-->
        <nz-tab nzTitle="Xuất">
          <nz-card class="mt-2px flex-card data-table card-border-content table-card">
            <nz-table #phanBo class="nowrap mt-16 table-chi-tiet" nzBordered>
              <thead>
              <tr>
                <th rowSpan="2">STT</th>
                <th rowSpan="2">Cục DTNN khu vực</th>
                <th rowSpan="2">Mã hàng</th>
                <th rowSpan="2">Ký hiệu</th>
                <th rowSpan="2">Tên hàng</th>
                <th rowSpan="2">Chủng loại hàng</th>
                <th rowSpan="2">Đơn vị tính</th>
                <th colSpan="3">Chỉ tiêu nhập trong năm kế hoạch</th>
                <th rowSpan="2">Hành động</th>
              </tr>
              <tr>
                <th>Tổng số</th>
                <th>Chỉ tiêu nhập các năm trước chuyển sang</th>
                <th>Kế hoạch năm hiện tại</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td></td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                    class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input (input)="onInput($event,'vat-tu')"
                             [nzAutocomplete]="autoDonViVatTuXuat" class=""
                             [(ngModel)]="keHoachVatTuXuatCreate.tenDvi"/>
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoDonViVatTuXuat (selectionChange)="selectDonViKeyDown($event,'kh-vat-tu')"
                                     [nzBackfill]="false">
                      <ng-container>
                        <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                                        (click)="selectDonViVatTuNew(option,'xuat')">
                          {{ option.labelDonVi }}
                        </nz-auto-option>
                      </ng-container>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>{{keHoachVatTuXuatCreate.dsVatTu[0].maHang}}</td>
                <td>{{keHoachVatTuXuatCreate.dsVatTu[0].kyHieu}}</td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                    class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                             [nzAutocomplete]="autoVatTuXuat"
                             class="" [(ngModel)]="keHoachVatTuXuatCreate.dsVatTu[0].tenVatTuCha"
                      />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoVatTuXuat>
                      <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                                      (click)="selectTenHangNew(vatTuCha,'xuat')">
                        {{ vatTuCha.ten }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                    class="search__input autocomplete__input donvi__input w-300">
                      <input nz-input (input)="onInputChungLoaiHang($event)" [nzAutocomplete]="autoChungLoaiHangXuat"
                             class=""
                             [(ngModel)]="keHoachVatTuXuatCreate.dsVatTu[0].tenVatTu"
                             [disabled]="dataVatTuConClone.length == 0"
                             [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'"/>
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoChungLoaiHangXuat>
                      <nz-auto-option *ngFor="let vatTuCon of dataVatTuConShow" [nzValue]="vatTuCon.ten"
                                      (click)="selectChungLoaiHangNew(vatTuCon,'xuat')">
                        {{ vatTuCon.ten }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>{{keHoachVatTuXuatCreate.dsVatTu[0].donViTinh}}</td>
                <td></td>
                <td>
                  <nz-input-number [nzSize]="'small'" nz-input
                                   [(ngModel)]="keHoachVatTuXuatCreate.dsVatTu[0].soLuongChuyenSang"
                                   [nzMin]="0"></nz-input-number>
                </td>
                <td>
                  <nz-input-number [nzSize]="'small'" nz-input
                                   [(ngModel)]="keHoachVatTuXuatCreate.dsVatTu[0].soLuongNhap"
                                   [nzMin]="0"></nz-input-number>
                </td>
                <td>
                  <a (click)="themVatTu('xuat')">
                    <i class="fa fa-plus"></i>
                  </a>
                  <!--<a (click)="suaPhuongAn(i)" *ngIf="!isView">
                    <i class="fa fa-pencil"></i>
                  </a>
                  &lt;!&ndash;              <a (click)="deletePhanLo(item.idVirtual)">&ndash;&gt;
                  <a (click)="xoaPhuongAn(i)" *ngIf="!isView">
                    <i class="fa fa-trash-o do"></i>
                  </a>-->
                </td>
              </tr>
              <ng-container *ngFor="let item of dataVatTuXuat, let i = index">
                <!--      tr create line-->
                <tr>
                  <td>{{i + 1}}</td>
                  <td colspan="9" [nzExpand]="expandSetVatTuXuat.has(item.maDvi)" nzShowExpand="true"
                      (nzExpandChange)="onExpandChange(item.maDvi, $event)"
                      style="width: 35px">{{ item.tenDvi }}</td>
                  <td>
                  </td>
                </tr>
                <ng-container *ngIf="expandSetVatTuXuat.has(item.maDvi)">
                  <tr *ngFor="let r of item.dsVatTu,let i1=index">
                    <ng-container *ngIf="!dataVatTuXuatEdit[i].dsVatTu[i1].isEdit; else editTemplateXuat">
                      <td></td>
                      <td>{{i1 + 1}}</td>
                      <td>{{r.maHang}}</td>
                      <td>{{r.kyHieu}}</td>
                      <td>{{r.tenVatTuCha}}</td>
                      <td>{{r.tenVatTu}}</td>
                      <td>{{r.donViTinh}}</td>
                      <td>{{+r.soLuongChuyenSang + +r.soLuongNhap}}</td>
                      <td>{{r.soLuongChuyenSang}}</td>
                      <td>{{r.soLuongNhap}}</td>
                      <td>
                        <a (click)="suaVatTu(i,i1,'xuat')">
                          <i class="fa fa-pencil"></i>
                        </a>
                        <a (click)="xoaVatTu(i,i1,'xuat')">
                          <i class="fa fa-trash-o do"></i>
                        </a>
                      </td>
                    </ng-container>
                    <ng-template #editTemplateXuat>
                      <td></td>
                      <td></td>
                      <td>{{dataVatTuXuatEdit[i].dsVatTu[i1].maHang}}</td>
                      <td>{{dataVatTuXuatEdit[i].dsVatTu[i1].kyHieu}}</td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                                   [nzAutocomplete]="autoVatTuXuatEdit"
                                   class="" [(ngModel)]="dataVatTuXuatEdit[i].dsVatTu[i1].tenVatTuCha"
                            />
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoVatTuXuatEdit>
                            <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                                            (click)="selectTenHangEditNew(i,i1,vatTuCha,'nhap')">
                              {{ vatTuCha.ten }}
                            </nz-auto-option>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input nz-input (input)="onInputChungLoaiHang($event)"
                                   [nzAutocomplete]="autoChungLoaiHangXuatEdit"
                                   class=""
                                   [(ngModel)]="dataVatTuXuatEdit[i].dsVatTu[i1].tenVatTu"
                                   [disabled]="dataVatTuConClone.length == 0"
                                   [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'"/>
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoChungLoaiHangXuatEdit>
                            <nz-auto-option *ngFor="let vatTuCon of dataVatTuConEditXuatShow[i]"
                                            [nzValue]="vatTuCon.ten"
                                            (click)="selectChungLoaiHangEditNew(i,i1,vatTuCon,'xuat')">
                              {{ vatTuCon.ten }}
                            </nz-auto-option>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>{{dataVatTuXuatEdit[i].dsVatTu[i1].donViTinh}}</td>
                      <td>{{+dataVatTuXuatEdit[i].dsVatTu[i1].soLuongChuyenSang + +dataVatTuXuatEdit[i].dsVatTu[i1].soLuongNhap|number: '1.0-1'}}</td>
                      <td>
                        <nz-input-number [nzMin]=0 nzSize="small"
                                         [(ngModel)]="dataVatTuXuatEdit[i].dsVatTu[i1].soLuongChuyenSang"></nz-input-number>
                      </td>
                      <td>
                        <nz-input-number [nzMin]=0 nzSize="small"
                                         [(ngModel)]="dataVatTuXuatEdit[i].dsVatTu[i1].soLuongNhap"></nz-input-number>
                      </td>
                      <td>
                        <a (click)="luuSuaVatTu(i,i1,'xuat')" class="save">
                          <i class="fa fa-save"></i>
                        </a>
                        <a (click)="huySuaVatTu(i,i1,'xuat')">
                          <i class="fa fa-times do"></i>
                        </a>
                      </td>
                    </ng-template>
                  </tr>
                </ng-container>
              </ng-container>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>
      </nz-tabset>
      <!--<div id="table-vat-tu"
           [ngClass]="tabSelected == tab.vatTu ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
        <nz-table #groupingTableVatTu [nzData]="dsVatTuClone" nzBordered class="table__body" [nzFrontPagination]="false"
                  [nzShowPagination]="false" [nzScroll]="{ x: '1700px' }">
          <thead>
          <tr>
            <th rowspan="3" class="text-center" width="40px" nzLeft>STT</th>
            <th rowspan="3" class="text-center" width="330px" nzLeft>
              {{userService.isTongCuc() ? 'CỤC DTNN KHU VỰC' : 'CHI CỤC KHU VỰC'}}
            </th>
            <th rowspan="3" class="text-center" width="330px">Mã hàng</th>
            <th rowspan="3" class="text-center" width="330px">Ký hiệu</th>
            <th rowspan="3" class="text-center" width="330px">Tên hàng</th>
            <th rowspan="3" class="text-center" width="330px">Chủng loại hàng</th>
            <th rowspan="3" class="text-center" width="330px">ĐƠN VỊ TÍNH</th>
            <th colspan="6" class="text-center" width="800px">CHỈ TIÊU NHẬP TRONG NĂM KẾ HOẠCH NĂM</th>
            <th rowspan="3" *ngIf="!this.isViewDetail" class="text-right" width="90px" nzRight>HÀNH ĐỘNG</th>
          </tr>
          <tr>
            <th rowspan="2" class="text-center">
              Tổng số
            </th>
            <th colspan="4" class="text-center">Chỉ tiêu nhập các năm trước chuyển</th>
            <th rowspan="2" class="text-center">
              Kế hoạch năm hiện tại
            </th>
          </tr>
          <tr>
            <th class="text-center">Tổng</th>
            <th class="text-center">KH năm <br> (1)</th>
            <th class="text-center">KH năm <br> (2)</th>
            <th class="text-center">KH năm <br> (3)</th>
          </tr>
          </thead>
          <tbody>
          <tr
            [ngClass]="this.thongTinChiTieuKeHoachNam.trangThai === this.globals.prop.BAN_HANH || this.isViewDetail ? 'row-disabled' : ''">
            <td></td>
            <td>
              <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                class="search__input autocomplete__input donvi__input w-300">
                  <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input (input)="onInput($event,'vat-tu')"
                         [nzAutocomplete]="autoDonViVatTu" class="" [(ngModel)]="keHoachVatTuCreate.tenDonVi"/>
                </nz-input-group>
                <ng-template #suffixIcon>
                  <i nz-icon nzType="search"></i>
                </ng-template>
                <nz-autocomplete #autoDonViVatTu (selectionChange)="selectDonViKeyDown($event,'kh-vat-tu')"
                                 [nzBackfill]="false">
                  <ng-container>
                    <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                                    (click)="selectDonViVatTu(option)">
                      {{ option.labelDonVi }}
                    </nz-auto-option>
                  </ng-container>
                </nz-autocomplete>
              </nz-form-control>
            </td>
            <td class="text-left">{{keHoachVatTuCreate.vatTuThietBi[0]?.maVatTuCha}}</td>
            <td class="text-left">{{keHoachVatTuCreate.vatTuThietBi[0]?.kyHieu}}</td>
            <td>
              <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                class="search__input autocomplete__input donvi__input w-300">
                  <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)" [nzAutocomplete]="autoVatTu"
                         class="" [(ngModel)]="keHoachVatTuCreate.vatTuThietBi[0].tenVatTuCha"
                         [title]="keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTuCha ? keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTuCha : ''"/>
                </nz-input-group>
                <ng-template #suffixIcon>
                  <i nz-icon nzType="search"></i>
                </ng-template>
                <nz-autocomplete #autoVatTu>
                  <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                                  (click)="selectTenHang(vatTuCha)">
                    {{ vatTuCha.ten }}
                  </nz-auto-option>
                </nz-autocomplete>
              </nz-form-control>
            </td>
            <td>
              <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                class="search__input autocomplete__input donvi__input w-300">
                  <input nz-input (input)="onInputChungLoaiHang($event)" [nzAutocomplete]="autoChungLoaiHang" class=""
                         [(ngModel)]="keHoachVatTuCreate.vatTuThietBi[0].tenVatTu"
                         [title]="keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTu ? keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTu : ''"
                         [disabled]="dataVatTuConClone.length == 0"
                         [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'"/>
                </nz-input-group>
                <ng-template #suffixIcon>
                  <i nz-icon nzType="search"></i>
                </ng-template>
                <nz-autocomplete #autoChungLoaiHang>
                  <nz-auto-option *ngFor="let vatTuCon of dataVatTuConShow" [nzValue]="vatTuCon.ten"
                                  (click)="selectChungLoaiHang(vatTuCon)">
                    {{ vatTuCon.ten }}
                  </nz-auto-option>
                </nz-autocomplete>
              </nz-form-control>
            </td>
            <td class="text-left">
              {{keHoachVatTuCreate.vatTuThietBi[0]?.donViTinh}}
            </td>
            <td class="text-right">{{keHoachVatTuCreate.vatTuThietBi[0]?.tongNhap | number: '1.0-1'}}</td>
            <td class="text-right">
              {{keHoachVatTuCreate.vatTuThietBi[0]?.tongCacNamTruoc | number: '1.0-1'}}
            </td>
            <td class="text-right">
              {{keHoachVatTuCreate.vatTuThietBi[0]?.cacNamTruoc[0]?.soLuong | number: '1.0-1'}}
            </td>
            <td class="text-right">
              {{keHoachVatTuCreate.vatTuThietBi[0]?.cacNamTruoc[1]?.soLuong | number: '1.0-1'}}
            </td>
            <td class="text-right">
              {{keHoachVatTuCreate.vatTuThietBi[0]?.cacNamTruoc[2]?.soLuong | number: '1.0-1'}}
            </td>
            <td class="text-right">
              <input class="w-120" nz-input nzSize="small" appNumberOnly
                     [(ngModel)]="keHoachVatTuCreate.vatTuThietBi[0].nhapTrongNam"
                     (input)="calculatorTongChiTieuNtn()"/>
            </td>
            <td *ngIf="!this.isViewDetail" class="text-right" nzRight style="margin-right: 30px;">
              <a class="save" (click)="themMoiVatTu()" [ngClass]="{'isDisabled': !isAddVatTu}">
                <i class="icon htvbdh_dau-cong"></i>
              </a>
              <a (click)="clearVatTu()" [ngClass]="{'isDisabled': !isAddVatTu}" style="margin-right: 10px;">
                <i class="fa fa-trash-o do"></i>
              </a>
            </td>
          </tr>
          <tr *ngFor="let dataVatTu of groupingTableVatTu.data, let i = index">
            <ng-container *ngIf="!dsVatTuClone[i]?.isEdit; else editTemplateVatTu">
              <td class="text-right">{{dataVatTu.stt}}</td>
              <td class="text-left">{{dataVatTu.tenDonVi}}</td>
              <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.maVatTuCha}}</td>
              <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.kyHieu}}</td>
              <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.tenVatTuCha}}</td>
              <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.tenVatTu}}</td>
              <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.donViTinh}}</td>
              <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.tongNhap | number: '1.0-1'}}</td>
              <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.tongCacNamTruoc | number: '1.0-1'}}</td>
              <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.cacNamTruoc[0]?.soLuong | number: '1.0-1'}}</td>
              <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.cacNamTruoc[1]?.soLuong | number: '1.0-1'}}</td>
              <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.cacNamTruoc[2]?.soLuong | number: '1.0-1'}}</td>
              <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.nhapTrongNam | number: '1.0-1'}}</td>
              <td *ngIf="!this.isViewDetail" class="text-right" nzRight>
                <a (click)="startEditVatTu(i)">
                  <i class="fa fa-pencil"></i>
                </a>
                <a (click)="deleteKeHoachVatTu(dataVatTu.stt)">
                  <i class="fa fa-trash-o do"></i>
                </a>
              </td>
            </ng-container>
            <ng-template #editTemplateVatTu>
              <td class="text-right">{{dsVatTuClone[i].stt}}</td>
              <td class="text-left">{{dsVatTuClone[i].tenDonVi}}</td>
              <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.maVatTuCha}}</td>
              <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.kyHieu}}</td>
              <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.tenVatTuCha}}</td>
              <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.tenVatTu}}</td>
              <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.donViTinh}}</td>
              <td class="text-right">{{calculatorTongChiTieuNhaptrongNam(i)}}</td>
              <td class="text-right">{{dsVatTuClone[i].vatTuThietBi[0]?.tongCacNamTruoc | number: '1.0-1'}}</td>
              <td class="text-right">{{dsVatTuClone[i].vatTuThietBi[0]?.cacNamTruoc[0]?.soLuong | number: '1.0-1'}}
              </td>
              <td class="text-right">{{dsVatTuClone[i].vatTuThietBi[0]?.cacNamTruoc[1]?.soLuong | number: '1.0-1'}}
              </td>
              <td class="text-right">{{dsVatTuClone[i].vatTuThietBi[0]?.cacNamTruoc[2]?.soLuong | number: '1.0-1'}}
              </td>
              <td class="text-right">
                <input class="w-120" nz-input nzSize="small" appNumberOnly
                       [(ngModel)]="dsVatTuClone[i].vatTuThietBi[0].nhapTrongNam"/>
              </td>
              <td *ngIf="!this.isViewDetail" class="text-right" nzRight>
                <a (click)="saveEditVatTu(i)" class="save">
                  <i class="fa fa-save"></i>
                </a>
                <a (click)="cancelEditVatTu(i)">
                  <i class="fa fa-times do"></i>
                </a>
              </td>
            </ng-template>
          </tr>
          <tr *ngIf="thongTinChiTieuKeHoachNam?.khVatTu.length > 0">
            <td colspan="2" class="first-last-row-table background-last-row">Cộng</td>
            <td class="background-last-row">
            </td>
            <td class="background-last-row">
            </td>
            <td class="background-last-row">
            </td>
            <td class="background-last-row">
            </td>
            <td class="background-last-row">
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 7, 4, ',', 'table-vat-tu') :
              0 |
                number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 8, 4, ',', 'table-vat-tu') :
              0 |
                number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 9, 4, ',', 'table-vat-tu') :
              0 |
                number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 10, 4, ',', 'table-vat-tu') :
              0 |
                number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 11, 4, ',', 'table-vat-tu') :
              0 |
                number: '1.0-1'}}
            </td>
            <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 12, 4, ',', 'table-vat-tu') :
              0 |
                number: '1.0-1'}}
            </td>
            <td class="background-last-row" *ngIf="!this.isViewDetail" nzRight>
            </td>
          </tr>
          </tbody>
        </nz-table>
        <div class="tab-content tab-menu" *ngIf="thongTinChiTieuKeHoachNam?.khVatTu.length > 0">
          <div class="tab-pane fade show active justify-content-between">
            <div class="trai">
            </div>
            <div class="canphai">
              <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                             [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate"
                             (nzPageIndexChange)="changePageIndex($event)"
                             (nzPageSizeChange)="changePageSize($event)">
                <ng-template #rangeTemplate let-range="range" let-total>
                  {{ range[0] }}-{{ range[1] }} of {{ total }} items
                </ng-template>
              </nz-pagination>
            </div>
          </div>
        </div>
      </div>-->
    </nz-tab>
    <nz-tab (nzClick)="downloadTemplate()" [nzTitle]="titleTemplate">
      <ng-template #titleTemplate>
        <div><i style="color: blue" class="icon htvbdh_tcdt_tep"></i> Tải biểu mẫu import dữ liệu</div>
      </ng-template>
    </nz-tab>
  </nz-tabset>

  <!-- start dialog place-->
  <!-- ========== -->
  <!--  dialog can cu-->
  <nz-modal [(nzVisible)]="openSelectCanCu" nzTitle="Căn cứ quyết định giao chỉ tiêu kế hoạch của TCDT">
    <div *nzModalContent class="modal__content">
      <nz-card class="mt-2px flex-card data-table card-border-content table-card">
        <nz-table #canCuTable nzBordered [nzData]="canCuData" [nzFrontPagination]="false" [nzShowPagination]="false">
          <thead>
          <tr>
            <th width="45px">
              <label nz-checkbox [(ngModel)]="allChecked" (ngModelChange)="updateAllChecked()"
                     [nzIndeterminate]="indeterminate"></label>
            </th>
            <th class="text-center">STT</th>
            <th class="text-center">Số quyết định</th>
            <th class="text-center">Ngày QĐ</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of canCuTable.data; let idx = index" (click)="updateSingleChecked()">
            <th width="45px">
              <label nz-checkbox [(ngModel)]="data.checked" (ngModelChange)="updateSingleChecked()"
                     [nzDisabled]="data.trangThai != '00'"></label>
            </th>
            <td class="text-center">{{(page - 1) * pageSize + idx + 1}}</td>
            <td>{{ data.soQd }}</td>
            <td>{{ data.ngayQd | date: 'dd/MM/YYYY' }}</td>
          </tr>
          </tbody>
        </nz-table>
        <div class="tab-content tab-menu">
          <div class="tab-pane fade show active justify-content-between">
            <div class="trai">
            </div>
            <div class="canphai">
              <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                             [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate"
                             (nzPageIndexChange)="changePageIndex($event)"
                             (nzPageSizeChange)="changePageSize($event)">
                <ng-template #rangeTemplate let-range="range" let-total>
                  {{ range[0] }}-{{ range[1] }} of {{ total }} items
                </ng-template>
              </nz-pagination>
            </div>
          </div>
        </div>
      </nz-card>
    </div>
    <div *nzModalFooter>
      <button nz-button (click)="handleCanCuOk()" class="modal__button--save">
        <i class="icon htvbdh_tcdt_tuchoi"></i>
        Xác nhận
      </button>
      <button nz-button (click)="handleCanCuCancel()" class="modal__button--cancel">
        <i nz-icon nzType="close-circle" nzTheme="fill" class="icon-cancel"></i>
        Đóng
      </button>
    </div>
  </nz-modal>
  <!-- ========== -->
  <!--  end dialog place-->
</div>
