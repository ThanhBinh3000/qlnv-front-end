<nz-affix class="menu-lv2 dieu-chinh-button" [nzOffsetTop]="43" *ngIf="!isViewOnModal">
  <div class="tab-content tab-menu" id="myTabContent">
    <div class="d-flex justify-content-between header-tab" id="banhanh">
      <div class="trai">
      </div>
      <div class="canphai phai">
        <button type="button" class="btn btn-sub" *ngIf="showListEvent.observers.length>0"
          (click)="redirectChiTieuKeHoachNam()">
          <i class="fa fa-arrow-left"></i>
          <span>Quay lại</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="guiDuyet()"
          *ngIf="isTongCuc() && thongTinChiTieuKeHoachNam.trangThai == STATUS.DANG_NHAP_DU_LIEU && (userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_CUC_BANHANH') || userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_TC_BANHANH'))">
          <i class="icon htvbdh_tcdt_guiduyet"></i>
          <span>Ban hành</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="guiDuyet()"
          *ngIf="isCuc() && thongTinChiTieuKeHoachNam.trangThai == STATUS.DU_THAO && (userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_CUC_BANHANH') || userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_TC_BANHANH'))">
          <i class="icon htvbdh_tcdt_guiduyet"></i>
          <span>Lưu và Gửi duyệt</span>
        </button>
        <button
          *ngIf="isCuc() && (thongTinChiTieuKeHoachNam.trangThai == STATUS.CHO_DUYET_TP || thongTinChiTieuKeHoachNam.trangThai == STATUS.CHO_DUYET_LDC) && (userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_CUC_BANHANH') || userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_TC_BANHANH'))"
          type="button" class="btn btn-sub" (click)="pheDuyet()">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Phê Duyệt</span>
        </button>
        <button
          *ngIf="isCuc() && thongTinChiTieuKeHoachNam.trangThai == STATUS.DA_DUYET_LDC && (userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_CUC_BANHANH') || userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_TC_BANHANH'))"
          type="button" class="btn btn-sub" (click)="pheDuyet()">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Ban hành</span>
        </button>

        <button class="btn btn-main btn-sm waves-effect waves-light" (click)="save(false)"
          *ngIf="(thongTinChiTieuKeHoachNam.trangThai == STATUS.DANG_NHAP_DU_LIEU || thongTinChiTieuKeHoachNam.trangThai == STATUS.DU_THAO) && (userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_CUC_THEM') || userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_TC_THEM'))">
          <i class="icon htvbdh_tcdt_save"></i>
          <span>Lưu</span>
        </button>
      </div>
    </div>
  </div>
</nz-affix>
<div class="bg-trang">
  <nz-card class="mt16 flex-card p-lr16">
    <div class="header">
      <div class="header-text">
        <div class="title-chi-tieu">
          <span
            [ngClass]="thongTinChiTieuKeHoachNam.trangThai == STATUS.BAN_HANH ? 'da-ban-hanh' : 'du-thao-va-lanh-dao-duyet'  ">
            {{thongTinChiTieuKeHoachNam.trangThai == STATUS.DANG_NHAP_DU_LIEU ? 'Đang nhập dữ liệu' :
            thongTinChiTieuKeHoachNam.tenTrangThai
            }}
          </span>
          <span>QUYẾT ĐỊNH ĐIỀU CHỈNH CHỈ TIÊU KẾ HOẠCH NĂM CỦA {{thongTinChiTieuKeHoachNam.cap == "1" ?
            'TỔNG CỤC' : 'CỤC'}}
          </span>
        </div>
      </div>
    </div>
    <form nz-form [formGroup]="formData" [nzLayout]="'vertical'">
      <div nz-row [nzGutter]="[16, 12]">
        <div nz-col nzSpan="4">
          <nz-form-item>
            <nz-form-label nz-col nzRequired [nzNoColon]="true" class="text-left"> Năm kế hoạch
            </nz-form-label>
            <nz-form-control nz-col [nzErrorTip]="error">
              <nz-select formControlName="namKeHoach" (ngModelChange)="selectNam()"
                [nzDisabled]="isViewDetail || !!this.id" nzAllowClear>
                <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
              </nz-select>
              <!-- <input [readonly]="true" nz-input formControlName="namKeHoach" readonly="true" /> -->
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col nzSpan="4">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true" class="text-left"> Số quyết định</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group nzAddOnAfter="/{{qdTCDT}}">
                <nz-input-number formControlName="soQuyetDinh" [nzMin]="1" [nzMax]="999999999999" [nzStep]="1"
                  [nzSize]="'small'" [nzDisabled]="isViewDetail" placeholder="Nhập số quyết định">
                </nz-input-number>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col nzSpan="4">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" class="text-left"> Ngày ký
            </nz-form-label>
            <nz-form-control nz-col [nzErrorTip]="error">
              <nz-date-picker class="search__input" nzFormat="dd/MM/yyyy" formControlName="ngayKy"
                [nzDisabled]="isViewDetail" nzPlaceHolder="Ngày ký">
              </nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col nzSpan="4">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" class="text-left"> Ngày hiệu lực
            </nz-form-label>
            <nz-form-control nz-col [nzErrorTip]="error">
              <nz-date-picker class="search__input" nzFormat="dd/MM/yyyy" formControlName="ngayHieuLuc"
                [nzDisabled]="isViewDetail" nzPlaceHolder="Ngày hiệu lực">
              </nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="4">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true">{{formData.value.cap == 1 ? "Số QĐ giao chỉ tiêu KH năm" :
              "Số QĐ điều chỉnh chỉ tiêu KH năm của TC"}}</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <!-- <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogQD()"> -->
              <input [readonly]="true" nz-input formControlName="soQuyetDinhGiaoCuaTc" readonly="true" />
              <!-- </nz-input-group> -->
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="4">
          <nz-form-item>
            <nz-form-label [nzRequired]="isTongCuc()" [nzNoColon]="true">Căn cứ trên số công văn/tờ
              trình</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <!-- <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogQD()"> -->
              <input [readonly]="true" nz-input formControlName="soCongVan" readonly="true" />
              <!-- </nz-input-group> -->
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="4" *ngIf="userService.isCuc() && formData.value.cap == 2">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true">Số QĐ giao chỉ tiêu KH năm của Cục</nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <!-- <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogQD()"> -->
              <input [readonly]="true" nz-input formControlName="soQuyetDinhGiaoNam" readonly="true" />
              <!-- </nz-input-group> -->
            </nz-form-control>
          </nz-form-item>
        </div>


        <div nz-col nzSpan="24">
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true" class="text-left"> Trích yếu
            </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <textarea rows="3" formControlName="trichYeu" class="search__input" nz-input nzSize="small"
                placeholder="Nhập text" [readonly]="isViewDetail"></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="24" *ngIf="isTongCuc()">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"> Số đề xuất điều chỉnh của Cục DTNN KV</nz-form-label>
            <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
              <input [readonly]="true" nz-input formControlName="soQuyetDinhDcCuaC" readonly="true" />
              <!-- <nz-select [nzDisabled]="isViewDetail" nzMode="multiple" nzPlaceHolder="Chọn số đề xuất" nzAllowClear
                formControlName="soQuyetDinhDcCuaCs">
                <nz-option *ngFor="let dx of listDeXuat" [nzValue]="dx" [nzLabel]="dx"></nz-option>
              </nz-select> -->
            </nz-form-control>
          </nz-form-item>
        </div>



        <div nz-col [nzSpan]="24">
          <nz-form-item class="form-item">
            <nz-form-label [nzNoColon]="true" class="label-color-kh"> Căn cứ pháp lý</nz-form-label>
            <div class="list-file">
              <file-list [isCanCuPL]="true" [disabled]="isViewDetail" [isViewDetail]="isViewDetail"
                [data]="listCcPhapLy"></file-list>
            </div>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="24">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" class="label-color-kh"> File đính kèm quyết định đã ký, đóng
              dấu</nz-form-label>
            <nz-form-control>
              <div class="list-file">
                <file-list [disabled]="isViewDetail" [data]="fileDinhKems" [isViewDetail]="isViewDetail"></file-list>
              </div>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </form>
  </nz-card>
  <div class='d-flex justify-content-between header-tab mt-2' *ngIf='thongTinChiTieuKeHoachNam.cap == "1"'>
    <div class='trai'>
    </div>
    <div class='canphai phai'>
      <button type='button' class='btn btn-main' (click)='preViewTheoCuc()'>
        <i class=' icon htvbdh_tcdt_print'></i>
        <span>Kết xuất dữ liệu theo Cục</span>
      </button>
    </div>
  </div>
  <!-- <nz-affix class="menu-lv3" [nzOffsetTop]="100"> -->
  <nz-tabset nzType="card" class="mt16 flex-card p-lr16" nz>
    <nz-tab [nzTitle]="'Kế hoạch lương thực dự trữ nhà nước'">
      <div id="table-luong-thuc"
        [ngClass]="tabSelected == tab.luongThuc ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
        <div class='d-flex justify-content-between header-tab'>
          <div class='trai'>
          </div>
          <div class='canphai phai'>
            <button type='button' class='btn btn-main' (click)='preView("LT")'>
              <i class=' icon htvbdh_tcdt_print'></i>
              <span>In/xem trước</span>
            </button>
          </div>
        </div>
        <div class="ghichu_tab">Đơn vị tính:Tấn</div>
        <nz-table #groupingTable [nzData]="dsKeHoachLuongThucClone" nzBordered [nzFrontPagination]="false"
          [nzShowPagination]="false" style="overflow: scroll;" [nzScroll]="{ x: '1700px' }">
          <thead>
            <tr>
              <th rowspan="4" class="text-center" width="40px" nzLeft>STT</th>
              <th rowspan="4" class="text-center" width="330px" nzLeft>
                {{userService.isTongCuc() ? 'CỤC DTNN KHU VỰC' : 'CHI CỤC KHU VỰC'}}</th>
              <th colspan="9" class="text-center" width="1200px">Tồn kho đầu năm (1) <br />( 01/01/{{yearNow}})</th>
              <th colspan="3" class="text-center" width="400px">Nhập trong năm (2)</th>
              <th colspan="9" class="text-center" width="1200px">Xuất trong năm (3)</th>
              <th colspan="3" class="text-center" width="400px">Tồn kho cuối năm (4)
                <br>
                ( 31/12/{{yearNow}})
              </th>
              <th rowspan="4" *ngIf="!this.isViewDetail" class="text-center" width="100px" nzRight>Hành động</th>
            </tr>
            <tr>
              <th rowspan="3" class="text-center">
                Tổng số
                <br />
                (quy thóc)
              </th>
              <th colspan="8" class="text-center">Trong đó</th>
              <th rowspan="3" class="text-center">
                Tổng số
                <br />
                (quy thóc)
              </th>
              <th colspan="2" class="text-center">Trong đó</th>
              <th rowspan="3" class="text-center">
                Tổng số
                <br />
                (quy thóc)
              </th>
              <th colspan="8" class="text-center">Trong đó</th>
              <th rowspan="3" class="text-center">Tổng số
                <br>
                (quy thóc)
              </th>
              <th colspan="2" class="text-center">Trong đó</th>
            </tr>
            <tr>
              <th colspan="4" class="text-center">Thóc (Tấn)</th>
              <th colspan="4" class="text-center">Gạo (Tấn)</th>
              <th rowspan="2" class="text-center">Thóc (Tấn)</th>
              <th rowspan="2" class="text-center">Gạo (Tấn)</th>
              <th colspan="4" class="text-center">Thóc (Tấn)</th>
              <th colspan="4" class="text-center">Gạo (Tấn)</th>
              <th rowspan="2" class="text-center">Thóc (Tấn)</th>
              <th rowspan="2" class="text-center">Gạo (Tấn)</th>
            </tr>
            <tr>
              <th class="text-center">Tổng</th>
              <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
              <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
              <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
              <th class="text-center">Tổng</th>
              <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
              <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
              <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
              <th class="text-center">Tổng</th>
              <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
              <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
              <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
              <th class="text-center">Tổng</th>
              <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
              <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
              <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
            </tr>

          </thead>
          <tbody>
            <tr *ngFor="let data of groupingTable.data, let i = index">
              <ng-container *ngIf="!dsKeHoachLuongThucClone[i]?.isEdit; else editTemplate">
                <td nzLeft [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{i+1}}</td>
                <td nzLeft [ngClass]="data.thayDoi ?'bg-selected':''" class="text-left">{{data.tenDvi}}</td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{(data.tongSoTon) | number:
                  '1.0-3': 'vi_VN'}}</td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{(data.tongThocTon)| number: '1.0-3':
                  'vi_VN'}}
                </td>
                <ng-container *ngIf="data?.tkdnThoc?.length > 0">
                  <td *ngFor="let item of data.tkdnThoc" [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                    {{(item.soLuong) | number: '1.0-3': 'vi_VN'}}</td>
                </ng-container>
                <ng-container *ngIf="data?.tkdnThoc?.length == 0">
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                </ng-container>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right"> {{(data.tongGaoTon) | number:
                  '1.0-3': 'vi_VN'}} </td>
                <ng-container *ngIf="data?.tkdnGao?.length > 0">
                  <td *ngFor="let item of data.tkdnGao" [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                    {{(item.soLuong) | number: '1.0-3':
                    'vi_VN'}} </td>
                </ng-container>
                <ng-container *ngIf="data?.tkdnGao?.length == 0">
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right"> 0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right"> 0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right"> 0</td>
                </ng-container>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="tong-so-quy-tdoc" class="text-right">
                  {{data.tongSoNhap | number: '1.0-3': 'vi_VN'}}
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{data.ntnThoc[0].soLuong | number:
                  '1.0-3': 'vi_VN'}}</td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{data.ntnGao[0].soLuong | number:
                  '1.0-3': 'vi_VN'}}</td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{data.tongSoXuat | number:
                  '1.0-3'}}</td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{data.tongThocXuat | number: '1.0-3':
                  'vi_VN'}}
                </td>
                <ng-container *ngIf="data?.xtnThoc?.length > 0">
                  <td *ngFor="let item of data.xtnThoc" [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                    {{item.soLuong | number: '1.0-3': 'vi_VN'}}</td>
                </ng-container>
                <ng-container *ngIf="data?.xtnThoc?.length == 0">
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                </ng-container>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{data.tongGaoXuat | number: '1.0-3':
                  'vi_VN'}}
                </td>
                <ng-container *ngIf="data?.xtnGao?.length > 0">
                  <td *ngFor="let item of data.xtnGao" [ngClass]="data.thayDoi ?'bg-selected':''"
                    [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                    {{item.soLuong | number: '1.0-3': 'vi_VN'}}</td>
                </ng-container>
                <ng-container *ngIf="data?.xtnGao?.length == 0">
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                </ng-container>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{(data.tongSoCuoiNam) | number:
                  '1.0-3': 'vi_VN'}}</td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{(data.tkcnThoc[0].soLuong) | number:
                  '1.0-3': 'vi_VN'}}
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{(data.tkcnGao[0].soLuong) | number:
                  '1.0-3': 'vi_VN'}}
                </td>
                <td *ngIf="!this.isViewDetail" class="text-center" nzRight>
                  <a (click)="startEdit(i)">
                    <i class="fa fa-pencil" title="Sửa"></i>
                  </a>
                  <a (click)="deleteKeHoachLuongThuc(i)" class="ml-3">
                    <i class="fa fa-trash-o do" title="Xóa bản ghi"></i>
                  </a>
                </td>
                <td *ngIf="data.stt == null" class="background-last-row"></td>
                <td *ngIf="data.stt ==  null" class="background-last-row"></td>
              </ng-container>
              <ng-template #editTemplate>
                <td nzLeft [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{i+1}}</td>
                <td nzLeft [ngClass]="data.thayDoi ?'bg-selected':''" class="text-left">{{data.tenDvi}}</td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{(data.tongSoTon) | number:
                  '1.0-1'}}</td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{(data.tongThocTon)| number: '1.0-3':
                  'vi_VN'}}
                </td>
                <ng-container *ngIf="data?.tkdnThoc?.length > 0">
                  <td *ngFor="let item of data.tkdnThoc" [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                    {{(item.soLuong) | number: '1.0-3': 'vi_VN'}}</td>
                </ng-container>
                <ng-container *ngIf="data?.tkdnThoc?.length == 0">
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">0</td>
                </ng-container>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right"> {{(data.tongGaoTon)| number: '1.0-3':
                  'vi_VN'}} </td>
                <ng-container *ngIf="data?.tkdnGao?.length > 0">
                  <td *ngFor="let item of data.tkdnGao" [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                    {{(item.soLuong)| number: '1.0-3':
                    'vi_VN'}} </td>
                </ng-container>
                <ng-container *ngIf="data?.tkdnGao?.length == 0">
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right"> 0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right"> 0</td>
                  <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right"> 0</td>
                </ng-container>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  {{calculatorntnTongSoQuyThoc(i)}}
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask
                    [options]="{allowZero: true, allowNegative: false,precision: 3,prefix: '',thousands: '.',decimal: ',', align: 'right',nullable: true,min: 0,inputMode: 1}"
                    [(ngModel)]="data.ntnThoc[0].soLuong" />
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask [options]="AMOUNT" [(ngModel)]="data.ntnGao[0].soLuong" />
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  {{calculatorxtnTongSoQuyThoc(i)}}
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  {{calculatorxtnTongThoc(i)}}
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask
                    [options]="{allowZero: true, allowNegative: false,precision: 3,prefix: '',thousands: '.',decimal: ',', align: 'right',nullable: true,min: 0,max: (dsKeHoachLuongThucClone[i].tkdnThoc[0].soLuong),inputMode: 1}"
                    [(ngModel)]="data.xtnThoc[0].soLuong" />
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask
                    [options]="{allowZero: true, allowNegative: false,precision: 3,prefix: '',thousands: '.',decimal: ',', align: 'right',nullable: true,min: 0,max: (dsKeHoachLuongThucClone[i].tkdnThoc[1].soLuong ),inputMode: 1}"
                    [(ngModel)]="data.xtnThoc[1].soLuong" />
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask
                    [options]="{allowZero: true, allowNegative: false,precision: 3,prefix: '',thousands: '.',decimal: ',', align: 'right',nullable: true,min: 0,max: (dsKeHoachLuongThucClone[i].tkdnThoc[2].soLuong ),inputMode: 1}"
                    [(ngModel)]="data.xtnThoc[2].soLuong" />
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  {{calculatorxtnTongGao(i)}}
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask
                    [options]="{allowZero: true, allowNegative: false,precision: 3,prefix: '',thousands: '.',decimal: ',', align: 'right',nullable: true,min: 0,max: (dsKeHoachLuongThucClone[i].tkdnGao[0].soLuong),inputMode: 1}"
                    [(ngModel)]="data.xtnGao[0].soLuong" />
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask
                    [options]="{allowZero: true, allowNegative: false,precision: 3,prefix: '',thousands: '.',decimal: ',', align: 'right',nullable: true,min: 0,max: (dsKeHoachLuongThucClone[i].tkdnGao[1].soLuong ),inputMode: 1}"
                    [(ngModel)]="data.xtnGao[1].soLuong" />
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask
                    [options]="{allowZero: true, allowNegative: false,precision: 3,prefix: '',thousands: '.',decimal: ',', align: 'right',nullable: true,min: 0,max:( dsKeHoachLuongThucClone[i].tkdnGao[2].soLuong),inputMode: 1}"
                    [(ngModel)]="data.xtnGao[2].soLuong" />
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  {{ calculatortkcnTongSoQuyThoc(i)}}
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  {{ calculatortkcnTongThoc(i)}}
                </td>
                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                  {{calculatortkcnTongGao(i)}}
                </td>
                <!-- <td></td> -->
                <td class="text-center" nzRight *ngIf="!isViewDetail">
                  <a (click)="saveEdit(i)" class="save">
                    <i class="fa fa-save"></i>
                  </a>
                  <a (click)="cancelEdit(i)" nzRight class="ml-3">
                    <i class="fa fa-times do"></i>
                  </a>
                </td>
              </ng-template>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <th nzLeft></th>
              <th class="first-last-row-table background-last-row" nzLeft> Cộng</th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkdnTongSoQuyThoc ?
                (sumTotalKhDuTruLuongThuc.tkdnTongSoQuyThoc) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkdnTongThoc ?
                (sumTotalKhDuTruLuongThuc.tkdnTongThoc) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{(sumTotalKhDuTruLuongThuc.tkdnThoc_nam1 ?
                (sumTotalKhDuTruLuongThuc.tkdnThoc_nam1) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkdnThoc_nam2 ?
                (sumTotalKhDuTruLuongThuc.tkdnThoc_nam2) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{(sumTotalKhDuTruLuongThuc.tkdnThoc_nam3 ?
                (sumTotalKhDuTruLuongThuc.tkdnThoc_nam3) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkdnTongGao ?
                (sumTotalKhDuTruLuongThuc.tkdnTongGao) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkdnGao_nam1 ?
                (sumTotalKhDuTruLuongThuc.tkdnGao_nam1) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkdnGao_nam2 ?
                (sumTotalKhDuTruLuongThuc.tkdnGao_nam2) : 0)|
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkdnGao_nam3 ?
                (sumTotalKhDuTruLuongThuc.tkdnGao_nam3) : 0)|
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{(sumTotalKhDuTruLuongThuc.ntnTongSoQuyThoc ?
                sumTotalKhDuTruLuongThuc.ntnTongSoQuyThoc : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.ntnThoc ?
                sumTotalKhDuTruLuongThuc.ntnThoc : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.ntnGao ?
                sumTotalKhDuTruLuongThuc.ntnGao : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.xtnTongSoQuyThoc ?
                sumTotalKhDuTruLuongThuc.xtnTongSoQuyThoc : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.xtnTongThoc ?
                sumTotalKhDuTruLuongThuc.xtnTongThoc : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.xtnThoc_nam1 ?
                sumTotalKhDuTruLuongThuc.xtnThoc_nam1 : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.xtnThoc_nam2 ?
                sumTotalKhDuTruLuongThuc.xtnThoc_nam2 : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.xtnThoc_nam3 ?
                sumTotalKhDuTruLuongThuc.xtnThoc_nam3 : 0)|
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.xtnTongGao ?
                sumTotalKhDuTruLuongThuc.xtnTongGao : 0)|
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.xtnGao_nam1 ?
                sumTotalKhDuTruLuongThuc.xtnGao_nam1 : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.xtnGao_nam2 ?
                sumTotalKhDuTruLuongThuc.xtnGao_nam2 : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.xtnGao_nam3 ?
                sumTotalKhDuTruLuongThuc.xtnGao_nam3 : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkcnTongSoQuyThoc ?
                (sumTotalKhDuTruLuongThuc.tkcnTongSoQuyThoc) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkcnTongThoc ?
                (sumTotalKhDuTruLuongThuc.tkcnTongThoc) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th class="background-last-row text-right">{{ (sumTotalKhDuTruLuongThuc.tkcnTongGao ?
                (sumTotalKhDuTruLuongThuc.tkcnTongGao) : 0) |
                number: '1.0-3': 'vi_VN'}}
              </th>
              <th></th>
            </tr>
            <tr>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th class="first-last-row-table background-last-row">{{userService.isTongCuc() ? 'Chỉ tiêu của TCDT' :
                'Chỉ tiêu của TCDT sau điều chỉnh'}} </th>
              <th class="text-right text-btc "> {{(formData.value.slThocNhap || 0)| number:
                '1.0-1': 'vi_VN'}}</th>
              <th class="text-right text-btc "> {{(formData.value.slGaoNhap || 0) | number:
                '1.0-1': 'vi_VN'}}</th>
              <th></th>
              <th class="text-right text-btc "> {{(formData.value.slTongXuatThoc || 0)| number:
                '1.0-1' : 'vi_VN'}}</th>
              <th></th>
              <th></th>
              <th></th>
              <th class="text-right text-btc "> {{(formData.value.slTongXuatGao || 0) | number:
                '1.0-1': 'vi_VN'}}</th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
            </tr>
          </tfoot>
        </nz-table>
      </div>
    </nz-tab>
    <nz-tab [nzTitle]="'Kế hoạch muối dự trữ nhà nước'">
      <div id="table-muoi"
        [ngClass]="tabSelected == tab.muoi ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
        <div class='d-flex justify-content-between header-tab'>
          <div class='trai'>
          </div>
          <div class='canphai phai'>
            <button type='button' class='btn btn-main' (click)='preView("MUOI")'>
              <i class=' icon htvbdh_tcdt_print'></i>
              <span>In/xem trước</span>
            </button>
          </div>
        </div>
        <div class="ghichu_tab">Đơn vị tính:Kg</div>
        <nz-table #groupingTableMuoi [nzData]="dsMuoiClone" nzBordered class="table__body" [nzFrontPagination]="false"
          [nzShowPagination]="false" style="overflow: scroll;">
          <thead>
            <tr>
              <th class="text-center" width="40px" nzLeft>STT</th>
              <th class="text-center" nzLeft>
                {{userService.isTongCuc() ? 'CỤC DTNN KHU VỰC' : 'CHI CỤC KHU VỰC'}}
              </th>
              <th class="text-center" width="200px">Tồn kho đầu năm</th>
              <th class="text-center" width="200px">Nhập trong năm</th>
              <th class="text-center" width="200px">Xuất trong năm</th>
              <th class="text-center" width="200px">Tồn kho cuối năm</th>
              <th *ngIf="!this.isViewDetail" class="text-center" width="150px" nzRight>
                Hành động
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let dataMuoi of groupingTableMuoi.data, let i = index">
              <ng-container *ngIf="!dsMuoiClone[i]?.isEdit; else editTemplateMuoi">
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-center">{{i+1}}</td>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-left">{{dataMuoi.tenDvi}}</td>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-right">{{dataMuoi.tonKhoDauNam | number:
                  '1.0-1': 'vi_VN'}}</td>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-right">{{dataMuoi.soLuongNhap | number:
                  '1.0-1': 'vi_VN'}}</td>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-right">{{dataMuoi.soLuongXuat | number:
                  '1.0-1': 'vi_VN'}}</td>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-right">{{dataMuoi.tonKhoCuoiNam |
                  number: '1.0-1': 'vi_VN'}}</td>
                <td *ngIf="!this.isViewDetail" class="text-center" nzRight>
                  <a (click)="startEditMuoi(i)">
                    <i class="fa fa-pencil" title="Sửa"></i>
                  </a>
                  <a (click)="deleteKeHoachMuoi(dataMuoi.stt)">
                    <i class="fa fa-trash-o do" title="Xóa bản ghi"></i>
                  </a>
                </td>
              </ng-container>
              <ng-template #editTemplateMuoi>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-right">{{dataMuoi.stt}}</td>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-left">{{dataMuoi.tenDvi}}</td>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-right">{{dataMuoi.tonKhoDauNam | number:
                  '1.0-1': 'vi_VN'}}</td>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask
                    [options]="{allowZero: true, allowNegative: false,precision: 0,prefix: '',thousands: '.',decimal: ',', align: 'right',nullable: true,min: 0,max: 9999999999999,inputMode: 1}"
                    [(ngModel)]="dataMuoi.soLuongNhap" />
                </td>
                <td [ngClass]="dataMuoi.thayDoi ?'bg-selected':''" class="text-right">
                  <input class="money-input" currencyMask
                    [options]="{allowZero: true, allowNegative: false,precision: 0,prefix: '',thousands: '.',decimal: ',', align: 'right',nullable: true,min: 0,max: dsMuoiClone[i].tonKhoDauNam,inputMode: 1}"
                    [(ngModel)]="dataMuoi.soLuongXuat" />
                </td>
                <td class="text-right">{{calculatortkcnMuoi(i)}}</td>
                <td *ngIf="!this.isViewDetail" class="text-center" nzRight>
                  <a (click)="saveEditMuoi(i)" class="save">
                    <i class="fa fa-save"></i>
                  </a>
                  <a (click)="cancelEditMuoi(i)">
                    <i class="fa fa-times do"></i>
                  </a>
                </td>
              </ng-template>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <th></th>
              <th style="text-align: center; font-weight: 700">Cộng</th>
              <th class="text-right"> {{sumTotalKhDuTruMuoi.tonKhoDauNam | number: '1.0-1': 'vi_VN'}}</th>
              <th class="text-right"> {{sumTotalKhDuTruMuoi.nhapTrongNam | number: '1.0-1': 'vi_VN'}}</th>
              <th class="text-right"> {{sumTotalKhDuTruMuoi.xuatTrongNamMuoi | number: '1.0-1': 'vi_VN'}}</th>
              <th class="text-right"> {{sumTotalKhDuTruMuoi.tonKhoCuoiNam | number: '1.0-1': 'vi_VN'}}</th>
              <th *ngIf="!this.isViewDetail"></th>
            </tr>
            <tr *ngIf="userService.isTongCuc()">
              <td></td>
              <th style="text-align: right; font-weight: 700">Chỉ tiêu của TCDT</th>
              <th class="text-right text-btc"> {{(formData.value.slTonKhoDauNam || 0) | number: '1.0-1': 'vi_VN'}}</th>
              <th class="text-right text-btc"> {{(formData.value.slNhapTrongNam || 0) | number: '1.0-1': 'vi_VN'}}</th>
              <th class="text-right text-btc"> {{(formData.value.slXuatTrongNam || 0) | number: '1.0-1': 'vi_VN'}}
              </th>
              <th class="text-right text-btc"> {{(formData.value.slTonKhoCuoiNam || 0) | number: '1.0-1': 'vi_VN'}}</th>
              <th *ngIf="!this.isViewDetail"></th>
            </tr>

          </tfoot>
        </nz-table>
      </div>
    </nz-tab>
    <nz-tab [nzTitle]="'Kế hoạch nhập vật tư, thiết bị dự trữ nhà nước'">
      <nz-tabset [(nzSelectedIndex)]="subTabVatTu" [nzTabBarExtraContent]="extraTemplate">
        <!-- nhapvattu-->
        <nz-tab nzTitle="Chỉ tiêu nhập">
          <nz-card class="mt-2px flex-card data-table card-border-content table-card">
            <nz-table #phanBo class="mt-16 table-chi-tiet" style="overflow: scroll;" nzBordered>
              <thead>
                <tr>
                  <th rowSpan="2" class="text-center">STT</th>
                  <th rowSpan="2">
                    {{userService.isTongCuc() ? 'CỤC DTNN KHU VỰC' : 'CHI CỤC KHU VỰC'}}
                  </th>
                  <th rowSpan="2" class="text-center">Mã hàng</th>
                  <th rowSpan="2" class="text-center">Ký hiệu</th>
                  <th rowSpan="2" class="text-center">Tên hàng</th>
                  <th rowSpan="2" class="text-center">Chủng loại hàng</th>
                  <th rowSpan="2" class="text-center">Đơn vị tính</th>
                  <th colSpan="3" class="text-center">Chỉ tiêu nhập trong năm kế hoạch</th>
                  <th rowSpan="2" class="text-center" *ngIf="!this.isViewDetail">Hành động</th>
                </tr>
                <tr>
                  <th class="text-center">Tổng số</th>
                  <th class="text-center">Chỉ tiêu nhập các năm trước chuyển sang</th>
                  <th class="text-center">Kế hoạch năm hiện tại</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of dataVatTuNhapTree , let idx = index">
                  <tr>
                    <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent1">{{idx + 1}}</td>
                    <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent1"
                      [nzExpand]="expandSet.has(data.idVirtual)"
                      (nzExpandChange)="onExpandChange(data.idVirtual, $event)">{{data.tenDvi}}</td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="text-left bg-parent1" nzRight *ngIf="!this.isViewDetail">
                      <a (click)="themSuaVatTu(data,'them','NHAP',true,idx)">
                        <i class="icon htvbdh_dau-cong"></i>
                      </a>
                    </td>
                  </tr>
                  <ng-container *ngIf="expandSet.has(data.idVirtual)">
                    <ng-container *ngFor="let item of data.dataChild, let y = index">
                      <tr *ngIf="item.tenVatTuCha">
                        <td></td>
                        <td></td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                          {{item.maVatTuCha}}</td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                          {{item.kyHieu}}</td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                          {{item.tenVatTuCha}}</td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent2"></td>
                        <ng-container *ngIf="!item.dataChild || item.dataChild.length == 0">
                          <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent2">
                            {{item.donViTinh}}
                          </td>
                          <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent2">
                            {{(item.soLuongChuyenSang + item.soLuongNhap) | number: '1.0-1': 'vi_VN'}}
                          </td>
                          <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent2">
                            {{item.soLuongChuyenSang | number: '1.0-1': 'vi_VN'}}
                          </td>
                          <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent2">
                            {{item.soLuongNhap | number: '1.0-1': 'vi_VN'}}
                          </td>
                        </ng-container>
                        <ng-container *ngIf="item.dataChild && item.dataChild.length > 0">
                          <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent2"></td>
                          <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                            {{sumSoLuong(item, 'soLuongChuyenSang') +
                            sumSoLuong(item, 'soLuongNhap')}}</td>
                          <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                            {{sumSoLuong(item, 'soLuongChuyenSang')}}</td>
                          <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                            {{sumSoLuong(item, 'soLuongNhap')}}</td>
                        </ng-container>
                        <td class="text-left" nzRight *ngIf="!this.isViewDetail">
                          <a *ngIf="item && item.dataChild && item.dataChild.length > 0"
                            (click)="themSuaVatTu(item,'them','NHAP',false,idx,data.donViId)">
                            <i class="icon htvbdh_dau-cong"></i>
                          </a>
                          <a *ngIf="item && (!item.dataChild || item.dataChild.length == 0)"
                            (click)="themSuaVatTu(item,'sua','NHAP',true,idx,data.donViId)">
                            <i class="fa fa-pencil" title="Sửa"></i>
                          </a>
                          <a (click)="xoaKeHoachVatTu(item,true)">
                            <i class="fa fa-trash-o do" title="Xóa bản ghi"></i>
                          </a>
                        </td>
                      </tr>
                      <ng-container
                        *ngIf="expandSet.has(item.idVirtual) && item.dataChild && item.dataChild.length > 0 && item.dataChild[0].tenVatTu">
                        <ng-container *ngFor="let itemLoaiHang of item.dataChild, let y1 = index">
                          <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td [ngClass]="data.thayDoi ?'bg-selected':''">{{itemLoaiHang.tenVatTu}}</td>
                            <td [ngClass]="data.thayDoi ?'bg-selected':''">{{itemLoaiHang.donViTinh}}</td>
                            <td [ngClass]="data.thayDoi ?'bg-selected':''">{{(itemLoaiHang.soLuongChuyenSang +
                              itemLoaiHang.soLuongNhap) |number: '1.0-1':
                              'vi_VN'}}</td>
                            <td [ngClass]="data.thayDoi ?'bg-selected':''">{{itemLoaiHang.soLuongChuyenSang |number:
                              '1.0-1': 'vi_VN'}}</td>
                            <td [ngClass]="data.thayDoi ?'bg-selected':''">{{itemLoaiHang.soLuongNhap |number: '1.0-1':
                              'vi_VN'}}</td>
                            <td class="text-left" nzRight *ngIf="!this.isViewDetail">
                              <a (click)="themSuaVatTu(itemLoaiHang,'sua','NHAP',false,idx,data.donViId)">
                                <i class="fa fa-pencil" title="Sửa"></i>
                              </a>
                              <a (click)="xoaKeHoachVatTu(itemLoaiHang,false)">
                                <i class="fa fa-trash-o do" title="Xóa bản ghi"></i>
                              </a>
                            </td>
                          </tr>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>

              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>
        <!--        xuatvattu-->
        <nz-tab nzTitle="Chỉ tiêu xuất">
          <nz-card class="mt-2px flex-card data-table card-border-content table-card">
            <nz-table #phanBo class="mt-16 table-chi-tiet" style="max-height: 700px; overflow: scroll;" nzBordered>
              <thead>
                <tr>
                  <th>STT</th>
                  <th>
                    {{userService.isTongCuc() ? 'CỤC DTNN KHU VỰC' : 'CHI CỤC KHU VỰC'}}
                  </th>
                  <th>Mã hàng</th>
                  <th>Ký hiệu</th>
                  <th>Tên hàng</th>
                  <th>Chủng loại hàng</th>
                  <th>Đơn vị tính</th>
                  <th>Năm nhập</th>
                  <th>Chỉ tiêu xuất</th>
                  <th *ngIf="!this.isViewDetail">Hành động</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of dataVatTuXuatTree , let idx = index">
                  <tr>
                    <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent1">{{idx + 1}}</td>
                    <td [ngClass]="data.thayDoi ?'bg-selected':''" class="bg-parent1"
                      [nzExpand]="expandSet.has(data.idVirtual)"
                      (nzExpandChange)="onExpandChange(data.idVirtual, $event)">{{data.tenDvi}}</td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="bg-parent1"></td>
                    <td class="text-left bg-parent1" nzRight *ngIf="!this.isViewDetail">
                      <a (click)="themSuaVatTu(data,'them','XUAT',true,idx)">
                        <i class="icon htvbdh_dau-cong"></i>
                      </a>
                    </td>
                  </tr>
                  <ng-container *ngIf="expandSet.has(data.idVirtual)">
                    <ng-container *ngFor="let item of data.dataChild, let y = index">
                      <tr *ngIf="item.tenVatTuCha">
                        <td></td>
                        <td></td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                          {{item.maVatTuCha}}</td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                          {{item.kyHieu}}</td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                          {{item.tenVatTuCha}}</td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2"></td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                          <span
                            *ngIf="item.dataChild && item.dataChild.length > 0 && (!item.dataChild[0].maVatTu  ||item.dataChild[0].maVatTu =='null')">{{item.donViTinh}}</span>
                        </td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold bg-parent2">
                        </td>
                        <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold text-right bg-parent2">
                          {{sumSoLuongVatTuXuat(item, 'soLuongXuat', 1) |number: '1.0-1': 'vi_VN'}}
                        </td>
                        <td class="text-left bg-parent2" nzRight *ngIf="!this.isViewDetail">
                          <a *ngIf="item && item.dataChild && item.dataChild.length > 0"
                            (click)="themSuaVatTu(item,'them','XUAT',false,idx,data.donViId)">
                            <i class="icon htvbdh_dau-cong"></i>
                          </a>
                          <a *ngIf="item && (!item.dataChild || item.dataChild.length == 0)"
                            (click)="themSuaVatTu(item,'sua','XUAT',false,idx,data.donViId)">
                            <i class="fa fa-pencil" title="Sửa"></i>
                          </a>
                          <a (click)="xoaKeHoachVatTuXuat(item,1)">
                            <i class="fa fa-trash-o do" title="Xóa bản ghi"></i>
                          </a>
                        </td>
                      </tr>
                      <ng-container
                        *ngIf="expandSet.has(item.idVirtual) && item.dataChild && item.dataChild.length > 0">
                        <ng-container *ngFor="let itemLoaiHang of item.dataChild, let y1 = index">
                          <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold">
                              {{itemLoaiHang.tenVatTu}}</td>
                            <ng-container *ngIf="itemLoaiHang.dataChild && itemLoaiHang.dataChild.length > 0">
                              <td [ngClass]="data.thayDoi ?'bg-selected':''">{{itemLoaiHang.donViTinh}}</td>
                              <td [ngClass]="data.thayDoi ?'bg-selected':''"></td>
                              <td [ngClass]="data.thayDoi ?'bg-selected':''" class="font-weight-bold text-right">
                                {{sumSoLuongVatTuXuat(itemLoaiHang,
                                'soLuongXuat', 2) |number: '1.0-1': 'vi_VN'}}</td>
                            </ng-container>
                            <ng-container *ngIf="!itemLoaiHang.dataChild || itemLoaiHang.dataChild.length == 0">
                              <td [ngClass]="data.thayDoi ?'bg-selected':''"></td>
                              <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{itemLoaiHang.namNhap}}
                              </td>
                              <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                                {{itemLoaiHang.soLuongXuat}}</td>
                            </ng-container>
                            <td class="text-left" nzRight *ngIf="!this.isViewDetail">
                              <a (click)="themSuaVatTu(itemLoaiHang,'them','XUAT',false,idx,data.donViId)">
                                <i class="icon htvbdh_dau-cong"></i>
                              </a>
                              <a (click)="xoaKeHoachVatTuXuat(itemLoaiHang,2)">
                                <i class="fa fa-trash-o do" title="Xóa bản ghi"></i>
                              </a>
                            </td>
                          </tr>
                          <ng-container *ngIf="expandSet.has(itemLoaiHang.idVirtual)">
                            <ng-container *ngFor="let itemDetail of itemLoaiHang.dataChild, let y2 = index">
                              <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td [ngClass]="data.thayDoi ?'bg-selected':''"></td>
                                <td [ngClass]="data.thayDoi ?'bg-selected':''"></td>
                                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">{{itemDetail.namNhap}}
                                </td>
                                <td [ngClass]="data.thayDoi ?'bg-selected':''" class="text-right">
                                  {{itemDetail.soLuongXuat |number: '1.0-1': 'vi_VN'}}</td>
                                <td *ngIf="!this.isViewDetail">
                                  <a (click)="themSuaVatTu(itemDetail,'sua','XUAT',false,idx)">
                                    <i class="fa fa-pencil" title="Sửa"></i>
                                  </a>
                                  <a (click)="xoaKeHoachVatTuXuat(itemDetail,3)">
                                    <i class="fa fa-trash-o do" title="Xóa bản ghi"></i>
                                  </a>
                                </td>
                              </tr>
                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>


              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>
      </nz-tabset>

      <ng-template #extraTemplate>
        <div class='btn-group mt-2'>
          <button *ngIf="subTabVatTu==0" type="button" class="btn btn-main" (click)="baoCaoNhapVt()">
            <i class="icon htvbdh_baocao"></i>
            <span>Tải báo cáo</span>
          </button>
          <button type="button" class="btn btn-main" (click)="preView('VT')">
            <i class="icon htvbdh_tcdt_print"></i>
            <span>In/xem trước</span>
          </button>
        </div>
      </ng-template>
    </nz-tab>

  </nz-tabset>

  <!-- </nz-affix> -->
  <!-- start dialog place-->
  <!-- ========== -->
  <!--  dialog can cu-->
  <nz-modal [(nzVisible)]="openSelectCanCu" nzTitle="Căn cứ quyết định giao chỉ tiêu kế hoạch của TCDT">
    <div *nzModalContent class="modal__content">
      <nz-card class="mt-2px flex-card data-table card-border-content table-card">
        <nz-table #canCuTable nzBordered [nzData]="canCuData" [nzFrontPagination]="false" [nzShowPagination]="false">
          <thead>
            <tr>
              <th width="45px">
                <label nz-checkbox [(ngModel)]="allChecked" (ngModelChange)="updateAllChecked()"
                  [nzIndeterminate]="indeterminate"></label>
              </th>
              <th class="text-center">STT</th>
              <th class="text-center">Số quyết định</th>
              <th class="text-center">Ngày QĐ</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of canCuTable.data; let idx = index" (click)="updateSingleChecked()">
              <th width="45px">
                <label nz-checkbox [(ngModel)]="data.checked" (ngModelChange)="updateSingleChecked()"
                  [nzDisabled]="data.trangThai != '00'"></label>
              </th>
              <td class="text-center">{{(page - 1) * pageSize + idx + 1}}</td>
              <td>{{ data.soQd }}</td>
              <td>{{ data.ngayQd | date: 'dd/MM/YYYY' }}</td>
            </tr>
          </tbody>
        </nz-table>
        <div class="tab-content tab-menu">
          <div class="tab-pane fade show active justify-content-between">
            <div class="trai">
            </div>
            <div class="canphai">
              <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate" (nzPageIndexChange)="changePageIndex($event)"
                (nzPageSizeChange)="changePageSize($event)">
                <ng-template #rangeTemplate let-range="range" let-total>
                  {{ range[0] }}-{{ range[1] }} trên tổng số {{ total }} bản ghi
                </ng-template>
              </nz-pagination>
            </div>
          </div>
        </div>
      </nz-card>
    </div>
    <div *nzModalFooter>
      <button nz-button (click)="handleCanCuOk()" class="modal__button--save">
        <i class="icon htvbdh_tcdt_tuchoi"></i>
        Xác nhận
      </button>
      <button nz-button (click)="handleCanCuCancel()" class="modal__button--cancel">
        <i nz-icon nzType="close-circle" nzTheme="fill" class="icon-cancel"></i>
        Đóng
      </button>
    </div>
  </nz-modal>

  <nz-modal [(nzVisible)]='showDlgPreview' nzTitle='ĐIỀU CHỈNH CHỈ TIÊU KẾ HOẠCH' nzWidth='100%'
    (nzOnCancel)="closeDlg()">
    <div *nzModalContent class='modal__content'>
      <pdf-viewer [src]='pdfSrc' [original-size]='false' [render-text]='true' style='width: 100%; height: 600px;'>
      </pdf-viewer>
    </div>
    <div *nzModalFooter>
      <button nz-button (click)='downloadPdf()' class='modal__button--save'>
        <i class='icon htvbdh_tcdt_tuchoi'></i>
        Tải Pdf
      </button>
      <button nz-button (click)='downloadExcel()' class='modal__button--save'>
        <i class='icon htvbdh_nhap-excel'></i>
        Xuất Excel
      </button>
      <button nz-button (click)='closeDlg()' class='modal__button--cancel'>
        <i nz-icon nzType='close-circle' nzTheme='fill' class='icon-cancel'></i>
        Đóng
      </button>
    </div>
  </nz-modal>
  <!-- ========== -->
  <!--  end dialog place-->
  <ng-template #error let-control>
    <app-template-error #error [control]="control"></app-template-error>
  </ng-template>
</div>

<nz-modal [(nzVisible)]='showDlgPreviewTheoCuc' nzTitle='THÔNG TIN ĐIỀU CHỈNH CHỈ TIÊU KẾ HOẠCH THEO TỪNG CỤC'
  nzWidth='100%' (nzOnCancel)='closeDlgTheoCuc()'>
  <div *nzModalContent class='modal__content'>
    <pdf-viewer [src]='pdfSrc' [render-text]='true' style='width: 100%; height: 650px;'></pdf-viewer>
  </div>
  <div *nzModalFooter>
    <button nz-button (click)='printPreview()' class='modal__button--save'>
      <i class='icon htvbdh_printer'></i>
      In
    </button>
    <button nz-button (click)='downloadPdfCuc()' class='modal__button--save'>
      <i class='icon htvbdh_file-pdf'></i>
      Xuất .pdf
    </button>
    <button nz-button (click)='downloadWord()' class='modal__button--save'>
      <i class='icon htvbdh_file-word'></i>
      Xuất .docx
    </button>
    <button nz-button (click)='closeDlgTheoCuc()' class='modal__button--cancel'>
      <i nz-icon nzType='close-circle' nzTheme='fill' class='icon-cancel'></i>
      Đóng
    </button>
  </div>
</nz-modal>