<nz-affix class="menu-lv3 dieu-chinh-button" [nzOffsetTop]="43">
  <div class="tab-content tab-menu" id="myTabContent">
    <div class="tab-pane fade show active justify-content-between" id="banhanh" role="tabpanel"
         aria-labelledby="banhanh-tab">
      <div class="trai">
      </div>
      <div class="canphai phai">
        <button type="button" class="btn btn-sub" (click)="redirectChiTieuKeHoachNam()">
          <i class="fa fa-arrow-left"></i>
          <span>Quay lại</span>
        </button>
        <button class="btn btn-outline-danger btn-sm waves-effect waves-light" (click)="khongBanHanh()"
                *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.TU_CHOI_LDV) && userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_TC_BANHANH')  && userService.isTongCuc()">
          <i class="icon htvbdh_tcdt_tuchoi"></i>
          <span>Không ban hành</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="save(true)"
                [disabled]="!formData.valid"
                *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.DU_THAO || dieuChinhThongTinChiTieuKHNam.trangThai ==  STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.TU_CHOI_LDC || dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.TU_CHOI_LDV) && !isView">
          <i class="icon htvbdh_tcdt_guiduyet"></i>
          <span>Lưu và gửi duyệt</span>
        </button>
        <button class="btn btn-main btn-sm waves-effect waves-light" (click)="save(false)" [disabled]="!formData.valid"
                *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.DU_THAO || dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.TU_CHOI_LDV  || dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.TU_CHOI_LDC || dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.TU_CHOI_TP || id == 0) && !isView">
          <i class="icon htvbdh_tcdt_save"></i>
          <span>Lưu</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="pheDuyet()"
                *ngIf="dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.CHO_DUYET_LDV && userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_TC_DUYET') && userService.isTongCuc()">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Phê duyệt</span>
        </button>
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="tuChoi()"
           *ngIf="dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.CHO_DUYET_LDV && userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_TC_DUYET') && userService.isTongCuc()">
          <i class="icon htvbdh_tcdt_tuchoi"></i>
          <span>Từ chối</span>
        </a>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="banHanh()"
                *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.DA_DUYET_LDV) && userService.isAccessPermisson('KHVDTNSNN_GKHDT_VDNDT_DCCTKH_QDDC_TC_BANHANH')  && userService.isTongCuc()">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Ban hành</span>
        </button>
        <!--        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="tuChoi()"-->
        <!--           *ngIf="dieuChinhThongTinChiTieuKHNam.trangThai == '04' && dieuChinhThongTinChiTieuKHNam.trangThai != '03' && !isView">-->
        <!--          <i class="icon htvbdh_tcdt_tuchoi"></i>-->
        <!--          <span>Từ chối</span>-->
        <!--        </a>-->
      </div>
    </div>
  </div>
</nz-affix>
<div class="contentBor chi-tieu__body dieu-chinh__body de-xuat">
  <div class="contentDetail">
    <div class="main-content main-ke-hoach">
      <div class="thong-tin-chi-tieu">
        <div class="title-chi-tieu">
          <span [ngClass]="thongTinTrangThai(dieuChinhThongTinChiTieuKHNam.trangThai)">{{trangThai}} </span>
          <span>Quyết định điều chỉnh chỉ tiêu kế hoạch năm {{lastBreadcrumb}} giao</span>
        </div>
        <div class="text-right align-content-end" *ngIf="dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.KHONG_BAN_HANH">
          <span class="text-xem-vanban-khongbanhanh" (click)="viewVbKhongBanHanh()">Xem văn bản không đồng ý điều chỉnh</span>
        </div>
        <nz-alert class="mg-t-16 mb-2" *ngIf="dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.TU_CHOI_LDV " nzShowIcon
                  nzType="error"
                  nzMessage="Lý do từ chối" nzDescription="{{dieuChinhThongTinChiTieuKHNam.lyDoTuChoi}}">
        </nz-alert>
        <form nz-form [formGroup]="formData" [nzLayout]="'vertical'">
          <div nz-row [nzGutter]="[16, 12]">
            <div nz-col [nzSpan]="3">
              <nz-form-label [nzNoColon]="true" nzRequired class="label-color-kh"> Năm kế hoạch
              </nz-form-label>
              <!--              <nz-select formControlName="namKeHoach" (ngModelChange)="selectNam()"-->
              <!--                         [nzDisabled]="!(dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.DU_THAO || id == 0 || dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.CHO_DUYET_LDC) || isView">-->
              <!--                <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>-->
              <!--              </nz-select>-->
              <nz-select formControlName="namKeHoach" (ngModelChange)="selectNam()">
                <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
              </nz-select>
            </div>
            <div nz-col [nzSpan]="3">
              <nz-form-label [nzNoColon]="true" class="label-color-kh"> Số quyết định</nz-form-label>
              <nz-input-group [nzAddOnAfter]="'/' + qdTCDT">
                <nz-input-number [nzSize]="'small'" nz-input formControlName="soQD"
                                 [nzDisabled]="checkTrangThaiRecord() || isView">
                </nz-input-number>
              </nz-input-group>
            </div>
            <div nz-col [nzSpan]="3">
              <nz-form-label [nzNoColon]="true" class="label-color-kh"> Ngày ký
              </nz-form-label>
              <nz-date-picker class="search__input"  nzFormat="dd/MM/yyyy"
                              formControlName="ngayKy" nzPlaceHolder="Ngày ký"
                              (nzOnOpenChange)="handleEndOpenChange($event)"
                              [nzDisabled]="checkTrangThaiRecord() || isView">
              </nz-date-picker>
            </div>
            <div nz-col [nzSpan]="3">
              <nz-form-label [nzNoColon]="true" class="label-color-kh"> Ngày hiệu lực
              </nz-form-label>
              <nz-date-picker class="search__input"  nzFormat="dd/MM/yyyy"
                              formControlName="ngayHieuLuc" nzPlaceHolder="Ngày hiệu lực"
                              (nzOnOpenChange)="handleEndOpenChange($event)"
                              [nzDisabled]="checkTrangThaiRecord() || isView">
              </nz-date-picker>
            </div>
            <div nz-col [nzSpan]="6" *ngIf="userService.isTongCuc()">
              <nz-form-label nzRequired [nzNoColon]="true" class="label-color-kh"> Quyết định giao chỉ tiêu KH năm
              </nz-form-label>
              <multiple-tag buttonName="Chọn căn cứ" placeHolder="Chọn quyết định giao chỉ tiêu kế hoạch năm"
                            icon="htvbdh_chuyen-vao-thu-vien" [data]="dataGiaoChiTieu"
                            [trangThai]="isView ? 'view-detail' : dieuChinhThongTinChiTieuKHNam.trangThai"
                            (selectDataEvent)="openDialogQuyetDinhGiaoChiTieu()"
                            (removeDataEvent)="deleteDataMultipleTag($event)"
                            [showDowloadFile]="false">
              </multiple-tag>
            </div>
            <div nz-col [nzSpan]="24">
              <nz-form-label nzRequired [nzNoColon]="true" class="label-color-kh"> Trích yếu</nz-form-label>
              <input formControlName="trichYeu" rows="1" nz-input placeholder="Nhập trích yếu"
                     [readonly]="checkTrangThaiRecord() || isView"/>
            </div>
            <div nz-col [nzSpan]="24" *ngIf="userService.isTongCuc()">
              <nz-form-label [nzNoColon]="true" class="label-color-kh"> Số đề xuất điều chỉnh của Cục DTNN KV
              </nz-form-label>
              <multiple-tag buttonName="Chọn căn cứ" placeHolder="Chọn văn bản đề xuất của cục"
                            icon="htvbdh_chuyen-vao-thu-vien" [data]="dataDeXuat"
                            [trangThai]="isView ? 'view-detail' : dieuChinhThongTinChiTieuKHNam.trangThai"
                            (selectDataEvent)="openDialogDeXuatCuc()" (removeDataEvent)="deleteDataDeXuatCuc($event)"
                            [showDowloadFile]="false">
              </multiple-tag>
            </div>
            <div nz-col [nzSpan]="6" *ngIf="userService.isCuc()">
              <nz-form-label [nzNoColon]="true" class="label-color-kh"> QĐ điều chỉnh chỉ tiêu KH năm của TC
              </nz-form-label>
              <multiple-tag buttonName="Chọn căn cứ" placeHolder="Chọn quyết định điều chỉnh giao chỉ tiêu kế hoạch năm"
                            icon="htvbdh_chuyen-vao-thu-vien" [data]="dataDieuChinh"
                            [trangThai]="isView ? 'view-detail' : dieuChinhThongTinChiTieuKHNam.trangThai"
                            (selectDataEvent)="openDialogQuyetDinhDieuChinh()"
                            (removeDataEvent)="deleteDataDieuChinh($event)"
                            [showDowloadFile]="false">
              </multiple-tag>
            </div>
            <div nz-col [nzSpan]="6" *ngIf="userService.isCuc()">
              <nz-form-label [nzNoColon]="true" class="label-color-kh"> Số QĐ giao chỉ tiêu KH năm của Cục
              </nz-form-label>
              <multiple-tag buttonName="Chọn căn cứ" placeHolder="Chọn quyết định giao chỉ tiêu kế hoạch năm"
                            icon="htvbdh_chuyen-vao-thu-vien" [data]="dataGiaoChiTieu"
                            [trangThai]="isView ? 'view-detail' : dieuChinhThongTinChiTieuKHNam.trangThai"
                            (selectDataEvent)="openDialogQuyetDinhGiaoChiTieu()"
                            (removeDataEvent)="deleteDataMultipleTag($event)"
                            [showDowloadFile]="false" typeFile="tai-lieu-dinh-kem">
              </multiple-tag>
            </div>
            <div nz-col [nzSpan]="6" *ngIf="userService.isCuc()">
              <nz-form-label [nzNoColon]="true" class="label-color-kh"> Đề xuất điều chỉnh chỉ tiêu KH của Cục
              </nz-form-label>
              <multiple-tag buttonName="Chọn căn cứ" placeHolder="Chọn văn bản đề xuất của cục"
                            icon="htvbdh_chuyen-vao-thu-vien" [data]="dataDeXuat"
                            [trangThai]="isView ? 'view-detail' : dieuChinhThongTinChiTieuKHNam.trangThai"
                            (selectDataEvent)="openDialogDeXuatCuc()" (removeDataEvent)="deleteDataDeXuatCuc($event)"
                            [showDowloadFile]="false" typeFile="tai-lieu-dinh-kem">
              </multiple-tag>
            </div>
            <div nz-col [nzSpan]="24">
              <nz-form-label [nzNoColon]="true" class="label-color-kh"> Tài liệu đính kèm
              </nz-form-label>
              <nz-form-item>
                <div class="list-file">
                  <file-list [data]="taiLieuDinhKemList" [isViewDetail]="isView"></file-list>
                </div>
              </nz-form-item>
            </div>
            <!--            <div nz-col [nzSpan]="24">-->
            <!--              <nz-form-label [nzNoColon]="true" class="label-color-kh"> Tài liệu đính kèm</nz-form-label>-->
            <!--              <multiple-tag buttonName="Chọn file" placeHolder="Chọn tài liệu đính kèm" icon="icon htvbdh_tcdt_tep"-->
            <!--                            [data]="taiLieuDinhKemList" type="file" (selectDataEvent)="openFile($event)"-->
            <!--                            [trangThai]="isView ? 'view-detail' : dieuChinhThongTinChiTieuKHNam.trangThai"-->
            <!--                            (removeDataEvent)="deleteTaiLieuDinhKemTag($event)"-->
            <!--                            (downloadFileEvent)="downloadFileKeHoach($event)"-->
            <!--                            typeFile="tai-lieu-dinh-kem">-->
            <!--              </multiple-tag>-->
            <!--            </div>-->
          </div>

        </form>
      </div>
      <div class="tab__container" *ngIf="selectedCanCu && selectedCanCu.id && yearNow > 0">
        <nz-tabset nzType="card" class="tab__container tab-level-3 tab-level-3-specical">
          <nz-tab [nzTitle]="'Điều chỉnh lương thực dự trữ nhà nước'" (nzClick)="selectTabData('00')">
          </nz-tab>
          <nz-tab [nzTitle]="'Điều chỉnh muối dự trữ nhà nước'" (nzClick)="selectTabData('01')"></nz-tab>
          <nz-tab [nzTitle]="'Điều chỉnh vật tư, thiết bị dự trữ nhà nước'" class="vat-tu__container"
                  (nzClick)="selectTabData('02')"></nz-tab>
        </nz-tabset>
        <div [ngClass]="tabSelected == '00' ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
          <div id="table-luong-thuc-tong-hop">
            <div class="ghichu_tab text-right"><h3>Đơn vị tính: Tấn</h3></div>
            <nz-table #groupingTableThocSau [nzData]="dataLuongThuc" nzBordered [nzFrontPagination]="false"
                      [nzShowPagination]="false" class="table__body" [nzScroll]="{ x: '1700px' }">
              <thead>
              <tr>
                <th rowspan="4" width="40px">STT</th>
                <th rowspan="4" width="300px">{{titleTable}}</th>
                <th colspan="9" class="text-center" width="1200px">Tồn kho đầu năm (1) <br/>( 01/01/{{yearNow}})</th>
                <th colspan="3" class="text-center" width="400px">Nhập trong năm (2)</th>
                <th colspan="9" class="text-center" width="1200px">Xuất trong năm (3)</th>
                <th colspan="3" class="text-center" width="400px">Tồn kho cuối năm (4)
                  <br>
                  ( 31/12/{{yearNow}})
                </th>
                <th width="90px" rowspan="4" nzRight
                    *ngIf="dieuChinhThongTinChiTieuKHNam.trangThai != STATUS.CHO_DUYET_LDC && dieuChinhThongTinChiTieuKHNam.trangThai != STATUS.CHO_DUYET_LDV  && dieuChinhThongTinChiTieuKHNam.trangThai != STATUS.CHO_DUYET_TP && !isView">
                  Hành động
                </th>
              </tr>
              <tr>
                <th rowspan="3" class="text-center">
                  Tổng số
                  <br/>
                  (quy thóc)
                </th>
                <th colspan="8" class="text-center">Trong đó</th>
                <th rowspan="3" class="text-center">
                  Tổng số
                  <br/>
                  (quy thóc)
                </th>
                <th colspan="2" class="text-center">Trong đó</th>
                <th rowspan="3" class="text-center">
                  Tổng số
                  <br/>
                  (quy thóc)
                </th>
                <th colspan="8" class="text-center">Trong đó</th>
                <th rowspan="3" class="text-center">Tổng số
                  <br>
                  (quy thóc)
                </th>
                <th colspan="2" class="text-center">Trong đó</th>
              </tr>
              <tr>
                <th colspan="4" class="text-center">Thóc (Tấn)</th>
                <th colspan="4" class="text-center">Gạo (Tấn)</th>
                <th rowspan="2" class="text-center">Thóc (Tấn)</th>
                <th rowspan="2" class="text-center">Gạo (Tấn)</th>
                <th colspan="4" class="text-center">Thóc (Tấn)</th>
                <th colspan="4" class="text-center">Gạo (Tấn)</th>
                <th rowspan="2" class="text-center">Thóc (Tấn)</th>
                <th rowspan="2" class="text-center">Gạo (Tấn)</th>
              </tr>
              <tr>
                <th class="text-center">Tổng</th>
                <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
                <th class="text-center">Tổng</th>
                <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
                <th class="text-center">Tổng</th>
                <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
                <th class="text-center">Tổng</th>
                <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
              </tr>
              </thead>
              <tbody>
              <tr
                *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai == STATUS.DU_THAO || id == 0) && dieuChinhThongTinChiTieuKHNam.trangThai != STATUS.CHO_DUYET_LDC && !isView">
                <td></td>
                <td>
                  <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                  class="search__input autocomplete__input donvi__input">
                    <input placeholder="Đơn vị" nz-input (input)="onInput($event,'luong-thuc')"
                           [nzAutocomplete]="auto" class="w-300" [(ngModel)]="keHoachLuongThucCreate.tenDonvi"
                           [readonly]="userInfo.CAP_DVI === globals.prop.CUC && lastBreadcrumb === 'Tổng cục'"/>
                  </nz-input-group>
                  <ng-template #suffixIcon>
                    <i nz-icon nzType="search"></i>
                  </ng-template>
                  <nz-autocomplete #auto>
                    <nz-auto-option *ngFor="let option of options" [nzValue]="option.labelDonVi"
                                    (click)="selectDonViKHLT(option, true, keHoachLuongThucCreate)">
                      {{ option.labelDonVi }}
                    </nz-auto-option>
                  </nz-autocomplete>
                </td>
                <td>{{keHoachLuongThucCreate?.tkdnTongSoQuyThoc ?? 0 | number: '1.0-1'}}</td>
                <td>{{keHoachLuongThucCreate?.tkdnTongThoc ?? 0 | number: '1.0-1'}}</td>
                <ng-container *ngIf="keHoachLuongThucCreate?.tkdnThoc?.length == 0">
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                </ng-container>
                <ng-container *ngIf="keHoachLuongThucCreate?.tkdnThoc?.length > 0">
                  <td *ngFor="let item of keHoachLuongThucCreate.tkdnThoc">{{item?.soLuong ?? 0 | number: '1.0-1'}}
                  </td>
                </ng-container>
                <td>{{keHoachLuongThucCreate?.tkdnTongGao ?? 0 | number: '1.0-1'}}</td>
                <ng-container *ngIf="keHoachLuongThucCreate?.tkdnGao?.length == 0">
                  <td> 0</td>
                  <td> 0</td>
                  <td> 0</td>
                </ng-container>
                <ng-container *ngIf="keHoachLuongThucCreate?.tkdnGao?.length > 0">
                  <td *ngFor="let item of keHoachLuongThucCreate.tkdnGao"> {{item?.soLuong ?? 0 | number: '1.0-1'}}
                  </td>
                </ng-container>
                <td class="tong-so-quy-thoc"> {{keHoachLuongThucCreate?.tdcNtnTongSoQuyThoc ?? 0 | number: '1.0-1'}}
                </td>
                <!--                <td>{{keHoachLuongThucCreate?.tdcNtnThoc ?? 0 | number: '1.0-1'}}</td>-->
                <!--                <td>{{keHoachLuongThucCreate?.tdcNtnGao ?? 0 | number: '1.0-1'}}</td>-->
                <td>
                  <input *ngIf="!isAddLuongThuc" nz-input [(ngModel)]="keHoachLuongThucCreate.dcNtnThoc"
                         [readonly]="true"/>
                  <nz-input-number *ngIf="isAddLuongThuc" type="text" nz-input [nzSize]="'small'"
                                   [(ngModel)]="keHoachLuongThucCreate.dcNtnThoc"
                                   (input)="caculatorDieuChinhLT(keHoachLuongThucCreate)"
                                   [nzMin]="0 - (keHoachLuongThucCreate?.tdcNtnThoc ?? 0)"
                                   [nzMax]="globals.prop.MAX_INPUT">
                  </nz-input-number>
                </td>
                <td>
                  <input *ngIf="!isAddLuongThuc" nz-input [(ngModel)]="keHoachLuongThucCreate.dcNtnGao"
                         [readonly]="true"/>
                  <nz-input-number *ngIf="isAddLuongThuc" type="text" nz-input [nzSize]="'small'"
                                   [(ngModel)]="keHoachLuongThucCreate.dcNtnGao"
                                   (input)="caculatorDieuChinhLT(keHoachLuongThucCreate)"
                                   [nzMin]="0 - (keHoachLuongThucCreate?.tdcNtnGao ?? 0)"
                                   [nzMax]="globals.prop.MAX_INPUT">
                  </nz-input-number>
                </td>
                <td>0</td>
                <td>0</td>
                <ng-container *ngIf="keHoachLuongThucCreate?.dcXtnThoc?.length == 0">
                  <td><input nz-input value="0" [readonly]="true"/></td>
                  <td><input nz-input value="0" [readonly]="true"/></td>
                  <td><input nz-input value="0" [readonly]="true"/></td>
                </ng-container>
                <ng-container *ngIf="keHoachLuongThucCreate?.dcXtnThoc?.length > 0">
                  <td *ngFor="let item of keHoachLuongThucCreate.dcXtnThoc;let gg = index;">
                    <input *ngIf="!isAddLuongThuc" nz-input [(ngModel)]="item.soLuong"
                           [readonly]="true"/>
                    <nz-input-number *ngIf="isAddLuongThuc" type="text" nz-input [nzSize]="'small'"
                                     [(ngModel)]="item.soLuong" (input)="caculatorDieuChinhLT(keHoachLuongThucCreate)"
                                     [nzMin]="0 - (keHoachLuongThucCreate?.tdcXtnThoc[gg]?.soLuong ?? 0)"
                                     [nzMax]="0 + (keHoachLuongThucCreate?.tdcXtnThoc[gg]?.soLuong ?? 0)">
                    </nz-input-number>
                  </td>
                </ng-container>
                <td>0</td>
                <ng-container *ngIf="keHoachLuongThucCreate?.dcXtnGao?.length == 0">
                  <td><input nz-input value="0" [readonly]="true"/></td>
                  <td><input nz-input value="0" [readonly]="true"/></td>
                  <td><input nz-input value="0" [readonly]="true"/></td>
                </ng-container>
                <ng-container *ngIf="keHoachLuongThucCreate?.dcXtnGao?.length > 0">
                  <td *ngFor="let item of keHoachLuongThucCreate.dcXtnGao;let gg = index;">
                    <input *ngIf="!isAddLuongThuc" nz-input [(ngModel)]="item.soLuong"
                           [readonly]="true"/>
                    <nz-input-number *ngIf="isAddLuongThuc" type="text" nz-input [nzSize]="'small'"
                                     [(ngModel)]="item.soLuong" (input)="caculatorDieuChinhLT(keHoachLuongThucCreate)"
                                     [nzMin]="0 - (keHoachLuongThucCreate?.tdcXtnGao[gg]?.soLuong ?? 0)"
                                     [nzMax]="0 + (keHoachLuongThucCreate?.tdcXtnGao[gg]?.soLuong ?? 0)">
                    </nz-input-number>
                  </td>
                </ng-container>
                <td>{{keHoachLuongThucCreate?.tkcnTongSoQuyThoc ?? 0 | number: '1.0-1'}}</td>
                <td>{{keHoachLuongThucCreate?.tkcnTongThoc ?? 0 | number: '1.0-1'}}</td>
                <td>{{keHoachLuongThucCreate?.tkcnTongGao ?? 0 | number: '1.0-1'}}</td>
                <td
                  *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai=== STATUS.DU_THAO || id===0 || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDV ||dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDC) && !isView "
                  nzRight>
                  <a class="save" (click)="themMoiKHLT()" [ngClass]="{'isDisabled': !isAddLuongThuc}">
                    <i class="icon htvbdh_dau-cong"></i>
                  </a>
                  <a (click)="loadDefaultLuongThucNew()" [ngClass]="{'isDisabled': !isAddLuongThuc}">
                    <i class="fa fa-trash-o do"></i>
                  </a>
                </td>
              </tr>
              <tr *ngFor="let data of groupingTableThocSau.data;let i = index">
                <ng-container *ngIf="!editLuongThucCache[data.donViId]?.edit; else editLuongThucTemplate">
                  <td>{{ (page - 1) * pageSize + i + 1 }}</td>
                  <td>{{data.tenDonvi}}</td>
                  <td>{{data?.tkdnTongSoQuyThoc ?? 0 | number: '1.0-1'}}</td>
                  <td>{{data?.tkdnTongThoc ?? 0 | number: '1.0-1'}}</td>
                  <ng-container *ngIf="data?.tkdnThoc?.length == 0">
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnThoc?.length > 0">
                    <td *ngFor="let item of data.tkdnThoc">{{item?.soLuong ?? 0 | number: '1.0-1'}}
                    </td>
                  </ng-container>
                  <td>{{data?.tkdnTongGao ?? 0 | number: '1.0-1'}}</td>
                  <ng-container *ngIf="data?.tkdnGao?.length == 0">
                    <td> 0</td>
                    <td> 0</td>
                    <td> 0</td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnGao?.length > 0">
                    <td *ngFor="let item of data.tkdnGao"> {{item?.soLuong ?? 0 | number: '1.0-1'}}
                    </td>
                  </ng-container>
                  <td class="tong-so-quy-thoc"> {{data?.tdcNtnTongSoQuyThoc ?? 0 | number: '1.0-1'}}
                  </td>
                  <td>{{data?.ntnThoc ?? 0 | number: '1.0-1' }}
                  </td>
                  <td>{{data?.ntnGao ?? 0 | number: '1.0-1' }}
                  </td>
                  <td>{{data?.xtnTongSoQuyThoc ?? 0 | number: '1.0-1'}}</td>
                  <td>{{data?.xtnTongThoc ?? 0 | number: '1.0-1'}}</td>
                  <ng-container *ngIf="data?.dcXtnThoc?.length == 0">
                    <td> 0</td>
                    <td> 0</td>
                    <td> 0</td>
                  </ng-container>
                  <ng-container *ngIf="data?.dcXtnThoc?.length > 0">
                    <td *ngFor="let item of data.dcXtnThoc"
                    >{{item.soLuong ?? 0 | number: '1.0-1' }}
                    </td>
                  </ng-container>
                  <td>{{data?.xtnTongGao ?? 0 | number: '1.0-1'}}</td>
                  <ng-container *ngIf="data?.dcXtnGao?.length == 0">
                    <td> 0</td>
                    <td> 0</td>
                    <td> 0</td>
                  </ng-container>
                  <ng-container *ngIf="data?.dcXtnGao?.length > 0">
                    <td *ngFor="let item of data.dcXtnGao">{{item.soLuong ?? 0 | number: '1.0-1' }}
                    </td>
                  </ng-container>
                  <td>{{data?.tkcnTongSoQuyThoc ?? 0 | number: '1.0-1'}}</td>
                  <td>{{data?.tkcnTongThoc ?? 0 | number: '1.0-1'}}</td>
                  <td>{{data?.tkcnTongGao ?? 0 | number: '1.0-1'}}</td>
                  <td
                    *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai=== STATUS.DU_THAO || id===0 || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDV ||dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDC) && !isView"
                    nzRight>
                    <a (click)="editRowLuongThuc(data.donViId)">
                      <i class="fa fa-pencil"></i>
                    </a>
                    <a (click)="deleteRowLuongThuc(data)">
                      <i class="fa fa-trash-o do"></i>
                    </a>
                  </td>
                </ng-container>
                <ng-template #editLuongThucTemplate>
                  <td></td>
                  <td>
                    {{editLuongThucCache[data.donViId].data?.tenDonvi}}
                  </td>
                  <td>{{editLuongThucCache[data.donViId].data?.tkdnTongSoQuyThoc ?? 0 | number: '1.0-1'}}</td>
                  <td>{{editLuongThucCache[data.donViId].data?.tkdnTongThoc ?? 0 | number: '1.0-1'}}</td>
                  <ng-container *ngIf="editLuongThucCache[data.donViId].data?.tkdnThoc?.length == 0">
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </ng-container>
                  <ng-container *ngIf="editLuongThucCache[data.donViId].data?.tkdnThoc?.length > 0">
                    <td *ngFor="let item of editLuongThucCache[data.donViId].data.tkdnThoc">{{item?.soLuong ?? 0 |
                      number: '1.0-1'}}
                    </td>
                  </ng-container>
                  <td>{{editLuongThucCache[data.donViId].data?.tkdnTongGao ?? 0 | number: '1.0-1'}}</td>
                  <ng-container *ngIf="editLuongThucCache[data.donViId].data?.tkdnGao?.length == 0">
                    <td> 0</td>
                    <td> 0</td>
                    <td> 0</td>
                  </ng-container>
                  <ng-container *ngIf="editLuongThucCache[data.donViId].data?.tkdnGao?.length > 0">
                    <td *ngFor="let item of editLuongThucCache[data.donViId].data.tkdnGao"> {{item?.soLuong ?? 0 |
                      number: '1.0-1'}}
                    </td>
                  </ng-container>
                  <td class="tong-so-quy-thoc"> {{editLuongThucCache[data.donViId].data?.tdcNtnTongSoQuyThoc ?? 0 |
                    number: '1.0-1'}}
                  </td>
                  <!--                  <td>{{editLuongThucCache[data.donViId].data?.tdcNtnThoc ?? 0 | number: '1.0-1'}}</td>-->
                  <!--                  <td>{{editLuongThucCache[data.donViId].data?.tdcNtnGao ?? 0 | number: '1.0-1'}}</td>-->
                  <td>
                    <nz-input-number type="text" nz-input [nzSize]="'small'"
                                     [(ngModel)]="editLuongThucCache[data.donViId].data.dcNtnThoc"
                                     (input)="caculatorDieuChinhLT(editLuongThucCache[data.donViId].data)"
                                     [nzMin]="0 - (editLuongThucCache[data.donViId].data?.tdcNtnThoc ?? 0)"
                                     [nzMax]="globals.prop.MAX_INPUT"></nz-input-number>
                  </td>
                  <td>
                    <nz-input-number type="text" nz-input [nzSize]="'small'"
                                     [(ngModel)]="editLuongThucCache[data.donViId].data.dcNtnGao"
                                     (input)="caculatorDieuChinhLT(editLuongThucCache[data.donViId].data)"
                                     [nzMin]="0 - (editLuongThucCache[data.donViId].data?.tdcNtnGao ?? 0)"
                                     [nzMax]="globals.prop.MAX_INPUT">
                    </nz-input-number>
                  </td>
                  <!--                  <td>{{editLuongThucCache[data.donViId].data?.sdcNtnTongSoQuyThoc ?? 0 | number: '1.0-1'}}</td>-->
                  <!--                  <td>{{editLuongThucCache[data.donViId].data?.sdcNtnThoc ?? 0 | number: '1.0-1'}}</td>-->
                  <!--                  <td>{{editLuongThucCache[data.donViId].data?.sdcNtnGao ?? 0 | number: '1.0-1'}}</td>-->
                  <td>{{editLuongThucCache[data.donViId].data?.dcXtnTongSoQuyThoc ?? 0 | number: '1.0-1'}}</td>
                  <td>{{editLuongThucCache[data.donViId].data?.dcXtnTongThoc ?? 0 | number: '1.0-1'}}</td>
                  <ng-container *ngIf="editLuongThucCache[data.donViId].data?.dcXtnThoc?.length == 0">
                    <td><input nz-input value="0" [readonly]="true"/></td>
                    <td><input nz-input value="0" [readonly]="true"/></td>
                    <td><input nz-input value="0" [readonly]="true"/></td>
                  </ng-container>
                  <ng-container *ngIf="editLuongThucCache[data.donViId].data?.dcXtnThoc?.length > 0">
                    <td *ngFor="let item of editLuongThucCache[data.donViId].data.dcXtnThoc;let gg = index;">
                      <nz-input-number type="text" nz-input [nzSize]="'small'"
                                       [(ngModel)]="item.soLuong"
                                       (input)="caculatorDieuChinhLT(editLuongThucCache[data.donViId].data)"
                                       [nzMin]="0 - (editLuongThucCache[data.donViId].data?.tdcXtnThoc[gg]?.soLuong ?? 0)"
                                       [nzMax]="0 + (editLuongThucCache[data.donViId].data?.tdcXtnThoc[gg]?.soLuong ?? 0)">
                      </nz-input-number>
                    </td>
                  </ng-container>
                  <td>{{editLuongThucCache[data.donViId].data?.dcXtnTongGao ?? 0 | number: '1.0-1'}}</td>
                  <ng-container *ngIf="editLuongThucCache[data.donViId].data?.dcXtnGao?.length == 0">
                    <td><input nz-input value="0" [readonly]="true"/></td>
                    <td><input nz-input value="0" [readonly]="true"/></td>
                    <td><input nz-input value="0" [readonly]="true"/></td>
                  </ng-container>
                  <ng-container *ngIf="editLuongThucCache[data.donViId].data?.dcXtnGao?.length > 0">
                    <td *ngFor="let item of editLuongThucCache[data.donViId].data.dcXtnGao;let gg = index;">
                      <nz-input-number type="text" nz-input [nzSize]="'small'"
                                       [(ngModel)]="item.soLuong"
                                       (input)="caculatorDieuChinhLT(editLuongThucCache[data.donViId].data)"
                                       [nzMin]="0 - (editLuongThucCache[data.donViId].data?.tdcXtnGao[gg]?.soLuong ?? 0)"
                                       [nzMax]="0 + (editLuongThucCache[data.donViId].data?.tdcXtnGao[gg]?.soLuong ?? 0)">
                      </nz-input-number>
                    </td>
                  </ng-container>
                  <td>{{editLuongThucCache[data.donViId].data?.tkcnTongSoQuyThoc ?? 0 | number: '1.0-1'}}</td>
                  <td>{{editLuongThucCache[data.donViId].data?.tkcnTongThoc ?? 0 | number: '1.0-1'}}</td>
                  <td>{{editLuongThucCache[data.donViId].data?.tkcnTongGao ?? 0 | number: '1.0-1'}}</td>
                  <td nzRight>
                    <a (click)="saveEditLuongThuc(data.donViId)" class="save">
                      <i class="fa fa-save"></i>
                    </a>
                    <a (click)="cancelEditLuongThuc(data.donViId)">
                      <i class="fa fa-times do"></i>
                    </a>
                  </td>
                </ng-template>
              </tr>
              <tr *ngIf="groupingTableThocSau?.data?.length > 0">
                <td colspan="2" class="first-last-row-table background-last-row">Cộng</td>
                <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 2, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 3, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 4, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 5, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 6, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 7, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 8, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 9, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 10, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 11, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 12, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 13, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 14, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 15, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 16, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 17, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 18, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 19, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 20, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0)|
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 21, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 22, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 23, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) | number: '1.0-1'}}</td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 24, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) | number: '1.0-1'}}</td>
                <td class="background-last-row">{{(tableExist ? reduceRowData(0, 25, 5,
                  ',', 'table-luong-thuc-tong-hop') : 0) | number: '1.0-1'}}</td>
                <td class="background-last-row"
                    *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai=== STATUS.DU_THAO || id===0 || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDV ||dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDC) && !isView"
                    nzRight>
                </td>
              </tr>
              </tbody>
            </nz-table>
            <div class="tab-content tab-menu">
              <div class="tab-pane fade show active justify-content-between">
                <div class="trai">
                </div>
                <div class="canphai">
                  <!-- begin phân trang  -->
                  <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                                 [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate"
                                 (nzPageIndexChange)="changePageIndex($event)"
                                 (nzPageSizeChange)="changePageSize($event)">
                    <ng-template #rangeTemplate let-range="range" let-total>
                      {{ range[0] }}-{{ range[1] }} trên tổng số {{ total }} bản ghi
                    </ng-template>
                  </nz-pagination>
                  <!-- end phân trang  -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <div [ngClass]="tabSelected == '01' ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
          <div id="table-muoi-tong-hop">
            <div class="ghichu_tab text-right"><h3>Đơn vị tính: Kg</h3></div>
            <nz-table #groupingTableMuoiSau [nzData]="dataMuoi" nzBordered [nzFrontPagination]="false"
                      [nzShowPagination]="false" [nzScroll]="{ x: '1700px' }">
              <thead>
              <tr>
                <th class="text-center" width="2%" nzLeft>STT</th>
                <th class="text-center" width="48%" nzLeft>
                  {{userService.isTongCuc() ? 'CỤC DTNN KHU VỰC' : 'CHI CỤC KHU VỰC'}}
                </th>
                <th class="text-center" width="10%">Tồn kho đầu năm</th>
                <th class="text-center" width="10%">Nhập trong năm</th>
                <th class="text-center" width="10%">Xuất trong năm</th>
                <th class="text-center" width="10%">Tồn kho cuối năm</th>
                <th width="10%" class="text-center" nzRight
                    *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai=== STATUS.DU_THAO || id===0 || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDV ||dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDC) && !isView">
                  Hành động
                </th>
              </tr>
              </thead>
              <tbody>
              <tr
                *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai=== STATUS.DU_THAO || id===0 || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDV ||dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDC) && !isView">
                <td></td>
                <td>
                  <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                  class="search__input autocomplete__input donvi__input">
                    <input placeholder="Đơn vị" nz-input (input)="onInput($event,'muoi')" [nzAutocomplete]="autoMuoi"
                           [(ngModel)]="keHoachMuoiCreate.tenDonvi"
                           [readonly]="userInfo.CAP_DVI === globals.prop.CUC && lastBreadcrumb === 'Tổng cục'"/>
                  </nz-input-group>
                  <ng-template #suffixIcon>
                    <i nz-icon nzType="search"></i>
                  </ng-template>
                  <nz-autocomplete #autoMuoi>
                    <nz-auto-option *ngFor="let option of options" [nzValue]="option.labelDonVi"
                                    (click)="selectDonViKHMuoi(option, true, keHoachMuoiCreate)">
                      {{ option.labelDonVi }}
                    </nz-auto-option>
                  </nz-autocomplete>
                </td>
                <td class="text-right">{{keHoachMuoiCreate?.tonKhoDauNam ?? 0 | number: '1.0-1'}}</td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" [nzMin]="0" [nzSize]="'small'"
                                   [(ngModel)]="keHoachMuoiCreate.nhapTrongNam">
                  </nz-input-number>
                </td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" [nzMin]="0" [nzSize]="'small'"
                                   [nzMax]="keHoachMuoiCreate.tonKhoDauNam"
                                   [(ngModel)]="keHoachMuoiCreate.xuatTrongNamMuoi">
                  </nz-input-number>
                </td>
                <td class="text-right">
                  {{(keHoachMuoiCreate.tonKhoDauNam ? keHoachMuoiCreate.tonKhoDauNam : 0) + (keHoachMuoiCreate.nhapTrongNam ? keHoachMuoiCreate.nhapTrongNam : 0) - (keHoachMuoiCreate.xuatTrongNamMuoi ? keHoachMuoiCreate.xuatTrongNamMuoi : 0)}}
                </td>
                <td
                  *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai=== STATUS.DU_THAO || id===0 || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDV ||dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDC) && !isView"
                  class="text-center" nzRight>
                  <a class="save" (click)="themMoiKHMuoi()" [ngClass]="{'isDisabled': !isAddMuoi}">
                    <i class="icon htvbdh_dau-cong"></i>
                  </a>
                  <a (click)="loadDefaultMuoiNew()" [ngClass]="{'isDisabled': !isAddMuoi}">
                    <i class="fa fa-trash-o do"></i>
                  </a>
                </td>
              </tr>
              <tr *ngFor="let dataMuoi of groupingTableMuoiSau.data;let i = index">
                <ng-container *ngIf="!editMuoiCache[dataMuoi.donViId]?.edit; else editMuoiTemplate">
                  <td>{{ (page - 1) * pageSize + i + 1 }}</td>
                  <td>{{dataMuoi.tenDonVi}}</td>
                  <td class="text-right">{{dataMuoi?.tonKhoDauNam ?? 0 | number: '1.0-1'}}</td>
                  <td class="text-right">{{dataMuoi.nhapTrongNam ?? 0 | number: '1.0-1' }}</td>
                  <td class="text-right">{{dataMuoi.xuatTrongNamMuoi ?? 0 | number: '1.0-1' }}</td>
                  <td class="text-right">
<!--                    {{(dataMuoi.tonKhoCuoiNam ? dataMuoi.tonKhoCuoiNam : 0) | number: '1.0-1' }}-->
                    {{(dataMuoi.tonKhoDauNam + dataMuoi.nhapTrongNam - dataMuoi.xuatTrongNamMuoi ) | number: '1.0-1' }}
                  </td>
                  <td
                    *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai=== STATUS.DU_THAO || id===0 || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDV ||dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDC) && !isView"
                    class="text-center" nzRight>
                    <a (click)="editRowMuoi(dataMuoi.donViId)">
                      <i class="fa fa-pencil"></i>
                    </a>
                    <a (click)="deleteRowMuoi(dataMuoi)">
                      <i class="fa fa-trash-o do"></i>
                    </a>
                  </td>
                </ng-container>
                <ng-template #editMuoiTemplate>
                  <td></td>
                  <td>
                    {{editMuoiCache[dataMuoi.donViId].data?.tenDonVi}}
                  </td>
                  <td
                    class="text-right">{{editMuoiCache[dataMuoi.donViId].data?.tonKhoDauNam ?? 0 | number: '1.0-1'}}</td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input [nzSize]="'small'"
                                     [(ngModel)]="editMuoiCache[dataMuoi.donViId].data.nhapTrongNam"
                                     [nzMin]="0"
                                     [nzMax]="globals.prop.MAX_INPUT">
                    </nz-input-number>
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input [nzSize]="'small'"
                                     [(ngModel)]="editMuoiCache[dataMuoi.donViId].data.xuatTrongNamMuoi"
                                     [nzMin]="0"
                                     [nzMax]="globals.prop.MAX_INPUT">
                    </nz-input-number>
                  </td>
                  <td class="text-right">
                    {{(editMuoiCache[dataMuoi.donViId].data.tonKhoDauNam + editMuoiCache[dataMuoi.donViId].data.nhapTrongNam - editMuoiCache[dataMuoi.donViId].data.xuatTrongNamMuoi ) | number: '1.0-1' }}
<!--                    {{(editMuoiCache[dataMuoi.donViId].data.tonKhoCuoiNam ? editMuoiCache[dataMuoi.donViId].data.tonKhoDauNam : 0) | number: '1.0-1'}}-->
                  </td>
                  <td class="text-center" nzRight>
                    <a (click)="saveEditMuoi(dataMuoi.donViId)" class="save">
                      <i class="fa fa-save"></i>
                    </a>
                    <a (click)="cancelEditMuoi(dataMuoi.donViId)">
                      <i class="fa fa-times do"></i>
                    </a>
                  </td>
                </ng-template>
              </tr>
              <tr *ngIf="groupingTableMuoiSau?.data?.length > 0">
                <td colspan="2" class="first-last-row-table background-last-row">Cộng</td>
                <td
                  class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 2, 2, ',', 'table-muoi-tong-hop') :
                  0 | number: '1.0-1'}}</td>
                <td
                  class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 3, 2, ',', 'table-muoi-tong-hop') :
                  0 | number: '1.0-1'}}</td>
                <td
                  class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 4, 2, ',', 'table-muoi-tong-hop') :
                  0 | number: '1.0-1'}}</td>
                <td
                  class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 5, 2, ',', 'table-muoi-tong-hop') :
                  0 | number: '1.0-1'}}</td>
                <td class="background-last-row" nzRight></td>
              </tr>
              </tbody>
            </nz-table>
            <!--            <div class="tab-content tab-menu">-->
            <!--              <div class="tab-pane fade show active justify-content-between">-->
            <!--                <div class="trai">-->
            <!--                </div>-->
            <!--                <div class="canphai">-->
            <!--                  &lt;!&ndash; begin phân trang  &ndash;&gt;-->
            <!--                  <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger-->
            <!--                                 [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate"-->
            <!--                                 (nzPageIndexChange)="changePageIndex($event)"-->
            <!--                                 (nzPageSizeChange)="changePageSize($event)">-->
            <!--                    <ng-template #rangeTemplate let-range="range" let-total>-->
            <!--                      {{ range[0] }}-{{ range[1] }} trên tổng số {{ total }} bản ghi-->
            <!--                    </ng-template>-->
            <!--                  </nz-pagination>-->
            <!--                  &lt;!&ndash; end phân trang  &ndash;&gt;-->
            <!--                </div>-->
            <!--              </div>-->
            <!--            </div>-->
          </div>
        </div>
        <div [ngClass]="tabSelected == '02' ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
          <div id="table-vat-tu-tong-hop">
            <nz-tabset>
              <!--        nhapvattu-->
              <nz-tab nzTitle="Nhập">
                <nz-card class="mt-2px flex-card data-table card-border-content table-card">
                  <nz-table #phanBo class="nowrap mt-16 table-chi-tiet" nzBordered>
                    <thead>
                    <tr>
                      <th rowSpan="2">STT</th>
                      <th rowSpan="2">Cục DTNN khu vực</th>
                      <th rowSpan="2">Mã hàng</th>
                      <th rowSpan="2">Ký hiệu</th>
                      <th rowSpan="2">Tên hàng</th>
                      <th rowSpan="2">Chủng loại hàng</th>
                      <th rowSpan="2">Đơn vị tính</th>
                      <th colSpan="3">Chỉ tiêu nhập trong năm kế hoạch</th>
                      <th rowSpan="2">Hành động</th>
                    </tr>
                    <tr>
                      <th>Tổng số</th>
                      <th>Chỉ tiêu nhập các năm trước chuyển sang</th>
                      <th>Kế hoạch năm hiện tại</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                      <td></td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input
                                   (input)="onInput($event,'vat-tu')"
                                   [nzAutocomplete]="autoDonViVatTuNhap" class=""
                                   [(ngModel)]="keHoachVatTuNhapCreate.tenDvi"/>
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoDonViVatTuNhap
                                           (selectionChange)="selectDonViKeyDown($event,'kh-vat-tu')"
                                           [nzBackfill]="false">
                            <ng-container>
                              <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                                              (click)="selectDonViVatTuNew(option,'nhap')">
                                {{ option.labelDonVi }}
                              </nz-auto-option>
                            </ng-container>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>{{keHoachVatTuNhapCreate.dsVatTu[0].maHang}}</td>
                      <td>{{keHoachVatTuNhapCreate.dsVatTu[0].kyHieu}}</td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                                   [nzAutocomplete]="autoVatTuNhap"
                                   class="" [(ngModel)]="keHoachVatTuNhapCreate.dsVatTu[0].tenVatTuCha"
                            />
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoVatTuNhap>
                            <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                                            (click)="selectTenHangNew(vatTuCha,'nhap')">
                              {{ vatTuCha.ten }}
                            </nz-auto-option>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input nz-input (input)="onInputChungLoaiHang($event)"
                                   [nzAutocomplete]="autoChungLoaiHangNhap"
                                   class=""
                                   [(ngModel)]="keHoachVatTuNhapCreate.dsVatTu[0].tenVatTu"
                                   [disabled]="dataVatTuConClone.length == 0"
                                   [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'"/>
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoChungLoaiHangNhap>
                            <nz-auto-option *ngFor="let vatTuCon of dataVatTuConShow" [nzValue]="vatTuCon.ten"
                                            (click)="selectChungLoaiHangNew(vatTuCon,'nhap')">
                              {{ vatTuCon.ten }}
                            </nz-auto-option>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>{{keHoachVatTuNhapCreate.dsVatTu[0].donViTinh}}</td>
                      <td></td>
                      <td>
                        <nz-input-number [nzSize]="'small'" nz-input
                                         [(ngModel)]="keHoachVatTuNhapCreate.dsVatTu[0].soLuongChuyenSang"
                                         [nzMin]="0" [nzFormatter]="globals.formatter"
                                         [nzParser]="globals.parser"></nz-input-number>
                      </td>
                      <td>
                        <nz-input-number [nzSize]="'small'" nz-input
                                         [(ngModel)]="keHoachVatTuNhapCreate.dsVatTu[0].soLuongNhap"
                                         [nzMin]="0" [nzFormatter]="globals.formatter"
                                         [nzParser]="globals.parser"></nz-input-number>
                      </td>
                      <td>
                        <a (click)="themVatTu('nhap')">
                          <i class="fa fa-plus"></i>
                        </a>
                      </td>
                    </tr>
                    <ng-container *ngFor="let item of dataVatTuNhap, let i = index">
                      <!--      tr create line-->
                      <tr>
                        <td>{{i + 1}}</td>
                        <td colspan="9" [nzExpand]="expandSetVatTuNhap.has(item.maDvi)" nzShowExpand="true"
                            (nzExpandChange)="onExpandChange(item.maDvi, $event)"
                            style="width: 35px">{{ item.tenDvi }}</td>
                        <td>
                        </td>
                      </tr>
                      <ng-container *ngIf="expandSetVatTuNhap.has(item.maDvi)">
                        <tr *ngFor="let r of item.dsVatTu,let i1=index">
                          <ng-container *ngIf="!dataVatTuNhapEdit[i].dsVatTu[i1].isEdit; else editTemplateNhap">
                            <td></td>
                            <td>{{i1 + 1}}</td>
                            <td>{{r.maHang}}</td>
                            <td>{{r.kyHieu}}</td>
                            <td>{{r.tenVatTuCha}}</td>
                            <td>{{r.tenVatTu}}</td>
                            <td>{{r.donViTinh}}</td>
                            <td>{{+r.soLuongChuyenSang + +r.soLuongNhap|number: '1.0-1'}}</td>
                            <td>{{r.soLuongChuyenSang|number: '1.0-1'}}</td>
                            <td>{{r.soLuongNhap|number: '1.0-1'}}</td>
                            <td
                              *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai=== STATUS.DU_THAO || id===0 || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDV ||dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDC) && !isView">
                              <a (click)="suaVatTu(i,i1,'nhap')">
                                <i class="fa fa-pencil"></i>
                              </a>
                              <a (click)="xoaVatTu(i,i1,'nhap')">
                                <i class="fa fa-trash-o do"></i>
                              </a>
                            </td>
                          </ng-container>
                          <ng-template #editTemplateNhap>
                            <td></td>
                            <td></td>
                            <td>{{dataVatTuNhapEdit[i].dsVatTu[i1].maHang}}</td>
                            <td>{{dataVatTuNhapEdit[i].dsVatTu[i1].kyHieu}}</td>
                            <td>
                              <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                                <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                                class="search__input autocomplete__input donvi__input w-300">
                                  <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                                         [nzAutocomplete]="autoVatTuNhapEdit"
                                         class="" [(ngModel)]="dataVatTuNhapEdit[i].dsVatTu[i1].tenVatTuCha"
                                  />
                                </nz-input-group>
                                <ng-template #suffixIcon>
                                  <i nz-icon nzType="search"></i>
                                </ng-template>
                                <nz-autocomplete #autoVatTuNhapEdit>
                                  <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                                                  (click)="selectTenHangEditNew(i,i1,vatTuCha,'nhap')">
                                    {{ vatTuCha.ten }}
                                  </nz-auto-option>
                                </nz-autocomplete>
                              </nz-form-control>
                            </td>
                            <td>
                              <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                                <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                                class="search__input autocomplete__input donvi__input w-300">
                                  <input nz-input (input)="onInputChungLoaiHang($event)"
                                         [nzAutocomplete]="autoChungLoaiHangNhapEdit"
                                         class=""
                                         [(ngModel)]="dataVatTuNhapEdit[i].dsVatTu[i1].tenVatTu"
                                         [disabled]="dataVatTuConClone.length == 0"
                                         [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'"/>
                                </nz-input-group>
                                <ng-template #suffixIcon>
                                  <i nz-icon nzType="search"></i>
                                </ng-template>
                                <nz-autocomplete #autoChungLoaiHangNhapEdit>
                                  <nz-auto-option *ngFor="let vatTuCon of dataVatTuConEditNhapShow[i]"
                                                  [nzValue]="vatTuCon.ten"
                                                  (click)="selectChungLoaiHangEditNew(i,i1,vatTuCon,'nhap')">
                                    {{ vatTuCon.ten }}
                                  </nz-auto-option>
                                </nz-autocomplete>
                              </nz-form-control>
                            </td>
                            <td>{{dataVatTuNhapEdit[i].dsVatTu[i1].donViTinh}}</td>
                            <td>{{+dataVatTuNhapEdit[i].dsVatTu[i1].soLuongChuyenSang + +dataVatTuNhapEdit[i].dsVatTu[i1].soLuongNhap|number: '1.0-1'}}</td>
                            <td>
                              <nz-input-number [nzMin]=0 nzSize="small"
                                               [(ngModel)]="dataVatTuNhapEdit[i].dsVatTu[i1].soLuongChuyenSang"
                                               [nzFormatter]="globals.formatter"
                                               [nzParser]="globals.parser"></nz-input-number>
                            </td>
                            <td>
                              <nz-input-number [nzMin]=0 nzSize="small"
                                               [(ngModel)]="dataVatTuNhapEdit[i].dsVatTu[i1].soLuongNhap"
                                               [nzFormatter]="globals.formatter"
                                               [nzParser]="globals.parser"></nz-input-number>
                            </td>
                            <td>
                              <a (click)="luuSuaVatTu(i,i1,'nhap')" class="save">
                                <i class="fa fa-save"></i>
                              </a>
                              <a (click)="huySuaVatTu(i,i1,'nhap')">
                                <i class="fa fa-times do"></i>
                              </a>
                            </td>
                          </ng-template>
                        </tr>
                      </ng-container>
                    </ng-container>
                    </tbody>
                  </nz-table>
                </nz-card>
              </nz-tab>
              <!--        xuatvattu-->
              <nz-tab nzTitle="Xuất">
                <nz-card class="mt-2px flex-card data-table card-border-content table-card">
                  <nz-table #phanBo class="nowrap mt-16 table-chi-tiet" nzBordered>
                    <thead>
                    <tr>
                      <th rowSpan="2">STT</th>
                      <th rowSpan="2">Cục DTNN khu vực</th>
                      <th rowSpan="2">Mã hàng</th>
                      <th rowSpan="2">Ký hiệu</th>
                      <th rowSpan="2">Tên hàng</th>
                      <th rowSpan="2">Chủng loại hàng</th>
                      <th rowSpan="2">Đơn vị tính</th>
                      <th colSpan="3">Chỉ tiêu nhập trong năm kế hoạch</th>
                      <th rowSpan="2">Hành động</th>
                    </tr>
                    <tr>
                      <th>Tổng số</th>
                      <th>Chỉ tiêu nhập các năm trước chuyển sang</th>
                      <th>Kế hoạch năm hiện tại</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                      <td></td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input
                                   (input)="onInput($event,'vat-tu')"
                                   [nzAutocomplete]="autoDonViVatTuXuat" class=""
                                   [(ngModel)]="keHoachVatTuXuatCreate.tenDvi"/>
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoDonViVatTuXuat
                                           (selectionChange)="selectDonViKeyDown($event,'kh-vat-tu')"
                                           [nzBackfill]="false">
                            <ng-container>
                              <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                                              (click)="selectDonViVatTuNew(option,'xuat')">
                                {{ option.labelDonVi }}
                              </nz-auto-option>
                            </ng-container>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>{{keHoachVatTuXuatCreate.dsVatTu[0].maHang}}</td>
                      <td>{{keHoachVatTuXuatCreate.dsVatTu[0].kyHieu}}</td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                                   [nzAutocomplete]="autoVatTuXuat"
                                   class="" [(ngModel)]="keHoachVatTuXuatCreate.dsVatTu[0].tenVatTuCha"
                            />
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoVatTuXuat>
                            <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                                            (click)="selectTenHangNew(vatTuCha,'xuat')">
                              {{ vatTuCha.ten }}
                            </nz-auto-option>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>
                        <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                          <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                          class="search__input autocomplete__input donvi__input w-300">
                            <input nz-input (input)="onInputChungLoaiHang($event)"
                                   [nzAutocomplete]="autoChungLoaiHangXuat"
                                   class=""
                                   [(ngModel)]="keHoachVatTuXuatCreate.dsVatTu[0].tenVatTu"
                                   [disabled]="dataVatTuConClone.length == 0"
                                   [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'"/>
                          </nz-input-group>
                          <ng-template #suffixIcon>
                            <i nz-icon nzType="search"></i>
                          </ng-template>
                          <nz-autocomplete #autoChungLoaiHangXuat>
                            <nz-auto-option *ngFor="let vatTuCon of dataVatTuConShow" [nzValue]="vatTuCon.ten"
                                            (click)="selectChungLoaiHangNew(vatTuCon,'xuat')">
                              {{ vatTuCon.ten }}
                            </nz-auto-option>
                          </nz-autocomplete>
                        </nz-form-control>
                      </td>
                      <td>{{keHoachVatTuXuatCreate.dsVatTu[0].donViTinh}}</td>
                      <td></td>
                      <td>
                        <nz-input-number [nzSize]="'small'" nz-input
                                         [(ngModel)]="keHoachVatTuXuatCreate.dsVatTu[0].soLuongChuyenSang"
                                         [nzMin]="0"></nz-input-number>
                      </td>
                      <td>
                        <nz-input-number [nzSize]="'small'" nz-input
                                         [(ngModel)]="keHoachVatTuXuatCreate.dsVatTu[0].soLuongNhap"
                                         [nzMin]="0"></nz-input-number>
                      </td>
                      <td>
                        <a (click)="themVatTu('xuat')">
                          <i class="fa fa-plus"></i>
                        </a>
                        <!--<a (click)="suaPhuongAn(i)" *ngIf="!isView">
                          <i class="fa fa-pencil"></i>
                        </a>
                        &lt;!&ndash;              <a (click)="deletePhanLo(item.idVirtual)">&ndash;&gt;
                        <a (click)="xoaPhuongAn(i)" *ngIf="!isView">
                          <i class="fa fa-trash-o do"></i>
                        </a>-->
                      </td>
                    </tr>
                    <ng-container *ngFor="let item of dataVatTuXuat, let i = index">
                      <!--      tr create line-->
                      <tr>
                        <td>{{i + 1}}</td>
                        <td colspan="9" [nzExpand]="expandSetVatTuXuat.has(item.maDvi)" nzShowExpand="true"
                            (nzExpandChange)="onExpandChange(item.maDvi, $event)"
                            style="width: 35px">{{ item.tenDvi }}</td>
                        <td>
                        </td>
                      </tr>
                      <ng-container *ngIf="expandSetVatTuXuat.has(item.maDvi)">
                        <tr *ngFor="let r of item.dsVatTu,let i1=index">
                          <ng-container *ngIf="!dataVatTuXuatEdit[i].dsVatTu[i1].isEdit; else editTemplateXuat">
                            <td></td>
                            <td>{{i1 + 1}}</td>
                            <td>{{r.maHang}}</td>
                            <td>{{r.kyHieu}}</td>
                            <td>{{r.tenVatTuCha}}</td>
                            <td>{{r.tenVatTu}}</td>
                            <td>{{r.donViTinh}}</td>
                            <td>{{+r.soLuongChuyenSang + +r.soLuongNhap}}</td>
                            <td>{{r.soLuongChuyenSang}}</td>
                            <td>{{r.soLuongNhap}}</td>
                            <td
                              *ngIf="(dieuChinhThongTinChiTieuKHNam.trangThai=== STATUS.DU_THAO || id===0 || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_TP || dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDV ||dieuChinhThongTinChiTieuKHNam.trangThai===STATUS.TU_CHOI_LDC) && !isView">
                              <a (click)="suaVatTu(i,i1,'xuat')">
                                <i class="fa fa-pencil"></i>
                              </a>
                              <a (click)="xoaVatTu(i,i1,'xuat')">
                                <i class="fa fa-trash-o do"></i>
                              </a>
                            </td>
                          </ng-container>
                          <ng-template #editTemplateXuat>
                            <td></td>
                            <td></td>
                            <td>{{dataVatTuXuatEdit[i].dsVatTu[i1].maHang}}</td>
                            <td>{{dataVatTuXuatEdit[i].dsVatTu[i1].kyHieu}}</td>
                            <td>
                              <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                                <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                                class="search__input autocomplete__input donvi__input w-300">
                                  <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                                         [nzAutocomplete]="autoVatTuXuatEdit"
                                         class="" [(ngModel)]="dataVatTuXuatEdit[i].dsVatTu[i1].tenVatTuCha"
                                  />
                                </nz-input-group>
                                <ng-template #suffixIcon>
                                  <i nz-icon nzType="search"></i>
                                </ng-template>
                                <nz-autocomplete #autoVatTuXuatEdit>
                                  <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                                                  (click)="selectTenHangEditNew(i,i1,vatTuCha,'nhap')">
                                    {{ vatTuCha.ten }}
                                  </nz-auto-option>
                                </nz-autocomplete>
                              </nz-form-control>
                            </td>
                            <td>
                              <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                                <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                                                class="search__input autocomplete__input donvi__input w-300">
                                  <input nz-input (input)="onInputChungLoaiHang($event)"
                                         [nzAutocomplete]="autoChungLoaiHangXuatEdit"
                                         class=""
                                         [(ngModel)]="dataVatTuXuatEdit[i].dsVatTu[i1].tenVatTu"
                                         [disabled]="dataVatTuConClone.length == 0"
                                         [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'"/>
                                </nz-input-group>
                                <ng-template #suffixIcon>
                                  <i nz-icon nzType="search"></i>
                                </ng-template>
                                <nz-autocomplete #autoChungLoaiHangXuatEdit>
                                  <nz-auto-option *ngFor="let vatTuCon of dataVatTuConEditXuatShow[i]"
                                                  [nzValue]="vatTuCon.ten"
                                                  (click)="selectChungLoaiHangEditNew(i,i1,vatTuCon,'xuat')">
                                    {{ vatTuCon.ten }}
                                  </nz-auto-option>
                                </nz-autocomplete>
                              </nz-form-control>
                            </td>
                            <td>{{dataVatTuXuatEdit[i].dsVatTu[i1].donViTinh}}</td>
                            <td>{{+dataVatTuXuatEdit[i].dsVatTu[i1].soLuongChuyenSang + +dataVatTuXuatEdit[i].dsVatTu[i1].soLuongNhap|number: '1.0-1'}}</td>
                            <td>
                              <nz-input-number [nzMin]=0 nzSize="small"
                                               [(ngModel)]="dataVatTuXuatEdit[i].dsVatTu[i1].soLuongChuyenSang"></nz-input-number>
                            </td>
                            <td>
                              <nz-input-number [nzMin]=0 nzSize="small"
                                               [(ngModel)]="dataVatTuXuatEdit[i].dsVatTu[i1].soLuongNhap"></nz-input-number>
                            </td>
                            <td>
                              <a (click)="luuSuaVatTu(i,i1,'xuat')" class="save">
                                <i class="fa fa-save"></i>
                              </a>
                              <a (click)="huySuaVatTu(i,i1,'xuat')">
                                <i class="fa fa-times do"></i>
                              </a>
                            </td>
                          </ng-template>
                        </tr>
                      </ng-container>
                    </ng-container>
                    </tbody>
                  </nz-table>
                </nz-card>
              </nz-tab>
            </nz-tabset>
            <div class="tab-content tab-menu">
              <div class="tab-pane fade show active justify-content-between">
                <div class="trai">
                </div>
                <div class="canphai">
                  <!-- begin phân trang  -->
                  <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                                 [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate"
                                 (nzPageIndexChange)="changePageIndex($event)"
                                 (nzPageSizeChange)="changePageSize($event)">
                    <ng-template #rangeTemplate let-range="range" let-total>
                      {{ range[0] }}-{{ range[1] }} trên tổng số {{ total }} bản ghi
                    </ng-template>
                  </nz-pagination>
                  <!-- end phân trang  -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="action">
          <input type="file" id="file-import-data" class="file-not-show" (change)="importFileData($event)"/>
          <button type="button" class="btn btn-sub" (click)="exportData()">
            <i class="icon htvbdh_chuyen-xu-ly"></i>
            <span>Export</span>
          </button>
          <button type="button" class="btn btn-sub" (click)="printTable()">
            <i class="icon htvbdh_tcdt_print"></i>
            <span>In</span>
          </button>
        </div>
      </div>
      <form nz-form [formGroup]="formData">
        <div class="ghi-chu">
          <nz-form-item>
            <nz-form-label nz-col [nzSpan]="24" [nzNoColon]="true" class="label-color-kh"> Ghi chú
            </nz-form-label>
            <nz-form-control nz-col [nzSpan]="24">
              <textarea rows="3" class="search__input" nz-input formControlName="ghiChu"
                        [readonly]="!(dieuChinhThongTinChiTieuKHNam.trangThai == '00' || id == 0 || dieuChinhThongTinChiTieuKHNam.trangThai == '03') || isView"
                        placeholder="Ghi chú"></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>
      </form>
    </div>
  </div>
</div>
