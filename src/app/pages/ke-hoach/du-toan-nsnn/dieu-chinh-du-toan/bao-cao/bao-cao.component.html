<ng-container *ngIf="isDataAvailable">
  <nz-affix [nzOffsetTop]="globals.prop.MENU_LV1" class="btn-affix">
    <div class="btn-group">
      <button type="button" class="btn btn-sub" (click)="back()">
        <i class="fa fa-arrow-left"></i>
        <span>Quay lại</span>
      </button>
      <button *ngIf="saveStatus" type="button" class="btn btn-sub" (click)="action('save')">
        <i class="icon htvbdh_tcdt_save"></i>
        <span>Lưu</span>
      </button>
      <button *ngIf="submitStatus" type="button" class="btn btn-sub" (click)="action('submit')">
        <i class="icon htvbdh_tcdt_guiduyet"></i>
        <span>Trình duyệt</span>
      </button>
      <button *ngIf="passStatus" type="button" class="btn btn-sub" (click)="action('nonpass')">
        <i class="icon htvbdh_tcdt_tuchoi"></i>
        <span>Từ chối</span>
      </button>
      <button *ngIf="passStatus" type="button" class="btn btn-sub" (click)="action('pass')">
        <i class="icon htvbdh_tcdt_pheduyet"></i>
        <span>Duyệt</span>
      </button>
      <button *ngIf="approveStatus" type="button" class="btn btn-sub" (click)="action('nonapprove')">
        <i class="icon htvbdh_tcdt_tuchoi"></i>
        <span>Từ chối</span>
      </button>
      <button *ngIf="approveStatus" type="button" class="btn btn-sub" (click)="action('approve')">
        <i class="icon htvbdh_tcdt_pheduyet"></i>
        <span>Phê duyệt</span>
      </button>
      <button *ngIf="acceptStatus" type="button" class="btn btn-sub" (click)="action('nonaccept')">
        <i class="icon htvbdh_tcdt_tuchoi"></i>
        <span>Từ chối</span>
      </button>
      <button *ngIf="acceptStatus" type="button" class="btn btn-sub" (click)="action('accept')">
        <i class="icon htvbdh_tcdt_pheduyet"></i>
        <span>Tiếp nhận</span>
      </button>
      <button *ngIf="copyStatus" type="button" class="btn btn-sub" (click)="showDialogCopy()">
        <i nz-icon nzType="copy" nzTheme="outline"></i>
        <span>Copy</span>
      </button>
    </div>
  </nz-affix>
  <div class="bg-trang">
    <div class="mt16 flex-card p-lr16">
      <div class="header mg-t-16">
        <div class="header-text">
          <div class="title-chi-tieu">
            <span [ngClass]="statusClass()">{{getStatusName(trangThaiBaoCao)}}</span>
            <span>Báo cáo điều chỉnh dự toán chi ngân sách nhà nước</span>
          </div>
        </div>
      </div>
      <nz-card class="mt-2px flex-card data-table card-border-content table-card">
        <nz-table class="nowrap mt-16 table-chi-tiet">
          <thead>
            <tr>
              <th>Mã báo cáo</th>
              <th>Năm báo cáo</th>
              <th>Đợt báo cáo</th>
              <th>Ngày tạo</th>
              <th>Người tạo</th>
              <th>Số công văn</th>
              <th>Ngày trình duyệt</th>
              <th>Ngày duyệt<br>(Trưởng bộ phận duyệt)</th>
              <th>Ngày phê duyệt<br>(Lãnh đạo duyệt)
              </th>
              <th>Ngày đơn vị cấp trên <br /> trả kết quả</th>
              <!-- <th width>Trạng thái</th> -->
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{maBaoCao}}</td>
              <td>
                {{namHienHanh}}
              </td>
              <td>
                {{dotBcao}}
              </td>
              <td>{{ngayNhap}}</td>
              <td>{{nguoiNhap}}</td>
              <td>
                <nz-upload [nzBeforeUpload]="beforeUploadCV" [hidden]="status">
                  <button nz-button>
                    <i nz-icon nzType="upload"></i>
                    Select File
                  </button>
                </nz-upload>
                <div class="tep__sqd" (click)="downloadFileCv()">
                  <span>{{congVan?.fileName}}</span>
                </div>
              </td>
              <td>{{ngayTrinhDuyet}}</td>
              <td>{{ngayDuyetTBP}}</td>
              <td>{{ngayDuyetLD}}</td>
              <td>{{ngayCapTrenTraKq}}</td>
              <!-- <td>
                {{getStatusName(trangThaiBaoCao)}}
              </td> -->
            </tr>
          </tbody>
        </nz-table>
      </nz-card>
    </div>

    <div class="mt-16 flex-card p-lr16">
      <nz-card class="mt-2px flex-card data-table card-border-content table-card">
        <nz-tabset class="tab__container" [(nzSelectedIndex)]="selectedIndex" nzType="editable-card"
          (nzClose)="closeTab($event)" nzHideAdd>
          <nz-tab [nzTitle]="'DANH SÁCH BIỂU MẪU'">
            <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
              <div nz-col class="gutter-row canphai phai" [nzSpan]="24" style="display:flex; justify-content: end;">
                <button type="button" class="btn btn-main" (click)="deleteSelected()" [hidden]="status">
                  <i class="fa fa-trash-o"></i>
                  <span>Xóa</span>
                </button>
                <button type="button" class="btn btn-main" (click)="addBieuMau()" [hidden]="status">
                  <i class="icon htvbdh_dau-cong"></i>
                  <span>Thêm</span>
                </button>
              </div>
            </div>
            <nz-table nzBordered class="table__body">
              <thead>
                <tr>
                  <th nzWidth="5%">STT</th>
                  <th nzWidth="10%">Biểu mẫu</th>
                  <th nzWidth="40%">Tên biểu mẫu</th>
                  <th nzWidth="10%">
                    Trạng thái
                  </th>
                  <th nzWidth="15%">Giao cho</th>
                  <th nzWidth="25%">Hành động</th>
                  <th [hidden]="status">
                    <label nz-checkbox [(ngModel)]="allChecked" (ngModelChange)="updateAllChecked()">
                    </label>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of lstDieuChinhs; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>
                    <div *ngFor="let item of phuLucs">
                      <div *ngIf="item.id == data.maLoai">
                        <!-- <a (click)="editAppendix(data.maBcao)" style="color: #1890ff;"> -->
                        {{item.tenPl}}
                        <!-- </a> -->
                      </div>
                    </div>
                  </td>
                  <td>
                    <div *ngFor="let item of phuLucs">
                      <div *ngIf="item.id == data.maLoai">
                        {{item.tenDm}}
                      </div>
                    </div>
                  </td>
                  <td>
                    <ng-container *ngIf="data.trangThai == '0'; else ok">
                      {{ getStatusBM(data.trangThai) }}<br>
                      Lý do: {{data.lyDoTuChoi}}
                    </ng-container>
                    <ng-template #ok>
                      {{ getStatusBM(data.trangThai) }}
                    </ng-template>

                  </td>
                  <td>
                    <ng-container
                      *ngIf="userInfo?.sub == nguoiNhap && !status && data?.id?.length==38 ;else templategiaoCho ">
                      <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn cán bộ thực hiện"
                        [(ngModel)]="data.giaoCho" [class]="data.giaoCho ?'' : 'input-error-validate'">
                        <nz-option *ngFor="let item of canBos" [nzValue]="item.username" [nzLabel]="item.username">
                        </nz-option>
                      </nz-select>
                    </ng-container>
                    <ng-template #templategiaoCho>
                      <div *ngFor="let item of canBos">
                        <div *ngIf="item.username == data.giaoCho">
                          {{item.username}}
                        </div>
                      </div>
                    </ng-template>
                  </td>

                  <td>
                    <a *ngIf="!status && userInfo?.sub == data.giaoCho && data.id" (click)="newTab(data.maLoai)">
                      <i class="fa fa-pencil"></i>
                    </a>
                    <a *ngIf="status" (click)="newTab(data.maLoai)">
                      <i class="fa fa-eye"></i>
                    </a>
                  </td>
                  <td [hidden]="status">
                    <label nz-checkbox [nzValue]="data.id" [(ngModel)]="data.checked"
                      (ngModelChange)="updateSingleChecked()"></label>
                  </td>
                </tr>
              </tbody>
            </nz-table>
            <ng-container *ngIf="lstDviTrucThuoc.length != 0">
              <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
                <div nz-col class="gutter-row" [nzSpan]="12">
                  Danh sách báo cáo từ các đơn vị trực thuộc
                  <br />
                </div>
              </div>
              <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
                <div nz-col class="gutter-row" [nzSpan]="24">
                  <nz-table [nzData]="lstDviTrucThuoc" nzBordered class="table__body">
                    <thead>
                      <tr>
                        <th nzWidth="50px">STT</th>
                        <th nzWidth="200px">Đơn vị lập</th>
                        <th nzWidth="150px">Mã báo cáo</th>
                        <th nzWidth="150px">Năm báo cáo</th>
                        <th nzWidth="150px">Ngày trình duyệt <br /> (Ngày đơn vị cấp dưới gửi
                          báo cáo)</th>
                        <th nzWidth="150px">Ngày duyệt <br />(Ngày đơn vị cấp trên duyệt báo
                          cáo)
                        </th>
                        <th nzWidth="150px">Trạng thái</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let data of lstDviTrucThuoc; let i = index">
                        <td>{{i+1}}</td>
                        <td>{{getUnitName(data.maDvi)}}</td>
                        <td>
                          {{ data.maBcao}}
                        </td>
                        <td>{{data.namHienHanh}}</td>
                        <td>{{data.ngayDuyet}}</td>
                        <td>{{data.ngayPheDuyet}}</td>
                        <td>{{getStatusName(data.trangThai)}}</td>
                        <td>
                          <a (click)="viewDetail(data.id)">
                            <i class="fa fa-eye"></i>
                          </a>
                        </td>
                      </tr>
                    </tbody>
                  </nz-table>
                </div>
              </div>
              <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
                <div nz-col nzSpan="24">
                  <label class="search__label">Thuyết minh</label>
                  <textarea rows="2" nz-input [(ngModel)]="thuyetMinh"></textarea>
                </div>
              </div>
            </ng-container>
            <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
              <div nz-col class="gutter-row" [nzSpan]="3">
                Danh sách văn bản đính kèm
                <nz-upload [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" [hidden]="status">
                  <button nz-button>
                    <i nz-icon nzType="upload"></i>
                    Select File
                  </button>
                </nz-upload>
                <button nz-button [nzType]="'primary'" (click)="handleUpload()" [disabled]="fileList.length === 0"
                  [hidden]="status" style="margin-top: 16px">
                  Thêm vào danh sách
                </button>
              </div>
            </div>
            <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
              <div nz-col class="gutter-row" [nzSpan]="12">
                <nz-table nzBordered class="table__body">
                  <thead>
                    <tr>
                      <th nzWidth="7%">STT</th>
                      <th>Tên file</th>
                      <th nzWidth="10%"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of lstFiles; let i = index">
                      <td>{{ i + 1 }} </td>
                      <td>{{ data.fileName }}</td>
                      <td>
                        <a (click)="downloadFile(data.id)">
                          <i class="fa fa-eye"></i>
                        </a>
                        <a *ngIf="!status" (click)="deleteFile(data.id)">
                          <i class="fa fa-trash-o do"></i>
                        </a>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>

              </div>
            </div>
          </nz-tab>
          <nz-tab *ngFor="let tab of tabs" nzClosable [nzTitle]="tab.tenPl">
            <ng-container *ngIf="tab.id == '1'">
              <app-phu-luc-1 [data]="tabData" (dataChange)="getNewData($event)">
              </app-phu-luc-1>
            </ng-container>
            <ng-container *ngIf="tab.id == '2'">
              <app-phu-luc-2 [data]="tabData" (dataChange)="getNewData($event)">
              </app-phu-luc-2>
            </ng-container>
            <ng-container *ngIf="tab.id == '3'">
              <app-phu-luc-3 [data]="tabData" (dataChange)="getNewData($event)">
              </app-phu-luc-3>
            </ng-container>
            <ng-container *ngIf="tab.id == '4'">
              <app-phu-luc-4 [data]="tabData" (dataChange)="getNewData($event)">
              </app-phu-luc-4>
            </ng-container>
            <ng-container *ngIf="tab.id == '5'">
              <app-phu-luc-5 [data]="tabData" (dataChange)="getNewData($event)">
              </app-phu-luc-5>
            </ng-container>
            <ng-container *ngIf="tab.id == '6'">
              <app-phu-luc-6 [data]="tabData" (dataChange)="getNewData($event)">
              </app-phu-luc-6>
            </ng-container>
            <ng-container *ngIf="tab.id == '7'">
              <app-phu-luc-7 [data]="tabData" (dataChange)="getNewData($event)">
              </app-phu-luc-7>
            </ng-container>
            <ng-container *ngIf="tab.id == '8'">
              <app-phu-luc-8 [data]="data" (dataChange)="getNewData($event)">
              </app-phu-luc-8>
            </ng-container>
          </nz-tab>
        </nz-tabset>
      </nz-card>
    </div>

  </div>
</ng-container>