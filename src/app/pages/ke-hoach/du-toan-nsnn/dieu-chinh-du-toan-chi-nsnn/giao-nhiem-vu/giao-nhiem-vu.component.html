<nz-affix class="menu-lv3" [nzOffsetTop]="43">
  <div class="tab-content tab-menu" id="myTabContent">
    <div class="tab-pane fade show active justify-content-between" id="banhanh" role="tabpanel"
      aria-labelledby="banhanh-tab">
      <div class="trai">
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="redirectChiTieuKeHoachNam()">
          <i class="fa fa-arrow-circle-left"></i>
        </a>
      </div>
      <div class="canphai phai">
        <button class="btn btn-main" (click)="save()" [hidden]="statusBtnSave || userInfo?.username != nguoiNhap">
          <i class="icon htvbdh_tcdt_save"></i>
          <span>Lưu</span>
        </button>
        <button class="btn btn-main" (click)="onSubmit('2',null)"
          [hidden]="statusBtnApprove || userInfo?.username != nguoiNhap">
          <i class="icon htvbdh_tcdt_guiduyet"></i>
          <span>Trình duyệt</span>
        </button>
        <a class="btn btn-main" (click)="tuChoi('3')" [hidden]="statusBtnTBP">
          <i class="icon htvbdh_tcdt_tuchoi"></i>
          <span>Từ chối</span>
        </a>
        <button class="btn btn-main" (click)="onSubmit('4',null)" [hidden]="statusBtnTBP">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Duyệt</span>
        </button>
        <button class="btn btn-main" (click)="tuChoi('5')" [hidden]="statusBtnLD">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Từ chối</span>
        </button>
        <a class="btn btn-main" (click)="onSubmit('7',null)" [hidden]="statusBtnLD">
          <i class="icon htvbdh_tcdt_tuchoi"></i>
          <span>Phê duyệt</span>
        </a>
        <button class="btn btn-main" (click)="tuChoi('8')" [hidden]="statusBtnDVCT">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Từ chối</span>
        </button>
        <a class="btn btn-main" (click)="onSubmit('9',null)" [hidden]="statusBtnDVCT">
          <i class="icon htvbdh_tcdt_tuchoi"></i>
          <span>Tiếp nhận</span>
        </a>
        <a class="btn btn-main" (click)="showDialogCopy()">
          <i nz-icon nzType="copy" nzTheme="outline"></i>
          <span>Copy</span>
        </a>
        <a class="btn btn-main" [hidden]="statusBtnPrint" (click)="doPrint()">
          <i nz-icon nzType="printer" nzTheme="outline"></i>
          <span>In</span>
        </a>
        <a class="btn btn-main" (click)="close()" [hidden]="statusBtnClose">
          <i nz-icon nzType="stop" nzTheme="outline"></i>
          <span>Đóng</span>
        </a>
      </div>
    </div>
  </div>
</nz-affix>
<div class="contentBor chi-tieu__body">
  <div class="contentDetail">
    <div class="main-content">
      <nz-card nzTitle="Thông tin chung báo cáo" class="mt16 flex-card p-lr16">
        <nz-table #basicTable class="nowrap">
          <thead>
            <tr>
              <th>Mã báo cáo</th>
              <th>Năm báo cáo</th>
              <th>Đợt báo cáo</th>
              <th>Ngày tạo</th>
              <th>Người tạo</th>
              <th>Số công văn</th>
              <th>Ngày trình duyệt</th>
              <th>Ngày duyệt<br>(Trưởng bộ phận duyệt)</th>
              <th>Ngày phê duyệt<br>(Lãnh đạo duyệt)
              </th>
              <th>Ngày đơn vị cấp trên <br /> trả kết quả</th>
              <th width>Trạng thái</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{maBaoCao}}</td>
              <td>
                {{namHienHanh}}
                <!-- <ng-container *ngIf="dotBcao && id ; else nam">
									{{namHienHanh}}
								</ng-container>
								<ng-template #nam>
									<nz-input-number [nzSize]="'small'"
										[class]="namHienHanh >= 1000 &&  namHienHanh <= 2999 || !namHienHanh && namHienHanh !== 0 ?'' : 'input-error-validate'"
										[(ngModel)]="namHienHanh" (ngModelChange)="changeNam()">
									</nz-input-number>
								</ng-template> -->
              </td>
              <td>
                <!-- {{dotBcao}} -->
                <!-- <ng-container *ngIf="dotBcao && id ; else chonDot">
									<div *ngFor="let item of dotBcaos">
										<div *ngIf="item.id == dotBcao">
											{{item.id}}
										</div>
									</div>
								</ng-container>
								<ng-template #chonDot>
									<nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn đợt báo cáo"
										[class]="dotBcao ? '' : 'input-error-validate'" [(ngModel)]="dotBcao"
										(ngModelChange)="changeDot()">
										<nz-option *ngFor="let item of dotBcaos" [nzValue]="item.id"
											[nzLabel]="item.id">
										</nz-option>
									</nz-select>
								</ng-template> -->
                {{dotBcao}}
              </td>
              <td>{{ngayNhap}}</td>
              <td>{{nguoiNhap}}</td>
              <td>
                <nz-upload [nzBeforeUpload]="beforeUploadCV" [hidden]="status">
                  <button nz-button>
                    <i nz-icon nzType="upload"></i>
                    Select File
                  </button>
                </nz-upload>
                <div class="tep__sqd" (click)="downloadFileCv()">
                  <!-- <i class="icon htvbdh_tcdt_tep"></i> -->
                  <span>{{congVan?.fileName}}</span>
                </div>
              </td>
              <td>{{ngayTrinhDuyet}}</td>
              <td>{{ngayDuyetTBP}}</td>
              <td>{{ngayDuyetLD}}</td>
              <td>{{ngayCapTrenTraKq}}</td>
              <td>
                <ng-container
                  *ngIf="trangThaiBaoCao == '3' || trangThaiBaoCao == '5' || trangThaiBaoCao == '8'; else chapnhan">
                  {{getStatusName(trangThaiBaoCao)}} - {{lyDoTuChoi}}
                </ng-container>
                <ng-template #chapnhan>
                  {{getStatusName(trangThaiBaoCao)}}
                </ng-template>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </nz-card>
      <div class="tab__container" id="tablePrint">
        <nz-tabset class="tab__container" [(nzSelectedIndex)]="selectedIndex" nzType="editable-card"
          (nzClose)="closeTab($event)" nzHideAdd>
          <nz-tab [nzTitle]="'DANH SÁCH BIỂU MẪU'">
            <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
              <div nz-col class="gutter-row canphai phai" [nzSpan]="24" style="display:flex; justify-content: end;">
                <button type="button" class="btn btn-main" (click)="deleteSelected()" [hidden]="status">
                  <i class="fa fa-trash-o"></i>
                  <span>Xóa</span>
                </button>
                <button type="button" class="btn btn-main" (click)="addBieuMau()" [hidden]="status">
                  <i class="icon htvbdh_dau-cong"></i>
                  <span>Thêm</span>
                </button>
              </div>
            </div>
            <nz-table nzBordered class="table__body">
              <thead>
                <tr>
                  <th nzWidth="5%">STT</th>
                  <th nzWidth="10%">Biểu mẫu</th>
                  <th nzWidth="40%">Tên biểu mẫu</th>
                  <th nzWidth="10%">
                    Trạng thái
                  </th>
                  <th nzWidth="15%">Giao cho</th>
                  <th nzWidth="25%">Hành động</th>
                  <th [hidden]="status">
                    <label nz-checkbox [(ngModel)]="allChecked" (ngModelChange)="updateAllChecked()">
                    </label>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of lstDieuChinhs; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>
                    <div *ngFor="let item of phuLucs">
                      <div *ngIf="item.id == data.maLoai">
                        <!-- <a (click)="editAppendix(data.maBcao)" style="color: #1890ff;"> -->
                        {{item.tenPl}}
                        <!-- </a> -->
                      </div>
                    </div>
                  </td>
                  <td>
                    <div *ngFor="let item of phuLucs">
                      <div *ngIf="item.id == data.maLoai">
                        {{item.tenDm}}
                      </div>
                    </div>
                  </td>
                  <td>
                    <ng-container *ngIf="data.trangThai == '0'; else ok">
                      {{ getStatusBM(data.trangThai) }}<br>
                      Lý do: {{data.lyDoTuChoi}}
                    </ng-container>
                    <ng-template #ok>
                      {{ getStatusBM(data.trangThai) }}
                    </ng-template>

                  </td>
                  <td>
                    <ng-container
                      *ngIf="userInfo?.username == nguoiNhap && !status && data?.id?.length==38 ;else templategiaoCho ">
                      <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn cán bộ thực hiện"
                        [(ngModel)]="data.giaoCho" [class]="data.giaoCho ?'' : 'input-error-validate'">
                        <nz-option *ngFor="let item of canBos" [nzValue]="item.username" [nzLabel]="item.username">
                        </nz-option>
                      </nz-select>
                    </ng-container>
                    <ng-template #templategiaoCho>
                      <div *ngFor="let item of canBos">
                        <div *ngIf="item.username == data.giaoCho">
                          {{item.username}}
                        </div>
                      </div>
                    </ng-template>
                  </td>

                  <td>
                    <ng-container *ngIf="data?.id?.length != 38">
                      <ng-container *ngIf="data.giaoCho == userInfo?.username && !status; else xem">
                        <button type="button" class="btn btn-main" (click)="newTab(data.maLoai)">
                          <span>Nhập dữ liệu</span>
                        </button>
                        <button type="button" class="btn btn-main">
                          <span>Biểu mẫu nhập số liệu</span>
                        </button>
                      </ng-container>
                      <ng-template #xem>
                        <button type="button" class="btn btn-main" (click)="newTab(data.maLoai)">
                          <span>Xem</span>
                        </button>
                      </ng-template>
                    </ng-container>
                  </td>
                  <td [hidden]="status">
                    <label nz-checkbox [nzValue]="data.id" [(ngModel)]="data.checked"
                      (ngModelChange)="updateSingleChecked()"></label>
                  </td>
                </tr>
              </tbody>
            </nz-table>
            <ng-container *ngIf="lstDviTrucThuoc.length != 0">
              <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
                <div nz-col class="gutter-row" [nzSpan]="12">
                  Danh sách báo cáo từ các đơn vị trực thuộc
                  <br />
                </div>
              </div>
              <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
                <div nz-col class="gutter-row" [nzSpan]="24">
                  <nz-table [nzData]="lstDviTrucThuoc" nzBordered class="table__body">
                    <thead>
                      <tr>
                        <th nzWidth="50px">STT</th>
                        <th nzWidth="200px">Đơn vị lập</th>
                        <th nzWidth="150px">Mã báo cáo</th>
                        <th nzWidth="150px">Năm báo cáo</th>
                        <th nzWidth="150px">Ngày trình duyệt <br /> (Ngày đơn vị cấp dưới gửi
                          báo cáo)</th>
                        <th nzWidth="150px">Ngày duyệt <br />(Ngày đơn vị cấp trên duyệt báo
                          cáo)
                        </th>
                        <th nzWidth="150px">Trạng thái</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let data of lstDviTrucThuoc; let i = index">
                        <td>{{i+1}}</td>
                        <td>{{getUnitName(data.maDvi)}}</td>
                        <td>
                          <a (click)="xemChiTiet(data.id)" style="color: #1890ff;">
                            {{ data.maBcao}}
                          </a>
                        </td>
                        <td>{{data.namHienHanh}}</td>
                        <td>{{data.ngayDuyet}}</td>
                        <td>{{data.ngayPheDuyet}}</td>
                        <td>{{getStatusName(data.trangThai)}}</td>
                      </tr>
                    </tbody>
                  </nz-table>
                </div>
              </div>
              <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
                <div nz-col nzSpan="24">
                  <label class="search__label">Thuyết minh</label>
                  <textarea rows="2" nz-input [(ngModel)]="thuyetMinh"></textarea>
                </div>
              </div>
            </ng-container>
            <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
              <div nz-col class="gutter-row" [nzSpan]="3">
                Danh sách văn bản đính kèm
                <nz-upload [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" [hidden]="status">
                  <button nz-button>
                    <i nz-icon nzType="upload"></i>
                    Select File
                  </button>
                </nz-upload>
                <button nz-button [nzType]="'primary'" (click)="handleUpload()" [disabled]="fileList.length === 0"
                  [hidden]="status" style="margin-top: 16px">
                  Thêm vào danh sách
                </button>
              </div>
            </div>
            <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top: 10px">
              <div nz-col class="gutter-row" [nzSpan]="12">
                <nz-table nzBordered class="table__body">
                  <thead>
                    <tr>
                      <th>STT</th>
                      <th>Tên file</th>
                      <th></th>
                      <th class="th" [hidden]="status"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of lstFiles; let i = index">
                      <td>{{ i + 1 }} </td>
                      <td>{{ data.fileName }}</td>
                      <td>
                        <button class="btn btn-function" (click)="downloadFile(data.id)">Xem</button>
                      </td>
                      <td [hidden]="status">
                        <button class="btn btn-function" (click)="deleteFile(data.id)">Xóa</button>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>

              </div>
            </div>
          </nz-tab>
          <nz-tab *ngFor="let tab of tabs" nzClosable [nzTitle]="tab.tenPl">
            <ng-container *ngIf="tab.id == '1'">
              <app-phu-luc1 [data]="data" (dataChange)="getNewData($event)">
              </app-phu-luc1>
            </ng-container>
            <ng-container *ngIf="tab.id == '2'">
              <app-phu-luc2 [data]="data" (dataChange)="getNewData($event)">
              </app-phu-luc2>
            </ng-container>
            <ng-container *ngIf="tab.id == '3'">
              <app-phu-luc3 [data]="data" (dataChange)="getNewData($event)">
              </app-phu-luc3>
            </ng-container>
            <ng-container *ngIf="tab.id == '4'">
              <app-phu-luc4 [data]="data" (dataChange)="getNewData($event)">
              </app-phu-luc4>
            </ng-container>
            <ng-container *ngIf="tab.id == '5'">
              <app-phu-luc5 [data]="data" (dataChange)="getNewData($event)">
              </app-phu-luc5>
            </ng-container>
            <ng-container *ngIf="tab.id == '6'">
              <app-phu-luc6 [data]="data" (dataChange)="getNewData($event)">
              </app-phu-luc6>
            </ng-container>
            <ng-container *ngIf="tab.id == '7'">
              <app-phu-luc7 [data]="data" (dataChange)="getNewData($event)">
              </app-phu-luc7>
            </ng-container>
            <ng-container *ngIf="tab.id == '8'">
              <app-phu-luc8 [data]="data" (dataChange)="getNewData($event)">
              </app-phu-luc8>
            </ng-container>
          </nz-tab>
        </nz-tabset>
        <!-- <div class="action">
					<button type="button" class="btn btn-main" >
						<i class="fa fa-trash-o"></i>
						<span>Xóa</span>
					</button>
				</div> -->
      </div>
      <div class="ghi-chu">
        <nz-form-label nzRequired [nzNoColon]="true">
          Ghi chú
        </nz-form-label>
        <ul>
          <li class="ghi-chu__item">
            Công văn xin ý kiến khảo sát xây dựng CSDL về Tài chính Công văn xin ý kiến khảo sát xây dựng
            CSDL về Tài
            chính Công văn xin ý kiến khảo sát xây dựng CSDL về Tài chính Công văn xin ý kiến khảo sát xây
            dựng CSDL về
            Tài chính Công văn xin ý kiến khảo sát xây dựng CSDL về Tài chính Công văn xin ý kiến khảo sát
            xây dựng CSDL
            về Tài chính Công văn xin ý kiến khảo sát xây dựng CSDL về Tài chính Công văn xin ý kiến khảo
            sát xây dựng
            CSDL về Tài chính Công văn xin ý kiến khảo sát xây dựng CSDL về Tài chính Công văn xin ý kiến
            khảo sát xây
            dựng CSDL về Tài chính
          </li>
          <li class="ghi-chu__item">
            Quyết định về việc phê duyệt kế hoạch lựa chọn nhà thầu cung cấp gạo nhập kho dự trữ quốc gia kế
            hoạch năm
            2022
          </li>
          <li class="ghi-chu__item">
            Quyết định về việc phê duyệt kế hoạch lựa chọn nhà thầu cung cấp gạo nhập kho dự trữ quốc gia kế
            hoạch năm
            2022
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
