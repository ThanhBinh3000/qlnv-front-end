<div class="bg-trang">
  <div class="header header-green-background">
    <div class="header-text">
      <div class="title-chi-tieu">
                    <span
                      [ngClass]="formData.value.trangThai == STATUS.DA_DUYET_LDC || formData.value.trangThai == STATUS.DA_DUYET_CBV ? 'da-ban-hanh' : 'du-thao-va-lanh-dao-duyet'">
                        {{ formData.value.tenTrangThai }}
                    </span>
        <span>ĐỀ XUẤT PHƯƠNG ÁN GIÁ</span>
      </div>
    </div>
    <div class="btn-group">
      <button type="button" class="btn btn-sub ml-2" (click)="quayLai()" *ngIf="!isModal">
        <i class="fa fa-arrow-left"></i>
        <span>Quay lại</span>
      </button>
      <button *ngIf="((formData.value.trangThai == STATUS.DA_DUYET_LDC && userService.isTongCuc()) && ((userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_DUYET_CBVU') && type == typeConst.GIA_MUA_TOI_DA )
     || (userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_DUYET_CBVU') && type == typeConst.GIA_CU_THE )))

     || ((formData.value.trangThai == STATUS.CHO_DUYET_TP && userService.isCuc()) && ((userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_DUYET_TP') && type == typeConst.GIA_MUA_TOI_DA )
     || (userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_GCT_DEXUAT_DUYET_TP') && type == typeConst.GIA_CU_THE )))

     || ((formData.value.trangThai == STATUS.CHO_DUYET_LDC && userService.isCuc()) && ((userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_DUYET_LDCUC') && type == typeConst.GIA_MUA_TOI_DA )
     || (userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_GCT_DEXUAT_DUYET_LDCUC') && type == typeConst.GIA_CU_THE )))
" type="button" class="btn btn-sub do ml-2" (click)="tuChoi()">
        <i class="icon htvbdh_tcdt_tuchoi do"></i>
        <span>Từ chối</span>
      </button>
      <button *ngIf="((formData.value.trangThai == STATUS.DA_DUYET_LDC && userService.isTongCuc()) && ((userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_DUYET_CBVU') && type == typeConst.GIA_MUA_TOI_DA )
     || (userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_DUYET_CBVU') && type == typeConst.GIA_CU_THE )))

     || ((formData.value.trangThai == STATUS.CHO_DUYET_TP && userService.isCuc()) && ((userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_DUYET_TP') && type == typeConst.GIA_MUA_TOI_DA )
     || (userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_GCT_DEXUAT_DUYET_TP') && type == typeConst.GIA_CU_THE )))

     || ((formData.value.trangThai == STATUS.CHO_DUYET_LDC && userService.isCuc()) && ((userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_DUYET_LDCUC') && type == typeConst.GIA_MUA_TOI_DA )
     || (userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_GCT_DEXUAT_DUYET_LDCUC') && type == typeConst.GIA_CU_THE )))"
              type="button" class="btn btn-sub xanh-nhat ml-2"
              (click)="pheDuyet()">
        <i class="icon htvbdh_tcdt_pheduyet"></i>
        <span>Duyệt</span>
      </button>
      <button *ngIf=" (formData.value.trangThai == STATUS.DU_THAO ||
            formData.value.trangThai == STATUS.TU_CHOI_TP ||  formData.value.trangThai == STATUS.TU_CHOI_LDC) && ((userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_THEM') && type == typeConst.GIA_MUA_TOI_DA )
     || (userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_GCT_DEXUAT_THEM') && type == typeConst.GIA_CU_THE ))  && userService.isCuc()"
              type="button" class="btn btn-sub xanh-nhat ml-2" (click)="save(true)">
        <i class="icon htvbdh_tcdt_guiduyet "></i>
        <span>Lưu và gửi duyệt</span>
      </button>
      <button *ngIf=" userService.isCuc() && (formData.value.trangThai == STATUS.DU_THAO ||
            formData.value.trangThai == STATUS.TU_CHOI_TP ||  formData.value.trangThai == STATUS.TU_CHOI_LDC) && ((userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_MTDBTT_DEXUAT_THEM') && type == typeConst.GIA_MUA_TOI_DA )
     || (userService.isAccessPermisson('KHVDTNSNN_PAGIA_LT_GCT_DEXUAT_THEM') && type == typeConst.GIA_CU_THE ))"
              type="button" class="btn btn-sub xanh ml-2" (click)="save()">
        <i class="icon htvbdh_luu"></i>
        <span>Lưu</span>
      </button>
    </div>
  </div>
  <nz-alert
    *ngIf="formData.value.trangThai == STATUS.TU_CHOI_TP ||  formData.value.trangThai == STATUS.TU_CHOI_LDC"
    nzShowIcon nzType="error" nzMessage="Lý do từ chối" nzDescription="{{formData.value.lyDoTuChoi}}">
  </nz-alert>
  <nz-card class="mt16 flex-card p-lr16">
    <form nzLayout="vertical" nz-form [formGroup]="formData">
      <div nz-row [nzGutter]="20">
        <div nz-col [nzSpan]="3">
          <nz-form-item class="form-item">
            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="nam-qd">Năm kế hoạch
            </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-select formControlName="namKeHoach" [nzDisabled]="isView" nzAllowClear="true">
                <nz-option *ngFor="let p of dsNam" [nzValue]="p.value" [nzLabel]="p.text">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="4">
          <nz-form-item class="form-item">
            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true">Số công văn
            </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group nzAddOnAfter="{{maDx}}">
                <input type="text" nz-input formControlName="soDeXuat" [readonly]="isView">
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="4" *ngIf="isGiaMuaToiDa">
          <nz-form-item class="form-item">
            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="nam-qd">Loại hàng hóa
            </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-select formControlName="loaiVthh" [nzDisabled]="isView" nzAllowClear="true"
                         (ngModelChange)="onChangeLoaiVthh($event)">
                <nz-option *ngFor="let p of listVthh" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item class="form-item">
            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="ngay-qd">Ngày ký
            </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-date-picker [nzDisabled]="isView" formControlName="ngayKy" nzFormat="dd/MM/yyyy" id="ngay-qd"
                              class="search__input">
              </nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item class="form-item">
            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="nam-qd"> Loại giá
            </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-select formControlName="loaiGia" [nzDisabled]="isView" nzAllowClear="true"
                         (ngModelChange)="onChangeLoaiGia($event)">
                <nz-option *ngFor="let p of dsLoaiGia" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="3">
          <nz-form-item class="form-item">
            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="nam-qd">Lần đề xuất
            </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <input type="text" nz-input formControlName="loaiDeXuat" [readonly]="true">
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="4">
          <nz-form-item class="form-item">
            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true">Số công văn cần điều chỉnh
            </nz-form-label>
            <nz-form-control [nzErrorTip]="error">
              <nz-input-group nzAddOnAfterIcon="folder-open">
                <input type="text" nz-input formControlName="soDeXuatDc" [readonly]="true" (click)="openModalSoDx()">
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="5" *ngIf="type=='GMTDBTT'">

        </div>
        <div nz-col [nzSpan]="24">
          <nz-form-item class="form-item">
            <nz-form-label [nzNoColon]="true" nzFor="ngay-qd">Trích yếu</nz-form-label>
            <nz-form-control>
              <textarea [readonly]="isView" formControlName="trichYeu" rows="3" class="search__input"
                        nz-input></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col nzSpan="24">
          <nz-form-item>
            <nz-form-label [nzNoColon]="true" nzSpan="24">
              Căn cứ pháp lý
            </nz-form-label>
          </nz-form-item>
          <nz-form-item>
            <div class="list-file" nz-col nzSpan="24">
              <file-list [data]="fileDinhKem"
                         [disabled]="isView">
              </file-list>
            </div>
          </nz-form-item>
        </div>

      </div>
    </form>
  </nz-card>

  <nz-tabset nzType="card" class="mt16 flex-card p-lr16" [nzTabBarExtraContent]="">
    <nz-tab [nzTitle]="'Thông tin chung'">
      <form nzLayout="vertical" nz-form [formGroup]="formData" class="mb-10">
        <div nz-row [nzGutter]="24">
          <div nz-col [nzSpan]="4" *ngIf="!isGiaMuaToiDa">
            <nz-form-item class="form-item">
              <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="nam-qd">Loại hàng hóa
              </nz-form-label>
              <nz-form-control [nzErrorTip]="error">
                <nz-select formControlName="loaiVthh" [nzDisabled]="isView" nzAllowClear="true"
                           (ngModelChange)="onChangeLoaiVthh($event)">
                  <nz-option *ngFor="let p of listVthh" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="4">
            <nz-form-item>
              <nz-form-label nzRequired [nzNoColon]="true"> Chủng loại hàng hóa</nz-form-label>
              <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                <nz-select formControlName="cloaiVthh" [nzDisabled]="isView" nzAllowClear="true"
                           (ngModelChange)="onChangeCloaiVthh($event)">
                  <nz-option *ngFor="let p of listCloaiVthh" [nzValue]="p.ma" [nzLabel]="p.ten">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="4" *ngIf="type=='GCT'">
            <nz-form-item class="form-item">
              <nz-form-label [nzNoColon]="true" class="label-color-kh"> Quyết định phê
                duyệt kế hoạch mua/bán
              </nz-form-label>
              <nz-form-control [nzErrorTip]="error">
                <nz-select [nzDisabled]="isView" formControlName="qdCtKhNam" (ngModelChange)="loadDetailNh($event)">
                  <nz-option *ngFor="let item of listQdCtKh" [nzLabel]="item.soQd" [nzValue]="item.soQd"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="isGiaMuaToiDa ? 14 : 4">
            <nz-form-item>
              <nz-form-label>
                Mô tả chi tiết chủng loại hàng hóa
              </nz-form-label>
              <nz-form-control [nzErrorTip]="error">
                <nz-input-group nzAddOnAfter="">
                  <nz-input-group>
                    <input type="text" [readonly]="isView" nz-input formControlName="moTa"/>
                  </nz-input-group>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="2"
               *ngIf="formData.value.loaiGia == 'LG01' || formData.value.loaiGia == 'LG03'">
            <nz-form-item>
              <nz-form-label>
                Thuế VAT
              </nz-form-label>
              <nz-form-control [nzErrorTip]="error">
                <nz-input-group>
                  <nz-input-group>
                    <nz-select [nzDisabled]="isView" formControlName="vat">
                      <nz-option *ngFor="let item of listVat" [nzLabel]="item.ghiChu"
                                 [nzValue]="item.giaTri"></nz-option>
                    </nz-select>
                  </nz-input-group>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="24">
            <nz-form-item>
              <nz-form-label>
                Tiêu chuẩn, quy chuẩn
              </nz-form-label>
              <nz-form-control [nzErrorTip]="error">
                <nz-input-group>
                  <nz-input-group>
                    <input type="text" nz-input formControlName="tchuanCluong" readonly/>
                  </nz-input-group>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="4" *ngIf="!isGiaMuaToiDa">
            <nz-form-item>
              <nz-form-label>
                Thời gian hoàn thành nhập hàng
              </nz-form-label>
              <nz-form-control [nzErrorTip]="error">
                <nz-input-group>
                  <nz-date-picker formControlName="tgianNhang" nzFormat="dd/MM/yyyy">
                  </nz-date-picker>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </form>
      <nz-table nzBordered [nzData]="pagTtChungs" [nzFrontPagination]="false" [nzShowPagination]="false"
                *ngIf="formData.value.apDungTatCa == false">
        <thead>
        <tr>
          <th class="text-center" nzWidth="45px">STT</th>
          <th class="text-center">Chi cục</th>
          <th class="text-center" nzWidth="200px">Chỉ tiêu theo KH được giao(tấn)</th>
          <th class="text-center" nzWidth="150px">Số lượng</th>
          <th class="text-center" nzWidth="350px">Đơn giá chưa VAT (đồng)</th>
          <th class="text-center" nzWidth="150px"
              *ngIf="formData.value.loaiGia == 'LG01' || formData.value.loaiGia == 'LG03'">Đơn giá có VAT (đồng)
          </th>
        </tr>
        <tr>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th>
            <div nz-row [nzGutter]="24">
              <div nz-col [nzSpan]="8">
                <nz-input-group>
                  <nz-input-number name="giaDn" [(ngModel)]="giaDn" [nzSize]="'small'" nz-input [nzMin]="0" [nzFormatter]="globals.formatter"
                                   [nzParser]="globals.parser">
                  </nz-input-number>
                </nz-input-group>
              </div>
              <div nz-col [nzSpan]="16">
                <nz-input-group>
                  <label nz-checkbox [(ngModel)]="isApDungTatCa" (ngModelChange)="onChangeIsApDungTatCa()">Áp dụng cho tất cả các Chi cục</label>
                </nz-input-group>
              </div>
            </div>
          </th>
          <th *ngIf="formData.value.loaiGia == 'LG01' || formData.value.loaiGia == 'LG03'">
          </th>
        </tr>

        </thead>
        <tbody>
        <tr *ngFor="let data of pagTtChungs; let idx = index">
          <td>{{ idx + 1 }}</td>
          <td>{{ data.tenChiCuc }}</td>
          <td class="text-right">{{ data.soLuongCtieu | number : '1.0-1' : 'vi-VN'}}</td>
          <td class="text-right">
            <nz-input-number  [(ngModel)]="data.soLuong" [nzSize]="'small'" nz-input [nzMin]="0" [nzFormatter]="globals.formatter" [nzMax]="data.soLuongCtieu > 0 ? data.soLuongCtieu : 9999999999999"
                              [nzParser]="globals.parser">
            </nz-input-number>
          </td>
          <td class="text-right" *ngIf="isApDungTatCa == true">{{ data.giaDn | number : '1.0-1' : 'vi-VN' }}</td>
          <td  *ngIf="isApDungTatCa == false">
            <nz-input-number  [(ngModel)]="data.giaDn" [nzSize]="'small'" nz-input [nzMin]="0" [nzFormatter]="globals.formatter"
                              [nzParser]="globals.parser">
            </nz-input-number>
          </td>
          <td class="text-right"
              *ngIf="formData.value.loaiGia == 'LG01' || formData.value.loaiGia == 'LG03'">{{ data.giaDnVat | number : '1.0-1' : 'vi-VN' }}</td>
        </tr>
        </tbody>
      </nz-table>

    </nz-tab>
    <nz-tab [nzTitle]="'Căn cứ phương pháp xác định giá'" *ngIf="isGiaMuaToiDa">
      <nz-card class="mt16 p-lr16 card-table pd-10">
        <span class="sub-title mb-10">CĂN CỨ PHÁP LÝ</span>
        <nz-table #dataTable nzBordered [nzData]="dataTableCanCuXdg" [nzFrontPagination]="false"
                  [nzShowPagination]="false">
          <thead>
          <tr>
            <th style="width: 2%;">STT</th>
            <th style="width: 75%;">Mô tả</th>
            <th style="width: 16%;">File đính kèm</th>
            <th style="width: 6%;">Hành động</th>
          </tr>
          <tr>
            <th class="text-center"></th>
            <th>
              <input type="text" [readonly]="isView" [(ngModel)]="rowItemCcXdg.moTa" nz-input/>
            </th>
            <th>
              <nz-form-control>
                <nz-input-group nzSize="large" [nzAddOnAfter]="suffixIcon">
                  <input placeholder="Chọn file" [(ngModel)]="rowItemCcXdg.fileDinhKem.fileName"
                         nz-input disabled/>
                </nz-input-group>
                <ng-template #suffixIcon>
                  <i class="icon htvbdh_tcdt_tep"></i>
                  <input class="input-file" (change)="getNameFile($event)" type="file"/>
                </ng-template>
              </nz-form-control>
            </th>
            <th class="text-left">
              <a *ngIf="!isView">
                <i class="icon htvbdh_dau-cong" (click)="themDataTable()"></i>
              </a>
              <a *ngIf="!isView">
                <i class="icon  htvbdh_nhap-lai1 "></i>
              </a>
            </th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of dataTableCanCuXdg; let idx = index">
            <ng-container *ngIf="dataEdit[idx] && !dataEdit[idx].edit; else editTemplate">
              <td class="text-center">{{ idx + 1 }}</td>
              <td>{{ data.moTa }}</td>
              <td>{{ data.fileDinhKem?.fileName }}</td>
              <td style="text-align: left; white-space: nowrap;">
                <a (click)="downloadFile(data.fileDinhKem)">
                  <i class="icon htvbdh_tcdt_import "></i>
                </a>
                <a *ngIf="!isView" (click)="startEdit(idx)">
                  <i class="fa fa-pencil" title="Sửa"></i>
                </a>
                <a *ngIf="!isView" (click)="deleteItem(idx)">
                  <i class="fa fa-trash-o do" title="Xóa bản ghi"></i>
                </a>
              </td>
            </ng-container>
            <ng-template #editTemplate>
              <td></td>
              <td>
                <input type="text" [(ngModel)]="dataEdit[idx].data.moTa" nz-input/>
              </td>
              <td>
                <nz-form-control>
                  <nz-input-group nzSize="large" [nzAddOnAfter]="suffixIcon">
                    <input placeholder="Chọn file"
                           [(ngModel)]="dataEdit[idx].data.fileDinhKem.fileName" nz-input
                           disabled/>
                  </nz-input-group>
                  <ng-template #suffixIcon>
                    <i class="icon htvbdh_tcdt_tep"></i>
                    <input class="input-file" (change)="getNameFile($event)"
                           type="file"/>
                  </ng-template>
                </nz-form-control>
              </td>
              <td>
                <a (click)="downloadFile(dataEdit[idx].data.fileDinhKem)">
                  <i class="icon htvbdh_tcdt_import "></i>
                </a>
                <a (click)="saveEdit(idx)" class="save">
                  <i class="fa fa-save"></i>
                </a>
                <a (click)="cancelEdit(idx)">
                  <i class="fa fa-ban do"></i> </a>
              </td>
            </ng-template>
          </tr>
          </tbody>
        </nz-table>
        <span class="sub-title mb-10">Phương pháp xác định giá </span>
        <form nzLayout="vertical" nz-form [formGroup]="formData" class="mb-10">
          <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="4">
              <nz-form-item class="form-item">
                <nz-form-control [nzErrorTip]="error">
                  <nz-select formControlName="maPphapXdg" [nzDisabled]="isView" nzAllowClear="true">
                    <nz-option *ngFor="let p of dsPhuongAnGia, let i = index" [nzValue]="p.ma"
                               [nzLabel]="p.giaTri">
                    </nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="10" *ngIf="formData.value.maPphapXdg == 'XDG01'">
              <nz-form-item class="form-item">
                <nz-form-control [nzErrorTip]="error">
                  <nz-radio-group formControlName="loaiHangXdg" (ngModelChange)="onChangePp()">
                    <label nz-radio *ngFor="let item of dsLoaiHangXdg"
                           [nzValue]="item.ma">{{item.giaTri}}</label>
                  </nz-radio-group>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
          <div nz-row [nzGutter]="20" *ngIf="formData.value.maPphapXdg == 'XDG01'">
            <div nz-col [nzSpan]="4">
              <nz-form-item>
                <nz-form-label>
                  {{formData.value.loaiHangXdg == 'XDG_LH02' ? 'Giá vốn trực tiếp (đồng/kg)' : ' Giá vốn nhập khẩu (đồng/kg) '}}
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfter="">
                    <nz-input-number formControlName="giaVonNk" [nzSize]="'small'"
                                     [nzFormatter]="globals.formatter" [nzParser]="globals.parser">
                    </nz-input-number>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="4">
              <nz-form-item>
                <nz-form-label>
                  Chi phí chung (đồng/kg)
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfter="">
                    <nz-input-number formControlName="chiPhiChung" [nzSize]="'small'"
                                     [nzFormatter]="globals.formatter" [nzParser]="globals.parser">
                    </nz-input-number>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="4" *ngIf="formData.value.loaiHangXdg == 'XDG_LH02'">
              <nz-form-item>
                <nz-form-label>
                  Chi phí phân bổ cho sản phẩm phụ (đồng/kg)
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfter="">
                    <nz-input-number formControlName="chiPhiPbo" [nzSize]="'small'"
                                     [nzFormatter]="globals.formatter" [nzParser]="globals.parser">
                    </nz-input-number>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="4">
              <nz-form-item>
                <nz-form-label>
                  Tổng chi phí (đồng/kg)
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfter="">
                    <nz-input-number formControlName="tongChiPhi" [nzSize]="'small'"
                                     [nzFormatter]="globals.formatter" [nzParser]="globals.parser" nzDisabled>
                    </nz-input-number>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </form>
      </nz-card>
    </nz-tab>
    <nz-tab [nzTitle]="'Thông tin khảo sát giá'" *ngIf="isGiaMuaToiDa">
      <nz-card class="mt16 p-lr16 card-table pd-10">
        <span class="sub-title mb-10">KẾT QUẢ KHẢO SÁT GIÁ THỊ TRƯỜNG</span>
        <app-thong-tin-ksg [dataCloaiVthh]="formData.value" [isView]="isView" *ngIf="dataTableKsGia || !idInput"
                           [vat]="formData.value.vat  ? formData.value.vat  : 0 " [isTabNdKhac]="false"
                           [isTableKetQua]="true" [listCloaiVthh]="listCloaiVthh" [(dataTable)]="dataTableKsGia"
                           [isVat]="formData.value.loaiGia == 'LG01' || formData.value.loaiGia == 'LG03'">
        </app-thong-tin-ksg>
        <span class="sub-title mb-10">KẾT QUẢ THẨM ĐỊNH GIÁ</span>
        <app-thong-tin-ksg [dataCloaiVthh]="formData.value" [isView]="isView" *ngIf="dataTableKsGia || !idInput"
                           [vat]="formData.value.vat ? formData.value.vat  : 0 " [isTabNdKhac]="false"
                           [isTableKetQua]="false" [(dataTable)]="dataTableKqGia"
                           [isVat]="formData.value.loaiGia == 'LG01' || formData.value.loaiGia == 'LG03'"></app-thong-tin-ksg>
        <span class="sub-title mb-10">CÁC THÔNG TIN KHÁC</span>
        <app-thong-tin-ksg [dataCloaiVthh]="formData.value" [isView]="isView" *ngIf="dataTableKsGia || !idInput"
                           [vat]="formData.value.vat ? formData.value.vat  : 0 " [isTabNdKhac]="true"
                           [isTableKetQua]="false" [(dataTable)]="dataTableTtThamKhao"
                           [isVat]="formData.value.loaiGia == 'LG01' || formData.value.loaiGia == 'LG03'"></app-thong-tin-ksg>
      </nz-card>
    </nz-tab>

    <nz-tab [nzTitle]="'Phân tích, dự báo biến động giá'" *ngIf="isGiaMuaToiDa">
      <form nzLayout="vertical" nz-form [formGroup]="formData">
        <div nz-row [nzGutter]="16" class="mb-10">
          <div nz-col [nzSpan]="24">
            <nz-form-item class="form-item">
              <nz-form-label [nzNoColon]="true" nzFor="ngay-qd">Nội dung</nz-form-label>
              <nz-form-control>
                <textarea [readonly]="isView" formControlName="noiDung" rows="3" class="search__input"
                          nz-input></textarea>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="24">
            <nz-form-item>
              <nz-form-label [nzNoColon]="true">
                File đính kèm
              </nz-form-label>
              <div class="list-file">
                <file-list [data]="fileDkPhanTich" [isViewDetail]="isView"></file-list>
              </div>
            </nz-form-item>
          </div>
        </div>
      </form>
    </nz-tab>
    <nz-tab [nzTitle]="'Căn cứ xác định giá'" *ngIf="!isGiaMuaToiDa">
      <nz-card class="mt16 p-lr16 card-table pd-10">
        <span class="sub-title mb-10">Phương pháp xác định giá</span>
        <form nzLayout="vertical" nz-form [formGroup]="formData" class="mb-10">
          <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="4">
              <nz-form-item class="form-item">
                <nz-form-control [nzErrorTip]="error">
                  <nz-select formControlName="maPphapXdg" [nzDisabled]="isView" nzAllowClear="true">
                    <nz-option *ngFor="let p of dsPhuongAnGia, let i = index" [nzValue]="p.ma"
                               [nzLabel]="p.giaTri">
                    </nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="10" *ngIf="formData.value.maPphapXdg == 'XDG01'">
              <nz-form-item class="form-item">
                <nz-form-control [nzErrorTip]="error">
                  <nz-radio-group formControlName="loaiHangXdg">
                    <label nz-radio *ngFor="let item of dsLoaiHangXdg"
                           [nzValue]="item.ma">{{item.giaTri}}</label>
                  </nz-radio-group>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
          <div nz-row [nzGutter]="20" *ngIf="formData.value.maPphapXdg == 'XDG01'">
            <div nz-col [nzSpan]="4">
              <nz-form-item>
                <nz-form-label>
                  {{formData.value.loaiHangXdg == 'XDG_LH02' ? 'Giá vốn trực tiếp (đồng/kg)' : ' Giá vốn nhập khẩu (đồng/kg) '}}
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfter="">
                    <nz-input-number formControlName="giaVonNk" [nzSize]="'small'"
                                     [nzFormatter]="globals.formatter" [nzParser]="globals.parser">
                    </nz-input-number>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="4">
              <nz-form-item>
                <nz-form-label>
                  Chi phí chung (đồng/kg)
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfter="">
                    <nz-input-number formControlName="chiPhiChung" [nzSize]="'small'"
                                     [nzFormatter]="globals.formatter" [nzParser]="globals.parser">
                    </nz-input-number>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="4" *ngIf="formData.value.loaiHangXdg == 'XDG_LH02'">
              <nz-form-item>
                <nz-form-label>
                  Chi phí phân bổ cho sản phẩm phụ (đồng/kg)
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfter="">
                    <nz-input-number formControlName="chiPhiPbo" [nzSize]="'small'"
                                     [nzFormatter]="globals.formatter" [nzParser]="globals.parser">
                    </nz-input-number>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="4">
              <nz-form-item>
                <nz-form-label>
                  Tổng chi phí (đồng/kg)
                </nz-form-label>
                <nz-form-control [nzErrorTip]="error">
                  <nz-input-group nzAddOnAfter="">
                    <nz-input-number formControlName="tongChiPhi" [nzSize]="'small'"
                                     [nzFormatter]="globals.formatter" [nzParser]="globals.parser" nzDisabled>
                    </nz-input-number>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </form>
        <span class="sub-title mb-10">GIÁ THỊ TRUỜNG</span>
        <app-thong-tin-ksg [vat]="formData.value.vat ? formData.value.vat  : 0 " *ngIf="!idInput || dataTableKsGia"
                           [isTableKetQua]="true"
                           [isVat]="formData.value.loaiGia == 'LG01' || formData.value.loaiGia == 'LG03'"
                           [listCloaiVthh]="listCloaiVthh" [(dataTable)]="dataTableKsGia" [isView]="isView">
        </app-thong-tin-ksg>
        <span class="sub-title mb-10">GIÁ CỦA SỞ TÀI CHÍNH</span>
        <app-thong-tin-ksg [isView]="isView" [vat]="formData.value.vat ? formData.value.vat : 0 "
                           *ngIf="!idInput || dataTableKqGia" [isTableKetQua]="false"
                           [isVat]="formData.value.loaiGia == 'LG01' || formData.value.loaiGia == 'LG03'"
                           [(dataTable)]="dataTableKqGia">
        </app-thong-tin-ksg>
      </nz-card>
    </nz-tab>
  </nz-tabset>
  <form nzLayout="vertical" nz-form [formGroup]="formData">
    <div nz-row [nzGutter]="20">
      <div nz-col nzSpan="24">
        <nz-form-item class="form-item">
          <nz-form-label>
            Ghi chú
          </nz-form-label>
          <nz-form-control>
                        <textarea [readonly]="formData.value.trangThai !== '00' && formData.value.trangThai !== '03'"
                                  nz-input [rows]="3" formControlName="ghiChu"></textarea>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </form>
</div>
<ng-template #error let-control>
  <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
  </ng-container>
</ng-template>

