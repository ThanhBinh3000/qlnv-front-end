<ng-container *ngIf="isMain; else templateSub">
    <nz-affix [nzOffsetTop]="globals.prop.MENU_LV2" class="btn-affix">
        <div class="btn-group">
            <button type="button" class="btn btn-sub" (click)="quayLai()">
                <i class="fa fa-arrow-left"></i>
                <span>Quay lại</span>
            </button>
            <button *ngIf="isTongHop && !formData.value.id" type="button" class="btn btn-main" (click)="save()">
                <i class="icon htvbdh_tcdt_save"></i>
                <span>Lưu</span>
            </button>
            <button *ngIf="isTongHop && formData.value.id > 0 " type="button" class="btn btn-sub xanh-nhat"
                (click)="taoTtrinh()">
                <i class="icon htvbdh_tcdt_tao-ttrinh"></i>
                <span>{{formData.value.trangThaiTh == STATUS.CHUA_TAO_TT ? 'Tạo tờ trình' : 'Xem tờ trình'}}</span>
            </button>
        </div>
    </nz-affix>
    <div class="bg-trang">
        <div class="header" *ngIf="isTongHop">
            <div class="header-text">
                <div class="title-chi-tieu">
                     <span
                       [ngClass]="formData.value.trangThaiTh == STATUS.DA_TAO_TT ? 'da-ban-hanh' : 'du-thao-va-lanh-dao-duyet'">
                        {{ formData.value.tenTrangThaiTh }}
                    </span>
                    <span>TIÊU CHÍ TỔNG HỢP</span>
                </div>
            </div>
        </div>
        <nz-card class="mt16 flex-card p-lr16">
            <form nzLayout="vertical" nz-form [formGroup]="formTraCuu">
                <div nz-row [nzGutter]="20" class="mb-10">
                    <div nz-col [nzSpan]="2">
                        <nz-form-item class="form-item">
                            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="nam-qd">Năm tổng hợp
                            </nz-form-label>
                            <nz-form-control [nzErrorTip]="error">
                                <nz-select formControlName="namTongHop" [nzDisabled]="isView" nzAllowClear="true">
                                    <nz-option *ngFor="let p of dsNam" [nzValue]="p.value" [nzLabel]="p.text">
                                    </nz-option>
                                </nz-select>
                                <ng-template #error let-control>
                                    <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
                                    </ng-container>
                                </ng-template>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col [nzSpan]="3">
                        <nz-form-item class="form-item">
                            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="nam-qd">Loại hàng hóa
                            </nz-form-label>
                            <nz-form-control [nzErrorTip]="error">
                                <nz-select formControlName="loaiVthh" [nzDisabled]="isView" nzAllowClear="true"
                                    (ngModelChange)="onChangeLoaiVthh($event)">
                                    <nz-option *ngFor="let p of listVthh" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                                    </nz-option>
                                    <ng-template #error let-control>
                                        <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
                                        </ng-container>
                                    </ng-template>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col [nzSpan]="3">
                        <nz-form-item>
                            <nz-form-label nzRequired [nzNoColon]="true"> Chủng loại hàng hóa </nz-form-label>
                            <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                                <nz-select formControlName="cloaiVthh" [nzDisabled]="isView" nzAllowClear="true"
                                    (ngModelChange)="onChangeCloaiVthh($event)">
                                    <nz-option *ngFor="let p of listCloaiVthh" [nzValue]="p.ma" [nzLabel]="p.ten">
                                    </nz-option>
                                    <ng-template #error let-control>
                                        <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
                                        </ng-container>
                                    </ng-template>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col [nzSpan]="3">
                        <nz-form-item class="form-item">
                            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="nam-qd">Loại giá
                            </nz-form-label>
                            <nz-form-control [nzErrorTip]="error">
                                <nz-select formControlName="loaiGia" [nzDisabled]="isView" nzAllowClear="true">
                                    <nz-option *ngFor="let p of dsLoaiGia" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                                    </nz-option>
                                    <ng-template #error let-control>
                                        <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
                                        </ng-container>
                                    </ng-template>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col [nzSpan]="8">
                        <nz-form-item>
                            <nz-form-label nzRequired [nzNoColon]="true"> Cục DTNNKV </nz-form-label>
                            <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
                                <nz-select formControlName="maDvis" [nzDisabled]="isView" [nzMaxTagCount]="2"
                                    nzMode="multiple" [(ngModel)]="listCucSelected">
                                    <nz-option *ngFor="let item of listCuc" [nzLabel]="item.tenDvi"
                                        [nzValue]="item.maDvi">
                                    </nz-option>
                                    <ng-template #error let-control>
                                        <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
                                        </ng-container>
                                    </ng-template>
                                </nz-select>
                                <ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more
                                    selected
                                </ng-template>

                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col [nzSpan]="5">
                        <nz-form-item class="form-item">
                            <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="ngay-qd"> Ngày đề
                                xuất
                            </nz-form-label>
                            <nz-form-control [nzErrorTip]="error">
                                <nz-range-picker formControlName="ngayDx" nzFormat="dd/MM/yyyy"
                                    class="search__input">
                                </nz-range-picker>
                                <ng-template #error let-control>
                                    <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
                                    </ng-container>
                                </ng-template>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </div>
                <div nz-row [nzGutter]="20" *ngIf="!formData.value.id">
                    <div nz-col [nzSpan]="24">
                        <div class="tong-hop-button group-button-search">
                            <button class="btn btn-main btn-sm waves-effect waves-light" (click)="tongHop()">
                                <i class="icon htvbdh_tcdt_tong-hop-de-xuat-tu-cuc"></i>
                                <span>Tổng hợp phương án giá</span>
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </nz-card>
        <div *ngIf="isTongHop">
            <div class="header">
                <div class="header-text">
                    <div class="title-chi-tieu">
                        <span>
                        </span>
                        <span>THÔNG TIN CHUNG</span>
                    </div>
                </div>
            </div>
            <nz-card class="mt16 flex-card p-lr16">
                <form nzLayout="vertical" nz-form [formGroup]="formData">
                    <div nz-row [nzGutter]="20" class="mb-10">
                        <div nz-col [nzSpan]="5">
                            <nz-form-item class="form-item">
                                <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true" nzFor="ngay-qd">Ngày
                                    tổng hợp
                                </nz-form-label>
                                <nz-form-control [nzErrorTip]="error">
                                    <nz-date-picker formControlName="ngayTongHop" nzDisabled nzFormat="dd/MM/yyyy"
                                        id="ngay-qd" class="search__input">
                                    </nz-date-picker>
                                    <ng-template #error let-control>
                                        <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
                                        </ng-container>
                                    </ng-template>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="14">
                            <nz-form-item class="form-item">
                                <nz-form-label nzRequired [nzNoColon]="true" [nzNoColon]="true"> Nội
                                    dung tổng hợp </nz-form-label>
                                <nz-form-control [nzErrorTip]="error">
                                    <nz-input-group>
                                        <input type="text" nz-input formControlName="noiDung" />
                                    </nz-input-group>
                                    <ng-template #error let-control>
                                        <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}
                                        </ng-container>
                                    </ng-template>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="5">
                            <nz-form-item>
                                <nz-form-label [nzNoColon]="true" [nzNoColon]="true"> Mã tổng
                                    hợp </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number class="text-right" nz-input formControlName="id" [nzSize]="'small'"
                                        nzDisabled>
                                    </nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                </form>
                <form nzLayout="vertical" nz-form [formGroup]="formData">
                    <span class="sub-title mb-10">THÔNG TIN VỀ GIÁ (ĐỒNG/KG)</span>
                    <div nz-row [nzGutter]="20">
                        <div nz-col [nzSpan]="4">
                            <nz-form-item>
                                <nz-form-label [nzNoColon]="true"> Giá khảo sát
                                    thị trường chưa VAT </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number class="text-right" nz-input formControlName="giaKsTt"
                                        [nzSize]="'small'" nzDisabled>
                                    </nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="4"
                            *ngIf="formTraCuu.value.loaiGia == 'LG01' || formTraCuu.value.loaiGia == 'LG03'">
                            <nz-form-item>
                                <nz-form-label [nzNoColon]="true"> Giá khảo sát thị trường có VAT </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number class="text-right" nz-input formControlName="giaKsTtVat"
                                        [nzSize]="'small'" nzDisabled>
                                    </nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="4"
                            *ngIf="formTraCuu.value.loaiGia == 'LG01' || formTraCuu.value.loaiGia == 'LG03'">
                            <nz-form-item>
                                <nz-form-label [nzNoColon]="true"> Kết quả thẩm định giá chưa VAT </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number class="text-right" nz-input formControlName="kqTd"
                                        [nzSize]="'small'" nzDisabled>
                                    </nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="4">
                            <nz-form-item>
                                <nz-form-label [nzNoColon]="true"> Kết quả thẩm định giá có VAT </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number class="text-right" nz-input formControlName="kqTdVat"
                                        [nzSize]="'small'" nzDisabled>
                                    </nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                    <div nz-row [nzGutter]="20" class="mb-10">
                        <div nz-col [nzSpan]="4">
                            <nz-form-item>
                                <nz-form-label [nzNoColon]="true"> Giá đề nghị chưa VAT </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number class="text-right" nz-input formControlName="giaDng"
                                        [nzSize]="'small'" nzDisabled>
                                    </nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="4"
                            *ngIf="formTraCuu.value.loaiGia == 'LG01' || formTraCuu.value.loaiGia == 'LG03'">
                            <nz-form-item>
                                <nz-form-label [nzNoColon]="true"> Giá đề nghị có VAT </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number class="text-right" nz-input formControlName="giaDngVat"
                                        [nzSize]="'small'" nzDisabled>
                                    </nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                </form>
            </nz-card>
            <div nz-col [nzSpan]="24" class="header">
                <div class="header-text">
                    <div class="title-chi-tieu">
                        <span>
                        </span>
                        <span>THÔNG TIN CHI TIẾT ĐỀ XUẤT CỦA CÁC CỤC DTNN KV</span>
                    </div>
                </div>
            </div>
            <nz-card class="mt-2px flex-card data-table card-border-content table-card">
                <nz-table #rowSelectionTable class="nowrap" nzBordered [nzData]="dataTable" [nzFrontPagination]="false"
                    [nzShowPagination]="false">
                    <thead>
                        <tr class="header-row">
                            <th class="text-center" style="width: 2%;">STT</th>
                            <th class="text-center" style="width: 6%;">Số đề xuất</th>
                            <th class="text-center" style="width: 25%;">Đơn vị</th>
                            <th class="text-center" style="width: 4%;">Số lượng (tấn)</th>
                            <th class="text-center" style="width: 7%;">Giá đề nghị chưa VAT (đồng/kg)</th>
                            <th class="text-center" style="width: 7%;">Giá đề nghị có VAT (đồng/kg)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of rowSelectionTable.data; let idx = index">
                            <td class="text-center">{{(page-1)*pageSize+idx+1}}</td>
                            <td>{{ data.soDx }}</td>
                            <td>{{ data.tenDvi}}</td>
                            <td>{{ data.soLuong }}</td>
                            <td>{{ data.giaDn }}</td>
                            <td>{{ data.giaDnVat }}</td>
                        </tr>
                    </tbody>
                </nz-table>
            </nz-card>
            <form nzLayout="vertical" nz-form [formGroup]="formData">
                <div nz-row [nzGutter]="20">
                    <div nz-col nzSpan="24">
                        <nz-form-item class="form-item">
                            <nz-form-label>
                                Ghi chú
                            </nz-form-label>
                            <nz-form-control>
                                <textarea nz-input [rows]="3" formControlName="ghiChu"></textarea>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </div>
            </form>
        </div>
    </div>
</ng-container>
<ng-template #templateSub>
    <app-them-moi-to-trinh-pag [type]="type" [isView]="isView" [idInput]="formData.value.id" (onClose)="reOpenMain()">
    </app-them-moi-to-trinh-pag>
</ng-template>
