<nz-affix class="menu-lv3" [nzOffsetTop]="43">
  <div class="tab-content tab-menu" id="myTabContent">
    <div class="tab-pane fade show active justify-content-between" id="banhanh" role="tabpanel"
      aria-labelledby="banhanh-tab">
      <div class="trai">
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="redirectChiTieuKeHoachNam()">
          <i class="fa fa-arrow-circle-left"></i>
        </a>
        <nz-breadcrumb>
          <nz-breadcrumb-item>
            <a routerLink="kehoach/chi-tieu-ke-hoach-nam-cap-tong-cuc">Giao chỉ tiêu kế hoạch đầu năm</a>
          </nz-breadcrumb-item>
          <nz-breadcrumb-item
            [ngClass]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH ? '' : 'last-breadcrumb'">
            {{lastBreadcrumb}}</nz-breadcrumb-item>
          <nz-breadcrumb-item
            *ngIf="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET"
            [ngClass]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET ? 'last-breadcrumb' : ''">Dự
            thảo
          </nz-breadcrumb-item>
          <nz-breadcrumb-item
            [ngClass]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH ? 'last-breadcrumb' : ''"
            *ngIf="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH">Ban hành
          </nz-breadcrumb-item>
        </nz-breadcrumb>
      </div>
      <div class="canphai phai">
        <button class="btn btn-main btn-sm waves-effect waves-light" (click)="save()"
          [disabled]="!formData.valid || canCuList.length === 0" *ngIf="thongTinChiTieuKeHoachNam.trangThai === globals.prop.DU_THAO || id===0 
          || thongTinChiTieuKeHoachNam.trangThai == globals.prop.TU_CHOI
          || thongTinChiTieuKeHoachNam.trangThai == globals.prop.DU_THAO_TRINH_DUYET">
          <i class="icon htvbdh_tcdt_save"></i>
          <span>Lưu</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="guiDuyet()"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai == globals.prop.DU_THAO || id == 0 || thongTinChiTieuKeHoachNam.trangThai == globals.prop.TU_CHOI"
          [disabled]="!formData.valid">
          <i class="icon htvbdh_tcdt_guiduyet"></i>
          <span>Gửi duyệt</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="pheDuyet()"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai == globals.prop.LANH_DAO_DUYET">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Phê duyệt</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai == globals.prop.DU_THAO_TRINH_DUYET">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Duyệt</span>
        </button>
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="tuChoi()"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai == globals.prop.LANH_DAO_DUYET || thongTinChiTieuKeHoachNam.trangThai == globals.prop.DU_THAO_TRINH_DUYET ">
          <i class="icon htvbdh_tcdt_tuchoi"></i>
          <span>Từ chối</span>
        </a>
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="huyBo()" *ngIf="thongTinChiTieuKeHoachNam.trangThai === globals.prop.DU_THAO || id===0 
          || thongTinChiTieuKeHoachNam.trangThai == globals.prop.TU_CHOI 
          || thongTinChiTieuKeHoachNam.trangThai == globals.prop.DU_THAO_TRINH_DUYET">
          <i class="icon htvbdh_tcdt_delete"></i>
          <span>Hủy bỏ</span>
        </a>
      </div>
    </div>
  </div>
</nz-affix>
<div class="contentBor chi-tieu__body">
  <div class="contentDetail">
    <div class="main-content">
      <!-- <nz-card nzTitle="Thông tin chỉ tiêu kế hoạch năm Tổng Cục giao" class="mt16 flex-card p-lr16"> -->
      <div class="thong-tin-chi-tieu">
        <div class="title-chi-tieu">
          <span *ngIf="id === 0" class="du-thao-va-lanh-dao-duyet">
            Dự Thảo
          </span>
          <span *ngIf="id > 0"
            [ngClass]="thongTinTrangThai(thongTinChiTieuKeHoachNam.trangThai)">{{thongTinChiTieuKeHoachNam.tenTrangThai}}</span>
          <span>Thông tin chỉ tiêu kế hoạch năm Tổng Cục giao</span>
        </div>
        <form nz-form [formGroup]="formData" class="mt-16">
          <div nz-row [nzGutter]="[16, 12]">
            <div nz-col nzSpan="2">
              <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true" class="text-left"> Số QĐ </nz-form-label>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="22">
              <div nz-row [nzGutter]="[16, 12]">
                <div nz-col nzSpan="4">
                  <nz-form-item>
                    <nz-form-control [nzErrorTip]="soQDError">
                      <nz-input-group nzAddOnAfter="/{{userInfo.MA_QD}}">
                        <nz-input-number formControlName="soQD" [nzMin]="1" [nzMax]="globals.prop.MAX_INPUT"
                          nzPlaceHolder="Nhập số quyết định" [nzStep]="1" [nzSize]="'small'"
                          [nzDisabled]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET">
                        </nz-input-number>
                      </nz-input-group>
                      <ng-template #soQDError let-control>
                        <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
                      </ng-template>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="6">
                  <nz-form-item>
                    <nz-form-label [nzSpan]="6" nzRequired [nzNoColon]="true" class="text-left"> Ngày ký
                    </nz-form-label>
                    <nz-form-control nz-col [nzSpan]="18" [nzErrorTip]="ngayKyError">
                      <nz-date-picker class="search__input" [nzDisabledDate]="disabledStartDate" nzFormat="yyyy-MM-dd"
                        formControlName="ngayKy" nzPlaceHolder="Ngày ký"
                        [nzDisabled]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET">
                      </nz-date-picker>
                      <ng-template #ngayKyError let-control>
                        <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
                      </ng-template>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="7">
                  <nz-form-item>
                    <nz-form-label nz-col [nzSpan]="6" nzRequired [nzNoColon]="true" class="text-left"> Ngày hiệu lực
                    </nz-form-label>
                    <nz-form-control nz-col [nzSpan]="18" [nzErrorTip]="ngayHieuLucError">
                      <nz-date-picker #endDatePicker [nzDisabledDate]="disabledEndDate" nzFormat="yyyy-MM-dd"
                        formControlName="ngayHieuLuc" nzPlaceHolder="Ngày hiệu lực"
                        [nzDisabled]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET">
                      </nz-date-picker>
                      <ng-template #ngayHieuLucError let-control>
                        <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
                      </ng-template>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="7">
                  <nz-form-item>
                    <nz-form-label nz-col [nzSpan]="6" nzRequired [nzNoColon]="true" class="text-left"> Năm kế hoạch
                    </nz-form-label>
                    <nz-form-control nz-col [nzSpan]="18" [nzErrorTip]="namKeHoachError">
                      <nz-select formControlName="namKeHoach" (ngModelChange)="selectNam()"
                        [nzDisabled]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET">
                        <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
                      </nz-select>
                      <ng-template #namKeHoachError let-control>
                        <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
                      </ng-template>
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>
            </div>

            <div nz-col nzSpan="2">
              <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true" class="text-left"> Trích yếu </nz-form-label>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="22">
              <nz-form-item>
                <nz-form-control [nzErrorTip]="namKeHoachError">
                  <input formControlName="trichYeu" class="search__input" nz-input nzSize="small"
                    placeholder="Nhập chỉ tiêu"
                    [readonly]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET" />
                </nz-form-control>
                <!-- <textarea formControlName="trichYeu" rows="3" class="search__input" nz-input
                    [readonly]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET"
                    [ngClass]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET ? 'disable' : ''"></textarea> -->
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="2">
              <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true" class="text-left"> Căn cứ </nz-form-label>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="22">
              <!-- <input nz-input formControlName="canCu" placeHolder="Chọn căn cứ" /> -->
              <multiple-tag buttonName="Chọn file" placeHolder="Chọn căn cứ" icon="htvbdh_chuyen-vao-thu-vien"
                [data]="canCuList" [trangThai]="thongTinChiTieuKeHoachNam.trangThai" type="file"
                (selectDataEvent)="openFileCanCu($event)" (removeDataEvent)="deleteCanCuTag($event)">
              </multiple-tag>
            </div>
            <div nz-col [nzSpan]="2">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" class="text-left"> Tài liệu đính kèm </nz-form-label>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="22">
              <multiple-tag buttonName="Chọn file" placeHolder="Chọn tài liệu đính kèm" icon="icon htvbdh_tcdt_tep"
                [data]="taiLieuDinhKemList" [trangThai]="thongTinChiTieuKeHoachNam.trangThai" type="file"
                (selectDataEvent)="openFile($event)" (removeDataEvent)="deleteTaiLieuDinhKemTag($event)">
              </multiple-tag>
            </div>


            <!-- <div nz-col nzSpan="6" class="tai-lieu-dinh-kem">
              <button class="btn btn-tep btn-sm waves-effect waves-light" (click)="selectFile('file-dinh-kem')"
                [disabled]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET">
                <i class="icon htvbdh_tcdt_tep"></i>
                <span>Tài liệu đính kèm</span>
              </button>
              <input type="file" id="file-dinh-kem" class="file-not-show" (change)="uploadFile($event)" />
            </div> -->
          </div>
        </form>
      </div>
      <!-- </nz-card> -->
      <div class="tab__container">
        <nz-tabset nzType="card" class="tab__container">
          <nz-tab [nzTitle]="'Kế hoạch lương thực dự trữ nhà nước'" (nzClick)="selectTabData(tab.luongThuc)">
          </nz-tab>
          <nz-tab [nzTitle]="'Kế hoạch muối dự trữ nhà nước'" (nzClick)="selectTabData(tab.muoi)">
          </nz-tab>
          <nz-tab [nzTitle]="'Kế hoạch nhập vật tư, thiết bị'" class="vat-tu__container"
            (nzClick)="selectTabData(tab.vatTu)">
          </nz-tab>
        </nz-tabset>
        <div id="table-luong-thuc"
          [ngClass]="tabSelected == tab.luongThuc ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
          <nz-table #groupingTable [nzData]="dsKeHoachLuongThucClone" nzBordered class="table__body"
            [nzFrontPagination]="false" [nzShowPagination]="false">
            <thead>
              <tr>
                <th rowspan="4" class="text-center">STT</th>
                <th rowspan="4" class="text-center">CỤC DTNN KHU VỰC</th>
                <th colspan="8" class="text-center">Tồn kho đầu năm (1) <br />( 01/01/{{yearNow}})</th>
                <th colspan="3" class="text-center">Nhập trong năm (2)</th>
                <th colspan="8" class="text-center">Xuất trong năm (3)</th>
                <th colspan="3" class="text-center">Tồn kho cuối năm (4)
                  <br>
                  ( 31/12/{{yearNow}})
                </th>
                <!-- <th rowspan="4">Trạng thái</th> -->
                <th rowspan="4" *ngIf="disableBanHanh()" class="text-center">Hành động</th>
              </tr>
              <tr>
                <th rowspan="3" class="text-center">
                  Tổng số
                  <br />
                  (quy thóc)
                </th>
                <th colspan="7" class="text-center">Trong đó</th>
                <th rowspan="3" class="text-center">
                  Tổng số
                  <br />
                  (quy thóc)
                </th>
                <th colspan="2" class="text-center">Trong đó</th>
                <th rowspan="3" class="text-center">
                  Tổng số
                  <br />
                  (quy thóc)
                </th>
                <th colspan="7" class="text-center">Trong đó</th>
                <th rowspan="3" class="text-center">Tổng số
                  <br>
                  (quy thóc)
                </th>
                <th colspan="2" class="text-center">Trong đó</th>
              </tr>
              <tr>
                <th colspan="4" class="text-center">Thóc (Tấn)</th>
                <th colspan="3" class="text-center">Gạo (Tấn)</th>
                <th rowspan="2" class="text-center">Thóc (Tấn)</th>
                <th rowspan="2" class="text-center">Gạo (Tấn)</th>
                <th colspan="4" class="text-center">Thóc (Tấn)</th>
                <th colspan="3" class="text-center">Gạo (Tấn)</th>
                <th rowspan="2" class="text-center">Thóc (Tấn)</th>
                <th rowspan="2" class="text-center">Gạo (Tấn)</th>
              </tr>
              <tr>
                <th>Tổng</th>
                <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
                <th class="text-center">Tổng</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
                <th class="text-center">Tổng</th>
                <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
                <th class="text-center">Tổng</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
              </tr>
            </thead>
            <tbody>
              <tr [ngClass]="disableBanHanh() ? '' : 'row-disabled'">
                <td></td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input">
                      <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input
                        (input)="onInput($event,'luong-thuc')" [nzAutocomplete]="auto" class="w-300"
                        [(ngModel)]="keHoachLuongThucCreate.tenDonvi"
                        [readonly]="userInfo.CAP_DVI === globals.prop.CUC" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #auto (selectionChange)="selectDonViKeyDown($event,'khlt')" [nzBackfill]="false">
                      <ng-container *ngIf="userInfo.CAP_DVI !== globals.prop.CUC">
                        <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                          (click)="selectDonViKHLT(option)">
                          {{ option.labelDonVi }}
                        </nz-auto-option>
                      </ng-container>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td class="text-right">{{calculatortkdnTongQuyThocCreate()}}</td>
                <td class="text-right">{{calculatortkdnTongThocCreate()}}
                </td>
                <td class="text-right">{{this.keHoachLuongThucCreate.tkdnThoc[0].soLuong}}</td>
                <td class="text-right">{{this.keHoachLuongThucCreate.tkdnThoc[1].soLuong}}</td>
                <td class="text-right">{{this.keHoachLuongThucCreate.tkdnThoc[2].soLuong}}</td>
                <td class="text-right">{{calculatortkdnTongGaoCreate()}}</td>
                <td class="text-right">{{this.keHoachLuongThucCreate.tkdnGao[0].soLuong}}</td>
                <td class="text-right">{{this.keHoachLuongThucCreate.tkdnGao[1].soLuong}}</td>
                <td class="text-right">{{calculatorntnTongQuyThocCreate()}}</td>
                <td class="text-right">
                  <nz-input-number [nzMin]="0" [nzMax]="globals.prop.MAX_INPUT" type="text" nz-input name="goiThau"
                    class="w-120" [nzSize]="'small'" [(ngModel)]="keHoachLuongThucCreate.ntnThoc">
                  </nz-input-number>
                </td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'" [(ngModel)]="keHoachLuongThucCreate.ntnGao">
                  </nz-input-number>
                </td>
                <td class="text-right">{{calculatorxtnTongSoQuyThocCreate()}}</td>
                <td class="text-right">{{calculatorxtnTongThocCreate()}}</td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnThoc[0].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnThoc[0].soLuong"></nz-input-number>
                </td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnThoc[1].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnThoc[1].soLuong"></nz-input-number>
                </td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnThoc[2].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnThoc[2].soLuong"></nz-input-number>
                </td>
                <td class="text-right">{{calculatorxtnTongGaoCreate()}}</td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnGao[0].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnGao[0].soLuong"></nz-input-number>
                </td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnGao[1].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnGao[1].soLuong"></nz-input-number>
                </td>
                <td class="text-right">{{calculatortkcnTongSoQuyThocCreate()}}</td>
                <td class="text-right">{{calculatortkcnTongThocCreate()}}</td>
                <td class="text-right">{{calculatortkcnTongGaoCreate()}}</td>
                <!-- <td class="background-last-row"></td> -->
                <td class="background-last-row" *ngIf="disableBanHanh()">
                  <a class="save" (click)="themMoiKHLT()" [ngClass]="{'isDisabled': !isAddLuongThuc}">
                    <i class="icon htvbdh_dau-cong"></i>
                  </a>
                  <a (click)="clearKHLT()" [ngClass]="{'isDisabled': !isAddLuongThuc}">
                    <i class="fa fa-trash-o do"></i>
                  </a>
                </td>
              </tr>
              <tr *ngFor="let data of groupingTable.data, let i = index">
                <ng-container *ngIf="!dsKeHoachLuongThucClone[i]?.isEdit; else editTemplate">
                  <td class="text-right">{{data.stt}}</td>
                  <td class="text-left">{{data.tenDonvi}}</td>
                  <td class="text-right">{{data.tkdnTongSoQuyThoc | number:
                    '1.0-1'}}</td>
                  <td class="text-right">{{data.tkdnTongThoc | number: '1.0-1'}}
                  </td>
                  <ng-container *ngIf="data?.tkdnThoc?.length > 0">
                    <td *ngFor="let item of data.tkdnThoc" class="text-right">
                      {{item.soLuong | number: '1.0-1'}}</td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnThoc?.length == 0">
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                  </ng-container>
                  <td class="text-right"> {{data.tkdnTongGao | number: '1.0-1'}} </td>
                  <ng-container *ngIf="data?.tkdnGao?.length > 0">
                    <td *ngFor="let item of data.tkdnGao" class="text-right"> {{item.soLuong | number: '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnGao?.length == 0">
                    <td class="text-right"> 0 </td>
                    <td class="text-right"> 0 </td>
                  </ng-container>
                  <td class="tong-so-quy-thoc" class="text-right"> {{data.ntnTongSoQuyThoc | number: '1.0-1'}}</td>
                  <td class="text-right">{{data.ntnThoc | number: '1.0-1'}}</td>
                  <td class="text-right">{{data.ntnGao | number: '1.0-1'}}</td>
                  <td class="text-right">{{data.xtnTongSoQuyThoc | number:
                    '1.0-1'}}</td>
                  <td class="text-right">{{data.xtnTongThoc | number: '1.0-1'}}
                  </td>
                  <ng-container *ngIf="data?.xtnThoc?.length > 0">
                    <td *ngFor="let item of data.xtnThoc" class="text-right">
                      {{item.soLuong | number: '1.0-1'}}</td>
                  </ng-container>
                  <ng-container *ngIf="data?.xtnThoc?.length == 0">
                    <td class="text-right">0 </td>
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                  </ng-container>
                  <td class="text-right">{{data.xtnTongGao | number: '1.0-1'}}
                  </td>
                  <ng-container *ngIf="data?.xtnGao?.length > 0">
                    <td *ngFor="let item of data.xtnGao" class="text-right">
                      {{item.soLuong | number: '1.0-1'}}</td>
                  </ng-container>
                  <ng-container *ngIf="data?.xtnGao?.length == 0">
                    <td class="text-right">0 </td>
                    <td class="text-right">0</td>
                  </ng-container>
                  <td class="text-right">{{data.tkcnTongSoQuyThoc | number:
                    '1.0-1'}}</td>
                  <td class="text-right">{{data.tkcnTongThoc | number: '1.0-1'}}
                  </td>
                  <td class="text-right">{{data.tkcnTongGao | number: '1.0-1'}}
                  </td>
                  <!-- <td>{{ convertTrangThai(thongTinChiTieuKeHoachNam.trangThai) }}</td> -->
                  <td *ngIf="thongTinChiTieuKeHoachNam.trangThai === globals.prop.DU_THAO || id===0 ">
                    <a (click)="startEdit(i)">
                      <i class="fa fa-pencil"></i>
                    </a>
                    <a (click)="deleteKeHoachLuongThuc(data.stt)">
                      <i class="fa fa-trash-o do"></i>
                    </a>
                  </td>
                  <td *ngIf="data.stt == null" class="background-last-row"></td>
                  <td *ngIf="data.stt ==  null" class="background-last-row"></td>
                </ng-container>
                <ng-template #editTemplate>
                  <td class="text-right">{{data.stt}}</td>
                  <td class="text-left">{{data.tenDonvi}}</td>
                  <td class="text-right">{{data.tkdnTongSoQuyThoc | number:
                    '1.0-1'}}</td>
                  <td class="text-right">{{data.tkdnTongThoc | number: '1.0-1'}}
                  </td>
                  <ng-container *ngIf="data?.tkdnThoc?.length > 0">
                    <td *ngFor="let item of data.tkdnThoc" class="text-right">
                      {{item.soLuong | number: '1.0-1'}}</td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnThoc?.length == 0">
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                  </ng-container>
                  <td class="text-right"> {{data.tkdnTongGao | number: '1.0-1'}} </td>
                  <ng-container *ngIf="data?.tkdnGao?.length > 0">
                    <td *ngFor="let item of data.tkdnGao" class="text-right"> {{item.soLuong | number: '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnGao?.length == 0">
                    <td class="text-right"> 0 </td>
                    <td class="text-right"> 0 </td>
                  </ng-container>
                  <td class="text-right">
                    {{calculatorntnTongSoQuyThoc(i)}}
                  </td>
                  <td class="text-right">
                    <nz-input-number [nzMin]="0" [nzMax]="globals.prop.MAX_INPUT" type="text" nz-input
                      [(ngModel)]="dsKeHoachLuongThucClone[i].ntnThoc" name="goiThau" class="w-200" [nzSize]="'small'">
                    </nz-input-number>
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].ntnGao" name="goiThau"
                      class="w-200" [nzMin]="0" [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td class="text-right">
                    {{calculatorxtnTongSoQuyThoc(i)}}
                  </td>
                  <td class="text-right">
                    {{calculatorxtnTongThoc(i)}}
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnThoc[0].soLuong"
                      name="goiThau" class="w-200" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnThoc[0].soLuong"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnThoc[1].soLuong"
                      name="goiThau" class="w-200" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnThoc[1].soLuong"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnThoc[2].soLuong"
                      name="goiThau" class="w-200" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnThoc[2].soLuong"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td class="text-right">
                    {{calculatorxtnTongGao(i)}}
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnGao[0].soLuong"
                      name="goiThau" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnGao[0].soLuong" class="w-200"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnGao[1].soLuong"
                      name="goiThau" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnGao[1].soLuong" class="w-200"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td class="text-right">
                    {{ calculatortkcnTongSoQuyThoc(i)}}
                  </td>
                  <td class="text-right">
                    {{ calculatortkcnTongThoc(i)}}
                  </td>
                  <td class="text-right">
                    {{calculatortkcnTongGao(i)}}
                  </td>
                  <!-- <td></td> -->
                  <td>
                    <a (click)="saveEdit(i)" class="save">
                      <i class="fa fa-save"></i>
                    </a>
                    <a (click)="cancelEdit(i)">
                      <i class="fa fa-times do"></i>
                    </a>
                  </td>
                </ng-template>
              </tr>
              <tr *ngIf="thongTinChiTieuKeHoachNam?.khLuongThuc?.length > 0">
                <td colspan="2" class="first-last-row-table background-last-row">Cộng</td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 2, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 3, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 4, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 5, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 6, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 7, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 8, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 9, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 10, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 11, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 12, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 13, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 14, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 15, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 16, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 17, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 18, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 19, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 20, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 21, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 22, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 23, 5,
                  ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <!-- <td class="background-last-row"></td> -->
                <td class="background-last-row" *ngIf="thongTinChiTieuKeHoachNam.trangThai===globals.prop.DU_THAO || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai===globals.prop.TU_CHOI"></td>
              </tr>
            </tbody>
          </nz-table>
          <div class="tab-content tab-menu">
            <div class="tab-pane fade show active justify-content-between">
              <div class="trai">
              </div>
              <div class="canphai">
                <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                  [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate" (nzPageIndexChange)="changePageIndex($event)"
                  (nzPageSizeChange)="changePageSize($event)">
                  <ng-template #rangeTemplate let-range="range" let-total>
                    {{ range[0] }}-{{ range[1] }} of {{ total }} items
                  </ng-template>
                </nz-pagination>
              </div>
            </div>
          </div>
        </div>
        <div id="table-muoi"
          [ngClass]="tabSelected == tab.muoi ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
          <nz-table #groupingTableMuoi [nzData]="dsMuoiClone" nzBordered class="table__body" [nzFrontPagination]="false"
            [nzShowPagination]="false">
            <thead>
              <tr>
                <th rowspan="3" class="text-center">STT</th>
                <th rowspan="3" class="text-center">CỤC DTNN KHU VỰC</th>
                <th colspan="4" class="text-center">Tồn kho đầu năm (1) <br />( 01/01/{{yearNow}})</th>
                <th class="text-center">Nhập trong năm (2)</th>
                <th colspan="4 " class="text-center">Xuất trong năm (3)</th>
                <th class="text-center">Tồn kho cuối năm (4)
                  <br>
                  ( 31/12/{{yearNow}})
                </th>
                <!-- <th rowspan="3" *ngIf="thongTinChiTieuKeHoachNam.trangThai===globals.prop.DU_THAO || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai===globals.prop.TU_CHOI">Trạng thái</th> -->
                <th rowspan="3" *ngIf="thongTinChiTieuKeHoachNam.trangThai===globals.prop.DU_THAO || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai===globals.prop.TU_CHOI" class="text-center">Hành động</th>
              </tr>
              <tr>
                <th rowspan="2" class="text-center">
                  Tổng số
                </th>
                <th colspan="3" class="text-center">Trong đó</th>
                <th rowspan="2" class="text-center">
                  Tổng số
                </th>
                <th rowspan="2" class="text-center">
                  Tổng số
                </th>
                <th colspan="3" class="text-center">Trong đó</th>
                <th rowspan="2" class="text-center">
                  Tổng số
                </th>
              </tr>
              <tr>
                <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 3}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 2}}</th>
                <th class="text-center">Nhập <br> {{yearNow - 1}}</th>
              </tr>
            </thead>
            <tbody>
              <tr [ngClass]="thongTinChiTieuKeHoachNam.trangThai===globals.prop.DU_THAO || id===0 ||
              thongTinChiTieuKeHoachNam.trangThai===globals.prop.TU_CHOI ? '' : 'row-disabled'">
                <td></td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input (input)="onInput($event, 'muoi')"
                        [nzAutocomplete]="autoMuoi" class="" [(ngModel)]="keHoachMuoiCreate.tenDonVi"
                        (input)="changeDonViMuoi()" [readonly]="userInfo.CAP_DVI === globals.prop.CUC" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoMuoi (selectionChange)="selectDonViKeyDown($event,'kh-muoi')"
                      [nzBackfill]="false">
                      <ng-container *ngIf="userInfo.CAP_DVI !== globals.prop.CUC">
                        <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                          (click)="selectDonViMuoi(option)">
                          {{ option.labelDonVi }}
                        </nz-auto-option>
                      </ng-container>

                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td class="text-right">{{calculatortkdnTongMuoiCreate()}}</td>
                <td class="text-right">{{keHoachMuoiCreate.tkdnMuoi[0].soLuong}}</td>
                <td class="text-right">{{keHoachMuoiCreate.tkdnMuoi[1].soLuong}}</td>
                <td class="text-right">{{keHoachMuoiCreate.tkdnMuoi[2].soLuong}}</td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'" [(ngModel)]="keHoachMuoiCreate.ntnTongSoMuoi">
                  </nz-input-number>
                </td>
                <td class="text-right">{{calculatorxtnTongMuoiCreate()}}</td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachMuoiCreate.tkdnMuoi[0].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachMuoiCreate.xtnMuoi[0].soLuong">
                  </nz-input-number>
                </td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachMuoiCreate.tkdnMuoi[1].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachMuoiCreate.xtnMuoi[1].soLuong">
                  </nz-input-number>
                </td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachMuoiCreate.tkdnMuoi[2].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachMuoiCreate.xtnMuoi[2].soLuong">
                  </nz-input-number>
                </td>
                <td class="text-right">{{calculatortkcnTongMuoiCreate()}}</td>
                <!-- <td *ngIf="thongTinChiTieuKeHoachNam.trangThai===globals.prop.DU_THAO || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai===globals.prop.TU_CHOI"></td> -->
                <td *ngIf="thongTinChiTieuKeHoachNam.trangThai===globals.prop.DU_THAO || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai===globals.prop.TU_CHOI">
                  <a class="save" (click)="themMoiMuoiDuTru()" [ngClass]="{'isDisabled': !isAddMuoi}">
                    <i class="icon htvbdh_dau-cong"></i>
                  </a>
                  <a (click)="clearMuoiDuTru()" [ngClass]="{'isDisabled': !isAddMuoi}">
                    <i class="fa fa-trash-o do"></i>
                  </a>
                </td>
              </tr>
              <tr *ngFor="let dataMuoi of groupingTableMuoi.data, let i = index">
                <ng-container *ngIf="!dsMuoiClone[i]?.isEdit; else editTemplateMuoi">
                  <td class="text-right">{{dataMuoi.stt}}</td>
                  <td class="text-left">{{dataMuoi.tenDonVi}}</td>
                  <td class="text-right">{{dataMuoi.tkdnTongSoMuoi | number: '1.0-1'}}</td>
                  <ng-container *ngIf="dataMuoi?.tkdnMuoi?.length > 0">
                    <td *ngFor="let itemMuoi of dataMuoi.tkdnMuoi" class="text-right">{{itemMuoi.soLuong | number:
                      '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="dataMuoi?.tkdnMuoi?.length == 0">
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                  </ng-container>
                  <td class="text-right">{{dataMuoi.ntnTongSoMuoi | number: '1.0-1'}}</td>
                  <td class="text-right">{{dataMuoi.xtnTongSoMuoi | number: '1.0-1'}}</td>
                  <ng-container *ngIf="dataMuoi?.xtnMuoi?.length > 0">
                    <td *ngFor="let itemMuoi of dataMuoi.xtnMuoi" class="text-right">{{itemMuoi.soLuong | number:
                      '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="dataMuoi?.xtnMuoi?.length == 0">
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                  </ng-container>
                  <td class="text-right">{{dataMuoi.tkcnTongSoMuoi | number: '1.0-1'}}</td>
                  <!-- <td *ngIf="disableBanHanh()">{{
                    convertTrangThai(thongTinChiTieuKeHoachNam.trangThai) }}</td> -->
                  <td *ngIf="disableBanHanh()">
                    <a (click)="startEditMuoi(i)">
                      <i class="fa fa-pencil"></i>
                    </a>
                    <a (click)="deleteKeHoachMuoi(dataMuoi.stt)">
                      <i class="fa fa-trash-o do"></i>
                    </a>
                  </td>
                </ng-container>
                <ng-template #editTemplateMuoi>
                  <td class="text-right">{{dataMuoi.stt}}</td>
                  <td class="text-left">{{dataMuoi.tenDonVi}}</td>
                  <td>{{dataMuoi.tkdnTongSoMuoi | number: '1.0-1'}}</td>
                  <ng-container *ngIf="dataMuoi?.tkdnMuoi?.length > 0">
                    <td *ngFor="let itemMuoi of dataMuoi.tkdnMuoi" class="text-right">{{itemMuoi.soLuong | number:
                      '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="dataMuoi?.tkdnMuoi?.length == 0">
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                  </ng-container>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'" [(ngModel)]="dsMuoiClone[i].ntnTongSoMuoi">
                    </nz-input-number>
                  </td>
                  <td class="text-right">{{calculatorxtnTongSoMuoi(i)}}</td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="dsMuoiClone[i].tkdnMuoi[0].soLuong" [nzSize]="'small'"
                      [(ngModel)]="dsMuoiClone[i].xtnMuoi[0].soLuong">
                    </nz-input-number>
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="dsMuoiClone[i].tkdnMuoi[1].soLuong" [nzSize]="'small'"
                      [(ngModel)]="dsMuoiClone[i].xtnMuoi[1].soLuong">
                    </nz-input-number>
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="dsMuoiClone[i].tkdnMuoi[2].soLuong" [nzSize]="'small'"
                      [(ngModel)]="dsMuoiClone[i].xtnMuoi[2].soLuong">
                    </nz-input-number>
                  </td>
                  <td class="text-right">{{calculatortkcnTongSoMuoi(i)}}</td>
                  <!-- <td *ngIf="disableBanHanh()"></td> -->
                  <td *ngIf="disableBanHanh()">
                    <a (click)="saveEditMuoi(i)" class="save">
                      <i class="fa fa-save"></i>
                    </a>
                    <a (click)="cancelEditMuoi(i)">
                      <i class="fa fa-times do"></i>
                    </a>
                  </td>
                </ng-template>
              </tr>

              <tr *ngIf="thongTinChiTieuKeHoachNam?.khMuoiDuTru?.length > 0">
                <td colspan="2" class="first-last-row-table background-last-row">Cộng</td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 2, 4, ',', 'table-muoi') : 0
                  |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 3, 4, ',', 'table-muoi') : 0
                  |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 4, 4, ',', 'table-muoi') : 0
                  |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 5, 4, ',', 'table-muoi') : 0
                  |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 6, 4, ',', 'table-muoi') : 0
                  |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 7, 4, ',', 'table-muoi') : 0
                  |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 8, 4, ',', 'table-muoi') : 0
                  |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 9, 4, ',', 'table-muoi') : 0
                  |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 10, 4, ',', 'table-muoi') :
                  0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 11, 4, ',', 'table-muoi') :
                  0 |
                  number:
                  '1.0-1'}}
                </td>
                <!-- <td class="background-last-row" *ngIf="disableBanHanh()"></td> -->
                <td class="background-last-row" *ngIf="disableBanHanh()"></td>
              </tr>
            </tbody>
          </nz-table>
          <div class="tab-content tab-menu">
            <div class="tab-pane fade show active justify-content-between">
              <div class="trai">
              </div>
              <div class="canphai">
                <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                  [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate" (nzPageIndexChange)="changePageIndex($event)"
                  (nzPageSizeChange)="changePageSize($event)">
                  <ng-template #rangeTemplate let-range="range" let-total>
                    {{ range[0] }}-{{ range[1] }} of {{ total }} items
                  </ng-template>
                </nz-pagination>
              </div>
            </div>
          </div>
        </div>
        <div id="table-vat-tu"
          [ngClass]="tabSelected == tab.vatTu ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
          <nz-table #groupingTableVatTu [nzData]="dsVatTuClone" nzBordered class="table__body"
            [nzFrontPagination]="false" [nzShowPagination]="false">
            <thead>
              <tr>
                <th rowspan="3" class="text-center">STT</th>
                <th rowspan="3" class="text-center">CỤC DTNN KHU VỰC</th>
                <th rowspan="3" class="text-center">Mã hàng</th>
                <th rowspan="3" class="text-center">Ký hiệu</th>
                <th rowspan="3" class="text-center">Tên hàng</th>
                <th rowspan="3" class="text-center">Chủng loại hàng</th>
                <th rowspan="3" class="text-center">ĐƠN VỊ TÍNH</th>
                <th colspan="6" class="text-center">CHỈ TIÊU NHẬP TRONG NĂM KẾ HOẠCH NĂM</th>
                <th rowspan="3" *ngIf="disableBanHanh()" class="text-center">HÀNH ĐỘNG</th>
              </tr>
              <tr>
                <th rowspan="2" class="text-center">
                  Tổng số
                </th>
                <th colspan="4" class="text-center">Chỉ tiêu nhập các năm trước chuyển</th>
                <th rowspan="2" class="text-center">
                  Kế hoạch năm hiện tại
                </th>
              </tr>
              <tr>
                <th class="text-center">Tổng</th>
                <th class="text-center">KH năm <br> (1)</th>
                <th class="text-center">KH năm <br> (2)</th>
                <th class="text-center">KH năm <br> (3)</th>
              </tr>
            </thead>
            <tbody>
              <tr [ngClass]="disableBanHanh() ? '' : 'row-disabled'">
                <td></td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input (input)="onInput($event,'vat-tu')"
                        [nzAutocomplete]="autoDonViVatTu" class="" [(ngModel)]="keHoachVatTuCreate.tenDonVi"
                        [readonly]="userInfo.CAP_DVI === globals.prop.CUC" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoDonViVatTu (selectionChange)="selectDonViKeyDown($event,'kh-vat-tu')"
                      [nzBackfill]="false">
                      <ng-container *ngIf="userInfo.CAP_DVI !== globals.prop.CUC">
                        <nz-auto-option *ngFor="let option of options" [nzValue]="option.tenDvi"
                          (click)="selectDonViVatTu(option)">
                          {{ option.labelDonVi }}
                        </nz-auto-option>
                      </ng-container>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td class="text-left">{{keHoachVatTuCreate.vatTuThietBi[0]?.maVatTuCha}}</td>
                <td class="text-left">{{keHoachVatTuCreate.vatTuThietBi[0]?.kyHieu}}</td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                        [nzAutocomplete]="autoVatTu" class=""
                        [(ngModel)]="keHoachVatTuCreate.vatTuThietBi[0].tenVatTuCha"
                        [title]="keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTuCha ? keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTuCha : ''" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoVatTu>
                      <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                        (click)="selectTenHang(vatTuCha)">
                        {{ vatTuCha.ten }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input w-300">
                      <input nz-input (input)="onInputChungLoaiHang($event)" [nzAutocomplete]="autoChungLoaiHang"
                        class="" [(ngModel)]="keHoachVatTuCreate.vatTuThietBi[0].tenVatTu"
                        [title]="keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTu ? keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTu : ''"
                        [disabled]="dataVatTuConClone.length == 0"
                        [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoChungLoaiHang>
                      <nz-auto-option *ngFor="let vatTuCon of dataVatTuConShow" [nzValue]="vatTuCon.ten"
                        (click)="selectChungLoaiHang(vatTuCon)">
                        {{ vatTuCon.ten }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td class="text-left">
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.donViTinh}}
                </td>
                <td class="text-right">{{keHoachVatTuCreate.vatTuThietBi[0]?.tongNhap | number: '1.0-1'}}</td>
                <td class="text-right">
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.tongCacNamTruoc | number: '1.0-1'}}
                </td>
                <td class="text-right">
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.cacNamTruoc[0]?.soLuong | number: '1.0-1'}}
                </td>
                <td class="text-right">
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.cacNamTruoc[1]?.soLuong | number: '1.0-1'}}
                </td>
                <td class="text-right">
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.cacNamTruoc[2]?.soLuong | number: '1.0-1'}}
                </td>
                <td class="text-right">
                  <nz-input-number type="text" nz-input name="khNamHienTai" class="w-120" [nzMin]="0"
                    [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'"
                    [(ngModel)]="keHoachVatTuCreate.vatTuThietBi[0].nhapTrongNam" (input)="calculatorTongChiTieuNtn()">
                  </nz-input-number>
                </td>
                <td *ngIf="disableBanHanh()">
                  <a class="save" (click)="themMoiVatTu()" [ngClass]="{'isDisabled': !isAddVatTu}">
                    <i class="icon htvbdh_dau-cong"></i>
                  </a>
                  <a (click)="clearVatTu()" [ngClass]="{'isDisabled': !isAddVatTu}">
                    <i class="fa fa-trash-o do"></i>
                  </a>
                </td>
              </tr>
              <tr *ngFor="let dataVatTu of groupingTableVatTu.data, let i = index">
                <ng-container *ngIf="!dsVatTuClone[i]?.isEdit; else editTemplateVatTu">
                  <td class="text-right">{{dataVatTu.stt}}</td>
                  <td class="text-left">{{dataVatTu.tenDonVi}}</td>
                  <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.maVatTuCha}}</td>
                  <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.kyHieu}}</td>
                  <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.tenVatTuCha}}</td>
                  <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.tenVatTu}}</td>
                  <td class="text-left">{{dataVatTu.vatTuThietBi[0]?.donViTinh}}</td>
                  <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.tongNhap | number: '1.0-1'}}</td>
                  <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.tongCacNamTruoc | number: '1.0-1'}}</td>
                  <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.cacNamTruoc[0]?.soLuong | number: '1.0-1'}}</td>
                  <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.cacNamTruoc[1]?.soLuong | number: '1.0-1'}}</td>
                  <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.cacNamTruoc[2]?.soLuong | number: '1.0-1'}}</td>
                  <td class="text-right">{{dataVatTu.vatTuThietBi[0]?.nhapTrongNam | number: '1.0-1'}}</td>
                  <td *ngIf="disableBanHanh()">
                    <a (click)="startEditVatTu(i)">
                      <i class="fa fa-pencil"></i>
                    </a>
                    <a (click)="deleteKeHoachVatTu(dataVatTu.stt)">
                      <i class="fa fa-trash-o do"></i>
                    </a>
                  </td>
                </ng-container>
                <ng-template #editTemplateVatTu>
                  <td class="text-right">{{dsVatTuClone[i].stt}}</td>
                  <td class="text-left">{{dsVatTuClone[i].tenDonVi}}</td>
                  <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.maVatTuCha}}</td>
                  <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.kyHieu}}</td>
                  <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.tenVatTuCha}}</td>
                  <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.tenVatTu}}</td>
                  <td class="text-left">{{dsVatTuClone[i].vatTuThietBi[0]?.donViTinh}}</td>
                  <td class="text-right">{{calculatorTongChiTieuNhaptrongNam(i)}}</td>
                  <td class="text-right">{{dsVatTuClone[i].vatTuThietBi[0]?.tongCacNamTruoc | number: '1.0-1'}}</td>
                  <td class="text-right">{{dsVatTuClone[i].vatTuThietBi[0]?.cacNamTruoc[0]?.soLuong | number: '1.0-1'}}
                  </td>
                  <td class="text-right">{{dsVatTuClone[i].vatTuThietBi[0]?.cacNamTruoc[1]?.soLuong | number: '1.0-1'}}
                  </td>
                  <td class="text-right">{{dsVatTuClone[i].vatTuThietBi[0]?.cacNamTruoc[2]?.soLuong | number: '1.0-1'}}
                  </td>
                  <td class="text-right">
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'"
                      [(ngModel)]="dsVatTuClone[i].vatTuThietBi[0].nhapTrongNam">
                    </nz-input-number>
                  </td>
                  <td *ngIf="disableBanHanh()">
                    <a (click)="saveEditVatTu(i)" class="save">
                      <i class="fa fa-save"></i>
                    </a>
                    <a (click)="cancelEditVatTu(i)">
                      <i class="fa fa-times do"></i>
                    </a>
                  </td>
                </ng-template>
              </tr>
              <tr *ngIf="thongTinChiTieuKeHoachNam?.khVatTu.length > 0">
                <td colspan="2" class="first-last-row-table background-last-row">Cộng</td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 7, 4, ',','table-vat-tu') :
                  0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 8, 4, ',','table-vat-tu') :
                  0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 9, 4, ',','table-vat-tu') :
                  0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 10, 4, ',','table-vat-tu') :
                  0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 11, 4, ',','table-vat-tu') :
                  0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row text-right">{{ tableExist ? reduceRowData(0, 12, 4, ',','table-vat-tu') :
                  0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row" *ngIf="disableBanHanh()">
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="tab-content tab-menu">
            <div class="tab-pane fade show active justify-content-between">
              <div class="trai">
              </div>
              <div class="canphai">
                <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                  [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate" (nzPageIndexChange)="changePageIndex($event)"
                  (nzPageSizeChange)="changePageSize($event)">
                  <ng-template #rangeTemplate let-range="range" let-total>
                    {{ range[0] }}-{{ range[1] }} of {{ total }} items
                  </ng-template>
                </nz-pagination>
              </div>
            </div>
          </div>
        </div>
        <div class="tep" (click)="downloadTemplate()"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai === globals.prop.DU_THAO || id===0 || thongTinChiTieuKeHoachNam.trangThai === globals.prop.TU_CHOI">
          <i class="icon htvbdh_tcdt_tep"></i>
          <span>biểu mẫu nhập dữ liệu Lương thực.xlsx</span>
        </div>
        <div class="action">
          <!-- <button type="button" class="btn btn-main" (click)="themMoi()"
            *ngIf="thongTinChiTieuKeHoachNam.trangThai === globals.prop.DU_THAO  || id===0 || thongTinChiTieuKeHoachNam.trangThai === globals.prop.TU_CHOI">
            <i class="icon htvbdh_dau-cong"></i>
            <span>Thêm</span>
          </button> -->
          <button type="button" class="btn btn-sub" (click)="selectFile('file-import-data')"
            *ngIf="thongTinChiTieuKeHoachNam.trangThai === globals.prop.DU_THAO || id===0 || thongTinChiTieuKeHoachNam.trangThai === globals.prop.TU_CHOI">
            <i class="icon htvbdh_tcdt_import"></i>
            <span>Import</span>
          </button>
          <input type="file" id="file-import-data" class="file-not-show" (change)="importFileData($event)" />
          <button type="button" class="btn btn-sub" (click)="exportData()">
            <i class="icon htvbdh_chuyen-xu-ly"></i>
            <span>Export</span>
          </button>
          <button type="button" class="btn btn-sub" (click)="printTable()">
            <i class="icon htvbdh_tcdt_print"></i>
            <span>In</span>
          </button>
        </div>
      </div>
      <div class="ghi-chu">
        <form nz-form [formGroup]="formData" class="mt-16">
          <div nz-row [nzGutter]="[16, 12]">
            <div nz-col [nzSpan]="24">
              <nz-form-item class="form-item-ghi-chu">
                <nz-form-label [nzNoColon]="true">
                  Ghi chú
                </nz-form-label>
                <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="soQDError">
                  <input nz-input nzSize="large" formControlName="ghiChu" style="height: 40px !important;"
                    [readonly]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET" />
                  <!-- <textarea rows="3" class="search__input" nz-input formControlName="ghiChu"
                    [readonly]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET"
                    [ngClass]="thongTinChiTieuKeHoachNam.trangThai === globals.prop.BAN_HANH || thongTinChiTieuKeHoachNam.trangThai === globals.prop.LANH_DAO_DUYET ? 'disable' : ''"></textarea> -->
                  <ng-template #soQDError let-control>
                    <ng-container *ngIf="control.hasError('required')">{{control.hasError('required')}}
                      {{errorInputRequired}}
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>