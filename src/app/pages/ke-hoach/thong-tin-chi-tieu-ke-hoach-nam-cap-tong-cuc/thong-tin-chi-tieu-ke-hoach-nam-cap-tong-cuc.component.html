<nz-affix class="menu-lv3" [nzOffsetTop]="43">
  <div class="tab-content tab-menu" id="myTabContent">
    <div class="tab-pane fade show active justify-content-between" id="banhanh" role="tabpanel"
      aria-labelledby="banhanh-tab">
      <div class="trai">
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="redirectChiTieuKeHoachNam()">
          <i class="fa fa-arrow-circle-left"></i>
        </a>
        <nz-breadcrumb>
          <nz-breadcrumb-item>
            <a [routerLink]="">Giao chỉ tiêu kế hoạch đầu năm</a>
          </nz-breadcrumb-item>
          <nz-breadcrumb-item [ngClass]="thongTinChiTieuKeHoachNam.trangThai === '02' ? '' : 'last-breadcrumb'">
            {{lastBreadcrumb}}</nz-breadcrumb-item>
          <nz-breadcrumb-item
            *ngIf="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01'"
            [ngClass]="thongTinChiTieuKeHoachNam.trangThai === '01' ? 'last-breadcrumb' : ''">Dự thảo
          </nz-breadcrumb-item>
          <nz-breadcrumb-item [ngClass]="thongTinChiTieuKeHoachNam.trangThai === '02' ? 'last-breadcrumb' : ''"
            *ngIf="thongTinChiTieuKeHoachNam.trangThai === '02'">Ban hành
          </nz-breadcrumb-item>
        </nz-breadcrumb>
      </div>
      <div class="canphai phai">
        <button class="btn btn-main btn-sm waves-effect waves-light" (click)="save()" [disabled]="!formData.valid"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai === '00' || id===0 || thongTinChiTieuKeHoachNam.trangThai == '03'">
          <i class="icon htvbdh_tcdt_save"></i>
          <span>Lưu</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="guiDuyet()"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai == '00' || id == 0 || thongTinChiTieuKeHoachNam.trangThai == '03'"
          [disabled]="!formData.valid">
          <i class="icon htvbdh_tcdt_guiduyet"></i>
          <span>Gửi duyệt</span>
        </button>
        <button class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="pheDuyet()"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai == '01'">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Phê duyệt</span>
        </button>
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="tuChoi()"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai == '01'">
          <i class="icon htvbdh_tcdt_tuchoi"></i>
          <span>Từ chối</span>
        </a>
        <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="huyBo()"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai == '01'">
          <i class="icon htvbdh_tcdt_delete"></i>
          <span>Hủy bỏ</span>
        </a>
      </div>
    </div>
  </div>
</nz-affix>
<div class="contentBor chi-tieu__body">
  <div class="contentDetail">
    <div class="main-content">
      <!-- <nz-card nzTitle="Thông tin chỉ tiêu kế hoạch năm Tổng Cục giao" class="mt16 flex-card p-lr16"> -->
      <div class="thong-tin-chi-tieu">
        <div class="title-chi-tieu">
          <span
            [ngClass]="thongTinTrangThai(thongTinChiTieuKeHoachNam.trangThai)">{{thongTinChiTieuKeHoachNam.tenTrangThai}}</span>
          <span>Thông tin chỉ tiêu kế hoạch năm Tổng Cục giao</span>
        </div>
        <form nz-form [formGroup]="formData" class="mt-16">
          <div nz-row [nzGutter]="[16, 12]">
            <div nz-col nzSpan="2">
              <nz-form-item>
                <nz-form-label nzRequired [nzNoColon]="true" class="text-left"> Số QĐ </nz-form-label>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="22">
              <div nz-row [nzGutter]="[16, 12]">
                <div nz-col nzSpan="3">
                  <nz-form-item>
                    <nz-form-control [nzErrorTip]="soQDError">
                      <nz-input-group nzAddOnAfter=" /QĐ-TCDT ">
                        <nz-input-number formControlName="soQD" [nzMin]="1" [nzMax]="9999999" [nzStep]="1"
                          [nzSize]="'small'"
                          [nzDisabled]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01'">
                        </nz-input-number>
                      </nz-input-group>
                      <ng-template #soQDError let-control>
                        <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
                      </ng-template>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="7">
                  <nz-form-item>
                    <nz-form-label [nzSpan]="6" nzRequired [nzNoColon]="true" class="text-left"> Ngày ký
                    </nz-form-label>
                    <nz-form-control nz-col [nzSpan]="18" [nzErrorTip]="ngayKyError">
                      <nz-date-picker class="search__input" [nzDisabledDate]="disabledStartDate" nzFormat="yyyy-MM-dd"
                        formControlName="ngayKy" nzPlaceHolder="Ngày ký"
                        [nzDisabled]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01'">
                      </nz-date-picker>
                      <ng-template #ngayKyError let-control>
                        <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
                      </ng-template>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="7">
                  <nz-form-item>
                    <nz-form-label nz-col [nzSpan]="6" nzRequired [nzNoColon]="true" class="text-left"> Ngày hiệu lực
                    </nz-form-label>
                    <nz-form-control nz-col [nzSpan]="18" [nzErrorTip]="ngayHieuLucError">
                      <nz-date-picker #endDatePicker [nzDisabledDate]="disabledEndDate" nzFormat="yyyy-MM-dd"
                        formControlName="ngayHieuLuc" nzPlaceHolder="Ngày hiệu lực"
                        [nzDisabled]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01'">
                      </nz-date-picker>
                      <ng-template #ngayHieuLucError let-control>
                        <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
                      </ng-template>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="7">
                  <nz-form-item>
                    <nz-form-label nz-col [nzSpan]="6" nzRequired [nzNoColon]="true" class="text-left"> Năm kế hoạch
                    </nz-form-label>
                    <nz-form-control nz-col [nzSpan]="18" [nzErrorTip]="namKeHoachError">
                      <nz-select formControlName="namKeHoach" (input)="selectNam()"
                        [nzDisabled]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01'">
                        <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
                      </nz-select>
                      <ng-template #namKeHoachError let-control>
                        <ng-container *ngIf="control.hasError('required')">{{errorInputRequired}}</ng-container>
                      </ng-template>
                    </nz-form-control>
                  </nz-form-item>
                </div>

              </div>
            </div>

            <div nz-col nzSpan="2">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" class="text-left"> Trích yếu </nz-form-label>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="22">
              <nz-form-item>
                <nz-form-control [nzErrorTip]="namKeHoachError">
                  <input formControlName="trichYeu" class="search__input" nz-input nzSize="small"
                    [readonly]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01'" />
                </nz-form-control>
                <!-- <textarea formControlName="trichYeu" rows="3" class="search__input" nz-input
                    [readonly]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01'"
                    [ngClass]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01' ? 'disable' : ''"></textarea> -->
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="2">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" class="text-left"> Căn cứ </nz-form-label>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="22">
              <!-- <input nz-input [readonly]="true" formControlName="canCu" /> -->
              <multiple-tag buttonName="Chọn căn cứ" placeHolder="Chọn căn cứ" icon="htvbdh_chuyen-vao-thu-vien"
                [data]="canCuList" [trangThai]="thongTinChiTieuKeHoachNam.trangThai"
                (selectDataEvent)="openDialogQuyetDinhGiaoChiTieu()" (removeDataEvent)="deleteDataMultipleTag($event)">
              </multiple-tag>
            </div>
            <div nz-col [nzSpan]="2">
              <nz-form-item>
                <nz-form-label [nzNoColon]="true" class="text-left"> Tài liệu đính kèm </nz-form-label>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="22">
              <multiple-tag buttonName="Chọn file" placeHolder="Chọn tài liệu đính kèm" icon="icon htvbdh_tcdt_tep"
                [data]="taiLieuDinhKemList" [trangThai]="thongTinChiTieuKeHoachNam.trangThai" type="file"
                (selectDataEvent)="openFile($event)" (removeDataEvent)="deleteTaiLieuDinhKemTag($event)">
              </multiple-tag>
            </div>


            <!-- <div nz-col nzSpan="6" class="tai-lieu-dinh-kem">
              <button class="btn btn-tep btn-sm waves-effect waves-light" (click)="selectFile('file-dinh-kem')"
                [disabled]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01'">
                <i class="icon htvbdh_tcdt_tep"></i>
                <span>Tài liệu đính kèm</span>
              </button>
              <input type="file" id="file-dinh-kem" class="file-not-show" (change)="uploadFile($event)" />
            </div> -->
          </div>
        </form>
      </div>
      <!-- </nz-card> -->
      <div class="tab__container">
        <nz-tabset nzType="card" class="tab__container">
          <nz-tab [nzTitle]="'Kế hoạch lương thực dự trữ nhà nước'" (nzClick)="tabSelected = tab.luongThuc">
          </nz-tab>
          <nz-tab [nzTitle]="'Kế hoạch muối dự trữ nhà nước'" (nzClick)="tabSelected = tab.muoi">
          </nz-tab>
          <nz-tab [nzTitle]="'Kế hoạch nhập vật tư, thiết bị'" class="vat-tu__container"
            (nzClick)="tabSelected = tab.vatTu">
          </nz-tab>
        </nz-tabset>
        <div id="table-luong-thuc"
          [ngClass]="tabSelected == tab.luongThuc ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
          <nz-table #groupingTable [nzData]="thongTinChiTieuKeHoachNam.khLuongThuc" nzBordered class="table__body"
            [nzFrontPagination]="false" [nzShowPagination]="false">
            <thead>
              <tr>
                <th rowspan="4">STT</th>
                <th rowspan="4">CỤC DTNN KHU VỰC</th>
                <th colspan="8">Tồn kho đầu năm (1) <br />( 01/01/2021)</th>
                <th colspan="3">Nhập trong năm (2)</th>
                <th colspan="8">Xuất trong năm (3)</th>
                <th colspan="3">Tồn kho cuối năm (4)
                  <br>
                  ( 31/12/2021)
                </th>
                <!-- <th rowspan="4">Trạng thái</th> -->
                <th rowspan="4" *ngIf="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai==='03'">Hành động</th>
              </tr>
              <tr>
                <th rowspan="3">
                  Tổng số
                  <br />
                  (quy thóc)
                </th>
                <th colspan="7">Trong đó</th>
                <th rowspan="3">
                  Tổng số
                  <br />
                  (quy thóc)
                </th>
                <th colspan="2">Trong đó</th>
                <th rowspan="3">
                  Tổng số
                  <br />
                  (quy thóc)
                </th>
                <th colspan="7">Trong đó</th>
                <th rowspan="3">Tổng số
                  <br>
                  (quy thóc)
                </th>
                <th colspan="2">Trong đó</th>
              </tr>
              <tr>
                <th colspan="4">Thóc</th>
                <th colspan="3">Gạo</th>
                <th rowspan="2">Thóc</th>
                <th rowspan="2">Gạo</th>
                <th colspan="4">Thóc</th>
                <th colspan="3">Gạo</th>
                <th rowspan="2">Thóc</th>
                <th rowspan="2">Gạo</th>
              </tr>
              <tr>
                <th>Tổng</th>
                <th>Nhập <br> {{yearNow - 3}}</th>
                <th>Nhập <br> {{yearNow - 2}}</th>
                <th>Nhập <br> {{yearNow - 1}}</th>
                <th>Tổng</th>
                <th>Nhập <br> {{yearNow - 2}}</th>
                <th>Nhập <br> {{yearNow - 1}}</th>
                <th>Tổng</th>
                <th>Nhập <br> {{yearNow - 3}}</th>
                <th>Nhập <br> {{yearNow - 2}}</th>
                <th>Nhập <br> {{yearNow - 1}}</th>
                <th>Tổng</th>
                <th>Nhập <br> {{yearNow - 2}}</th>
                <th>Nhập <br> {{yearNow - 1}}</th>
              </tr>
            </thead>
            <tbody>
              <tr [ngClass]="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
              thongTinChiTieuKeHoachNam.trangThai==='03' ? '' : 'row-disabled'">
                <td></td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input">
                      <input placeholder="Đơn vị" nz-input (input)="onInput($event,'luong-thuc')"
                        [nzAutocomplete]="auto" class="w-300" [(ngModel)]="keHoachLuongThucCreate.tenDonvi" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #auto>
                      <nz-auto-option *ngFor="let option of options" [nzValue]="option.labelDonVi"
                        (click)="selectDonViKHLT(option)">
                        {{ option.labelDonVi }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>{{calculatortkdnTongQuyThocCreate()}}</td>
                <td>{{calculatortkdnTongThocCreate()}}
                </td>
                <td>{{this.keHoachLuongThucCreate.tkdnThoc[0].soLuong}}</td>
                <td>{{this.keHoachLuongThucCreate.tkdnThoc[1].soLuong}}</td>
                <td>{{this.keHoachLuongThucCreate.tkdnThoc[2].soLuong}}</td>
                <td>{{calculatortkdnTongGaoCreate()}}</td>
                <td>{{this.keHoachLuongThucCreate.tkdnGao[0].soLuong}}</td>
                <td>{{this.keHoachLuongThucCreate.tkdnGao[1].soLuong}}</td>
                <td>{{calculatorntnTongQuyThocCreate()}}</td>
                <td>
                  <nz-input-number [nzMin]="0" [nzMax]="globals.prop.MAX_INPUT" type="text" nz-input name="goiThau"
                    class="w-120" [nzSize]="'small'" [(ngModel)]="keHoachLuongThucCreate.ntnThoc">
                  </nz-input-number>
                </td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'" [(ngModel)]="keHoachLuongThucCreate.ntnGao">
                  </nz-input-number>
                </td>
                <td>{{calculatorxtnTongSoQuyThocCreate()}}</td>
                <td>{{calculatorxtnTongThocCreate()}}</td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnThoc[0].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnThoc[0].soLuong"></nz-input-number>
                </td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnThoc[1].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnThoc[1].soLuong"></nz-input-number>
                </td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnThoc[2].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnThoc[2].soLuong"></nz-input-number>
                </td>
                <td>{{calculatorxtnTongGaoCreate()}}</td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnGao[0].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnGao[0].soLuong"></nz-input-number>
                </td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachLuongThucCreate.tkdnGao[1].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachLuongThucCreate.xtnGao[1].soLuong"></nz-input-number>
                </td>
                <td>{{calculatortkcnTongSoQuyThocCreate()}}</td>
                <td>{{calculatortkcnTongThocCreate()}}</td>
                <td>{{calculatortkcnTongGaoCreate()}}</td>
                <!-- <td class="background-last-row"></td> -->
                <td class="background-last-row" *ngIf="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai==='03'">
                  <a class="save" (click)="themMoiKHLT()" [ngClass]="{'isDisabled': !isAddLuongThuc}">
                    <i class="icon htvbdh_dau-cong"></i>
                  </a>
                  <a (click)="clearKHLT()" [ngClass]="{'isDisabled': !isAddLuongThuc}">
                    <i class="fa fa-trash-o do"></i>
                  </a>
                </td>
              </tr>
              <tr *ngFor="let data of groupingTable.data, let i = index">
                <ng-container *ngIf="!dsKeHoachLuongThucClone[i]?.isEdit; else editTemplate">
                  <td>{{data.stt}}</td>
                  <td>{{data.tenDonvi}}</td>
                  <td>{{data.tkdnTongSoQuyThoc | number:
                    '1.0-1'}}</td>
                  <td>{{data.tkdnTongThoc | number: '1.0-1'}}
                  </td>
                  <ng-container *ngIf="data?.tkdnThoc?.length > 0">
                    <td *ngFor="let item of data.tkdnThoc">
                      {{item.soLuong | number: '1.0-1'}}</td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnThoc?.length == 0">
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </ng-container>
                  <td> {{data.tkdnTongGao | number: '1.0-1'}} </td>
                  <ng-container *ngIf="data?.tkdnGao?.length > 0">
                    <td *ngFor="let item of data.tkdnGao"> {{item.soLuong | number: '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnGao?.length == 0">
                    <td> 0 </td>
                    <td> 0 </td>
                  </ng-container>
                  <td class="tong-so-quy-thoc"> {{data.ntnTongSoQuyThoc | number: '1.0-1'}}</td>
                  <td>{{data.ntnThoc | number: '1.0-1'}}</td>
                  <td>{{data.ntnGao | number: '1.0-1'}}</td>
                  <td>{{data.xtnTongSoQuyThoc | number:
                    '1.0-1'}}</td>
                  <td>{{data.xtnTongThoc | number: '1.0-1'}}
                  </td>
                  <ng-container *ngIf="data?.xtnThoc?.length > 0">
                    <td *ngFor="let item of data.xtnThoc">
                      {{item.soLuong | number: '1.0-1'}}</td>
                  </ng-container>
                  <ng-container *ngIf="data?.xtnThoc?.length == 0">
                    <td>0 </td>
                    <td>0</td>
                    <td>0</td>
                  </ng-container>
                  <td>{{data.xtnTongGao | number: '1.0-1'}}
                  </td>
                  <ng-container *ngIf="data?.xtnGao?.length > 0">
                    <td *ngFor="let item of data.xtnGao">
                      {{item.soLuong | number: '1.0-1'}}</td>
                  </ng-container>
                  <ng-container *ngIf="data?.xtnGao?.length == 0">
                    <td>0 </td>
                    <td>0</td>
                  </ng-container>
                  <td>{{data.tkcnTongSoQuyThoc | number:
                    '1.0-1'}}</td>
                  <td>{{data.tkcnTongThoc | number: '1.0-1'}}
                  </td>
                  <td>{{data.tkcnTongGao | number: '1.0-1'}}
                  </td>
                  <!-- <td>{{ convertTrangThai(thongTinChiTieuKeHoachNam.trangThai) }}</td> -->
                  <td *ngIf="thongTinChiTieuKeHoachNam.trangThai === '00' || id===0 ">
                    <a (click)="startEdit(i)">
                      <i class="fa fa-pencil"></i>
                    </a>
                    <a (click)="deleteKeHoachLuongThuc(data.stt)">
                      <i class="fa fa-trash-o do"></i>
                    </a>
                  </td>
                  <td *ngIf="data.stt == null" class="background-last-row"></td>
                  <td *ngIf="data.stt ==  null" class="background-last-row"></td>
                </ng-container>
                <ng-template #editTemplate>
                  <td>{{data.stt}}</td>
                  <td>{{data.tenDonvi}}</td>
                  <td>{{data.tkdnTongSoQuyThoc | number:
                    '1.0-1'}}</td>
                  <td>{{data.tkdnTongThoc | number: '1.0-1'}}
                  </td>
                  <ng-container *ngIf="data?.tkdnThoc?.length > 0">
                    <td *ngFor="let item of data.tkdnThoc">
                      {{item.soLuong | number: '1.0-1'}}</td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnThoc?.length == 0">
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </ng-container>
                  <td> {{data.tkdnTongGao | number: '1.0-1'}} </td>
                  <ng-container *ngIf="data?.tkdnGao?.length > 0">
                    <td *ngFor="let item of data.tkdnGao"> {{item.soLuong | number: '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="data?.tkdnGao?.length == 0">
                    <td> 0 </td>
                    <td> 0 </td>
                  </ng-container>
                  <td>
                    {{calculatorntnTongSoQuyThoc(i)}}
                  </td>
                  <td>
                    <nz-input-number [nzMin]="0" [nzMax]="globals.prop.MAX_INPUT" type="text" nz-input
                      [(ngModel)]="dsKeHoachLuongThucClone[i].ntnThoc" name="goiThau" class="w-200" [nzSize]="'small'">
                    </nz-input-number>
                  </td>
                  <td>
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].ntnGao" name="goiThau"
                      class="w-200" [nzMin]="0" [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td>
                    {{calculatorxtnTongSoQuyThoc(i)}}
                  </td>
                  <td>
                    {{calculatorxtnTongThoc(i)}}
                  </td>
                  <td>
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnThoc[0].soLuong"
                      name="goiThau" class="w-200" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnThoc[0].soLuong"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td>
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnThoc[1].soLuong"
                      name="goiThau" class="w-200" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnThoc[1].soLuong"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td>
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnThoc[2].soLuong"
                      name="goiThau" class="w-200" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnThoc[2].soLuong"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td>
                    {{calculatorxtnTongGao(i)}}
                  </td>
                  <td>
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnGao[0].soLuong"
                      name="goiThau" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnGao[0].soLuong" class="w-200"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td>
                    <nz-input-number type="text" nz-input [(ngModel)]="dsKeHoachLuongThucClone[i].xtnGao[1].soLuong"
                      name="goiThau" [nzMin]="0" [nzMax]="dsKeHoachLuongThucClone[i].tkdnGao[1].soLuong" class="w-200"
                      [nzSize]="'small'"></nz-input-number>
                  </td>
                  <td>
                    {{ calculatortkcnTongSoQuyThoc(i)}}
                  </td>
                  <td>
                    {{ calculatortkcnTongThoc(i)}}
                  </td>
                  <td>
                    {{calculatortkcnTongGao(i)}}
                  </td>
                  <!-- <td></td> -->
                  <td>
                    <a (click)="saveEdit(i)" class="save">
                      <i class="fa fa-save"></i>
                    </a>
                    <a (click)="cancelEdit(i)">
                      <i class="fa fa-times do"></i>
                    </a>
                  </td>
                </ng-template>
              </tr>
              <tr *ngIf="thongTinChiTieuKeHoachNam?.khLuongThuc?.length > 0">
                <td colspan="2" class="first-last-row-table background-last-row">Cộng</td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 2, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 3, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 4, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 5, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 6, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 7, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 8, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 9, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 10, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 11, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 12, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 13, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 14, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 15, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 16, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 17, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 18, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 19, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 20, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 21, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 22, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 23, 5, ',','table-luong-thuc') : 0 |
                  number: '1.0-1'}}
                </td>
                <!-- <td class="background-last-row"></td> -->
                <td class="background-last-row" *ngIf="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai==='03'"></td>
              </tr>
            </tbody>
          </nz-table>
        </div>
        <div id="table-muoi"
          [ngClass]="tabSelected == tab.muoi ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
          <nz-table #groupingTableMuoi [nzData]="thongTinChiTieuKeHoachNam.khMuoiDuTru" nzBordered class="table__body"
            [nzFrontPagination]="false" [nzShowPagination]="false">
            <thead>
              <tr>
                <th rowspan="3">STT</th>
                <th rowspan="3">CỤC DTNN KHU VỰC</th>
                <th colspan="4">Tồn kho đầu năm (1) <br />( 01/01/2021)</th>
                <th>Nhập trong năm (2)</th>
                <th colspan="4 ">Xuất trong năm (3)</th>
                <th>Tồn kho cuối năm (4)
                  <br>
                  ( 31/12/2021)
                </th>
                <th rowspan="3">Trạng thái</th>
                <th rowspan="3" *ngIf="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai==='03'">Hành động</th>
              </tr>
              <tr>
                <th rowspan="2">
                  Tổng số
                </th>
                <th colspan="3">Trong đó</th>
                <th rowspan="2">
                  Tổng số
                </th>
                <th rowspan="2">
                  Tổng số
                </th>
                <th colspan="3">Trong đó</th>
                <th rowspan="2">
                  Tổng số
                </th>
              </tr>
              <tr>
                <th>Nhập <br> {{yearNow - 3}}</th>
                <th>Nhập <br> {{yearNow - 2}}</th>
                <th>Nhập <br> {{yearNow - 1}}</th>
                <th>Nhập <br> {{yearNow - 3}}</th>
                <th>Nhập <br> {{yearNow - 2}}</th>
                <th>Nhập <br> {{yearNow - 1}}</th>
              </tr>
            </thead>
            <tbody>
              <tr [ngClass]="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
              thongTinChiTieuKeHoachNam.trangThai==='03' ? '' : 'row-disabled'">
                <td></td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Đơn vị" nz-input (input)="onInput($event, 'muoi')" [nzAutocomplete]="autoMuoi"
                        class="" [(ngModel)]="keHoachMuoiCreate.tenDonVi" (input)="changeDonViMuoi()" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoMuoi>
                      <nz-auto-option *ngFor="let option of options" [nzValue]="option.labelDonVi"
                        (click)="selectDonViMuoi(option)">
                        {{ option.labelDonVi }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>{{calculatortkdnTongMuoiCreate()}}</td>
                <td>{{keHoachMuoiCreate.tkdnMuoi[0].soLuong}}</td>
                <td>{{keHoachMuoiCreate.tkdnMuoi[1].soLuong}}</td>
                <td>{{keHoachMuoiCreate.tkdnMuoi[2].soLuong}}</td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'" [(ngModel)]="keHoachMuoiCreate.ntnTongSoMuoi">
                  </nz-input-number>
                </td>
                <td>{{calculatorxtnTongMuoiCreate()}}</td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachMuoiCreate.tkdnMuoi[0].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachMuoiCreate.xtnMuoi[0].soLuong">
                  </nz-input-number>
                </td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachMuoiCreate.tkdnMuoi[1].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachMuoiCreate.xtnMuoi[1].soLuong">
                  </nz-input-number>
                </td>
                <td>
                  <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                    [nzMax]="keHoachMuoiCreate.tkdnMuoi[2].soLuong" [nzSize]="'small'"
                    [(ngModel)]="keHoachMuoiCreate.xtnMuoi[2].soLuong">
                  </nz-input-number>
                </td>
                <td>{{calculatortkcnTongMuoiCreate()}}</td>
                <td></td>
                <td *ngIf="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai==='03'">
                  <a class="save" (click)="themMoiMuoiDuTru()" [ngClass]="{'isDisabled': !isAddMuoi}">
                    <i class="icon htvbdh_dau-cong"></i>
                  </a>
                  <a (click)="clearMuoiDuTru()" [ngClass]="{'isDisabled': !isAddMuoi}">
                    <i class="fa fa-trash-o do"></i>
                  </a>
                </td>
              </tr>
              <tr *ngFor="let dataMuoi of groupingTableMuoi.data, let i = index">
                <ng-container *ngIf="!dsMuoiClone[i]?.isEdit; else editTemplateMuoi">
                  <td>{{dataMuoi.stt}}</td>
                  <td>{{dataMuoi.tenDonVi}}</td>
                  <td>{{dataMuoi.tkdnTongSoMuoi | number: '1.0-1'}}</td>
                  <ng-container *ngIf="dataMuoi?.tkdnMuoi?.length > 0">
                    <td *ngFor="let itemMuoi of dataMuoi.tkdnMuoi">{{itemMuoi.soLuong | number: '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="dataMuoi?.tkdnMuoi?.length == 0">
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </ng-container>
                  <td>{{dataMuoi.ntnTongSoMuoi | number: '1.0-1'}}</td>
                  <td>{{dataMuoi.xtnTongSoMuoi | number: '1.0-1'}}</td>
                  <ng-container *ngIf="dataMuoi?.xtnMuoi?.length > 0">
                    <td *ngFor="let itemMuoi of dataMuoi.xtnMuoi">{{itemMuoi.soLuong | number: '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="dataMuoi?.xtnMuoi?.length == 0">
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </ng-container>
                  <td>{{dataMuoi.tkcnTongSoMuoi | number: '1.0-1'}}</td>
                  <td *ngIf="dataMuoi.stt">{{ convertTrangThai(thongTinChiTieuKeHoachNam.trangThai) }}</td>
                  <td *ngIf="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
                  thongTinChiTieuKeHoachNam.trangThai==='03'">
                    <a (click)="startEditMuoi(i)">
                      <i class="fa fa-pencil"></i>
                    </a>
                    <a (click)="deleteKeHoachMuoi(dataMuoi.stt)">
                      <i class="fa fa-trash-o do"></i>
                    </a>
                  </td>
                </ng-container>
                <ng-template #editTemplateMuoi>
                  <td>{{dataMuoi.stt}}</td>
                  <td>{{dataMuoi.tenDonVi}}</td>
                  <td>{{dataMuoi.tkdnTongSoMuoi | number: '1.0-1'}}</td>
                  <ng-container *ngIf="dataMuoi?.tkdnMuoi?.length > 0">
                    <td *ngFor="let itemMuoi of dataMuoi.tkdnMuoi">{{itemMuoi.soLuong | number: '1.0-1'}} </td>
                  </ng-container>
                  <ng-container *ngIf="dataMuoi?.tkdnMuoi?.length == 0">
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </ng-container>
                  <td>
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'" [(ngModel)]="dsMuoiClone[i].ntnTongSoMuoi">
                    </nz-input-number>
                  </td>
                  <td>{{calculatorxtnTongSoMuoi(i)}}</td>
                  <td>
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="dsMuoiClone[i].tkdnMuoi[0].soLuong" [nzSize]="'small'"
                      [(ngModel)]="dsMuoiClone[i].xtnMuoi[0].soLuong">
                    </nz-input-number>
                  </td>
                  <td>
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="dsMuoiClone[i].tkdnMuoi[1].soLuong" [nzSize]="'small'"
                      [(ngModel)]="dsMuoiClone[i].xtnMuoi[1].soLuong">
                    </nz-input-number>
                  </td>
                  <td>
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="dsMuoiClone[i].tkdnMuoi[2].soLuong" [nzSize]="'small'"
                      [(ngModel)]="dsMuoiClone[i].xtnMuoi[2].soLuong">
                    </nz-input-number>
                  </td>
                  <td>{{calculatortkcnTongSoMuoi(i)}}</td>
                  <td></td>
                  <td *ngIf="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
                  thongTinChiTieuKeHoachNam.trangThai==='03'">
                    <a (click)="saveEditMuoi(i)" class="save">
                      <i class="fa fa-save"></i>
                    </a>
                    <a (click)="cancelEditMuoi(i)">
                      <i class="fa fa-times do"></i>
                    </a>
                  </td>
                  <td *ngIf="dataMuoi.stt == null" class="background-last-row"></td>
                  <td *ngIf="dataMuoi.stt ==  null" class="background-last-row"></td>
                </ng-template>
              </tr>

              <tr *ngIf="thongTinChiTieuKeHoachNam?.khMuoiDuTru?.length > 0">
                <td colspan="2" class="first-last-row-table background-last-row">Cộng</td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 2, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 3, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 4, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 5, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 6, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 7, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 8, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 9, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 10, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 11, 4, ',', 'table-muoi') : 0 |
                  number:
                  '1.0-1'}}
                </td>
                <td class="background-last-row"></td>
                <td class="background-last-row" *ngIf="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai==='03'"></td>
              </tr>
            </tbody>
          </nz-table>
        </div>
        <div id="table-vat-tu"
          [ngClass]="tabSelected == tab.vatTu ? 'show-table table-out-tab' : 'hide-table table-out-tab'">
          <nz-table #groupingTableVatTu [nzData]="thongTinChiTieuKeHoachNam.khVatTu" nzBordered class="table__body"
            [nzFrontPagination]="false" [nzShowPagination]="false">
            <thead>
              <tr>
                <th rowspan="3">STT</th>
                <th rowspan="3">CỤC DTNN KHU VỰC</th>
                <th rowspan="3">Mã hàng</th>
                <th rowspan="3">Ký hiệu</th>
                <th rowspan="3">Tên hàng</th>
                <th rowspan="3">Chủng loại hàng</th>
                <th rowspan="3">ĐƠN VỊ TÍNH</th>
                <th colspan="6">CHỈ TIÊU NHẬP TRONG NĂM KẾ HOẠCH NĂM</th>
                <th rowspan="3">HÀNH ĐỘNG</th>
              </tr>
              <tr>
                <th rowspan="2">
                  Tổng số
                </th>
                <th colspan="4">Chỉ tiêu nhập các năm trước chuyển</th>
                <th rowspan="2">
                  Kế hoạch năm hiện tại
                </th>
              </tr>
              <tr>
                <th>Tổng</th>
                <th class="text-center">KH năm <br> (1)</th>
                <th class="text-center">KH năm <br> (2)</th>
                <th class="text-center">KH năm <br> (3)</th>
              </tr>
            </thead>
            <tbody>
              <tr [ngClass]="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
              thongTinChiTieuKeHoachNam.trangThai==='03' ? '' : 'row-disabled'">
                <td></td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập đơn vị">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Chọn cục dự trữ nhà nước khu vực" nz-input (input)="onInput($event,'vat-tu')"
                        [nzAutocomplete]="autoDonViVatTu" class="" [(ngModel)]="keHoachVatTuCreate.tenDonVi" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoDonViVatTu>
                      <nz-auto-option *ngFor="let option of options" [nzValue]="option.labelDonVi"
                        (click)="selectDonViVatTu(option)">
                        {{ option.labelDonVi }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>{{keHoachVatTuCreate.vatTuThietBi[0]?.maVatTuCha}}</td>
                <td>{{keHoachVatTuCreate.vatTuThietBi[0]?.kyHieu}}</td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập tên hàng">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input w-300">
                      <input placeholder="Chọn tên" nz-input (input)="onInputTenHang($event)"
                        [nzAutocomplete]="autoVatTu" class=""
                        [(ngModel)]="keHoachVatTuCreate.vatTuThietBi[0].tenVatTuCha"
                        [title]="keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTuCha ? keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTuCha : ''" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoVatTu>
                      <nz-auto-option *ngFor="let vatTuCha of dataVatTuChaShow" [nzValue]="vatTuCha.ten"
                        (click)="selectTenHang(vatTuCha)">
                        {{ vatTuCha.ten }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>
                  <nz-form-control nzErrorTip="Vui lòng nhập chủng loại hàng">
                    <nz-input-group nzSize="large" [nzSuffix]="suffixIcon"
                      class="search__input autocomplete__input donvi__input w-300">
                      <input nz-input (input)="onInputChungLoaiHang($event)" [nzAutocomplete]="autoChungLoaiHang"
                        class="" [(ngModel)]="keHoachVatTuCreate.vatTuThietBi[0].tenVatTu"
                        [title]="keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTu ? keHoachVatTuCreate.vatTuThietBi[0]?.tenVatTu : ''"
                        [disabled]="dataVatTuConClone.length == 0"
                        [placeholder]="dataVatTuConClone.length == 0 ? 'Không có chủng loại hàng' : 'Chọn chủng loại hàng'" />
                    </nz-input-group>
                    <ng-template #suffixIcon>
                      <i nz-icon nzType="search"></i>
                    </ng-template>
                    <nz-autocomplete #autoChungLoaiHang>
                      <nz-auto-option *ngFor="let vatTuCon of dataVatTuConShow" [nzValue]="vatTuCon.ten"
                        (click)="selectChungLoaiHang(vatTuCon)">
                        {{ vatTuCon.ten }}
                      </nz-auto-option>
                    </nz-autocomplete>
                  </nz-form-control>
                </td>
                <td>
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.donViTinh}}
                </td>
                <td>{{keHoachVatTuCreate.vatTuThietBi[0]?.tongNhap | number: '1.0-1'}}</td>
                <td>
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.tongCacNamTruoc | number: '1.0-1'}}
                </td>
                <td>
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.cacNamTruoc[0]?.soLuong | number: '1.0-1'}}
                </td>
                <td>
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.cacNamTruoc[1]?.soLuong | number: '1.0-1'}}
                </td>
                <td>
                  {{keHoachVatTuCreate.vatTuThietBi[0]?.cacNamTruoc[2]?.soLuong | number: '1.0-1'}}
                </td>
                <td>
                  <nz-input-number type="text" nz-input name="khNamHienTai" class="w-120" [nzMin]="0"
                    [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'"
                    [(ngModel)]="keHoachVatTuCreate.vatTuThietBi[0].nhapTrongNam" (input)="calculatorTongChiTieuNtn()">
                  </nz-input-number>
                </td>
                <td *ngIf="thongTinChiTieuKeHoachNam.trangThai==='00' || id===0 ||
                thongTinChiTieuKeHoachNam.trangThai==='03'">
                  <a class="save" (click)="themMoiVatTu()" [ngClass]="{'isDisabled': !isAddVatTu}">
                    <i class="icon htvbdh_dau-cong"></i>
                  </a>
                  <a (click)="clearVatTu()" [ngClass]="{'isDisabled': !isAddVatTu}">
                    <i class="fa fa-trash-o do"></i>
                  </a>
                </td>
              </tr>
              <tr *ngFor="let dataVatTu of groupingTableVatTu.data, let i = index">
                <ng-container *ngIf="!dsVatTuClone[i]?.isEdit; else editTemplateVatTu">
                  <td>{{dataVatTu.stt}}</td>
                  <td>{{dataVatTu.tenDonVi}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.maVatTuCha}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.kyHieu}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.tenVatTuCha}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.tenVatTu}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.donViTinh}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.tongNhap | number: '1.0-1'}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.tongCacNamTruoc | number: '1.0-1'}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.cacNamTruoc[0]?.soLuong | number: '1.0-1'}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.cacNamTruoc[1]?.soLuong | number: '1.0-1'}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.cacNamTruoc[2]?.soLuong | number: '1.0-1'}}</td>
                  <td>{{dataVatTu.vatTuThietBi[0]?.nhapTrongNam | number: '1.0-1'}}</td>
                  <td>
                    <a (click)="startEditVatTu(i)">
                      <i class="fa fa-pencil"></i>
                    </a>
                    <a (click)="deleteKeHoachVatTu(dataVatTu.stt)">
                      <i class="fa fa-trash-o do"></i>
                    </a>
                  </td>
                </ng-container>
                <ng-template #editTemplateVatTu>
                  <td>{{dsVatTuClone[i].stt}}</td>
                  <td>{{dsVatTuClone[i].tenDonVi}}</td>
                  <td>{{dsVatTuClone[i].vatTuThietBi[0]?.maVatTuCha}}</td>
                  <td>{{dsVatTuClone[i].vatTuThietBi[0]?.kyHieu}}</td>
                  <td>{{dsVatTuClone[i].vatTuThietBi[0]?.tenVatTuCha}}</td>
                  <td>{{dsVatTuClone[i].vatTuThietBi[0]?.tenVatTu}}</td>
                  <td>{{dsVatTuClone[i].vatTuThietBi[0]?.donViTinh}}</td>
                  <td>{{calculatorTongChiTieuNhaptrongNam(i)}}</td>
                  <td>{{dsVatTuClone[i].vatTuThietBi[0]?.tongCacNamTruoc | number: '1.0-1'}}</td>
                  <td>{{dsVatTuClone[i].vatTuThietBi[0]?.cacNamTruoc[0]?.soLuong | number: '1.0-1'}}</td>
                  <td>{{dsVatTuClone[i].vatTuThietBi[0]?.cacNamTruoc[1]?.soLuong | number: '1.0-1'}}</td>
                  <td>{{dsVatTuClone[i].vatTuThietBi[0]?.cacNamTruoc[2]?.soLuong | number: '1.0-1'}}</td>
                  <td>
                    <nz-input-number type="text" nz-input name="goiThau" class="w-120" [nzMin]="0"
                      [nzMax]="globals.prop.MAX_INPUT" [nzSize]="'small'"
                      [(ngModel)]="dsVatTuClone[i].vatTuThietBi[0].nhapTrongNam">
                    </nz-input-number>
                  </td>
                  <td>
                    <a (click)="saveEditVatTu(i)" class="save">
                      <i class="fa fa-save"></i>
                    </a>
                    <a (click)="cancelEditVatTu(i)">
                      <i class="fa fa-times do"></i>
                    </a>
                  </td>
                </ng-template>
              </tr>
              <tr *ngIf="thongTinChiTieuKeHoachNam?.khVatTu.length > 0">
                <td colspan="2" class="first-last-row-table background-last-row">Cộng</td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row">
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 7, 4, ',','table-vat-tu') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 8, 4, ',','table-vat-tu') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 9, 4, ',','table-vat-tu') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 10, 4, ',','table-vat-tu') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 11, 4, ',','table-vat-tu') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">{{ tableExist ? reduceRowData(0, 12, 4, ',','table-vat-tu') : 0 |
                  number: '1.0-1'}}
                </td>
                <td class="background-last-row">
                </td>
              </tr>
            </tbody>
          </nz-table>
        </div>
        <div class="tep" (click)="downloadTemplate()"
          *ngIf="thongTinChiTieuKeHoachNam.trangThai === '00' || id===0 || thongTinChiTieuKeHoachNam.trangThai === '03'">
          <i class="icon htvbdh_tcdt_tep"></i>
          <span>biểu mẫu nhập dữ liệu Lương thực.xlsx</span>
        </div>
        <div class="action">
          <!-- <button type="button" class="btn btn-main" (click)="themMoi()"
            *ngIf="thongTinChiTieuKeHoachNam.trangThai === '00'  || id===0 || thongTinChiTieuKeHoachNam.trangThai === '03'">
            <i class="icon htvbdh_dau-cong"></i>
            <span>Thêm</span>
          </button> -->
          <button type="button" class="btn btn-sub" (click)="selectFile('file-import-data')"
            *ngIf="thongTinChiTieuKeHoachNam.trangThai === '00' || id===0 || thongTinChiTieuKeHoachNam.trangThai === '03'">
            <i class="icon htvbdh_tcdt_import"></i>
            <span>Import</span>
          </button>
          <input type="file" id="file-import-data" class="file-not-show" (change)="importFileData($event)" />
          <button type="button" class="btn btn-sub" (click)="exportData()">
            <i class="icon htvbdh_chuyen-xu-ly"></i>
            <span>Export</span>
          </button>
          <button type="button" class="btn btn-sub" (click)="printTable()">
            <i class="icon htvbdh_tcdt_print"></i>
            <span>In</span>
          </button>
        </div>
      </div>
      <div class="ghi-chu">
        <form nz-form [formGroup]="formData" class="mt-16">
          <div nz-row [nzGutter]="[16, 12]">
            <div nz-col [nzSpan]="24">
              <nz-form-item class="form-item-ghi-chu">
                <nz-form-label nzRequired [nzNoColon]="true">
                  Ghi chú
                </nz-form-label>
                <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="soQDError">
                  <input nz-input nzSize="large" formControlName="ghiChu" style="height: 40px !important;"
                    [readonly]="true" />
                  <!-- <textarea rows="3" class="search__input" nz-input formControlName="ghiChu"
                    [readonly]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01'"
                    [ngClass]="thongTinChiTieuKeHoachNam.trangThai === '02' || thongTinChiTieuKeHoachNam.trangThai === '01' ? 'disable' : ''"></textarea> -->
                  <ng-template #soQDError let-control>
                    <ng-container *ngIf="control.hasError('required')">{{control.hasError('required')}}
                      {{errorInputRequired}}
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>