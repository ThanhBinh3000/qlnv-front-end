<div class="bg-trang">
  <h3 class="label_dm">QUẢN LÝ DANH MỤC ĐỊNH MỨC PHÍ NHẬP, XUẤT, BẢO QUẢN</h3>
  <nz-card class="mt16 flex-card p-lr16">
      <div nz-row [nzGutter]="20">
        <div nz-col [nzSpan]="6">
          <label class="search__label">Mã định mức</label>
            <nz-form-control>
              <nz-input-group id="ma-dm">
                <input type="text" nz-input [(ngModel)]="searchFilter.maDinhMuc" />
              </nz-input-group>
            </nz-form-control>
        </div>
        <div nz-col [nzSpan]="6">
          <label class="search__label">Tên định mức</label>
          <nz-form-control>
              <nz-input-group id="ten-dm">
                <input type="text" nz-input [(ngModel)]="searchFilter.tenDinhMuc"  />
              </nz-input-group>
            </nz-form-control>
        </div>
                <div nz-col [nzSpan]="6" >
                  <label class="search__label">Loại hàng hóa</label>

                  <nz-form-control nz-col [nzSpan]="24">
                      <nz-input-group nzAddOnAfterIcon="folder-open" (click)="selectHangHoa('search')">
                        <input class="search__input" [(ngModel)]="searchFilter.tenVthh" [readonly]="true" nz-input
                               readonly="true" />
                      </nz-input-group>
                    </nz-form-control>
                </div>

        <div nz-col [nzSpan]="6" >
          <label class="search__label">Chủng loại hàng hóa</label>

          <nz-form-control nz-col [nzSpan]="24">
              <nz-input-group nzAddOnAfterIcon="folder-open" (click)="selectHangHoa('search')">
                <input class="search__input" [(ngModel)]="searchFilter.tenCloaiVthh" [readonly]="true" nz-input
                       readonly="true" />
              </nz-input-group>
            </nz-form-control>
        </div>
        <br>
        <div nz-col nzSpan="6">
          <label class="search__label">Loại đinh mức</label>
          <nz-form-control >
            <nz-input-group>
              <nz-select  nzAllowClear [(ngModel)]="searchFilter.loaiDinhMuc">
                <nz-option *ngFor="let p of listDinhMuc"  [nzValue]="p.ma" [nzLabel]="p.giaTri">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </nz-form-control>
        </div>
        <div nz-col nzSpan="6">
          <label class="search__label">Loại hình bảo quản</label>
          <nz-form-control >
            <nz-input-group>
              <nz-select  nzAllowClear [(ngModel)]="searchFilter.loaiHinhBq">
                <nz-option *ngFor="let p of listLhbq" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </nz-form-control>
        </div>
        <div nz-col nzSpan="6">
          <label class="search__label">Hình thức bảo quản</label>
          <nz-form-control >
            <nz-input-group>
              <nz-select  nzAllowClear [(ngModel)]="searchFilter.hinhThucBq">
                <nz-option *ngFor="let p of listHtBq" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </nz-form-control>
        </div>
      </div>
    <div class="cangiua group-button-search">
      <button nz-button class="search__button--clear" (click)="clearFilter()" >
        <i class="icon  htvbdh_nhap-lai1"></i>
        Xóa điều kiện
      </button>
      <button nz-button class="search__button--search" (click)="search()"  >
        <i nz-icon nzType="search"></i>
        Tìm kiếm
      </button>
    </div>
  </nz-card>
  <div class="group-button">
    <h3 class="label_dm">DANH SÁCH ĐỊNH MỨC PHÍ NHẬP, XUẤT, BẢO QUẢN</h3>
    <div class="buttons">
      <button type="button" class="btn btn-sub btn-xoa" (click)="xoa()">
        <i class="fa fa-trash-o do"></i>
        <span>Xoá</span>
      </button>
      <button type="button" class="btn btn-sub" (click)="export()">
        <i class="icon htvbdh_chuyen-xu-ly"></i>
        <span>Xuất file</span>
      </button>
    </div>
  </div>
  <nz-card class="mt-2px flex-card data-table card-border-content table-card">
    <form nz-form nzLayout="vertical" [formGroup]="formData">
    <nz-table #basicTable nzBordered class="nowrap" [nzData]="dataTable" [nzFrontPagination]="false"
              [nzShowPagination]="false" nzBordered>
      <thead>
      <tr>
        <th class="text-center" style="width: 2%;" >
          <label nz-checkbox [ngModelOptions]="{standalone: true}" [(ngModel)]="allChecked"  (ngModelChange)="updateAllChecked()"
                 [nzIndeterminate]="indeterminate"></label>
        </th>
        <th class="text-center" style="width: 2%;">STT</th>
        <th class="text-center" style="width: 8%;">Mã định mức</th>
        <th class="text-center" style="width: 15%;">Tên định mức</th>
        <th class="text-center" style="width: 17%;">Loại hàng hóa</th>
        <th class="text-center" style="width: 17%;">Chủng loại hàng hóa</th>
        <th class="text-center" style="width: 10%;">Loại định mức</th>
        <th class="text-center" style="width: 13%;">Loại hình bảo quản</th>
        <th class="text-center" style="width: 8%;">Đơn vị tính</th>
        <th class="text-center" style="width: 8%;">Trạng thái</th>
        <th  class="text-center" style="width: 8%;" >Hành động</th>
      </tr>
      <tr class="search-table">
        <th></th>
        <th></th>
        <th>
          <nz-form-control>
            <nz-input-group  >
              <input type="text" nz-input formControlName="maDinhMuc" />
            </nz-input-group>
          </nz-form-control>
        </th>
        <th>
          <nz-form-control>
            <nz-input-group >
              <input type="text" nz-input formControlName="tenDinhMuc"  />
            </nz-input-group>
          </nz-form-control>
        </th>
        <th>
          <nz-form-control nz-col [nzSpan]="24">
            <nz-input-group nzAddOnAfterIcon="folder-open" (click)="selectHangHoa('save')">
              <input class="search__input" formControlName="tenVthh" [readonly]="true" nz-input
                     readonly="true" />
            </nz-input-group>
          </nz-form-control>
        </th>
        <th>
          <nz-input-group nzAddOnAfterIcon="folder-open" (click)="selectHangHoa('save')">
            <input class="search__input" formControlName="tenCloaiVthh" [readonly]="true" nz-input
                   readonly="true" />
          </nz-input-group>
        </th>
        <th>
          <nz-form-control >
            <nz-input-group>
              <nz-select  nzAllowClear formControlName="loaiDinhMuc">
                <nz-option *ngFor="let p of listDinhMuc"  [nzValue]="p.ma" [nzLabel]="p.giaTri">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </nz-form-control>
        </th>
        <th>
          <nz-form-control >
            <nz-input-group>
              <nz-select  nzAllowClear formControlName="loaiHinhBq">
                <nz-option *ngFor="let p of listLhbq" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </nz-form-control>
        </th>
        <th>
          <nz-form-control >
            <nz-input-group>
              <nz-select  nzAllowClear formControlName="hinhThucBq">
                <nz-option *ngFor="let p of listHtBq" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </nz-form-control>
        </th>
        <th>
          <nz-form-control >
            <nz-input-group>
              <nz-select formControlName="trangThai"  nzAllowClear>
                <nz-option nzValue="01" nzLabel="Hoạt động" >
                </nz-option>
                <nz-option nzValue="00" nzLabel="Không hoạt động" >
                </nz-option>
              </nz-select>
            </nz-input-group>
          </nz-form-control>
        </th>
        <th class="text-left">
          <a (click)="themmoi()" [ngClass]="{'isDisabled': formData.invalid}">
            <i class="icon htvbdh_dau-cong"></i>
          </a>
          <a>
            <i class="icon  htvbdh_nhap-lai1 "></i>
          </a>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let data of basicTable.data; let i = index">
        <ng-container *ngIf="!dataEdit[i].edit; else editTemplate">
        <td width="45px">
          <label nz-checkbox  [ngModelOptions]="{standalone: true}"  [(ngModel)]="data.checked"  (ngModelChange)="updateSingleChecked()"></label>
        </td>
        <td class="text-center">{{i +1}}</td>
        <td>{{ data.maDinhMuc }}</td>
        <td>{{ data.tenDinhMuc }}</td>
        <td>{{ data.tenLoaiVthh }}</td>
        <td>{{ data.tencLoaiVthh }}</td>
        <td>{{data.tenLoaiDinhMuc}}</td>
        <td>{{data.tenLoaiHinhBq}}</td>
        <td>{{ data.tenHinhThucBq }}</td>
        <td>{{ data.trangThai }}</td>
        <td style="text-align: center;">
          <a (click)="startEdit(i)">
            <i class="table-icon fa fa-pencil"></i>
          </a>
          <a (click)="xoaItem(data)">
            <i class="table-icon fa fa-trash-o do" ></i>
          </a>
        </td>
        </ng-container>
        <ng-template #editTemplate>
          <th></th>
          <td class="text-center">{{i +1}}</td>
          <th>
            <nz-form-control>
              <nz-input-group >
                <input  [ngModelOptions]="{standalone: true}"
                       type="text" nz-input [(ngModel)]= dataEdit[i].data.maDinhMuc />
              </nz-input-group>
            </nz-form-control>
          </th>
          <th>
            <nz-form-control>
              <nz-input-group >
                <input [ngModelOptions]="{standalone: true}"
                       type="text" nz-input [(ngModel)]= dataEdit[i].data.tenDinhMuc  />
              </nz-input-group>
            </nz-form-control>
          </th>
          <th>
            <nz-form-control nz-col [nzSpan]="24">
              <nz-input-group nzAddOnAfterIcon="folder-open" (click)="selectHangHoa('edit' , i)">
                <input [ngModelOptions]="{standalone: true}" class="search__input" [(ngModel)]= dataEdit[i].data.tenLoaiVthh [readonly]="true" nz-input
                       readonly="true" />
              </nz-input-group>
            </nz-form-control>
          </th>
          <th>
            <nz-input-group nzAddOnAfterIcon="folder-open" (click)="selectHangHoa('edit' , i)">
              <input [ngModelOptions]="{standalone: true}" class="search__input" [(ngModel)]= dataEdit[i].data.tencLoaiVthh [readonly]="true" nz-input
                     readonly="true" />
            </nz-input-group>
          </th>
          <th>
            <nz-form-control >
              <nz-input-group>
                <nz-select [ngModelOptions]="{standalone: true}"  nzAllowClear [(ngModel)]= dataEdit[i].data.loaiDinhMuc>
                  <nz-option  *ngFor="let p of listDinhMuc"  [nzValue]="p.ma" [nzLabel]="p.giaTri">
                  </nz-option>
                </nz-select>
              </nz-input-group>
            </nz-form-control>
          </th>
          <th>
            <nz-form-control >
              <nz-input-group>
                <nz-select  [ngModelOptions]="{standalone: true}" nzAllowClear [(ngModel)]= dataEdit[i].data.loaiHinhBq>
                  <nz-option *ngFor="let p of listLhbq" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                  </nz-option>
                </nz-select>
              </nz-input-group>
            </nz-form-control>
          </th>
          <th>
            <nz-form-control >
              <nz-input-group>
                <nz-select [ngModelOptions]="{standalone: true}"  nzAllowClear [(ngModel)]= dataEdit[i].data.hinhThucBq>
                  <nz-option *ngFor="let p of listHtBq" [nzValue]="p.ma" [nzLabel]="p.giaTri">
                  </nz-option>
                </nz-select>
              </nz-input-group>
            </nz-form-control>
          </th>
          <th>
            <nz-form-control >
              <nz-input-group>
                <nz-select [ngModelOptions]="{standalone: true}"  nzAllowClear [(ngModel)]= dataEdit[i].data.trangThai>
                  <nz-option nzValue="00" nzLabel="Hoạt động" >
                  </nz-option>
                  <nz-option nzValue="01" nzLabel="Không hoạt động" >
                  </nz-option>
                </nz-select>
              </nz-input-group>
            </nz-form-control>
          </th>
          <th style="text-align: center;" >
          <a  (click)="themmoi(dataEdit[i].data, data.id)" [ngClass]="{'isDisabled': formDataChinhSua.invalid}">
            <i class="fa fa-save mr-3"></i>
          </a>
          <a (click)="huyEdit(i)">
            <i class="fa fa-times do mr-3"></i>
          </a>
        </th>
        </ng-template>
      </tr>
      </tbody>
    </nz-table>
    </form>
    <div class="tab-content tab-menu" id="myTabContent">
      <div class="tab-pane fade show active justify-content-between">
        <div class="trai">
        </div>
        <div class="canphai">
          <!-- begin phân trang  -->
          <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
                         [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate" (nzPageIndexChange)="changePageIndex($event)"
                         (nzPageSizeChange)="changePageSize($event)">
            <ng-template #rangeTemplate let-range="range" let-total>
              {{ range[0] }}-{{ range[1] }} of {{ total }} items
            </ng-template>
          </nz-pagination>
          <!-- end phân trang  -->
        </div>
      </div>
    </div>
  </nz-card>

</div>
