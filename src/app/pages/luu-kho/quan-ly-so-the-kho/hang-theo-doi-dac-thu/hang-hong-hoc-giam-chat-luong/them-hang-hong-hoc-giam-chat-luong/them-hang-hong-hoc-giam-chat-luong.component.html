<nz-affix [nzOffsetTop]="globals.prop.MENU_LV2" class="btn-affix">
  <div class="btn-group">
    <button type="button" class="btn btn-sub" (click)="huy()">
      <i class="fa fa-arrow-left"></i>
      <span>Quay lại</span>
    </button>
    <button
            class="btn btn-main btn-sm waves-effect waves-light" (click)="luu()">
      <i class="icon htvbdh_tcdt_save"></i>
      <span>Lưu</span>
    </button>
  </div>
</nz-affix>
<div class="bg-trang">
  <div class="header-detail-tab">
    <div class="title-chi-tieu">
      <span
        [ngClass]="formData.value.trangThai == globals.prop.NHAP_DA_BAN_HANH_QD ? 'da-ban-hanh' : 'du-thao-va-lanh-dao-duyet'">
        {{ formData.value.tenTrangThai }}
      </span>
      <span>Hàng hỏng hóc,giảm chất lượng do nguyên nhân bất khả kháng</span>
    </div>
  </div>
  <br>
  <nz-card class="mt16 flex-card p-lr16">
    <form [nzLayout]="'vertical'" nz-form [formGroup]="formData" class="hang-theo-doi-dac-thu">
      <div class="search__body" nz-row [nzGutter]="24">
        <nz-form-item nz-col nzSpan="4" class="form-item">
          <nz-form-label nzFor="loai-hang-hoa">Đơn vị</nz-form-label>
          <nz-form-control >
            <nz-input-group>
              <nz-select  nzAllowClear formControlName="maDonVi" (ngModelChange)="onChangChiCuc($event)" >
                <nz-option *ngFor="let p of danhSachChiCuc" [nzValue]="p.maDvi" [nzLabel]="p.tenDvi">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item nz-col nzSpan="4" class="form-item">
          <nz-form-label nzFor="ngay-tao">Ngày tạo danh sách</nz-form-label>
          <nz-form-control >
            <nz-date-picker [nzDisabled]="true" formControlName="ngayTao" nzFormat="dd/MM/yyyy" id="ngay-tao" class="search__input">
            </nz-date-picker>
          </nz-form-control>
        </nz-form-item>
      </div>

      <ng-template #suffixIconOpenFolder>
        <i nz-icon nzType="folder-open"></i>
      </ng-template>
    </form>
  </nz-card>

  <nz-card class="mt-16 flex-card data-table card-border-content">
    <nz-table #editRowTable [nzData]="dataTable" [nzFrontPagination]="false" [nzShowPagination]="false" nzBordered [nzScroll]=
      "{ x: '2200px' }">
      <thead>
        <tr>
          <th class="text-center" style="width: 5%;">STT</th>
          <th style="width: 10%;">Loại hàng hoá</th>
          <th style="width: 10%;">Chủng loại hàng hoá</th>
          <th style="width: 10%;">Tên hàng hoá</th>
          <th style="width: 10%;">Điểm kho</th>
          <th style="width: 10%;">Nhà kho</th>
          <th style="width: 10%;">Ngăn kho</th>
          <th style="width: 10%;">Lô kho</th>
          <th style="width: 10%;">Số lượng tồn</th>
          <th style="width: 10%;">Số lượng thanh lý</th>
          <th style="width: 8%;">Đơn vị tính</th>
          <th style="width: 30%;">Lý do</th>
          <th style="width: 10%;" nzRight>Hành động</th>
        </tr>
        <tr>
          <th></th>
          <th>
            <nz-form-control>
              <nz-select  [(ngModel)]="rowItem.loaiVthh" (ngModelChange)="changeLoaiHangHoa($event)">
                <nz-option *ngFor="let item of dsLoaiHangHoa" nzValue="{{item.ma}}" nzLabel="{{item.ten}}">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </th>
          <th>
            <nz-form-control>
              <nz-select [(ngModel)]="rowItem.cloaiVthh">
                <nz-option *ngFor="let item of listChungLoaiHangHoa" nzValue="{{item.ma}}" nzLabel="{{item.ten}}">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </th>
          <th>
            <nz-input-group>
              <input type="text" [(ngModel)]="rowItem.tenLoaiVthh" nz-input placeholder="Nhập tên hàng hoá" />
            </nz-input-group>
          </th>
          <th>
            <nz-input-group>
              <nz-select [(ngModel)]="rowItem.maDiemKho" placeholder="Nhập điểm kho" (ngModelChange)="onChangeDiemKho($event)">
                <nz-option nzValue="null" nzDisabled nzHide></nz-option>
                <nz-option nzValue="{{item.maDvi}}" nzLabel="{{item.tenDvi}}" *ngFor="let item of dsDiemKho">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </th>
          <th>
            <nz-input-group>
              <nz-select [(ngModel)]="rowItem.maNhaKho" placeholder="Nhập nhà kho" (ngModelChange)="onChangeNhaKho($event)">
                <nz-option nzValue="null" nzDisabled nzHide></nz-option>
                <nz-option *ngFor="let p of dsNhaKho" [nzValue]="p.maDvi" [nzLabel]="p.tenDvi">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </th>
          <th>
            <nz-input-group>
              <nz-select [(ngModel)]="rowItem.maNganKho" placeholder="Nhập nhà kho" (ngModelChange)="onChangeNganKho($event)">
                <nz-option nzValue="null" nzDisabled nzHide></nz-option>
                <nz-option *ngFor="let p of dsNganLo" [nzValue]="p.maDvi" [nzLabel]="p.tenDvi">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </th>
          <th>
            <nz-input-group>
              <nz-select [(ngModel)]="rowItem.maLoKho" placeholder="Nhập ngăn lô">
                <nz-option nzValue="null" nzDisabled nzHide></nz-option>
                <nz-option *ngFor="let p of dsLoKho" [nzValue]="p.maDvi" [nzLabel]="p.tenDvi">
                </nz-option>
              </nz-select>
            </nz-input-group>
          </th>
          <th>
            <nz-input-group>
              <input type="number" [(ngModel)]="rowItem.soLuongTon" nz-input placeholder="Nhập số lượng" />
            </nz-input-group>
          </th>
          <th>
            <nz-input-group>
              <input type="number" [(ngModel)]="rowItem.soLuongThanhLy" nz-input placeholder="Nhập số lượng" />
            </nz-input-group>
          </th>
          <th>
            <nz-input-group>
              <input type="text" [(ngModel)]="rowItem.donVi" nz-input [readonly]="true"/>
            </nz-input-group>
          </th>
          <th>
            <nz-input-group>
              <input type="text" [(ngModel)]="rowItem.lyDo" nz-input placeholder="Nhập lý do" />
            </nz-input-group>
          </th>
          <th style="text-align: center;" nzRight>
            <a (click)="themMoiItem()">
              <i class="table-icon icon htvbdh_dau-cong"></i>
            </a>
            <a (click)="clearData()">
              <i class="table-icon icon  htvbdh_nhap-lai1"></i>
            </a>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of editRowTable.data; let idx = index">
          <ng-container *ngIf="!dataEdit[data.id].edit; else editTemplate">
            <td>{{ idx + 1 }}</td>
            <td>{{ data.tenLoaiVthh}}</td>
            <td>{{ data.tenLoaiVthh}}</td>
            <td>{{ data.tenLoaiVthh}}</td>
            <td>{{ data.tenLoaiVthh}}</td>
            <td>{{ data.tenLoaiVthh}}</td>
            <td>{{ data.tenLoaiVthh}}</td>
            <td>{{ data.soLuongTon }}</td>
            <td>{{ data.soLuongThanhLy }}</td>
            <td>{{ data.donVi }}</td>
            <td>{{ data.lyDo }}</td>
            <td style="text-align: center;" nzRight>
              <a (click)="editItem(data.id)">
                <i class="table-icon fa fa-pencil"></i>
              </a>
              <a (click)="xoaItem(data.id)">
                <i class="table-icon fa fa-trash-o do"></i>
              </a>
            </td>
          </ng-container>
          <ng-template #editTemplate>
<!--            <td>-->
<!--              <input type="text" nz-input [(ngModel)]="dataEdit[data.id].data.tenLoaiHang" />-->
<!--            </td>-->
<!--            <td><input type="text" nz-input [(ngModel)]="dataEdit[data.id].data.tenHangHoa" /></td>-->
<!--            <td><input type="text" nz-input [(ngModel)]="dataEdit[data.id].data.tenDiemKho" /></td>-->
<!--            <td><input type="text" nz-input [(ngModel)]="dataEdit[data.id].data.tenNhaKho" /></td>-->
<!--            <td><input type="text" nz-input [(ngModel)]="dataEdit[data.id].data.tenNganLo" /></td>-->
<!--            <td><input type="number" nz-input [(ngModel)]="dataEdit[data.id].data.soLuongTon" /></td>-->
<!--            <td><input type="number" nz-input [(ngModel)]="dataEdit[data.id].data.soLuongThanhLy" /></td>-->
<!--            <td><input type="number" nz-input [(ngModel)]="dataEdit[data.id].data.donVi" /></td>-->
<!--            <td><input type="number" nz-input [(ngModel)]="dataEdit[data.id].data.lyDo" /></td>-->

<!--            <td>-->
<!--              <a (click)="luuEdit(data.id)" class="save">Lưu</a>-->
<!--              <a (click)="huyEdit(data.id)">Huỷ bỏ</a>-->
<!--            </td>-->
          </ng-template>
        </tr>
      </tbody>
    </nz-table>
    <div class="tab-content tab-menu" id="myTabContent">
      <div class="tab-pane fade show active justify-content-between">
        <div class="trai">

        </div>
        <div class="canphai">
          <nz-pagination class="pagination-card" [nzPageIndex]="page" [nzTotal]="totalRecord" nzShowSizeChanger
            [nzPageSize]="pageSize" [nzShowTotal]="rangeTemplate" (nzPageIndexChange)="changePageIndex($event)"
            (nzPageSizeChange)="changePageSize($event)">
            <ng-template #rangeTemplate let-range="range" let-total>
              {{ range[0] }}-{{ range[1] }} of {{ total }} items
            </ng-template>
          </nz-pagination>
        </div>
      </div>
    </div>
  </nz-card>
</div>
