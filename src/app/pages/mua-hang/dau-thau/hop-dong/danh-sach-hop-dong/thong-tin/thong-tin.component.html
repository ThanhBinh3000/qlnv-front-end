<div class="luong-thuc__danh-sach chi-tiet-hop-dong" *ngIf="!isViewPhuLuc">
  <nz-affix class="menu-lv3 dieu-chinh-button" [nzOffsetTop]="43">
    <div class="contentBor chi-tieu__body">
      <div class="contentDetail">
        <div class="thong-tin-de-xuat-khlcnt">
          <div class="tab-content tab-menu" id="myTabContent">
            <div class="tab-pane fade show active justify-content-between" id="banhanh" role="tabpanel"
              aria-labelledby="banhanh-tab">
              <div class="trai">
              </div>
              <div class="canphai phai">
                <button class="btn btn-main btn-sm waves-effect waves-light" (click)="save(false)"
                  *ngIf="(detail.trangThai == '00' || detail.trangThai == '03' || id == 0) && !isView">
                  <i class="icon  htvbdh_tcdt_save"></i>
                  <span>Lưu</span>
                </button>
                <button class="btn btn-outline-grey btn-sm waves-effect waves-light"
                  *ngIf="(detail.trangThai == '00' || detail.trangThai == '03' || id == 0) && !isView">
                  <i class="icon htvbdh_trinh"></i>
                  <span>Trình duyệt</span>
                </button>
                <button class="btn btn-outline-grey btn-sub btn-sm waves-effect waves-light"
                  *ngIf="detail.trangThai == '01' && !isView">
                  <i class="icon  htvbdh_da-xu-ly"></i>
                  <span>Hoàn thành</span>
                </button>
                <button class="btn btn-outline-grey btn-sm waves-effect waves-light"
                  *ngIf="detail.trangThai == '04' && !isView">
                  <i class="icon htvbdh_dakyduyet"></i>
                  <span>Duyệt</span>
                </button>
                <a class="btn btn-outline-grey btn-sm waves-effect waves-light"
                  *ngIf="detail.trangThai == '04' && !isView">
                  <i class="icon htvbdh_tcdt_tuchoi"></i>
                  <span>Từ chối</span>
                </a>
                <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="back()">
                  <span>Quay về</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nz-affix>
  <div class="contentBor chi-tieu__body">
    <div class="contentDetail">
      <div class="main-content thong-tin-de-xuat-khlcnt">
        <div class="thong-tin-chi-tieu">
          <div class="title-chi-tieu hop-dong-title">
            <span [ngClass]="thongTinTrangThai(detail.trangThai)">Dự thảo</span>
            <span>Căn cứ kết quả LCNT</span>
          </div>
          <div class="flex-card p-lr16">
            <div nz-row [nzGutter]="[16, 12]">
              <div nz-col [nzSpan]="6">
                <nz-form-item>
                  <nz-form-label [nzNoColon]="true"> Căn cứ </nz-form-label>
                  <nz-input-group nzAddOnAfterIcon="folder-open" (click)="openDialogKQLCNT()">
                    <input nz-input [readonly]="true" [(ngModel)]="detail.canCu" />
                  </nz-input-group>
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="18">
                <nz-form-item>
                  <nz-form-label [nzNoColon]="true"> Gói thầu </nz-form-label>
                  <nz-select [(ngModel)]="detail.goiThau">
                    <nz-option *ngFor="let item of listGoiThau" [nzValue]="item.value" [nzLabel]="item.text">
                    </nz-option>
                  </nz-select>
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="6">
                <nz-form-item>
                  <nz-form-label [nzNoColon]="true"> Số hợp đồng </nz-form-label>
                  <input nz-input placeholder="Số hợp đồng" [(ngModel)]="detail.soHd" />
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="12">
                <nz-form-item>
                  <nz-form-label [nzNoColon]="true"> Tên hợp đồng </nz-form-label>
                  <input nz-input placeholder="Tên hợp đồng" [(ngModel)]="detail.tenHd" />
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="6">
                <nz-form-item>
                  <nz-form-label [nzNoColon]="true">Ngày ký</nz-form-label>
                  <nz-date-picker class="search__input" nzFormat="yyyy-MM-dd" nzPlaceHolder="Ngày ký"
                    [(ngModel)]="detail.ngayKy">
                  </nz-date-picker>
                </nz-form-item>
              </div>
            </div>
          </div>
        </div>
        <div class="tab__luong-thuc">
          <nz-tabset nzType="card" class="tab-level-3">
            <nz-tab [nzTitle]="'Thông tin chung'" class="tt-chung__container"
              (nzClick)="tabSelected = 'thong-tin-chung'">
              <div nz-row [nzGutter]="[16, 6]">
                <div nz-col [nzSpan]="12">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true">
                      Ngày hiệu lực
                    </nz-form-label>
                    <nz-range-picker placeholder="Ngày hiệu lực" nzFormat="dd/MM/yyyy" [(ngModel)]="detail.ngayHieuLuc"
                      (ngModelChange)="changeDateThucHien()">
                    </nz-range-picker>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Số ngày thực hiện </nz-form-label>
                    <input nz-input [readonly]="true" placeholder="Số ngày thực hiện"
                      [(ngModel)]="detail.soNgayThien" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true">Loại hàng DTQG</nz-form-label>
                    <input nz-input [readonly]="true" placeholder="Số ngày thực hiện" [(ngModel)]="loaiStr" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true">Chủng loại hàng hóa</nz-form-label>
                    <input nz-input [readonly]="true" placeholder="Số ngày thực hiện" [(ngModel)]="loaiStr" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Số lượng (kg) </nz-form-label>
                    <input nz-input [readonly]="true" placeholder="Số lượng (tấn)" [(ngModel)]="detail.soLuong"
                      (input)="caculatorSauVAT()" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Đơn giá gồm thuế (đ/kg) </nz-form-label>
                    <nz-input-number type="text" nz-input [nzSize]="'small'" [nzMin]="0" (input)="caculatorSauVAT()"
                      [nzMax]="globals.prop.MAX_INPUT" [(ngModel)]="detail.donGiaVat"></nz-input-number>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Giá trị hợp đồng sau thuế </nz-form-label>
                    <nz-input-number type="text" nz-input [nzSize]="'small'" [nzMin]="0"
                      [nzMax]="globals.prop.MAX_INPUT" [(ngModel)]="detail.gtriHdSauVat" disabled></nz-input-number>
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <button class="btn btn-sm waves-effect waves-light btn-file-dinh-kem">
                    <i class="icon htvbdh_tcdt_tep"></i>
                    <span>Tài liệu đính kèm</span>
                  </button>
                </div>
                <div nz-col [nzSpan]="6">
                  <button class="btn btn-download-file btn-sm waves-effect waves-light">
                    <i class="icon htvbdh_tcdt_import"></i>
                    <span>Tải file</span>
                  </button>
                </div>
              </div>
              <div class="title-tab">Thông tin chủ đầu tư</div>
              <div nz-row [nzGutter]="[16, 6]">
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Tên đơn vị DTNN </nz-form-label>
                    <input nz-input [readonly]="true" placeholder="Tên đơn vị DTNN" [(ngModel)]="detailChuDauTu.ten" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="12">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Địa chỉ </nz-form-label>
                    <input nz-input placeholder="Địa chỉ" [(ngModel)]="detailChuDauTu.diaChi" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Mã số thuế </nz-form-label>
                    <input nz-input placeholder="Mã số thuế" [(ngModel)]="detailChuDauTu.mst" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Số điện thoại </nz-form-label>
                    <input nz-input placeholder="Số điện thoại" [(ngModel)]="detailChuDauTu.sdt" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Số tài khoản </nz-form-label>
                    <input nz-input placeholder="Số tài khoản" [(ngModel)]="detailChuDauTu.stk" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="12">
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Tên người đại diện </nz-form-label>
                    <input nz-input placeholder="Tên người đại diện" [(ngModel)]="detailChuDauTu.tenNguoiDdien" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Chức vụ </nz-form-label>
                    <input nz-input placeholder="Chức vụ" [(ngModel)]="detailChuDauTu.chucVu" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="12">
                </div>
              </div>
              <div class="title-tab">Thông tin đơn vị cung cấp</div>
              <div nz-row [nzGutter]="[16, 6]">
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Tên đơn vị thực hiện </nz-form-label>
                    <input nz-input placeholder="Tên đơn vị thực hiện" [(ngModel)]="detailDviCungCap.ten" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="12">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Địa chỉ </nz-form-label>
                    <input nz-input placeholder="Địa chỉ" [(ngModel)]="detailDviCungCap.diaChi" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Mã số thuế </nz-form-label>
                    <input nz-input placeholder="Mã số thuế" [(ngModel)]="detailDviCungCap.mst" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Số điện thoại </nz-form-label>
                    <input nz-input placeholder="Số điện thoại" [(ngModel)]="detailDviCungCap.sdt" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Số tài khoản </nz-form-label>
                    <input nz-input placeholder="Số tài khoản" [(ngModel)]="detailDviCungCap.stk" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="12">
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Tên người đại diện </nz-form-label>
                    <input nz-input placeholder="Tên người đại diện" [(ngModel)]="detailDviCungCap.tenNguoiDdien" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="6">
                  <nz-form-item>
                    <nz-form-label [nzNoColon]="true"> Chức vụ </nz-form-label>
                    <input nz-input placeholder="Chức vụ" [(ngModel)]="detailDviCungCap.chucVu" />
                  </nz-form-item>
                </div>
                <div nz-col [nzSpan]="12">
                </div>
              </div>
            </nz-tab>
            <nz-tab [nzTitle]="'Bảng giá chi tiết hợp đồng'" class="ds-goi-thau__container"
              (nzClick)="tabSelected = 'bang-gia'">
              <nz-card class="flex-card p-lr16">
                <nz-table #editRowTable nzBordered [nzData]="detail?.bangGia" [nzFrontPagination]="false"
                  [nzShowPagination]="false">
                  <thead>
                    <tr>
                      <th [width]="35">STT</th>
                      <th>Tên gói thầu</th>
                      <th width="175px">Số hiệu gói thầu</th>
                      <th width="175px">Số lượng</th>
                      <th width="175px">Đơn giá (Trước thuế)</th>
                      <th width="175px">Thuế</th>
                      <th width="175px">Giá trước thuế</th>
                      <th width="175px">Giá sau thuế</th>
                      <th width="175px" class="text-right"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of editRowTable.data; let i = index" class="editable-row">
                      <td>{{ i + 1 }}</td>
                      <td>{{ data.tenGthau }}</td>
                      <td>{{ data.shgt }}</td>
                      <td>{{ data.soLuong | number: '1.0-1' }}</td>
                      <td>{{ data.donGia | number: '1.0-1' }}</td>
                      <td>{{ data.vat | number: '1.0-1' }}</td>
                      <td>{{ data.giaTruocVat | number: '1.0-1' }}</td>
                      <td>{{ data.giaSauVat | number: '1.0-1' }}</td>
                      <td class="text-right">
                        <a (click)="openDialogBang(data)">
                          <i class="fa fa-pencil"></i>
                        </a>
                        <a>
                          <i class="fa fa-trash-o do"></i>
                        </a>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </nz-card>
            </nz-tab>
            <nz-tab [nzTitle]="'Danh sách phụ lục hợp đồng'" class="ds-goi-thau__container"
              (nzClick)="tabSelected = 'phu-luc'">
              <nz-card class="mt16 flex-card p-lr16">
                <nz-table #editRowTable nzBordered [nzData]="detail?.phuLuc" [nzFrontPagination]="false"
                  [nzShowPagination]="false">
                  <thead>
                    <tr>
                      <th [width]="35">STT</th>
                      <th>Số phụ lục hợp đồng</th>
                      <th width="300px">Ngày ký</th>
                      <th width="300px">Thời gian hết hiệu lực</th>
                      <th width="300px">Giá tri phụ lục</th>
                      <th width="300px">Trạng thái</th>
                      <th width="175px" class="text-right"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of editRowTable.data; let i = index" class="editable-row">
                      <td>{{ i + 1 }}</td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td class="text-right">
                        <a (click)="redirectPhuLuc(data.id)">
                          <i class="fa fa-pencil"></i>
                        </a>
                        <a>
                          <i class="fa fa-trash-o do"></i>
                        </a>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </nz-card>
            </nz-tab>
          </nz-tabset>
          <div class="action" *ngIf="tabSelected == 'phu-luc'">
            <button type="button" class="btn btn-main" (click)="redirectPhuLuc(0)">
              <i class="icon htvbdh_dau-cong"></i>
              <span>Thêm</span>
            </button>
          </div>
          <nz-form-item>
            <nz-form-label nzRequired [nzNoColon]="true">
              Ghi chú
            </nz-form-label>
            <textarea nz-input [rows]="3" [(ngModel)]="detail.ghiChu" (input)="validateGhiChu()"></textarea>
            <span class="error-text" *ngIf="errorGhiChu">{{errorInputRequired}}</span>
          </nz-form-item>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="chi-tiet" *ngIf="isViewPhuLuc">
  <app-phu-luc [isViewPhuLuc]="isViewPhuLuc" [idPhuLuc]="idPhuLuc" [typeVthh]="typeVthh"
    (showChiTietEvent)="showChiTiet()"></app-phu-luc>
</div>