<div class="bg-trang">
  <div class="header header-green-background">
    <div class="header-text">
      <div class="title-chi-tieu">
        <span
          [ngClass]="formData.value.trangThai == STATUS.BAN_HANH ? 'status-xanh' : 'status-do'">
          {{ formData.value.tenTrangThai }}
        </span>
        <span>Báo cáo nguồn hình thành dự trữ quốc gia</span>
      </div>
    </div>
    <div class="btn-group">
      <button type="button" class="btn btn-sub" (click)="quayLai()">
        <i class="fa fa-arrow-left"></i>
        <span>Quay lại</span>
      </button>
      <ng-container>
        <button *ngIf="formData.value.trangThai == STATUS.DU_THAO
        && userService.isAccessPermisson('BCBN_LAPBAOCAO_TT130_NHTDTQG_DUYET')"
          type="button" class="btn btn-sub xanh-nhat" (click)="guiDuyet(idInput)">
          <i class="icon htvbdh_tcdt_pheduyet"></i>
          <span>Ban hành</span>
        </button>
        <button *ngIf="formData.value.trangThai == STATUS.DU_THAO && !isView && userService.isAccessPermisson('BCBN_LAPBAOCAO_TT130_NHTDTQG_LAP')"
          type="button" class="btn btn-main" (click)="save()">
          <i class="icon htvbdh_tcdt_save"></i>
          <span>Lưu</span>
        </button>
      </ng-container>
    </div>
  </div>
<nz-card class="mg-t-16 flex-card p-lr16">
  <div class="header header-green-background mg-t-16">
    <div class="header-text">
      <div class="title-chi-tieu">
        <span></span>
        <span>Thông tin chung</span>
      </div>
    </div>
  </div>
  <form nzLayout="vertical" nz-form [formGroup]="formData">
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="4">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true"> Thông tư số</nz-form-label>
          <nz-form-control>
            <nz-input-group>
              <input nz-input readonly formControlName="thongTuSo" />
            </nz-input-group>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="4">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true"> Biểu số</nz-form-label>
          <nz-form-control>
            <nz-input-group>
              <input nz-input readonly formControlName="bieuSo" />
            </nz-input-group>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true"> Đơn vị gửi báo cáo</nz-form-label>
          <nz-form-control>
            <nz-input-group>
              <input nz-input readonly formControlName="tenDonViGui" />
            </nz-input-group>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true"> Đơn vị nhận báo cáo</nz-form-label>
          <nz-form-control>
            <nz-input-group>
              <input nz-input readonly formControlName="tenDonViNhan" />
            </nz-input-group>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="4">
        <nz-form-item>
          <nz-form-label nzRequired [nzNoColon]="true"> Thời gian tạo</nz-form-label>
          <nz-form-control nz-col [nzSpan]="24" [nzErrorTip]="error">
            <nz-date-picker nzDisabled formControlName="ngayTao" nzFormat="dd/MM/yyyy">
            </nz-date-picker>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="4">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true" class="label-color-kh"> Năm báo cáo
          </nz-form-label>
          <nz-select formControlName="namBc" [nzDisabled]="isView">
            <nz-option *ngFor="let p of listNam" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
          </nz-select>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="4">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true" class="label-color-kh"> Kỳ báo cáo
          </nz-form-label>
          <nz-select formControlName="kyBc" [nzDisabled]="isView">
            <nz-option *ngFor="let p of listQuy" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
          </nz-select>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="4">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true" class="label-color-kh"> Loại báo cáo
          </nz-form-label>
          <nz-select formControlName="loaiBc" (ngModelChange)="changeLoaiBc($event)" [nzDisabled]="isView">
            <nz-option *ngFor="let p of listLoaiBc" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
          </nz-select>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label [nzNoColon]="true"> Thời hạn gửi báo cáo</nz-form-label>
          <nz-form-control>
            <nz-input-group>
              <input nz-input readonly formControlName="thoiHanGuiBc" />
            </nz-input-group>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </form>
</nz-card>
<div class="group-button">
  <h3>DANH SÁCH BÁO CÁO NGUỒN HÌNH THÀNH DỰ TRỮ QUỐC GIA</h3>
  <div class="buttons">
    <button
            type="button" class="btn btn-sub xanh-nhat" (click)="downloadTemplate(templateName)">
      <i class="icon htvbdh_download2"></i>
      <span>Tải biểu mẫu import dữ liệu</span>
    </button>
    <input type="file" (change)="handleSelectFile($event)"/>
  </div>
</div>
<nz-card class="mt-2px flex-card data-table card-border-content table-card">
  <nz-table class="nowrap" [nzData]="dataTable" [nzFrontPagination]="false"
            [nzShowPagination]="false" nzBordered>
    <thead>
    <tr>
      <th rowSpan="3" class="text-center" style="width: 15%">Nội dung</th>
      <th rowSpan="3" class="text-center" style="width: 5%">Mã số</th>
      <th colSpan="5" class="text-center" style="width: 30%">Nguồn hình thành DTQG trong kỳ (tỷ đồng)</th>
      <th colSpan="5" class="text-center" style="width: 30%">Lũy kế từ đầu năm (tỷ đồng)</th>
      <th rowSpan="3" class="text-center multi-line" style="width: 10%">Tỷ lệ (%) tổng dự toán chi DTQG so với GDP cùng
        kỳ
      </th>
      <th rowSpan="3" class="text-center" style="width: 10%">Hành động</th>
    </tr>
    <tr>
      <th colSpan="4" class="text-center">Dự toán NSNN chi cho mua hàng DTQG</th>
      <th rowSpan="2" class="text-center">Tổng</th>
      <th colSpan="4" class="text-center">Dự toán NSNN chi cho mua hàng DTQG</th>
      <th rowSpan="2" class="text-center">Tổng</th>
    </tr>
    <tr>
      <th class="text-center">Mua tăng</th>
      <th class="text-center">Mua bù</th>
      <th class="text-center">Mua bổ sung</th>
      <th class="text-center">Mua khác</th>
      <th class="text-center">Mua tăng</th>
      <th class="text-center">Mua bù</th>
      <th class="text-center">Mua bổ sung</th>
      <th class="text-center">Mua khác</th>
    </tr>
    <tr class="grey-bg">
      <th class="text-center">A</th>
      <th class="text-center">B</th>
      <th class="text-center">1</th>
      <th class="text-center">2</th>
      <th class="text-center">3</th>
      <th class="text-center">4</th>
      <th class="text-center">5</th>
      <th class="text-center">6</th>
      <th class="text-center">7</th>
      <th class="text-center">8</th>
      <th class="text-center">9</th>
      <th class="text-center">10</th>
      <th class="text-center">11</th>
      <th class="text-center"></th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let data of dataNguonNsnn; let i = index" class="bold-first-child">
      <ng-container *ngIf="!data.edit; else editTemplate">
        <td>{{ data.noiDung }}</td>
        <td>{{ data.maSo }}</td>
        <td>{{ data.muaTangTrongKy }}</td>
        <td>{{ data.muaBuTrongKy }}</td>
        <td>{{ data.muaBsungTrongKy }}</td>
        <td>{{ data.khacTrongKy }}</td>
        <td>{{ data.tongTrongKy }}</td>
        <td>{{ data.muaTangLuyKe }}</td>
        <td>{{ data.muaBuLuyKe }}</td>
        <td>{{ data.muaBsungLuyKe }}</td>
        <td>{{ data.khacLuyKe }}</td>
        <td>{{ data.tongLuyKe }}</td>
        <td>{{ data.tiLe }}</td>
        <td>
          <a (click)="editRowNguon(i)" *ngIf="!isView">
            <i class=" fa fa-pencil"></i>
          </a>
          <a (click)="deleteRowNguon(i)" *ngIf="!isView">
            <i class=" fa fa-trash-o do"></i>
          </a>
        </td>
      </ng-container>
      <ng-template #editTemplate>
        <td><input nz-input [(ngModel)]="itemRowNguonEdit[i].noiDung" /></td>
        <td><input nz-input [(ngModel)]="itemRowNguonEdit[i].maSo" /></td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNguonEdit[i].muaTangTrongKy"></nz-input-number>
        </td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNguonEdit[i].muaBuTrongKy"></nz-input-number>
        </td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNguonEdit[i].muaBsungTrongKy"></nz-input-number>
        </td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNguonEdit[i].khacTrongKy"></nz-input-number>
        </td>
        <td></td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNguonEdit[i].muaTangLuyKe"></nz-input-number>
        </td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNguonEdit[i].muaBuLuyKe"></nz-input-number>
        </td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNguonEdit[i].muaBsungLuyKe"></nz-input-number>
        </td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNguonEdit[i].khacLuyKe"></nz-input-number>
        </td>
        <td></td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNguonEdit[i].tiLe"></nz-input-number>
        </td>
        <td>
          <a (click)="saveEditRowNguon(i)">
            <i class="icon htvbdh_tcdt_save"></i>
          </a>
          <a (click)="cancelEditRowNguon(i)">
            <i class="fa fa-ban do"></i>
          </a>
        </td>
      </ng-template>
    </tr>
    <tr *ngIf="!isView">
      <td><input nz-input [(ngModel)]="itemRowNguon.noiDung" /></td>
      <td><input nz-input [(ngModel)]="itemRowNguon.maSo" /></td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNguon.muaTangTrongKy"></nz-input-number>
      </td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNguon.muaBuTrongKy"></nz-input-number>
      </td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNguon.muaBsungTrongKy"></nz-input-number>
      </td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNguon.khacTrongKy"></nz-input-number>
      </td>
      <td></td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNguon.muaTangLuyKe"></nz-input-number>
      </td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNguon.muaBuLuyKe"></nz-input-number>
      </td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNguon.muaBsungLuyKe"></nz-input-number>
      </td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNguon.khacLuyKe"></nz-input-number>
      </td>
      <td></td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNguon.tiLe"></nz-input-number>
      </td>
      <td>
        <a (click)="addRowNguon()" [class.disabled]="!itemRowNguon">
          <i class="fa fa-plus"></i>
        </a>
        <a (click)="clearItemRow()">
          <i class="fa fa-refresh"></i>
        </a>
      </td>
    </tr>
    <tr *ngFor="let data of dataNguonNgoaiNsnn; let i = index" class="bold-first-child">
      <ng-container *ngIf="!data.edit; else editNnTemplate">
        <td>{{ data.noiDung }}</td>
        <td>{{ data.maSo }}</td>
        <td>{{ data.muaTangTrongKy }}</td>
        <td>{{ data.muaBuTrongKy }}</td>
        <td>{{ data.muaBsungTrongKy }}</td>
        <td>{{ data.khacTrongKy }}</td>
        <td>{{ data.tongTrongKy }}</td>
        <td>{{ data.muaTangLuyKe }}</td>
        <td>{{ data.muaBuLuyKe }}</td>
        <td>{{ data.muaBsungLuyKe }}</td>
        <td>{{ data.khacLuyKe }}</td>
        <td>{{ data.tongLuyKe }}</td>
        <td>{{ data.tiLe }}</td>
        <td>
          <a (click)="editRowNgoaiNguon(i)" *ngIf="!isView">
            <i class=" fa fa-pencil"></i>
          </a>
          <a (click)="deleteRowNgoaiNguon(i)" *ngIf="!isView">
            <i class=" fa fa-trash-o do"></i>
          </a>
        </td>
      </ng-container>
      <ng-template #editNnTemplate>
        <td><input nz-input [(ngModel)]="itemRowNgoaiNguonEdit[i].noiDung" /></td>
        <td><input nz-input [(ngModel)]="itemRowNgoaiNguonEdit[i].maSo" /></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNgoaiNguonEdit[i].tongTrongKy"></nz-input-number>
        </td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNgoaiNguonEdit[i].tongLuyKe"></nz-input-number>
        </td>
        <td>
          <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                           [(ngModel)]="itemRowNgoaiNguonEdit[i].tiLe"></nz-input-number>
        </td>
        <td>
          <a (click)="saveEditRowNgoaiNguon(i)">
            <i class="icon htvbdh_tcdt_save"></i>
          </a>
          <a (click)="cancelEditRowNgoaiNguon(i)">
            <i class="fa fa-ban do"></i>
          </a>
        </td>
      </ng-template>
    </tr>
    <tr *ngIf="!isView">
      <td><input nz-input [(ngModel)]="itemRowNgoaiNguon.noiDung" /></td>
      <td><input nz-input [(ngModel)]="itemRowNgoaiNguon.maSo" /></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNgoaiNguon.tongTrongKy"></nz-input-number>
      </td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNgoaiNguon.tongLuyKe"></nz-input-number>
      </td>
      <td>
        <nz-input-number [nzMin]="0" [nzFormatter]="globals.formatter" [nzParser]="globals.parser"
                         [(ngModel)]="itemRowNgoaiNguon.tiLe"></nz-input-number>
      </td>
      <td>
        <a (click)="addRowNgoaiNguon()" [class.disabled]="!itemRowNgoaiNguon">
          <i class="fa fa-plus"></i>
        </a>
        <a (click)="clearItemRowNn()">
          <i class="fa fa-refresh"></i>
        </a>
      </td>
    </tr>
    <tr>
      <td class="first-last-row-table background-last-row text-right">Tổng</td>
      <td class="text-center"></td>
      <td class="text-center">X</td>
      <td class="text-center">X</td>
      <td class="text-center">X</td>
      <td class="text-center">X</td>
      <td class="text-center"></td>
      <td class="text-center">X</td>
      <td class="text-center">X</td>
      <td class="text-center">X</td>
      <td class="text-center">X</td>
      <td class="text-center"></td>
      <td class="text-center"></td>
      <td class="text-center"></td>
    </tr>
    </tbody>
  </nz-table>
  <label><span style="color: red">* </span> Ghi chú</label>
  <textarea rows="3" readonly nz-input [(ngModel)]="ghiChu"></textarea>
</nz-card>
</div>
<ng-template #error let-control>
  <ng-container *ngIf="control.hasError('required')">{{globals.prop.REQUIRED}}</ng-container>
</ng-template>
