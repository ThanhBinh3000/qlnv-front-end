<div nz-row nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzGutter="24">
  <div nz-col [nzSpan]="8">
    <nz-form-item>
      <nz-form-label nzRequired [nzNoColon]="true"> Cục DTNN KV </nz-form-label>
      <input nz-input [(ngModel)]="data.tenDvi" [readonly]="true" />
    </nz-form-item>
  </div>
</div>
<div nz-row nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzGutter="24">
  <div nz-col [nzSpan]="12">
    <nz-form-item>
      <nz-form-label nzRequired [nzNoColon]="true"> Tên dự án </nz-form-label>
      <input nz-input [(ngModel)]="data.tenDuAn" [readonly]="true" />
    </nz-form-item>
  </div>
  <div nz-col [nzSpan]="12">
    <nz-form-item>
      <nz-form-label nzRequired [nzNoColon]="true"> Đơn giá gồm VAT (đồng/kg) </nz-form-label>
      <input nz-input [(ngModel)]="data.donGia" [readonly]="true" />
    </nz-form-item>
  </div>
  <div nz-col [nzSpan]="24" class="mt-16">
    <div id="table-goi-thau">
      <nz-card nzTitle="Danh sách gói thầu" class="mt16 flex-card p-lr16 dialog-thong-tin-phu-luc">
        <nz-table #groupingTable #editRowTable nzBordered class="nowrap mt-16 flex-card p-lr16"
          [nzData]="data?.children" [nzFrontPagination]="false" [nzShowPagination]="false">
          <thead>
            <tr>
              <th rowspan="2" [width]="35" class="text-center">STT</th>
              <th rowspan="2" [width]="218" class="text-center">Gói thầu</th>
              <th colspan="3" [width]="300" class="text-center">ĐỊA ĐIỂM NHẬP KHO</th>
              <th rowspan="2" [width]="95" class="text-center">Số lượng (tấn)</th>
              <th rowspan="2" [width]="100" class="text-center">Đơn giá đã bao gồm VAT (đồng/kg)</th>
              <th rowspan="2" [width]="200" class="text-center">Thành tiền (đồng)</th>
              <th rowspan="2" [width]="80" class="text-center">Thao tác</th>
            </tr>
            <tr>
              <th class="text-center"> Tên chi cục </th>
              <th class="text-center"> Điểm kho </th>
              <th class="text-center"> Địa điểm kho </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of editRowTable.data; let i = index" class="editable-row">
              <ng-container *ngIf="!editCache[i]?.edit; else editTemplate">
                <td class="text-center">{{i+1}}</td>
                <td>{{ data.goiThau}}</td>
                <td>{{ data.maDvi }}</td>
                <td>{{ data.maDiemKho }}</td>
                <td>{{ data.diaDiemNhap }}</td>
                <td>{{ data.soLuong | number: '1.0-1' }}</td>
                <td>{{ data.donGia | number: '1.0-1' }}</td>
                <td>{{ data.soLuong * 1000 * data.donGia | number: '1.0-1' }}</td>
                <td class="text-center">
                  <a (click)="startEdit(i)">
                    <i class="fa fa-pencil"></i>
                  </a>
                  <a (click)="deleteRow(i)">
                    <i class="fa fa-trash-o do"></i>
                  </a>
                </td>
              </ng-container>
              <ng-template #editTemplate>
                <td class="text-center">{{i+1}}</td>
                <td>
                  <input type="text" [(ngModel)]="editCache[i].data.goiThau" nz-input name="goiThau" />
                </td>
                <td>
                  <nz-select [(ngModel)]="editCache[i].data.maDvi" (ngModelChange)="changeChiCuc($event,i)">
                    <nz-option *ngFor="let p of listChiCuc" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
                  </nz-select>
                </td>
                <td>
                  <nz-select [(ngModel)]="editCache[i].data.maDiemKho" (ngModelChange)="changeDiemKho(i)">
                    <nz-option *ngFor="let p of listDiemKho" [nzValue]="p.value" [nzLabel]="p.text"></nz-option>
                  </nz-select>
                </td>
                <td><input type="text" [(ngModel)]="editCache[i].data.diaDiemNhap" nz-input /> </td>
                <td>
                  <nz-input-number nz-input [(ngModel)]="editCache[i].data.soLuong" [nzMin]="1" [nzStep]="1"
                    [nzSize]="'small'">
                  </nz-input-number>
                </td>
                <td>
                  <nz-input-number nz-input [(ngModel)]="editCache[i].data.donGia" [nzMin]="1" [nzStep]="1"
                    [nzSize]="'small'">
                  </nz-input-number>
                </td>
                <td>
                  {{editCache[i].data.soLuong *
                  1000 *
                  editCache[i].data.donGia | number: '1.0-1'}}
                </td>
                <td class="text-center">
                  <a (click)="saveEdit(i)" class="save">
                    <i class="icon htvbdh_tcdt_save"></i>
                  </a>
                  <a (click)="cancelEdit(i)">
                    <i class="fa fa-ban do"></i>
                  </a>
                </td>
              </ng-template>
            </tr>
            <tr *ngIf="editRowTable.data.length > 0">
              <td colspan="5" class="background-last-row align-right">Tổng</td>
              <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 5, 1, ',','table-goi-thau') : 0) |
                number:
                '1.0-1'}}</td>
              <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 6, 1, ',','table-goi-thau') : 0) |
                number:
                '1.0-1'}}</td>
              <td class="background-last-row">{{ (tableExist ? reduceRowData(0, 7, 1, ',','table-goi-thau') : 0) |
                number:
                '1.0-1'}}</td>
              <td class="background-last-row"></td>
            </tr>
          </tbody>
        </nz-table>
      </nz-card>
    </div>
  </div>
  <div nz-col [nzSpan]="24" class="mt-16">
    <nz-form-item>
      <nz-form-label nzRequired [nzNoColon]="true">
        Ghi chú
      </nz-form-label>
      <textarea nz-input [rows]="3" [(ngModel)]="ghiChu" [readonly]="true"></textarea>
    </nz-form-item>
  </div>
</div>
<div class="modal-footer">
  <div class="nut">
    <div class="cantrai">
    </div>
    <div class="canphai">
      <a class="btn btn-outline-grey btn-sm waves-effect waves-light" (click)="onCancel()">
        <i aria-hidden="true" class="fa fa-sign-out"></i>
        Đóng
      </a>
    </div>
  </div>
</div>